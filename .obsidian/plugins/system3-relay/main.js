/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var _0=Object.create;var ba=Object.defineProperty;var v0=Object.getOwnPropertyDescriptor;var S0=Object.getOwnPropertyNames;var k0=Object.getPrototypeOf,I0=Object.prototype.hasOwnProperty;var L0=(o,e,t)=>e in o?ba(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Bi=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),lf=(o,e)=>{for(var t in e)ba(o,t,{get:e[t],enumerable:!0})},fh=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of S0(e))!I0.call(o,s)&&s!==t&&ba(o,s,{get:()=>e[s],enumerable:!(r=v0(e,s))||r.enumerable});return o};var vs=(o,e,t)=>(t=o!=null?_0(k0(o)):{},fh(e||!o||!o.__esModule?ba(t,"default",{value:o,enumerable:!0}):t,o)),C0=o=>fh(ba({},"__esModule",{value:!0}),o);var mt=(o,e,t)=>(L0(o,typeof e!="symbol"?e+"":e,t),t);var wa=Bi((KM,dh)=>{"use strict";function Jr(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function uh(o,e){for(var t="",r=0,s=-1,n=0,a,i=0;i<=o.length;++i){if(i<o.length)a=o.charCodeAt(i);else{if(a===47)break;a=47}if(a===47){if(!(s===i-1||n===1))if(s!==i-1&&n===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),s=i,n=0;continue}}else if(t.length===2||t.length===1){t="",r=0,s=i,n=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(s+1,i):t=o.slice(s+1,i),r=i-s-1;s=i,n=0}else a===46&&n!==-1?++n:n=-1}return t}function T0(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var on={resolve:function(){for(var e="",t=!1,r,s=arguments.length-1;s>=-1&&!t;s--){var n;s>=0?n=arguments[s]:(r===void 0&&(r=process.cwd()),n=r),Jr(n),n.length!==0&&(e=n+"/"+e,t=n.charCodeAt(0)===47)}return e=uh(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(Jr(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=uh(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return Jr(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];Jr(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":on.normalize(e)},relative:function(e,t){if(Jr(e),Jr(t),e===t||(e=on.resolve(e),t=on.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var s=e.length,n=s-r,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var i=t.length,l=i-a,f=n<l?n:l,u=-1,d=0;d<=f;++d){if(d===f){if(l>f){if(t.charCodeAt(a+d)===47)return t.slice(a+d+1);if(d===0)return t.slice(a+d)}else n>f&&(e.charCodeAt(r+d)===47?u=d:d===0&&(u=0));break}var m=e.charCodeAt(r+d),g=t.charCodeAt(a+d);if(m!==g)break;m===47&&(u=d)}var h="";for(d=r+u+1;d<=s;++d)(d===s||e.charCodeAt(d)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+t.slice(a+u):(a+=u,t.charCodeAt(a)===47&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(Jr(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,s=-1,n=!0,a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),t===47){if(!n){s=a;break}}else n=!1;return s===-1?r?"/":".":r&&s===1?"//":e.slice(0,s)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');Jr(e);var r=0,s=-1,n=!0,a;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var i=t.length-1,l=-1;for(a=e.length-1;a>=0;--a){var f=e.charCodeAt(a);if(f===47){if(!n){r=a+1;break}}else l===-1&&(n=!1,l=a+1),i>=0&&(f===t.charCodeAt(i)?--i===-1&&(s=a):(i=-1,s=l))}return r===s?s=l:s===-1&&(s=e.length),e.slice(r,s)}else{for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!n){r=a+1;break}}else s===-1&&(n=!1,s=a+1);return s===-1?"":e.slice(r,s)}},extname:function(e){Jr(e);for(var t=-1,r=0,s=-1,n=!0,a=0,i=e.length-1;i>=0;--i){var l=e.charCodeAt(i);if(l===47){if(!n){r=i+1;break}continue}s===-1&&(n=!1,s=i+1),l===46?t===-1?t=i:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||s===-1||a===0||a===1&&t===s-1&&t===r+1?"":e.slice(t,s)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return T0("/",e)},parse:function(e){Jr(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),s=r===47,n;s?(t.root="/",n=1):n=0;for(var a=-1,i=0,l=-1,f=!0,u=e.length-1,d=0;u>=n;--u){if(r=e.charCodeAt(u),r===47){if(!f){i=u+1;break}continue}l===-1&&(f=!1,l=u+1),r===46?a===-1?a=u:d!==1&&(d=1):a!==-1&&(d=-1)}return a===-1||l===-1||d===0||d===1&&a===l-1&&a===i+1?l!==-1&&(i===0&&s?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(i,l)):(i===0&&s?(t.name=e.slice(1,a),t.base=e.slice(1,l)):(t.name=e.slice(i,a),t.base=e.slice(i,l)),t.ext=e.slice(a,l)),i>0?t.dir=e.slice(0,i-1):s&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};on.posix=on;dh.exports=on});var Wy=Bi((b3,qy)=>{var By=require("url").parse,fC=require("events"),uC=require("https"),dC=require("http"),pC=require("util"),mC=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],Vy=[239,187,191],hC=58,gC=32,Ny=10,yC=13,Hy=1024*256,xC=/^(cookie|authorization)$/i;function bC(o){return Vy.every(function(e,t){return o[t]===e})}function yt(o,e){var t=yt.CONNECTING,r=e&&e.headers,s=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var n=this;n.reconnectInterval=1e3,n.connectionInProgress=!1;function a(w){t!==yt.CLOSED&&(t=yt.CONNECTING,h("error",new Ya("error",{message:w})),m&&(o=m,m=null,s=!1),setTimeout(function(){t!==yt.CONNECTING||n.connectionInProgress||(n.connectionInProgress=!0,g())},n.reconnectInterval))}var i,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var f=!1,u="",d="",m=null;function g(){var w=By(o),v=w.protocol==="https:";if(w.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(w.headers["Last-Event-ID"]=l),r){var M=s?_C(r):r;for(var R in M){var D=M[R];D&&(w.headers[R]=D)}}w.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(w.createConnection=e.createConnection);var E=e&&e.proxy;if(E){var O=By(e.proxy);v=O.protocol==="https:",w.protocol=v?"https:":"http:",w.path=o,w.headers.Host=w.host,w.hostname=O.hostname,w.host=O.host,w.port=O.port}if(e&&e.https){for(var A in e.https)if(mC.indexOf(A)!==-1){var F=e.https[A];F!==void 0&&(w[A]=F)}}e&&e.withCredentials!==void 0&&(w.withCredentials=e.withCredentials),i=(v?uC:dC).request(w,function(V){if(n.connectionInProgress=!1,V.statusCode===500||V.statusCode===502||V.statusCode===503||V.statusCode===504){h("error",new Ya("error",{status:V.statusCode,message:V.statusMessage})),a();return}if(V.statusCode===301||V.statusCode===302||V.statusCode===307){var q=V.headers.location;if(!q){h("error",new Ya("error",{status:V.statusCode,message:V.statusMessage}));return}var Z=new URL(o).origin,j=new URL(q).origin;s=Z!==j,V.statusCode===307&&(m=o),o=q,process.nextTick(g);return}if(V.statusCode!==200)return h("error",new Ya("error",{status:V.statusCode,message:V.statusMessage})),n.close();t=yt.OPEN,V.on("close",function(){V.removeAllListeners("close"),V.removeAllListeners("end"),a()}),V.on("end",function(){V.removeAllListeners("close"),V.removeAllListeners("end"),a()}),h("open",new Ya("open"));var K,W,te=0,Te=-1,ie=0,Pe=0;V.on("data",function(Ke){K?(Ke.length>K.length-Pe&&(ie=K.length*2+Ke.length,ie>Hy&&(ie=K.length+Ke.length+Hy),W=Buffer.alloc(ie),K.copy(W,0,0,Pe),K=W),Ke.copy(K,Pe),Pe+=Ke.length):(K=Ke,bC(K)&&(K=K.slice(Vy.length)),Pe=K.length);for(var Oe=0,pe=Pe;Oe<pe;){f&&(K[Oe]===Ny&&++Oe,f=!1);for(var fe=-1,oe=Te,Ne,It=te;fe<0&&It<pe;++It)Ne=K[It],Ne===hC?oe<0&&(oe=It-Oe):Ne===yC?(f=!0,fe=It-Oe):Ne===Ny&&(fe=It-Oe);if(fe<0){te=pe-Oe,Te=oe;break}else te=0,Te=-1;_(K,Oe,oe,fe),Oe+=fe+1}Oe===pe?(K=void 0,Pe=0):Oe>0&&(K=K.slice(Oe,Pe),Pe=K.length)})}),i.on("error",function(V){n.connectionInProgress=!1,a(V.message)}),i.setNoDelay&&i.setNoDelay(!0),i.end()}g();function h(){n.listeners(arguments[0]).length>0&&n.emit.apply(n,arguments)}this._close=function(){t!==yt.CLOSED&&(t=yt.CLOSED,i.abort&&i.abort(),i.xhr&&i.xhr.abort&&i.xhr.abort())};function _(w,v,M,R){if(R===0){if(u.length>0){var D=d||"message";h(D,new wC(D,{data:u.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),u=""}d=void 0}else if(M>0){var E=M<0,O=0,A=w.slice(v,v+(E?R:M)).toString();E?O=R:w[v+M+1]!==gC?O=M+1:O=M+2,v+=O;var F=R-O,V=w.slice(v,v+F).toString();if(A==="data")u+=V+`
`;else if(A==="event")d=V;else if(A==="id")l=V;else if(A==="retry"){var q=parseInt(V,10);Number.isNaN(q)||(n.reconnectInterval=q)}}}}qy.exports=yt;pC.inherits(yt,fC.EventEmitter);yt.prototype.constructor=yt;["open","error","message"].forEach(function(o){Object.defineProperty(yt.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(yt,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(yt,"OPEN",{enumerable:!0,value:1});Object.defineProperty(yt,"CLOSED",{enumerable:!0,value:2});yt.prototype.CONNECTING=0;yt.prototype.OPEN=1;yt.prototype.CLOSED=2;yt.prototype.close=function(){this._close()};yt.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};yt.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};yt.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function Ya(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function wC(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function _C(o){var e={};for(var t in o)xC.test(t)||(e[t]=o[t]);return e}});var Rd=Bi((Q4,jn)=>{var ne=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},rt=-1,ot=1,$e=0;ne.Diff=function(o,e){return[o,e]};ne.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var s=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new ne.Diff($e,o)]:[];typeof t=="undefined"&&(t=!0);var n=t,a=this.diff_commonPrefix(o,e),i=o.substring(0,a);o=o.substring(a),e=e.substring(a),a=this.diff_commonSuffix(o,e);var l=o.substring(o.length-a);o=o.substring(0,o.length-a),e=e.substring(0,e.length-a);var f=this.diff_compute_(o,e,n,s);return i&&f.unshift(new ne.Diff($e,i)),l&&f.push(new ne.Diff($e,l)),this.diff_cleanupMerge(f),f};ne.prototype.diff_compute_=function(o,e,t,r){var s;if(!o)return[new ne.Diff(ot,e)];if(!e)return[new ne.Diff(rt,o)];var n=o.length>e.length?o:e,a=o.length>e.length?e:o,i=n.indexOf(a);if(i!=-1)return s=[new ne.Diff(ot,n.substring(0,i)),new ne.Diff($e,a),new ne.Diff(ot,n.substring(i+a.length))],o.length>e.length&&(s[0][0]=s[2][0]=rt),s;if(a.length==1)return[new ne.Diff(rt,o),new ne.Diff(ot,e)];var l=this.diff_halfMatch_(o,e);if(l){var f=l[0],u=l[1],d=l[2],m=l[3],g=l[4],h=this.diff_main(f,d,t,r),_=this.diff_main(u,m,t,r);return h.concat([new ne.Diff($e,g)],_)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};ne.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var s=r.lineArray,n=this.diff_main(o,e,!1,t);this.diff_charsToLines_(n,s),this.diff_cleanupSemantic(n),n.push(new ne.Diff($e,""));for(var a=0,i=0,l=0,f="",u="";a<n.length;){switch(n[a][0]){case ot:l++,u+=n[a][1];break;case rt:i++,f+=n[a][1];break;case $e:if(i>=1&&l>=1){n.splice(a-i-l,i+l),a=a-i-l;for(var d=this.diff_main(f,u,!1,t),m=d.length-1;m>=0;m--)n.splice(a,0,d[m]);a=a+d.length}l=0,i=0,f="",u="";break}a++}return n.pop(),n};ne.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,s=e.length,n=Math.ceil((r+s)/2),a=n,i=2*n,l=new Array(i),f=new Array(i),u=0;u<i;u++)l[u]=-1,f[u]=-1;l[a+1]=0,f[a+1]=0;for(var d=r-s,m=d%2!=0,g=0,h=0,_=0,w=0,v=0;v<n&&!(new Date().getTime()>t);v++){for(var M=-v+g;M<=v-h;M+=2){var R=a+M,D;M==-v||M!=v&&l[R-1]<l[R+1]?D=l[R+1]:D=l[R-1]+1;for(var E=D-M;D<r&&E<s&&o.charAt(D)==e.charAt(E);)D++,E++;if(l[R]=D,D>r)h+=2;else if(E>s)g+=2;else if(m){var O=a+d-M;if(O>=0&&O<i&&f[O]!=-1){var A=r-f[O];if(D>=A)return this.diff_bisectSplit_(o,e,D,E,t)}}}for(var F=-v+_;F<=v-w;F+=2){var O=a+F,A;F==-v||F!=v&&f[O-1]<f[O+1]?A=f[O+1]:A=f[O-1]+1;for(var V=A-F;A<r&&V<s&&o.charAt(r-A-1)==e.charAt(s-V-1);)A++,V++;if(f[O]=A,A>r)w+=2;else if(V>s)_+=2;else if(!m){var R=a+d-F;if(R>=0&&R<i&&l[R]!=-1){var D=l[R],E=a+D-R;if(A=r-A,D>=A)return this.diff_bisectSplit_(o,e,D,E,t)}}}}return[new ne.Diff(rt,o),new ne.Diff(ot,e)]};ne.prototype.diff_bisectSplit_=function(o,e,t,r,s){var n=o.substring(0,t),a=e.substring(0,r),i=o.substring(t),l=e.substring(r),f=this.diff_main(n,a,!1,s),u=this.diff_main(i,l,!1,s);return f.concat(u)};ne.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function s(l){for(var f="",u=0,d=-1,m=t.length;d<l.length-1;){d=l.indexOf(`
`,u),d==-1&&(d=l.length-1);var g=l.substring(u,d+1);(r.hasOwnProperty?r.hasOwnProperty(g):r[g]!==void 0)?f+=String.fromCharCode(r[g]):(m==n&&(g=l.substring(u),d=l.length),f+=String.fromCharCode(m),r[g]=m,t[m++]=g),u=d+1}return f}var n=4e4,a=s(o);n=65535;var i=s(e);return{chars1:a,chars2:i,lineArray:t}};ne.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],s=[],n=0;n<r.length;n++)s[n]=e[r.charCodeAt(n)];o[t][1]=s.join("")}};ne.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),s=r,n=0;t<s;)o.substring(n,s)==e.substring(n,s)?(t=s,n=t):r=s,s=Math.floor((r-t)/2+t);return s};ne.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),s=r,n=0;t<s;)o.substring(o.length-s,o.length-n)==e.substring(e.length-s,e.length-n)?(t=s,n=t):r=s,s=Math.floor((r-t)/2+t);return s};ne.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var s=Math.min(t,r);if(o==e)return s;for(var n=0,a=1;;){var i=o.substring(s-a),l=e.indexOf(i);if(l==-1)return n;a+=l,(l==0||o.substring(s-a)==e.substring(0,a))&&(n=a,a++)}};ne.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var s=this;function n(h,_,w){for(var v=h.substring(w,w+Math.floor(h.length/4)),M=-1,R="",D,E,O,A;(M=_.indexOf(v,M+1))!=-1;){var F=s.diff_commonPrefix(h.substring(w),_.substring(M)),V=s.diff_commonSuffix(h.substring(0,w),_.substring(0,M));R.length<V+F&&(R=_.substring(M-V,M)+_.substring(M,M+F),D=h.substring(0,w-V),E=h.substring(w+F),O=_.substring(0,M-V),A=_.substring(M+F))}return R.length*2>=h.length?[D,E,O,A,R]:null}var a=n(t,r,Math.ceil(t.length/4)),i=n(t,r,Math.ceil(t.length/2)),l;if(!a&&!i)return null;i?a?l=a[4].length>i[4].length?a:i:l=i:l=a;var f,u,d,m;o.length>e.length?(f=l[0],u=l[1],d=l[2],m=l[3]):(d=l[0],m=l[1],f=l[2],u=l[3]);var g=l[4];return[f,u,d,m,g]};ne.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,s=null,n=0,a=0,i=0,l=0,f=0;n<o.length;)o[n][0]==$e?(t[r++]=n,a=l,i=f,l=0,f=0,s=o[n][1]):(o[n][0]==ot?l+=o[n][1].length:f+=o[n][1].length,s&&s.length<=Math.max(a,i)&&s.length<=Math.max(l,f)&&(o.splice(t[r-1],0,new ne.Diff(rt,s)),o[t[r-1]+1][0]=ot,r--,r--,n=r>0?t[r-1]:-1,a=0,i=0,l=0,f=0,s=null,e=!0)),n++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),n=1;n<o.length;){if(o[n-1][0]==rt&&o[n][0]==ot){var u=o[n-1][1],d=o[n][1],m=this.diff_commonOverlap_(u,d),g=this.diff_commonOverlap_(d,u);m>=g?(m>=u.length/2||m>=d.length/2)&&(o.splice(n,0,new ne.Diff($e,d.substring(0,m))),o[n-1][1]=u.substring(0,u.length-m),o[n+1][1]=d.substring(m),n++):(g>=u.length/2||g>=d.length/2)&&(o.splice(n,0,new ne.Diff($e,u.substring(0,g))),o[n-1][0]=ot,o[n-1][1]=d.substring(0,d.length-g),o[n+1][0]=rt,o[n+1][1]=u.substring(g),n++),n++}n++}};ne.prototype.diff_cleanupSemanticLossless=function(o){function e(g,h){if(!g||!h)return 6;var _=g.charAt(g.length-1),w=h.charAt(0),v=_.match(ne.nonAlphaNumericRegex_),M=w.match(ne.nonAlphaNumericRegex_),R=v&&_.match(ne.whitespaceRegex_),D=M&&w.match(ne.whitespaceRegex_),E=R&&_.match(ne.linebreakRegex_),O=D&&w.match(ne.linebreakRegex_),A=E&&g.match(ne.blanklineEndRegex_),F=O&&h.match(ne.blanklineStartRegex_);return A||F?5:E||O?4:v&&!R&&D?3:R||D?2:v||M?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==$e&&o[t+1][0]==$e){var r=o[t-1][1],s=o[t][1],n=o[t+1][1],a=this.diff_commonSuffix(r,s);if(a){var i=s.substring(s.length-a);r=r.substring(0,r.length-a),s=i+s.substring(0,s.length-a),n=i+n}for(var l=r,f=s,u=n,d=e(r,s)+e(s,n);s.charAt(0)===n.charAt(0);){r+=s.charAt(0),s=s.substring(1)+n.charAt(0),n=n.substring(1);var m=e(r,s)+e(s,n);m>=d&&(d=m,l=r,f=s,u=n)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=f,u?o[t+1][1]=u:(o.splice(t+1,1),t--))}t++}};ne.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;ne.whitespaceRegex_=/\s/;ne.linebreakRegex_=/[\r\n]/;ne.blanklineEndRegex_=/\n\r?\n$/;ne.blanklineStartRegex_=/^\r?\n\r?\n/;ne.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,s=null,n=0,a=!1,i=!1,l=!1,f=!1;n<o.length;)o[n][0]==$e?(o[n][1].length<this.Diff_EditCost&&(l||f)?(t[r++]=n,a=l,i=f,s=o[n][1]):(r=0,s=null),l=f=!1):(o[n][0]==rt?f=!0:l=!0,s&&(a&&i&&l&&f||s.length<this.Diff_EditCost/2&&a+i+l+f==3)&&(o.splice(t[r-1],0,new ne.Diff(rt,s)),o[t[r-1]+1][0]=ot,r--,s=null,a&&i?(l=f=!0,r=0):(r--,n=r>0?t[r-1]:-1,l=f=!1),e=!0)),n++;e&&this.diff_cleanupMerge(o)};ne.prototype.diff_cleanupMerge=function(o){o.push(new ne.Diff($e,""));for(var e=0,t=0,r=0,s="",n="",a;e<o.length;)switch(o[e][0]){case ot:r++,n+=o[e][1],e++;break;case rt:t++,s+=o[e][1],e++;break;case $e:t+r>1?(t!==0&&r!==0&&(a=this.diff_commonPrefix(n,s),a!==0&&(e-t-r>0&&o[e-t-r-1][0]==$e?o[e-t-r-1][1]+=n.substring(0,a):(o.splice(0,0,new ne.Diff($e,n.substring(0,a))),e++),n=n.substring(a),s=s.substring(a)),a=this.diff_commonSuffix(n,s),a!==0&&(o[e][1]=n.substring(n.length-a)+o[e][1],n=n.substring(0,n.length-a),s=s.substring(0,s.length-a))),e-=t+r,o.splice(e,t+r),s.length&&(o.splice(e,0,new ne.Diff(rt,s)),e++),n.length&&(o.splice(e,0,new ne.Diff(ot,n)),e++),e++):e!==0&&o[e-1][0]==$e?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,s="",n="";break}o[o.length-1][1]===""&&o.pop();var i=!1;for(e=1;e<o.length-1;)o[e-1][0]==$e&&o[e+1][0]==$e&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),i=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),i=!0)),e++;i&&this.diff_cleanupMerge(o)};ne.prototype.diff_xIndex=function(o,e){var t=0,r=0,s=0,n=0,a;for(a=0;a<o.length&&(o[a][0]!==ot&&(t+=o[a][1].length),o[a][0]!==rt&&(r+=o[a][1].length),!(t>e));a++)s=t,n=r;return o.length!=a&&o[a][0]===rt?n:n+(e-s)};ne.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,s=/>/g,n=/\n/g,a=0;a<o.length;a++){var i=o[a][0],l=o[a][1],f=l.replace(t,"&amp;").replace(r,"&lt;").replace(s,"&gt;").replace(n,"&para;<br>");switch(i){case ot:e[a]='<ins style="background:#e6ffe6;">'+f+"</ins>";break;case rt:e[a]='<del style="background:#ffe6e6;">'+f+"</del>";break;case $e:e[a]="<span>"+f+"</span>";break}}return e.join("")};ne.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==ot&&(e[t]=o[t][1]);return e.join("")};ne.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==rt&&(e[t]=o[t][1]);return e.join("")};ne.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,s=0;s<o.length;s++){var n=o[s][0],a=o[s][1];switch(n){case ot:t+=a.length;break;case rt:r+=a.length;break;case $e:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};ne.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case ot:e[t]="+"+encodeURI(o[t][1]);break;case rt:e[t]="-"+o[t][1].length;break;case $e:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};ne.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,s=0,n=e.split(/\t/g),a=0;a<n.length;a++){var i=n[a].substring(1);switch(n[a].charAt(0)){case"+":try{t[r++]=new ne.Diff(ot,decodeURI(i))}catch(u){throw new Error("Illegal escape in diff_fromDelta: "+i)}break;case"-":case"=":var l=parseInt(i,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+i);var f=o.substring(s,s+=l);n[a].charAt(0)=="="?t[r++]=new ne.Diff($e,f):t[r++]=new ne.Diff(rt,f);break;default:if(n[a])throw new Error("Invalid diff operation in diff_fromDelta: "+n[a])}}if(s!=o.length)throw new Error("Delta length ("+s+") does not equal source text length ("+o.length+").");return t};ne.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};ne.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),s=this;function n(D,E){var O=D/e.length,A=Math.abs(t-E);return s.Match_Distance?O+A/s.Match_Distance:A?1:O}var a=this.Match_Threshold,i=o.indexOf(e,t);i!=-1&&(a=Math.min(n(0,i),a),i=o.lastIndexOf(e,t+e.length),i!=-1&&(a=Math.min(n(0,i),a)));var l=1<<e.length-1;i=-1;for(var f,u,d=e.length+o.length,m,g=0;g<e.length;g++){for(f=0,u=d;f<u;)n(g,t+u)<=a?f=u:d=u,u=Math.floor((d-f)/2+f);d=u;var h=Math.max(1,t-u+1),_=Math.min(t+u,o.length)+e.length,w=Array(_+2);w[_+1]=(1<<g)-1;for(var v=_;v>=h;v--){var M=r[o.charAt(v-1)];if(g===0?w[v]=(w[v+1]<<1|1)&M:w[v]=(w[v+1]<<1|1)&M|((m[v+1]|m[v])<<1|1)|m[v+1],w[v]&l){var R=n(g,v-1);if(R<=a)if(a=R,i=v-1,i>t)h=Math.max(1,2*t-i);else break}}if(n(g+1,t)>a)break;m=w}return i};ne.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};ne.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var s=e.substring(o.start2-r,o.start2);s&&o.diffs.unshift(new ne.Diff($e,s));var n=e.substring(o.start2+o.length1,o.start2+o.length1+r);n&&o.diffs.push(new ne.Diff($e,n)),o.start1-=s.length,o.start2-=s.length,o.length1+=s.length+n.length,o.length2+=s.length+n.length}};ne.prototype.patch_make=function(o,e,t){var r,s;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,s=this.diff_main(r,e,!0),s.length>2&&(this.diff_cleanupSemantic(s),this.diff_cleanupEfficiency(s));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")s=o,r=this.diff_text1(s);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,s=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,s=t;else throw new Error("Unknown call format to patch_make.");if(s.length===0)return[];for(var n=[],a=new ne.patch_obj,i=0,l=0,f=0,u=r,d=r,m=0;m<s.length;m++){var g=s[m][0],h=s[m][1];switch(!i&&g!==$e&&(a.start1=l,a.start2=f),g){case ot:a.diffs[i++]=s[m],a.length2+=h.length,d=d.substring(0,f)+h+d.substring(f);break;case rt:a.length1+=h.length,a.diffs[i++]=s[m],d=d.substring(0,f)+d.substring(f+h.length);break;case $e:h.length<=2*this.Patch_Margin&&i&&s.length!=m+1?(a.diffs[i++]=s[m],a.length1+=h.length,a.length2+=h.length):h.length>=2*this.Patch_Margin&&i&&(this.patch_addContext_(a,u),n.push(a),a=new ne.patch_obj,i=0,u=d,l=f);break}g!==ot&&(l+=h.length),g!==rt&&(f+=h.length)}return i&&(this.patch_addContext_(a,u),n.push(a)),n};ne.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],s=new ne.patch_obj;s.diffs=[];for(var n=0;n<r.diffs.length;n++)s.diffs[n]=new ne.Diff(r.diffs[n][0],r.diffs[n][1]);s.start1=r.start1,s.start2=r.start2,s.length1=r.length1,s.length2=r.length2,e[t]=s}return e};ne.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,s=[],n=0;n<o.length;n++){var a=o[n].start2+r,i=this.diff_text1(o[n].diffs),l,f=-1;if(i.length>this.Match_MaxBits?(l=this.match_main(e,i.substring(0,this.Match_MaxBits),a),l!=-1&&(f=this.match_main(e,i.substring(i.length-this.Match_MaxBits),a+i.length-this.Match_MaxBits),(f==-1||l>=f)&&(l=-1))):l=this.match_main(e,i,a),l==-1)s[n]=!1,r-=o[n].length2-o[n].length1;else{s[n]=!0,r=l-a;var u;if(f==-1?u=e.substring(l,l+i.length):u=e.substring(l,f+this.Match_MaxBits),i==u)e=e.substring(0,l)+this.diff_text2(o[n].diffs)+e.substring(l+i.length);else{var d=this.diff_main(i,u,!1);if(i.length>this.Match_MaxBits&&this.diff_levenshtein(d)/i.length>this.Patch_DeleteThreshold)s[n]=!1;else{this.diff_cleanupSemanticLossless(d);for(var m=0,g,h=0;h<o[n].diffs.length;h++){var _=o[n].diffs[h];_[0]!==$e&&(g=this.diff_xIndex(d,m)),_[0]===ot?e=e.substring(0,l+g)+_[1]+e.substring(l+g):_[0]===rt&&(e=e.substring(0,l+g)+e.substring(l+this.diff_xIndex(d,m+_[1].length))),_[0]!==rt&&(m+=_[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,s]};ne.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var s=o[0],n=s.diffs;if(n.length==0||n[0][0]!=$e)n.unshift(new ne.Diff($e,t)),s.start1-=e,s.start2-=e,s.length1+=e,s.length2+=e;else if(e>n[0][1].length){var a=e-n[0][1].length;n[0][1]=t.substring(n[0][1].length)+n[0][1],s.start1-=a,s.start2-=a,s.length1+=a,s.length2+=a}if(s=o[o.length-1],n=s.diffs,n.length==0||n[n.length-1][0]!=$e)n.push(new ne.Diff($e,t)),s.length1+=e,s.length2+=e;else if(e>n[n.length-1][1].length){var a=e-n[n.length-1][1].length;n[n.length-1][1]+=t.substring(0,a),s.length1+=a,s.length2+=a}return t};ne.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var s=r.start1,n=r.start2,a="";r.diffs.length!==0;){var i=new ne.patch_obj,l=!0;for(i.start1=s-a.length,i.start2=n-a.length,a!==""&&(i.length1=i.length2=a.length,i.diffs.push(new ne.Diff($e,a)));r.diffs.length!==0&&i.length1<e-this.Patch_Margin;){var f=r.diffs[0][0],u=r.diffs[0][1];f===ot?(i.length2+=u.length,n+=u.length,i.diffs.push(r.diffs.shift()),l=!1):f===rt&&i.diffs.length==1&&i.diffs[0][0]==$e&&u.length>2*e?(i.length1+=u.length,s+=u.length,l=!1,i.diffs.push(new ne.Diff(f,u)),r.diffs.shift()):(u=u.substring(0,e-i.length1-this.Patch_Margin),i.length1+=u.length,s+=u.length,f===$e?(i.length2+=u.length,n+=u.length):l=!1,i.diffs.push(new ne.Diff(f,u)),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}a=this.diff_text2(i.diffs),a=a.substring(a.length-this.Patch_Margin);var d=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);d!==""&&(i.length1+=d.length,i.length2+=d.length,i.diffs.length!==0&&i.diffs[i.diffs.length-1][0]===$e?i.diffs[i.diffs.length-1][1]+=d:i.diffs.push(new ne.Diff($e,d))),l||o.splice(++t,0,i)}}};ne.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};ne.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,s=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var n=t[r].match(s);if(!n)throw new Error("Invalid patch string: "+t[r]);var a=new ne.patch_obj;for(e.push(a),a.start1=parseInt(n[1],10),n[2]===""?(a.start1--,a.length1=1):n[2]=="0"?a.length1=0:(a.start1--,a.length1=parseInt(n[2],10)),a.start2=parseInt(n[3],10),n[4]===""?(a.start2--,a.length2=1):n[4]=="0"?a.length2=0:(a.start2--,a.length2=parseInt(n[4],10)),r++;r<t.length;){var i=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(f){throw new Error("Illegal escape in patch_fromText: "+l)}if(i=="-")a.diffs.push(new ne.Diff(rt,l));else if(i=="+")a.diffs.push(new ne.Diff(ot,l));else if(i==" ")a.diffs.push(new ne.Diff($e,l));else{if(i=="@")break;if(i!=="")throw new Error('Invalid patch mode "'+i+'" in: '+l)}r++}}return e};ne.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};ne.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,s=0;s<this.diffs.length;s++){switch(this.diffs[s][0]){case ot:r="+";break;case rt:r="-";break;case $e:r=" ";break}t[s+1]=r+encodeURI(this.diffs[s][1])+`
`}return t.join("").replace(/%20/g," ")};jn.exports=ne;jn.exports.diff_match_patch=ne;jn.exports.DIFF_DELETE=rt;jn.exports.DIFF_INSERT=ot;jn.exports.DIFF_EQUAL=$e});var Cb=Bi((Vp,ta)=>{(function(o,e){typeof Vp=="object"&&typeof ta!="undefined"?ta.exports=e():typeof define=="function"&&define.amd?define(e):o.moment=e()})(Vp,function(){"use strict";var o;function e(){return o.apply(null,arguments)}function t(c){o=c}function r(c){return c instanceof Array||Object.prototype.toString.call(c)==="[object Array]"}function s(c){return c!=null&&Object.prototype.toString.call(c)==="[object Object]"}function n(c,p){return Object.prototype.hasOwnProperty.call(c,p)}function a(c){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(c).length===0;var p;for(p in c)if(n(c,p))return!1;return!0}function i(c){return c===void 0}function l(c){return typeof c=="number"||Object.prototype.toString.call(c)==="[object Number]"}function f(c){return c instanceof Date||Object.prototype.toString.call(c)==="[object Date]"}function u(c,p){var y=[],x,I=c.length;for(x=0;x<I;++x)y.push(p(c[x],x));return y}function d(c,p){for(var y in p)n(p,y)&&(c[y]=p[y]);return n(p,"toString")&&(c.toString=p.toString),n(p,"valueOf")&&(c.valueOf=p.valueOf),c}function m(c,p,y,x){return Vm(c,p,y,x,!0).utc()}function g(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function h(c){return c._pf==null&&(c._pf=g()),c._pf}var _;Array.prototype.some?_=Array.prototype.some:_=function(c){var p=Object(this),y=p.length>>>0,x;for(x=0;x<y;x++)if(x in p&&c.call(this,p[x],x,p))return!0;return!1};function w(c){if(c._isValid==null){var p=h(c),y=_.call(p.parsedDateParts,function(I){return I!=null}),x=!isNaN(c._d.getTime())&&p.overflow<0&&!p.empty&&!p.invalidEra&&!p.invalidMonth&&!p.invalidWeekday&&!p.weekdayMismatch&&!p.nullInput&&!p.invalidFormat&&!p.userInvalidated&&(!p.meridiem||p.meridiem&&y);if(c._strict&&(x=x&&p.charsLeftOver===0&&p.unusedTokens.length===0&&p.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(c))c._isValid=x;else return x}return c._isValid}function v(c){var p=m(NaN);return c!=null?d(h(p),c):h(p).userInvalidated=!0,p}var M=e.momentProperties=[],R=!1;function D(c,p){var y,x,I,$=M.length;if(i(p._isAMomentObject)||(c._isAMomentObject=p._isAMomentObject),i(p._i)||(c._i=p._i),i(p._f)||(c._f=p._f),i(p._l)||(c._l=p._l),i(p._strict)||(c._strict=p._strict),i(p._tzm)||(c._tzm=p._tzm),i(p._isUTC)||(c._isUTC=p._isUTC),i(p._offset)||(c._offset=p._offset),i(p._pf)||(c._pf=h(p)),i(p._locale)||(c._locale=p._locale),$>0)for(y=0;y<$;y++)x=M[y],I=p[x],i(I)||(c[x]=I);return c}function E(c){D(this,c),this._d=new Date(c._d!=null?c._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),R===!1&&(R=!0,e.updateOffset(this),R=!1)}function O(c){return c instanceof E||c!=null&&c._isAMomentObject!=null}function A(c){e.suppressDeprecationWarnings===!1&&typeof console!="undefined"&&console.warn&&console.warn("Deprecation warning: "+c)}function F(c,p){var y=!0;return d(function(){if(e.deprecationHandler!=null&&e.deprecationHandler(null,c),y){var x=[],I,$,G,Le=arguments.length;for($=0;$<Le;$++){if(I="",typeof arguments[$]=="object"){I+=`
[`+$+"] ";for(G in arguments[0])n(arguments[0],G)&&(I+=G+": "+arguments[0][G]+", ");I=I.slice(0,-2)}else I=arguments[$];x.push(I)}A(c+`
Arguments: `+Array.prototype.slice.call(x).join("")+`
`+new Error().stack),y=!1}return p.apply(this,arguments)},p)}var V={};function q(c,p){e.deprecationHandler!=null&&e.deprecationHandler(c,p),V[c]||(A(p),V[c]=!0)}e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;function Z(c){return typeof Function!="undefined"&&c instanceof Function||Object.prototype.toString.call(c)==="[object Function]"}function j(c){var p,y;for(y in c)n(c,y)&&(p=c[y],Z(p)?this[y]=p:this["_"+y]=p);this._config=c,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function K(c,p){var y=d({},c),x;for(x in p)n(p,x)&&(s(c[x])&&s(p[x])?(y[x]={},d(y[x],c[x]),d(y[x],p[x])):p[x]!=null?y[x]=p[x]:delete y[x]);for(x in c)n(c,x)&&!n(p,x)&&s(c[x])&&(y[x]=d({},y[x]));return y}function W(c){c!=null&&this.set(c)}var te;Object.keys?te=Object.keys:te=function(c){var p,y=[];for(p in c)n(c,p)&&y.push(p);return y};var Te={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function ie(c,p,y){var x=this._calendar[c]||this._calendar.sameElse;return Z(x)?x.call(p,y):x}function Pe(c,p,y){var x=""+Math.abs(c),I=p-x.length,$=c>=0;return($?y?"+":"":"-")+Math.pow(10,Math.max(0,I)).toString().substr(1)+x}var Ke=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Oe=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,pe={},fe={};function oe(c,p,y,x){var I=x;typeof x=="string"&&(I=function(){return this[x]()}),c&&(fe[c]=I),p&&(fe[p[0]]=function(){return Pe(I.apply(this,arguments),p[1],p[2])}),y&&(fe[y]=function(){return this.localeData().ordinal(I.apply(this,arguments),c)})}function Ne(c){return c.match(/\[[\s\S]/)?c.replace(/^\[|\]$/g,""):c.replace(/\\/g,"")}function It(c){var p=c.match(Ke),y,x;for(y=0,x=p.length;y<x;y++)fe[p[y]]?p[y]=fe[p[y]]:p[y]=Ne(p[y]);return function(I){var $="",G;for(G=0;G<x;G++)$+=Z(p[G])?p[G].call(I,c):p[G];return $}}function Wt(c,p){return c.isValid()?(p=zt(p,c.localeData()),pe[p]=pe[p]||It(p),pe[p](c)):c.localeData().invalidDate()}function zt(c,p){var y=5;function x(I){return p.longDateFormat(I)||I}for(Oe.lastIndex=0;y>=0&&Oe.test(c);)c=c.replace(Oe,x),Oe.lastIndex=0,y-=1;return c}var dt={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function gt(c){var p=this._longDateFormat[c],y=this._longDateFormat[c.toUpperCase()];return p||!y?p:(this._longDateFormat[c]=y.match(Ke).map(function(x){return x==="MMMM"||x==="MM"||x==="DD"||x==="dddd"?x.slice(1):x}).join(""),this._longDateFormat[c])}var pt="Invalid date";function Kt(){return this._invalidDate}var gs="%d",js=/\d{1,2}/;function aa(c){return this._ordinal.replace("%d",c)}var ia={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function Ys(c,p,y,x){var I=this._relativeTime[y];return Z(I)?I(c,p,y,x):I.replace(/%d/i,c)}function la(c,p){var y=this._relativeTime[c>0?"future":"past"];return Z(y)?y(p):y.replace(/%s/i,p)}var Ir={};function st(c,p){var y=c.toLowerCase();Ir[y]=Ir[y+"s"]=Ir[p]=c}function Gt(c){return typeof c=="string"?Ir[c]||Ir[c.toLowerCase()]:void 0}function mo(c){var p={},y,x;for(x in c)n(c,x)&&(y=Gt(x),y&&(p[y]=c[x]));return p}var ys={};function _t(c,p){ys[c]=p}function ca(c){var p=[],y;for(y in c)n(c,y)&&p.push({unit:y,priority:ys[y]});return p.sort(function(x,I){return x.priority-I.priority}),p}function le(c){return c%4===0&&c%100!==0||c%400===0}function Me(c){return c<0?Math.ceil(c)||0:Math.floor(c)}function ke(c){var p=+c,y=0;return p!==0&&isFinite(p)&&(y=Me(p)),y}function vt(c,p){return function(y){return y!=null?(Js(this,c,y),e.updateOffset(this,p),this):Lr(this,c)}}function Lr(c,p){return c.isValid()?c._d["get"+(c._isUTC?"UTC":"")+p]():NaN}function Js(c,p,y){c.isValid()&&!isNaN(y)&&(p==="FullYear"&&le(c.year())&&c.month()===1&&c.date()===29?(y=ke(y),c._d["set"+(c._isUTC?"UTC":"")+p](y,c.month(),Ci(y,c.month()))):c._d["set"+(c._isUTC?"UTC":"")+p](y))}function xs(c){return c=Gt(c),Z(this[c])?this[c]():this}function Hc(c,p){if(typeof c=="object"){c=mo(c);var y=ca(c),x,I=y.length;for(x=0;x<I;x++)this[y[x].unit](c[y[x].unit])}else if(c=Gt(c),Z(this[c]))return this[c](p);return this}var _i=/\d/,Yt=/\d\d/,vi=/\d{3}/,fa=/\d{4}/,Y=/[+-]?\d{6}/,ue=/\d\d?/,nt=/\d\d\d\d?/,ho=/\d\d\d\d\d\d?/,ir=/\d{1,3}/,Vc=/\d{1,4}/,Si=/[+-]?\d{1,6}/,Qs=/\d+/,ki=/[+-]?\d+/,H_=/Z|[+-]\d\d:?\d\d/gi,Ii=/Z|[+-]\d\d(?::?\d\d)?/gi,V_=/[+-]?\d+(\.\d{1,3})?/,ua=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Li;Li={};function he(c,p,y){Li[c]=Z(p)?p:function(x,I){return x&&y?y:p}}function q_(c,p){return n(Li,c)?Li[c](p._strict,p._locale):new RegExp(W_(c))}function W_(c){return hr(c.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(p,y,x,I,$){return y||x||I||$}))}function hr(c){return c.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var qc={};function Qe(c,p){var y,x=p,I;for(typeof c=="string"&&(c=[c]),l(p)&&(x=function($,G){G[p]=ke($)}),I=c.length,y=0;y<I;y++)qc[c[y]]=x}function da(c,p){Qe(c,function(y,x,I,$){I._w=I._w||{},p(y,I._w,I,$)})}function z_(c,p,y){p!=null&&n(qc,c)&&qc[c](p,y._a,y,c)}var jt=0,go=1,Yr=2,Lt=3,Rr=4,yo=5,bs=6,K_=7,G_=8;function j_(c,p){return(c%p+p)%p}var xt;Array.prototype.indexOf?xt=Array.prototype.indexOf:xt=function(c){var p;for(p=0;p<this.length;++p)if(this[p]===c)return p;return-1};function Ci(c,p){if(isNaN(c)||isNaN(p))return NaN;var y=j_(p,12);return c+=(p-y)/12,y===1?le(c)?29:28:31-y%7%2}oe("M",["MM",2],"Mo",function(){return this.month()+1}),oe("MMM",0,0,function(c){return this.localeData().monthsShort(this,c)}),oe("MMMM",0,0,function(c){return this.localeData().months(this,c)}),st("month","M"),_t("month",8),he("M",ue),he("MM",ue,Yt),he("MMM",function(c,p){return p.monthsShortRegex(c)}),he("MMMM",function(c,p){return p.monthsRegex(c)}),Qe(["M","MM"],function(c,p){p[go]=ke(c)-1}),Qe(["MMM","MMMM"],function(c,p,y,x){var I=y._locale.monthsParse(c,x,y._strict);I!=null?p[go]=I:h(y).invalidMonth=c});var Y_="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Cm="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Tm=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,J_=ua,Q_=ua;function X_(c,p){return c?r(this._months)?this._months[c.month()]:this._months[(this._months.isFormat||Tm).test(p)?"format":"standalone"][c.month()]:r(this._months)?this._months:this._months.standalone}function Z_(c,p){return c?r(this._monthsShort)?this._monthsShort[c.month()]:this._monthsShort[Tm.test(p)?"format":"standalone"][c.month()]:r(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function ev(c,p,y){var x,I,$,G=c.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],x=0;x<12;++x)$=m([2e3,x]),this._shortMonthsParse[x]=this.monthsShort($,"").toLocaleLowerCase(),this._longMonthsParse[x]=this.months($,"").toLocaleLowerCase();return y?p==="MMM"?(I=xt.call(this._shortMonthsParse,G),I!==-1?I:null):(I=xt.call(this._longMonthsParse,G),I!==-1?I:null):p==="MMM"?(I=xt.call(this._shortMonthsParse,G),I!==-1?I:(I=xt.call(this._longMonthsParse,G),I!==-1?I:null)):(I=xt.call(this._longMonthsParse,G),I!==-1?I:(I=xt.call(this._shortMonthsParse,G),I!==-1?I:null))}function tv(c,p,y){var x,I,$;if(this._monthsParseExact)return ev.call(this,c,p,y);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),x=0;x<12;x++){if(I=m([2e3,x]),y&&!this._longMonthsParse[x]&&(this._longMonthsParse[x]=new RegExp("^"+this.months(I,"").replace(".","")+"$","i"),this._shortMonthsParse[x]=new RegExp("^"+this.monthsShort(I,"").replace(".","")+"$","i")),!y&&!this._monthsParse[x]&&($="^"+this.months(I,"")+"|^"+this.monthsShort(I,""),this._monthsParse[x]=new RegExp($.replace(".",""),"i")),y&&p==="MMMM"&&this._longMonthsParse[x].test(c))return x;if(y&&p==="MMM"&&this._shortMonthsParse[x].test(c))return x;if(!y&&this._monthsParse[x].test(c))return x}}function Pm(c,p){var y;if(!c.isValid())return c;if(typeof p=="string"){if(/^\d+$/.test(p))p=ke(p);else if(p=c.localeData().monthsParse(p),!l(p))return c}return y=Math.min(c.date(),Ci(c.year(),p)),c._d["set"+(c._isUTC?"UTC":"")+"Month"](p,y),c}function Am(c){return c!=null?(Pm(this,c),e.updateOffset(this,!0),this):Lr(this,"Month")}function rv(){return Ci(this.year(),this.month())}function ov(c){return this._monthsParseExact?(n(this,"_monthsRegex")||Fm.call(this),c?this._monthsShortStrictRegex:this._monthsShortRegex):(n(this,"_monthsShortRegex")||(this._monthsShortRegex=J_),this._monthsShortStrictRegex&&c?this._monthsShortStrictRegex:this._monthsShortRegex)}function sv(c){return this._monthsParseExact?(n(this,"_monthsRegex")||Fm.call(this),c?this._monthsStrictRegex:this._monthsRegex):(n(this,"_monthsRegex")||(this._monthsRegex=Q_),this._monthsStrictRegex&&c?this._monthsStrictRegex:this._monthsRegex)}function Fm(){function c(G,Le){return Le.length-G.length}var p=[],y=[],x=[],I,$;for(I=0;I<12;I++)$=m([2e3,I]),p.push(this.monthsShort($,"")),y.push(this.months($,"")),x.push(this.months($,"")),x.push(this.monthsShort($,""));for(p.sort(c),y.sort(c),x.sort(c),I=0;I<12;I++)p[I]=hr(p[I]),y[I]=hr(y[I]);for(I=0;I<24;I++)x[I]=hr(x[I]);this._monthsRegex=new RegExp("^("+x.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+y.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+p.join("|")+")","i")}oe("Y",0,0,function(){var c=this.year();return c<=9999?Pe(c,4):"+"+c}),oe(0,["YY",2],0,function(){return this.year()%100}),oe(0,["YYYY",4],0,"year"),oe(0,["YYYYY",5],0,"year"),oe(0,["YYYYYY",6,!0],0,"year"),st("year","y"),_t("year",1),he("Y",ki),he("YY",ue,Yt),he("YYYY",Vc,fa),he("YYYYY",Si,Y),he("YYYYYY",Si,Y),Qe(["YYYYY","YYYYYY"],jt),Qe("YYYY",function(c,p){p[jt]=c.length===2?e.parseTwoDigitYear(c):ke(c)}),Qe("YY",function(c,p){p[jt]=e.parseTwoDigitYear(c)}),Qe("Y",function(c,p){p[jt]=parseInt(c,10)});function pa(c){return le(c)?366:365}e.parseTwoDigitYear=function(c){return ke(c)+(ke(c)>68?1900:2e3)};var Dm=vt("FullYear",!0);function nv(){return le(this.year())}function av(c,p,y,x,I,$,G){var Le;return c<100&&c>=0?(Le=new Date(c+400,p,y,x,I,$,G),isFinite(Le.getFullYear())&&Le.setFullYear(c)):Le=new Date(c,p,y,x,I,$,G),Le}function ma(c){var p,y;return c<100&&c>=0?(y=Array.prototype.slice.call(arguments),y[0]=c+400,p=new Date(Date.UTC.apply(null,y)),isFinite(p.getUTCFullYear())&&p.setUTCFullYear(c)):p=new Date(Date.UTC.apply(null,arguments)),p}function Ti(c,p,y){var x=7+p-y,I=(7+ma(c,0,x).getUTCDay()-p)%7;return-I+x-1}function Mm(c,p,y,x,I){var $=(7+y-x)%7,G=Ti(c,x,I),Le=1+7*(p-1)+$+G,He,Xe;return Le<=0?(He=c-1,Xe=pa(He)+Le):Le>pa(c)?(He=c+1,Xe=Le-pa(c)):(He=c,Xe=Le),{year:He,dayOfYear:Xe}}function ha(c,p,y){var x=Ti(c.year(),p,y),I=Math.floor((c.dayOfYear()-x-1)/7)+1,$,G;return I<1?(G=c.year()-1,$=I+xo(G,p,y)):I>xo(c.year(),p,y)?($=I-xo(c.year(),p,y),G=c.year()+1):(G=c.year(),$=I),{week:$,year:G}}function xo(c,p,y){var x=Ti(c,p,y),I=Ti(c+1,p,y);return(pa(c)-x+I)/7}oe("w",["ww",2],"wo","week"),oe("W",["WW",2],"Wo","isoWeek"),st("week","w"),st("isoWeek","W"),_t("week",5),_t("isoWeek",5),he("w",ue),he("ww",ue,Yt),he("W",ue),he("WW",ue,Yt),da(["w","ww","W","WW"],function(c,p,y,x){p[x.substr(0,1)]=ke(c)});function iv(c){return ha(c,this._week.dow,this._week.doy).week}var lv={dow:0,doy:6};function cv(){return this._week.dow}function fv(){return this._week.doy}function uv(c){var p=this.localeData().week(this);return c==null?p:this.add((c-p)*7,"d")}function dv(c){var p=ha(this,1,4).week;return c==null?p:this.add((c-p)*7,"d")}oe("d",0,"do","day"),oe("dd",0,0,function(c){return this.localeData().weekdaysMin(this,c)}),oe("ddd",0,0,function(c){return this.localeData().weekdaysShort(this,c)}),oe("dddd",0,0,function(c){return this.localeData().weekdays(this,c)}),oe("e",0,0,"weekday"),oe("E",0,0,"isoWeekday"),st("day","d"),st("weekday","e"),st("isoWeekday","E"),_t("day",11),_t("weekday",11),_t("isoWeekday",11),he("d",ue),he("e",ue),he("E",ue),he("dd",function(c,p){return p.weekdaysMinRegex(c)}),he("ddd",function(c,p){return p.weekdaysShortRegex(c)}),he("dddd",function(c,p){return p.weekdaysRegex(c)}),da(["dd","ddd","dddd"],function(c,p,y,x){var I=y._locale.weekdaysParse(c,x,y._strict);I!=null?p.d=I:h(y).invalidWeekday=c}),da(["d","e","E"],function(c,p,y,x){p[x]=ke(c)});function pv(c,p){return typeof c!="string"?c:isNaN(c)?(c=p.weekdaysParse(c),typeof c=="number"?c:null):parseInt(c,10)}function mv(c,p){return typeof c=="string"?p.weekdaysParse(c)%7||7:isNaN(c)?null:c}function Wc(c,p){return c.slice(p,7).concat(c.slice(0,p))}var hv="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Em="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),gv="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),yv=ua,xv=ua,bv=ua;function wv(c,p){var y=r(this._weekdays)?this._weekdays:this._weekdays[c&&c!==!0&&this._weekdays.isFormat.test(p)?"format":"standalone"];return c===!0?Wc(y,this._week.dow):c?y[c.day()]:y}function _v(c){return c===!0?Wc(this._weekdaysShort,this._week.dow):c?this._weekdaysShort[c.day()]:this._weekdaysShort}function vv(c){return c===!0?Wc(this._weekdaysMin,this._week.dow):c?this._weekdaysMin[c.day()]:this._weekdaysMin}function Sv(c,p,y){var x,I,$,G=c.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],x=0;x<7;++x)$=m([2e3,1]).day(x),this._minWeekdaysParse[x]=this.weekdaysMin($,"").toLocaleLowerCase(),this._shortWeekdaysParse[x]=this.weekdaysShort($,"").toLocaleLowerCase(),this._weekdaysParse[x]=this.weekdays($,"").toLocaleLowerCase();return y?p==="dddd"?(I=xt.call(this._weekdaysParse,G),I!==-1?I:null):p==="ddd"?(I=xt.call(this._shortWeekdaysParse,G),I!==-1?I:null):(I=xt.call(this._minWeekdaysParse,G),I!==-1?I:null):p==="dddd"?(I=xt.call(this._weekdaysParse,G),I!==-1||(I=xt.call(this._shortWeekdaysParse,G),I!==-1)?I:(I=xt.call(this._minWeekdaysParse,G),I!==-1?I:null)):p==="ddd"?(I=xt.call(this._shortWeekdaysParse,G),I!==-1||(I=xt.call(this._weekdaysParse,G),I!==-1)?I:(I=xt.call(this._minWeekdaysParse,G),I!==-1?I:null)):(I=xt.call(this._minWeekdaysParse,G),I!==-1||(I=xt.call(this._weekdaysParse,G),I!==-1)?I:(I=xt.call(this._shortWeekdaysParse,G),I!==-1?I:null))}function kv(c,p,y){var x,I,$;if(this._weekdaysParseExact)return Sv.call(this,c,p,y);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),x=0;x<7;x++){if(I=m([2e3,1]).day(x),y&&!this._fullWeekdaysParse[x]&&(this._fullWeekdaysParse[x]=new RegExp("^"+this.weekdays(I,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[x]=new RegExp("^"+this.weekdaysShort(I,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[x]=new RegExp("^"+this.weekdaysMin(I,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[x]||($="^"+this.weekdays(I,"")+"|^"+this.weekdaysShort(I,"")+"|^"+this.weekdaysMin(I,""),this._weekdaysParse[x]=new RegExp($.replace(".",""),"i")),y&&p==="dddd"&&this._fullWeekdaysParse[x].test(c))return x;if(y&&p==="ddd"&&this._shortWeekdaysParse[x].test(c))return x;if(y&&p==="dd"&&this._minWeekdaysParse[x].test(c))return x;if(!y&&this._weekdaysParse[x].test(c))return x}}function Iv(c){if(!this.isValid())return c!=null?this:NaN;var p=this._isUTC?this._d.getUTCDay():this._d.getDay();return c!=null?(c=pv(c,this.localeData()),this.add(c-p,"d")):p}function Lv(c){if(!this.isValid())return c!=null?this:NaN;var p=(this.day()+7-this.localeData()._week.dow)%7;return c==null?p:this.add(c-p,"d")}function Cv(c){if(!this.isValid())return c!=null?this:NaN;if(c!=null){var p=mv(c,this.localeData());return this.day(this.day()%7?p:p-7)}else return this.day()||7}function Tv(c){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||zc.call(this),c?this._weekdaysStrictRegex:this._weekdaysRegex):(n(this,"_weekdaysRegex")||(this._weekdaysRegex=yv),this._weekdaysStrictRegex&&c?this._weekdaysStrictRegex:this._weekdaysRegex)}function Pv(c){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||zc.call(this),c?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(n(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=xv),this._weekdaysShortStrictRegex&&c?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function Av(c){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||zc.call(this),c?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(n(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=bv),this._weekdaysMinStrictRegex&&c?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function zc(){function c(Jt,So){return So.length-Jt.length}var p=[],y=[],x=[],I=[],$,G,Le,He,Xe;for($=0;$<7;$++)G=m([2e3,1]).day($),Le=hr(this.weekdaysMin(G,"")),He=hr(this.weekdaysShort(G,"")),Xe=hr(this.weekdays(G,"")),p.push(Le),y.push(He),x.push(Xe),I.push(Le),I.push(He),I.push(Xe);p.sort(c),y.sort(c),x.sort(c),I.sort(c),this._weekdaysRegex=new RegExp("^("+I.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+x.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+y.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+p.join("|")+")","i")}function Kc(){return this.hours()%12||12}function Fv(){return this.hours()||24}oe("H",["HH",2],0,"hour"),oe("h",["hh",2],0,Kc),oe("k",["kk",2],0,Fv),oe("hmm",0,0,function(){return""+Kc.apply(this)+Pe(this.minutes(),2)}),oe("hmmss",0,0,function(){return""+Kc.apply(this)+Pe(this.minutes(),2)+Pe(this.seconds(),2)}),oe("Hmm",0,0,function(){return""+this.hours()+Pe(this.minutes(),2)}),oe("Hmmss",0,0,function(){return""+this.hours()+Pe(this.minutes(),2)+Pe(this.seconds(),2)});function Rm(c,p){oe(c,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),p)})}Rm("a",!0),Rm("A",!1),st("hour","h"),_t("hour",13);function Om(c,p){return p._meridiemParse}he("a",Om),he("A",Om),he("H",ue),he("h",ue),he("k",ue),he("HH",ue,Yt),he("hh",ue,Yt),he("kk",ue,Yt),he("hmm",nt),he("hmmss",ho),he("Hmm",nt),he("Hmmss",ho),Qe(["H","HH"],Lt),Qe(["k","kk"],function(c,p,y){var x=ke(c);p[Lt]=x===24?0:x}),Qe(["a","A"],function(c,p,y){y._isPm=y._locale.isPM(c),y._meridiem=c}),Qe(["h","hh"],function(c,p,y){p[Lt]=ke(c),h(y).bigHour=!0}),Qe("hmm",function(c,p,y){var x=c.length-2;p[Lt]=ke(c.substr(0,x)),p[Rr]=ke(c.substr(x)),h(y).bigHour=!0}),Qe("hmmss",function(c,p,y){var x=c.length-4,I=c.length-2;p[Lt]=ke(c.substr(0,x)),p[Rr]=ke(c.substr(x,2)),p[yo]=ke(c.substr(I)),h(y).bigHour=!0}),Qe("Hmm",function(c,p,y){var x=c.length-2;p[Lt]=ke(c.substr(0,x)),p[Rr]=ke(c.substr(x))}),Qe("Hmmss",function(c,p,y){var x=c.length-4,I=c.length-2;p[Lt]=ke(c.substr(0,x)),p[Rr]=ke(c.substr(x,2)),p[yo]=ke(c.substr(I))});function Dv(c){return(c+"").toLowerCase().charAt(0)==="p"}var Mv=/[ap]\.?m?\.?/i,Ev=vt("Hours",!0);function Rv(c,p,y){return c>11?y?"pm":"PM":y?"am":"AM"}var Um={calendar:Te,longDateFormat:dt,invalidDate:pt,ordinal:gs,dayOfMonthOrdinalParse:js,relativeTime:ia,months:Y_,monthsShort:Cm,week:lv,weekdays:hv,weekdaysMin:gv,weekdaysShort:Em,meridiemParse:Mv},ct={},ga={},ya;function Ov(c,p){var y,x=Math.min(c.length,p.length);for(y=0;y<x;y+=1)if(c[y]!==p[y])return y;return x}function $m(c){return c&&c.toLowerCase().replace("_","-")}function Uv(c){for(var p=0,y,x,I,$;p<c.length;){for($=$m(c[p]).split("-"),y=$.length,x=$m(c[p+1]),x=x?x.split("-"):null;y>0;){if(I=Pi($.slice(0,y).join("-")),I)return I;if(x&&x.length>=y&&Ov($,x)>=y-1)break;y--}p++}return ya}function $v(c){return c.match("^[^/\\\\]*$")!=null}function Pi(c){var p=null,y;if(ct[c]===void 0&&typeof ta!="undefined"&&ta&&ta.exports&&$v(c))try{p=ya._abbr,y=require,y("./locale/"+c),Go(p)}catch(x){ct[c]=null}return ct[c]}function Go(c,p){var y;return c&&(i(p)?y=bo(c):y=Gc(c,p),y?ya=y:typeof console!="undefined"&&console.warn&&console.warn("Locale "+c+" not found. Did you forget to load it?")),ya._abbr}function Gc(c,p){if(p!==null){var y,x=Um;if(p.abbr=c,ct[c]!=null)q("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),x=ct[c]._config;else if(p.parentLocale!=null)if(ct[p.parentLocale]!=null)x=ct[p.parentLocale]._config;else if(y=Pi(p.parentLocale),y!=null)x=y._config;else return ga[p.parentLocale]||(ga[p.parentLocale]=[]),ga[p.parentLocale].push({name:c,config:p}),null;return ct[c]=new W(K(x,p)),ga[c]&&ga[c].forEach(function(I){Gc(I.name,I.config)}),Go(c),ct[c]}else return delete ct[c],null}function Bv(c,p){if(p!=null){var y,x,I=Um;ct[c]!=null&&ct[c].parentLocale!=null?ct[c].set(K(ct[c]._config,p)):(x=Pi(c),x!=null&&(I=x._config),p=K(I,p),x==null&&(p.abbr=c),y=new W(p),y.parentLocale=ct[c],ct[c]=y),Go(c)}else ct[c]!=null&&(ct[c].parentLocale!=null?(ct[c]=ct[c].parentLocale,c===Go()&&Go(c)):ct[c]!=null&&delete ct[c]);return ct[c]}function bo(c){var p;if(c&&c._locale&&c._locale._abbr&&(c=c._locale._abbr),!c)return ya;if(!r(c)){if(p=Pi(c),p)return p;c=[c]}return Uv(c)}function Nv(){return te(ct)}function jc(c){var p,y=c._a;return y&&h(c).overflow===-2&&(p=y[go]<0||y[go]>11?go:y[Yr]<1||y[Yr]>Ci(y[jt],y[go])?Yr:y[Lt]<0||y[Lt]>24||y[Lt]===24&&(y[Rr]!==0||y[yo]!==0||y[bs]!==0)?Lt:y[Rr]<0||y[Rr]>59?Rr:y[yo]<0||y[yo]>59?yo:y[bs]<0||y[bs]>999?bs:-1,h(c)._overflowDayOfYear&&(p<jt||p>Yr)&&(p=Yr),h(c)._overflowWeeks&&p===-1&&(p=K_),h(c)._overflowWeekday&&p===-1&&(p=G_),h(c).overflow=p),c}var Hv=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Vv=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,qv=/Z|[+-]\d\d(?::?\d\d)?/,Ai=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],Yc=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Wv=/^\/?Date\((-?\d+)/i,zv=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Kv={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Bm(c){var p,y,x=c._i,I=Hv.exec(x)||Vv.exec(x),$,G,Le,He,Xe=Ai.length,Jt=Yc.length;if(I){for(h(c).iso=!0,p=0,y=Xe;p<y;p++)if(Ai[p][1].exec(I[1])){G=Ai[p][0],$=Ai[p][2]!==!1;break}if(G==null){c._isValid=!1;return}if(I[3]){for(p=0,y=Jt;p<y;p++)if(Yc[p][1].exec(I[3])){Le=(I[2]||" ")+Yc[p][0];break}if(Le==null){c._isValid=!1;return}}if(!$&&Le!=null){c._isValid=!1;return}if(I[4])if(qv.exec(I[4]))He="Z";else{c._isValid=!1;return}c._f=G+(Le||"")+(He||""),Qc(c)}else c._isValid=!1}function Gv(c,p,y,x,I,$){var G=[jv(c),Cm.indexOf(p),parseInt(y,10),parseInt(x,10),parseInt(I,10)];return $&&G.push(parseInt($,10)),G}function jv(c){var p=parseInt(c,10);return p<=49?2e3+p:p<=999?1900+p:p}function Yv(c){return c.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Jv(c,p,y){if(c){var x=Em.indexOf(c),I=new Date(p[0],p[1],p[2]).getDay();if(x!==I)return h(y).weekdayMismatch=!0,y._isValid=!1,!1}return!0}function Qv(c,p,y){if(c)return Kv[c];if(p)return 0;var x=parseInt(y,10),I=x%100,$=(x-I)/100;return $*60+I}function Nm(c){var p=zv.exec(Yv(c._i)),y;if(p){if(y=Gv(p[4],p[3],p[2],p[5],p[6],p[7]),!Jv(p[1],y,c))return;c._a=y,c._tzm=Qv(p[8],p[9],p[10]),c._d=ma.apply(null,c._a),c._d.setUTCMinutes(c._d.getUTCMinutes()-c._tzm),h(c).rfc2822=!0}else c._isValid=!1}function Xv(c){var p=Wv.exec(c._i);if(p!==null){c._d=new Date(+p[1]);return}if(Bm(c),c._isValid===!1)delete c._isValid;else return;if(Nm(c),c._isValid===!1)delete c._isValid;else return;c._strict?c._isValid=!1:e.createFromInputFallback(c)}e.createFromInputFallback=F("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(c){c._d=new Date(c._i+(c._useUTC?" UTC":""))});function Xs(c,p,y){return c!=null?c:p!=null?p:y}function Zv(c){var p=new Date(e.now());return c._useUTC?[p.getUTCFullYear(),p.getUTCMonth(),p.getUTCDate()]:[p.getFullYear(),p.getMonth(),p.getDate()]}function Jc(c){var p,y,x=[],I,$,G;if(!c._d){for(I=Zv(c),c._w&&c._a[Yr]==null&&c._a[go]==null&&eS(c),c._dayOfYear!=null&&(G=Xs(c._a[jt],I[jt]),(c._dayOfYear>pa(G)||c._dayOfYear===0)&&(h(c)._overflowDayOfYear=!0),y=ma(G,0,c._dayOfYear),c._a[go]=y.getUTCMonth(),c._a[Yr]=y.getUTCDate()),p=0;p<3&&c._a[p]==null;++p)c._a[p]=x[p]=I[p];for(;p<7;p++)c._a[p]=x[p]=c._a[p]==null?p===2?1:0:c._a[p];c._a[Lt]===24&&c._a[Rr]===0&&c._a[yo]===0&&c._a[bs]===0&&(c._nextDay=!0,c._a[Lt]=0),c._d=(c._useUTC?ma:av).apply(null,x),$=c._useUTC?c._d.getUTCDay():c._d.getDay(),c._tzm!=null&&c._d.setUTCMinutes(c._d.getUTCMinutes()-c._tzm),c._nextDay&&(c._a[Lt]=24),c._w&&typeof c._w.d!="undefined"&&c._w.d!==$&&(h(c).weekdayMismatch=!0)}}function eS(c){var p,y,x,I,$,G,Le,He,Xe;p=c._w,p.GG!=null||p.W!=null||p.E!=null?($=1,G=4,y=Xs(p.GG,c._a[jt],ha(at(),1,4).year),x=Xs(p.W,1),I=Xs(p.E,1),(I<1||I>7)&&(He=!0)):($=c._locale._week.dow,G=c._locale._week.doy,Xe=ha(at(),$,G),y=Xs(p.gg,c._a[jt],Xe.year),x=Xs(p.w,Xe.week),p.d!=null?(I=p.d,(I<0||I>6)&&(He=!0)):p.e!=null?(I=p.e+$,(p.e<0||p.e>6)&&(He=!0)):I=$),x<1||x>xo(y,$,G)?h(c)._overflowWeeks=!0:He!=null?h(c)._overflowWeekday=!0:(Le=Mm(y,x,I,$,G),c._a[jt]=Le.year,c._dayOfYear=Le.dayOfYear)}e.ISO_8601=function(){},e.RFC_2822=function(){};function Qc(c){if(c._f===e.ISO_8601){Bm(c);return}if(c._f===e.RFC_2822){Nm(c);return}c._a=[],h(c).empty=!0;var p=""+c._i,y,x,I,$,G,Le=p.length,He=0,Xe,Jt;for(I=zt(c._f,c._locale).match(Ke)||[],Jt=I.length,y=0;y<Jt;y++)$=I[y],x=(p.match(q_($,c))||[])[0],x&&(G=p.substr(0,p.indexOf(x)),G.length>0&&h(c).unusedInput.push(G),p=p.slice(p.indexOf(x)+x.length),He+=x.length),fe[$]?(x?h(c).empty=!1:h(c).unusedTokens.push($),z_($,x,c)):c._strict&&!x&&h(c).unusedTokens.push($);h(c).charsLeftOver=Le-He,p.length>0&&h(c).unusedInput.push(p),c._a[Lt]<=12&&h(c).bigHour===!0&&c._a[Lt]>0&&(h(c).bigHour=void 0),h(c).parsedDateParts=c._a.slice(0),h(c).meridiem=c._meridiem,c._a[Lt]=tS(c._locale,c._a[Lt],c._meridiem),Xe=h(c).era,Xe!==null&&(c._a[jt]=c._locale.erasConvertYear(Xe,c._a[jt])),Jc(c),jc(c)}function tS(c,p,y){var x;return y==null?p:c.meridiemHour!=null?c.meridiemHour(p,y):(c.isPM!=null&&(x=c.isPM(y),x&&p<12&&(p+=12),!x&&p===12&&(p=0)),p)}function rS(c){var p,y,x,I,$,G,Le=!1,He=c._f.length;if(He===0){h(c).invalidFormat=!0,c._d=new Date(NaN);return}for(I=0;I<He;I++)$=0,G=!1,p=D({},c),c._useUTC!=null&&(p._useUTC=c._useUTC),p._f=c._f[I],Qc(p),w(p)&&(G=!0),$+=h(p).charsLeftOver,$+=h(p).unusedTokens.length*10,h(p).score=$,Le?$<x&&(x=$,y=p):(x==null||$<x||G)&&(x=$,y=p,G&&(Le=!0));d(c,y||p)}function oS(c){if(!c._d){var p=mo(c._i),y=p.day===void 0?p.date:p.day;c._a=u([p.year,p.month,y,p.hour,p.minute,p.second,p.millisecond],function(x){return x&&parseInt(x,10)}),Jc(c)}}function sS(c){var p=new E(jc(Hm(c)));return p._nextDay&&(p.add(1,"d"),p._nextDay=void 0),p}function Hm(c){var p=c._i,y=c._f;return c._locale=c._locale||bo(c._l),p===null||y===void 0&&p===""?v({nullInput:!0}):(typeof p=="string"&&(c._i=p=c._locale.preparse(p)),O(p)?new E(jc(p)):(f(p)?c._d=p:r(y)?rS(c):y?Qc(c):nS(c),w(c)||(c._d=null),c))}function nS(c){var p=c._i;i(p)?c._d=new Date(e.now()):f(p)?c._d=new Date(p.valueOf()):typeof p=="string"?Xv(c):r(p)?(c._a=u(p.slice(0),function(y){return parseInt(y,10)}),Jc(c)):s(p)?oS(c):l(p)?c._d=new Date(p):e.createFromInputFallback(c)}function Vm(c,p,y,x,I){var $={};return(p===!0||p===!1)&&(x=p,p=void 0),(y===!0||y===!1)&&(x=y,y=void 0),(s(c)&&a(c)||r(c)&&c.length===0)&&(c=void 0),$._isAMomentObject=!0,$._useUTC=$._isUTC=I,$._l=y,$._i=c,$._f=p,$._strict=x,sS($)}function at(c,p,y,x){return Vm(c,p,y,x,!1)}var aS=F("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var c=at.apply(null,arguments);return this.isValid()&&c.isValid()?c<this?this:c:v()}),iS=F("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var c=at.apply(null,arguments);return this.isValid()&&c.isValid()?c>this?this:c:v()});function qm(c,p){var y,x;if(p.length===1&&r(p[0])&&(p=p[0]),!p.length)return at();for(y=p[0],x=1;x<p.length;++x)(!p[x].isValid()||p[x][c](y))&&(y=p[x]);return y}function lS(){var c=[].slice.call(arguments,0);return qm("isBefore",c)}function cS(){var c=[].slice.call(arguments,0);return qm("isAfter",c)}var fS=function(){return Date.now?Date.now():+new Date},xa=["year","quarter","month","week","day","hour","minute","second","millisecond"];function uS(c){var p,y=!1,x,I=xa.length;for(p in c)if(n(c,p)&&!(xt.call(xa,p)!==-1&&(c[p]==null||!isNaN(c[p]))))return!1;for(x=0;x<I;++x)if(c[xa[x]]){if(y)return!1;parseFloat(c[xa[x]])!==ke(c[xa[x]])&&(y=!0)}return!0}function dS(){return this._isValid}function pS(){return Or(NaN)}function Fi(c){var p=mo(c),y=p.year||0,x=p.quarter||0,I=p.month||0,$=p.week||p.isoWeek||0,G=p.day||0,Le=p.hour||0,He=p.minute||0,Xe=p.second||0,Jt=p.millisecond||0;this._isValid=uS(p),this._milliseconds=+Jt+Xe*1e3+He*6e4+Le*1e3*60*60,this._days=+G+$*7,this._months=+I+x*3+y*12,this._data={},this._locale=bo(),this._bubble()}function Di(c){return c instanceof Fi}function Xc(c){return c<0?Math.round(-1*c)*-1:Math.round(c)}function mS(c,p,y){var x=Math.min(c.length,p.length),I=Math.abs(c.length-p.length),$=0,G;for(G=0;G<x;G++)(y&&c[G]!==p[G]||!y&&ke(c[G])!==ke(p[G]))&&$++;return $+I}function Wm(c,p){oe(c,0,0,function(){var y=this.utcOffset(),x="+";return y<0&&(y=-y,x="-"),x+Pe(~~(y/60),2)+p+Pe(~~y%60,2)})}Wm("Z",":"),Wm("ZZ",""),he("Z",Ii),he("ZZ",Ii),Qe(["Z","ZZ"],function(c,p,y){y._useUTC=!0,y._tzm=Zc(Ii,c)});var hS=/([\+\-]|\d\d)/gi;function Zc(c,p){var y=(p||"").match(c),x,I,$;return y===null?null:(x=y[y.length-1]||[],I=(x+"").match(hS)||["-",0,0],$=+(I[1]*60)+ke(I[2]),$===0?0:I[0]==="+"?$:-$)}function ef(c,p){var y,x;return p._isUTC?(y=p.clone(),x=(O(c)||f(c)?c.valueOf():at(c).valueOf())-y.valueOf(),y._d.setTime(y._d.valueOf()+x),e.updateOffset(y,!1),y):at(c).local()}function tf(c){return-Math.round(c._d.getTimezoneOffset())}e.updateOffset=function(){};function gS(c,p,y){var x=this._offset||0,I;if(!this.isValid())return c!=null?this:NaN;if(c!=null){if(typeof c=="string"){if(c=Zc(Ii,c),c===null)return this}else Math.abs(c)<16&&!y&&(c=c*60);return!this._isUTC&&p&&(I=tf(this)),this._offset=c,this._isUTC=!0,I!=null&&this.add(I,"m"),x!==c&&(!p||this._changeInProgress?jm(this,Or(c-x,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?x:tf(this)}function yS(c,p){return c!=null?(typeof c!="string"&&(c=-c),this.utcOffset(c,p),this):-this.utcOffset()}function xS(c){return this.utcOffset(0,c)}function bS(c){return this._isUTC&&(this.utcOffset(0,c),this._isUTC=!1,c&&this.subtract(tf(this),"m")),this}function wS(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var c=Zc(H_,this._i);c!=null?this.utcOffset(c):this.utcOffset(0,!0)}return this}function _S(c){return this.isValid()?(c=c?at(c).utcOffset():0,(this.utcOffset()-c)%60===0):!1}function vS(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function SS(){if(!i(this._isDSTShifted))return this._isDSTShifted;var c={},p;return D(c,this),c=Hm(c),c._a?(p=c._isUTC?m(c._a):at(c._a),this._isDSTShifted=this.isValid()&&mS(c._a,p.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function kS(){return this.isValid()?!this._isUTC:!1}function IS(){return this.isValid()?this._isUTC:!1}function zm(){return this.isValid()?this._isUTC&&this._offset===0:!1}var LS=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,CS=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Or(c,p){var y=c,x=null,I,$,G;return Di(c)?y={ms:c._milliseconds,d:c._days,M:c._months}:l(c)||!isNaN(+c)?(y={},p?y[p]=+c:y.milliseconds=+c):(x=LS.exec(c))?(I=x[1]==="-"?-1:1,y={y:0,d:ke(x[Yr])*I,h:ke(x[Lt])*I,m:ke(x[Rr])*I,s:ke(x[yo])*I,ms:ke(Xc(x[bs]*1e3))*I}):(x=CS.exec(c))?(I=x[1]==="-"?-1:1,y={y:ws(x[2],I),M:ws(x[3],I),w:ws(x[4],I),d:ws(x[5],I),h:ws(x[6],I),m:ws(x[7],I),s:ws(x[8],I)}):y==null?y={}:typeof y=="object"&&("from"in y||"to"in y)&&(G=TS(at(y.from),at(y.to)),y={},y.ms=G.milliseconds,y.M=G.months),$=new Fi(y),Di(c)&&n(c,"_locale")&&($._locale=c._locale),Di(c)&&n(c,"_isValid")&&($._isValid=c._isValid),$}Or.fn=Fi.prototype,Or.invalid=pS;function ws(c,p){var y=c&&parseFloat(c.replace(",","."));return(isNaN(y)?0:y)*p}function Km(c,p){var y={};return y.months=p.month()-c.month()+(p.year()-c.year())*12,c.clone().add(y.months,"M").isAfter(p)&&--y.months,y.milliseconds=+p-+c.clone().add(y.months,"M"),y}function TS(c,p){var y;return c.isValid()&&p.isValid()?(p=ef(p,c),c.isBefore(p)?y=Km(c,p):(y=Km(p,c),y.milliseconds=-y.milliseconds,y.months=-y.months),y):{milliseconds:0,months:0}}function Gm(c,p){return function(y,x){var I,$;return x!==null&&!isNaN(+x)&&(q(p,"moment()."+p+"(period, number) is deprecated. Please use moment()."+p+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),$=y,y=x,x=$),I=Or(y,x),jm(this,I,c),this}}function jm(c,p,y,x){var I=p._milliseconds,$=Xc(p._days),G=Xc(p._months);c.isValid()&&(x=x==null?!0:x,G&&Pm(c,Lr(c,"Month")+G*y),$&&Js(c,"Date",Lr(c,"Date")+$*y),I&&c._d.setTime(c._d.valueOf()+I*y),x&&e.updateOffset(c,$||G))}var PS=Gm(1,"add"),AS=Gm(-1,"subtract");function Ym(c){return typeof c=="string"||c instanceof String}function FS(c){return O(c)||f(c)||Ym(c)||l(c)||MS(c)||DS(c)||c===null||c===void 0}function DS(c){var p=s(c)&&!a(c),y=!1,x=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],I,$,G=x.length;for(I=0;I<G;I+=1)$=x[I],y=y||n(c,$);return p&&y}function MS(c){var p=r(c),y=!1;return p&&(y=c.filter(function(x){return!l(x)&&Ym(c)}).length===0),p&&y}function ES(c){var p=s(c)&&!a(c),y=!1,x=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],I,$;for(I=0;I<x.length;I+=1)$=x[I],y=y||n(c,$);return p&&y}function RS(c,p){var y=c.diff(p,"days",!0);return y<-6?"sameElse":y<-1?"lastWeek":y<0?"lastDay":y<1?"sameDay":y<2?"nextDay":y<7?"nextWeek":"sameElse"}function OS(c,p){arguments.length===1&&(arguments[0]?FS(arguments[0])?(c=arguments[0],p=void 0):ES(arguments[0])&&(p=arguments[0],c=void 0):(c=void 0,p=void 0));var y=c||at(),x=ef(y,this).startOf("day"),I=e.calendarFormat(this,x)||"sameElse",$=p&&(Z(p[I])?p[I].call(this,y):p[I]);return this.format($||this.localeData().calendar(I,this,at(y)))}function US(){return new E(this)}function $S(c,p){var y=O(c)?c:at(c);return this.isValid()&&y.isValid()?(p=Gt(p)||"millisecond",p==="millisecond"?this.valueOf()>y.valueOf():y.valueOf()<this.clone().startOf(p).valueOf()):!1}function BS(c,p){var y=O(c)?c:at(c);return this.isValid()&&y.isValid()?(p=Gt(p)||"millisecond",p==="millisecond"?this.valueOf()<y.valueOf():this.clone().endOf(p).valueOf()<y.valueOf()):!1}function NS(c,p,y,x){var I=O(c)?c:at(c),$=O(p)?p:at(p);return this.isValid()&&I.isValid()&&$.isValid()?(x=x||"()",(x[0]==="("?this.isAfter(I,y):!this.isBefore(I,y))&&(x[1]===")"?this.isBefore($,y):!this.isAfter($,y))):!1}function HS(c,p){var y=O(c)?c:at(c),x;return this.isValid()&&y.isValid()?(p=Gt(p)||"millisecond",p==="millisecond"?this.valueOf()===y.valueOf():(x=y.valueOf(),this.clone().startOf(p).valueOf()<=x&&x<=this.clone().endOf(p).valueOf())):!1}function VS(c,p){return this.isSame(c,p)||this.isAfter(c,p)}function qS(c,p){return this.isSame(c,p)||this.isBefore(c,p)}function WS(c,p,y){var x,I,$;if(!this.isValid())return NaN;if(x=ef(c,this),!x.isValid())return NaN;switch(I=(x.utcOffset()-this.utcOffset())*6e4,p=Gt(p),p){case"year":$=Mi(this,x)/12;break;case"month":$=Mi(this,x);break;case"quarter":$=Mi(this,x)/3;break;case"second":$=(this-x)/1e3;break;case"minute":$=(this-x)/6e4;break;case"hour":$=(this-x)/36e5;break;case"day":$=(this-x-I)/864e5;break;case"week":$=(this-x-I)/6048e5;break;default:$=this-x}return y?$:Me($)}function Mi(c,p){if(c.date()<p.date())return-Mi(p,c);var y=(p.year()-c.year())*12+(p.month()-c.month()),x=c.clone().add(y,"months"),I,$;return p-x<0?(I=c.clone().add(y-1,"months"),$=(p-x)/(x-I)):(I=c.clone().add(y+1,"months"),$=(p-x)/(I-x)),-(y+$)||0}e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function zS(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function KS(c){if(!this.isValid())return null;var p=c!==!0,y=p?this.clone().utc():this;return y.year()<0||y.year()>9999?Wt(y,p?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):Z(Date.prototype.toISOString)?p?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Wt(y,"Z")):Wt(y,p?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function GS(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var c="moment",p="",y,x,I,$;return this.isLocal()||(c=this.utcOffset()===0?"moment.utc":"moment.parseZone",p="Z"),y="["+c+'("]',x=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",I="-MM-DD[T]HH:mm:ss.SSS",$=p+'[")]',this.format(y+x+I+$)}function jS(c){c||(c=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var p=Wt(this,c);return this.localeData().postformat(p)}function YS(c,p){return this.isValid()&&(O(c)&&c.isValid()||at(c).isValid())?Or({to:this,from:c}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function JS(c){return this.from(at(),c)}function QS(c,p){return this.isValid()&&(O(c)&&c.isValid()||at(c).isValid())?Or({from:this,to:c}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function XS(c){return this.to(at(),c)}function Jm(c){var p;return c===void 0?this._locale._abbr:(p=bo(c),p!=null&&(this._locale=p),this)}var Qm=F("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(c){return c===void 0?this.localeData():this.locale(c)});function Xm(){return this._locale}var Ei=1e3,Zs=60*Ei,Ri=60*Zs,Zm=(365*400+97)*24*Ri;function en(c,p){return(c%p+p)%p}function eh(c,p,y){return c<100&&c>=0?new Date(c+400,p,y)-Zm:new Date(c,p,y).valueOf()}function th(c,p,y){return c<100&&c>=0?Date.UTC(c+400,p,y)-Zm:Date.UTC(c,p,y)}function ZS(c){var p,y;if(c=Gt(c),c===void 0||c==="millisecond"||!this.isValid())return this;switch(y=this._isUTC?th:eh,c){case"year":p=y(this.year(),0,1);break;case"quarter":p=y(this.year(),this.month()-this.month()%3,1);break;case"month":p=y(this.year(),this.month(),1);break;case"week":p=y(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":p=y(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":p=y(this.year(),this.month(),this.date());break;case"hour":p=this._d.valueOf(),p-=en(p+(this._isUTC?0:this.utcOffset()*Zs),Ri);break;case"minute":p=this._d.valueOf(),p-=en(p,Zs);break;case"second":p=this._d.valueOf(),p-=en(p,Ei);break}return this._d.setTime(p),e.updateOffset(this,!0),this}function e1(c){var p,y;if(c=Gt(c),c===void 0||c==="millisecond"||!this.isValid())return this;switch(y=this._isUTC?th:eh,c){case"year":p=y(this.year()+1,0,1)-1;break;case"quarter":p=y(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":p=y(this.year(),this.month()+1,1)-1;break;case"week":p=y(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":p=y(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":p=y(this.year(),this.month(),this.date()+1)-1;break;case"hour":p=this._d.valueOf(),p+=Ri-en(p+(this._isUTC?0:this.utcOffset()*Zs),Ri)-1;break;case"minute":p=this._d.valueOf(),p+=Zs-en(p,Zs)-1;break;case"second":p=this._d.valueOf(),p+=Ei-en(p,Ei)-1;break}return this._d.setTime(p),e.updateOffset(this,!0),this}function t1(){return this._d.valueOf()-(this._offset||0)*6e4}function r1(){return Math.floor(this.valueOf()/1e3)}function o1(){return new Date(this.valueOf())}function s1(){var c=this;return[c.year(),c.month(),c.date(),c.hour(),c.minute(),c.second(),c.millisecond()]}function n1(){var c=this;return{years:c.year(),months:c.month(),date:c.date(),hours:c.hours(),minutes:c.minutes(),seconds:c.seconds(),milliseconds:c.milliseconds()}}function a1(){return this.isValid()?this.toISOString():null}function i1(){return w(this)}function l1(){return d({},h(this))}function c1(){return h(this).overflow}function f1(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}oe("N",0,0,"eraAbbr"),oe("NN",0,0,"eraAbbr"),oe("NNN",0,0,"eraAbbr"),oe("NNNN",0,0,"eraName"),oe("NNNNN",0,0,"eraNarrow"),oe("y",["y",1],"yo","eraYear"),oe("y",["yy",2],0,"eraYear"),oe("y",["yyy",3],0,"eraYear"),oe("y",["yyyy",4],0,"eraYear"),he("N",rf),he("NN",rf),he("NNN",rf),he("NNNN",_1),he("NNNNN",v1),Qe(["N","NN","NNN","NNNN","NNNNN"],function(c,p,y,x){var I=y._locale.erasParse(c,x,y._strict);I?h(y).era=I:h(y).invalidEra=c}),he("y",Qs),he("yy",Qs),he("yyy",Qs),he("yyyy",Qs),he("yo",S1),Qe(["y","yy","yyy","yyyy"],jt),Qe(["yo"],function(c,p,y,x){var I;y._locale._eraYearOrdinalRegex&&(I=c.match(y._locale._eraYearOrdinalRegex)),y._locale.eraYearOrdinalParse?p[jt]=y._locale.eraYearOrdinalParse(c,I):p[jt]=parseInt(c,10)});function u1(c,p){var y,x,I,$=this._eras||bo("en")._eras;for(y=0,x=$.length;y<x;++y){switch(typeof $[y].since){case"string":I=e($[y].since).startOf("day"),$[y].since=I.valueOf();break}switch(typeof $[y].until){case"undefined":$[y].until=1/0;break;case"string":I=e($[y].until).startOf("day").valueOf(),$[y].until=I.valueOf();break}}return $}function d1(c,p,y){var x,I,$=this.eras(),G,Le,He;for(c=c.toUpperCase(),x=0,I=$.length;x<I;++x)if(G=$[x].name.toUpperCase(),Le=$[x].abbr.toUpperCase(),He=$[x].narrow.toUpperCase(),y)switch(p){case"N":case"NN":case"NNN":if(Le===c)return $[x];break;case"NNNN":if(G===c)return $[x];break;case"NNNNN":if(He===c)return $[x];break}else if([G,Le,He].indexOf(c)>=0)return $[x]}function p1(c,p){var y=c.since<=c.until?1:-1;return p===void 0?e(c.since).year():e(c.since).year()+(p-c.offset)*y}function m1(){var c,p,y,x=this.localeData().eras();for(c=0,p=x.length;c<p;++c)if(y=this.clone().startOf("day").valueOf(),x[c].since<=y&&y<=x[c].until||x[c].until<=y&&y<=x[c].since)return x[c].name;return""}function h1(){var c,p,y,x=this.localeData().eras();for(c=0,p=x.length;c<p;++c)if(y=this.clone().startOf("day").valueOf(),x[c].since<=y&&y<=x[c].until||x[c].until<=y&&y<=x[c].since)return x[c].narrow;return""}function g1(){var c,p,y,x=this.localeData().eras();for(c=0,p=x.length;c<p;++c)if(y=this.clone().startOf("day").valueOf(),x[c].since<=y&&y<=x[c].until||x[c].until<=y&&y<=x[c].since)return x[c].abbr;return""}function y1(){var c,p,y,x,I=this.localeData().eras();for(c=0,p=I.length;c<p;++c)if(y=I[c].since<=I[c].until?1:-1,x=this.clone().startOf("day").valueOf(),I[c].since<=x&&x<=I[c].until||I[c].until<=x&&x<=I[c].since)return(this.year()-e(I[c].since).year())*y+I[c].offset;return this.year()}function x1(c){return n(this,"_erasNameRegex")||of.call(this),c?this._erasNameRegex:this._erasRegex}function b1(c){return n(this,"_erasAbbrRegex")||of.call(this),c?this._erasAbbrRegex:this._erasRegex}function w1(c){return n(this,"_erasNarrowRegex")||of.call(this),c?this._erasNarrowRegex:this._erasRegex}function rf(c,p){return p.erasAbbrRegex(c)}function _1(c,p){return p.erasNameRegex(c)}function v1(c,p){return p.erasNarrowRegex(c)}function S1(c,p){return p._eraYearOrdinalRegex||Qs}function of(){var c=[],p=[],y=[],x=[],I,$,G=this.eras();for(I=0,$=G.length;I<$;++I)p.push(hr(G[I].name)),c.push(hr(G[I].abbr)),y.push(hr(G[I].narrow)),x.push(hr(G[I].name)),x.push(hr(G[I].abbr)),x.push(hr(G[I].narrow));this._erasRegex=new RegExp("^("+x.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+p.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+c.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+y.join("|")+")","i")}oe(0,["gg",2],0,function(){return this.weekYear()%100}),oe(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Oi(c,p){oe(0,[c,c.length],0,p)}Oi("gggg","weekYear"),Oi("ggggg","weekYear"),Oi("GGGG","isoWeekYear"),Oi("GGGGG","isoWeekYear"),st("weekYear","gg"),st("isoWeekYear","GG"),_t("weekYear",1),_t("isoWeekYear",1),he("G",ki),he("g",ki),he("GG",ue,Yt),he("gg",ue,Yt),he("GGGG",Vc,fa),he("gggg",Vc,fa),he("GGGGG",Si,Y),he("ggggg",Si,Y),da(["gggg","ggggg","GGGG","GGGGG"],function(c,p,y,x){p[x.substr(0,2)]=ke(c)}),da(["gg","GG"],function(c,p,y,x){p[x]=e.parseTwoDigitYear(c)});function k1(c){return rh.call(this,c,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function I1(c){return rh.call(this,c,this.isoWeek(),this.isoWeekday(),1,4)}function L1(){return xo(this.year(),1,4)}function C1(){return xo(this.isoWeekYear(),1,4)}function T1(){var c=this.localeData()._week;return xo(this.year(),c.dow,c.doy)}function P1(){var c=this.localeData()._week;return xo(this.weekYear(),c.dow,c.doy)}function rh(c,p,y,x,I){var $;return c==null?ha(this,x,I).year:($=xo(c,x,I),p>$&&(p=$),A1.call(this,c,p,y,x,I))}function A1(c,p,y,x,I){var $=Mm(c,p,y,x,I),G=ma($.year,0,$.dayOfYear);return this.year(G.getUTCFullYear()),this.month(G.getUTCMonth()),this.date(G.getUTCDate()),this}oe("Q",0,"Qo","quarter"),st("quarter","Q"),_t("quarter",7),he("Q",_i),Qe("Q",function(c,p){p[go]=(ke(c)-1)*3});function F1(c){return c==null?Math.ceil((this.month()+1)/3):this.month((c-1)*3+this.month()%3)}oe("D",["DD",2],"Do","date"),st("date","D"),_t("date",9),he("D",ue),he("DD",ue,Yt),he("Do",function(c,p){return c?p._dayOfMonthOrdinalParse||p._ordinalParse:p._dayOfMonthOrdinalParseLenient}),Qe(["D","DD"],Yr),Qe("Do",function(c,p){p[Yr]=ke(c.match(ue)[0])});var oh=vt("Date",!0);oe("DDD",["DDDD",3],"DDDo","dayOfYear"),st("dayOfYear","DDD"),_t("dayOfYear",4),he("DDD",ir),he("DDDD",vi),Qe(["DDD","DDDD"],function(c,p,y){y._dayOfYear=ke(c)});function D1(c){var p=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return c==null?p:this.add(c-p,"d")}oe("m",["mm",2],0,"minute"),st("minute","m"),_t("minute",14),he("m",ue),he("mm",ue,Yt),Qe(["m","mm"],Rr);var M1=vt("Minutes",!1);oe("s",["ss",2],0,"second"),st("second","s"),_t("second",15),he("s",ue),he("ss",ue,Yt),Qe(["s","ss"],yo);var E1=vt("Seconds",!1);oe("S",0,0,function(){return~~(this.millisecond()/100)}),oe(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),oe(0,["SSS",3],0,"millisecond"),oe(0,["SSSS",4],0,function(){return this.millisecond()*10}),oe(0,["SSSSS",5],0,function(){return this.millisecond()*100}),oe(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),oe(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),oe(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),oe(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),st("millisecond","ms"),_t("millisecond",16),he("S",ir,_i),he("SS",ir,Yt),he("SSS",ir,vi);var jo,sh;for(jo="SSSS";jo.length<=9;jo+="S")he(jo,Qs);function R1(c,p){p[bs]=ke(("0."+c)*1e3)}for(jo="S";jo.length<=9;jo+="S")Qe(jo,R1);sh=vt("Milliseconds",!1),oe("z",0,0,"zoneAbbr"),oe("zz",0,0,"zoneName");function O1(){return this._isUTC?"UTC":""}function U1(){return this._isUTC?"Coordinated Universal Time":""}var ae=E.prototype;ae.add=PS,ae.calendar=OS,ae.clone=US,ae.diff=WS,ae.endOf=e1,ae.format=jS,ae.from=YS,ae.fromNow=JS,ae.to=QS,ae.toNow=XS,ae.get=xs,ae.invalidAt=c1,ae.isAfter=$S,ae.isBefore=BS,ae.isBetween=NS,ae.isSame=HS,ae.isSameOrAfter=VS,ae.isSameOrBefore=qS,ae.isValid=i1,ae.lang=Qm,ae.locale=Jm,ae.localeData=Xm,ae.max=iS,ae.min=aS,ae.parsingFlags=l1,ae.set=Hc,ae.startOf=ZS,ae.subtract=AS,ae.toArray=s1,ae.toObject=n1,ae.toDate=o1,ae.toISOString=KS,ae.inspect=GS,typeof Symbol!="undefined"&&Symbol.for!=null&&(ae[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),ae.toJSON=a1,ae.toString=zS,ae.unix=r1,ae.valueOf=t1,ae.creationData=f1,ae.eraName=m1,ae.eraNarrow=h1,ae.eraAbbr=g1,ae.eraYear=y1,ae.year=Dm,ae.isLeapYear=nv,ae.weekYear=k1,ae.isoWeekYear=I1,ae.quarter=ae.quarters=F1,ae.month=Am,ae.daysInMonth=rv,ae.week=ae.weeks=uv,ae.isoWeek=ae.isoWeeks=dv,ae.weeksInYear=T1,ae.weeksInWeekYear=P1,ae.isoWeeksInYear=L1,ae.isoWeeksInISOWeekYear=C1,ae.date=oh,ae.day=ae.days=Iv,ae.weekday=Lv,ae.isoWeekday=Cv,ae.dayOfYear=D1,ae.hour=ae.hours=Ev,ae.minute=ae.minutes=M1,ae.second=ae.seconds=E1,ae.millisecond=ae.milliseconds=sh,ae.utcOffset=gS,ae.utc=xS,ae.local=bS,ae.parseZone=wS,ae.hasAlignedHourOffset=_S,ae.isDST=vS,ae.isLocal=kS,ae.isUtcOffset=IS,ae.isUtc=zm,ae.isUTC=zm,ae.zoneAbbr=O1,ae.zoneName=U1,ae.dates=F("dates accessor is deprecated. Use date instead.",oh),ae.months=F("months accessor is deprecated. Use month instead",Am),ae.years=F("years accessor is deprecated. Use year instead",Dm),ae.zone=F("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",yS),ae.isDSTShifted=F("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",SS);function $1(c){return at(c*1e3)}function B1(){return at.apply(null,arguments).parseZone()}function nh(c){return c}var Je=W.prototype;Je.calendar=ie,Je.longDateFormat=gt,Je.invalidDate=Kt,Je.ordinal=aa,Je.preparse=nh,Je.postformat=nh,Je.relativeTime=Ys,Je.pastFuture=la,Je.set=j,Je.eras=u1,Je.erasParse=d1,Je.erasConvertYear=p1,Je.erasAbbrRegex=b1,Je.erasNameRegex=x1,Je.erasNarrowRegex=w1,Je.months=X_,Je.monthsShort=Z_,Je.monthsParse=tv,Je.monthsRegex=sv,Je.monthsShortRegex=ov,Je.week=iv,Je.firstDayOfYear=fv,Je.firstDayOfWeek=cv,Je.weekdays=wv,Je.weekdaysMin=vv,Je.weekdaysShort=_v,Je.weekdaysParse=kv,Je.weekdaysRegex=Tv,Je.weekdaysShortRegex=Pv,Je.weekdaysMinRegex=Av,Je.isPM=Dv,Je.meridiem=Rv;function Ui(c,p,y,x){var I=bo(),$=m().set(x,p);return I[y]($,c)}function ah(c,p,y){if(l(c)&&(p=c,c=void 0),c=c||"",p!=null)return Ui(c,p,y,"month");var x,I=[];for(x=0;x<12;x++)I[x]=Ui(c,x,y,"month");return I}function sf(c,p,y,x){typeof c=="boolean"?(l(p)&&(y=p,p=void 0),p=p||""):(p=c,y=p,c=!1,l(p)&&(y=p,p=void 0),p=p||"");var I=bo(),$=c?I._week.dow:0,G,Le=[];if(y!=null)return Ui(p,(y+$)%7,x,"day");for(G=0;G<7;G++)Le[G]=Ui(p,(G+$)%7,x,"day");return Le}function N1(c,p){return ah(c,p,"months")}function H1(c,p){return ah(c,p,"monthsShort")}function V1(c,p,y){return sf(c,p,y,"weekdays")}function q1(c,p,y){return sf(c,p,y,"weekdaysShort")}function W1(c,p,y){return sf(c,p,y,"weekdaysMin")}Go("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(c){var p=c%10,y=ke(c%100/10)===1?"th":p===1?"st":p===2?"nd":p===3?"rd":"th";return c+y}}),e.lang=F("moment.lang is deprecated. Use moment.locale instead.",Go),e.langData=F("moment.langData is deprecated. Use moment.localeData instead.",bo);var wo=Math.abs;function z1(){var c=this._data;return this._milliseconds=wo(this._milliseconds),this._days=wo(this._days),this._months=wo(this._months),c.milliseconds=wo(c.milliseconds),c.seconds=wo(c.seconds),c.minutes=wo(c.minutes),c.hours=wo(c.hours),c.months=wo(c.months),c.years=wo(c.years),this}function ih(c,p,y,x){var I=Or(p,y);return c._milliseconds+=x*I._milliseconds,c._days+=x*I._days,c._months+=x*I._months,c._bubble()}function K1(c,p){return ih(this,c,p,1)}function G1(c,p){return ih(this,c,p,-1)}function lh(c){return c<0?Math.floor(c):Math.ceil(c)}function j1(){var c=this._milliseconds,p=this._days,y=this._months,x=this._data,I,$,G,Le,He;return c>=0&&p>=0&&y>=0||c<=0&&p<=0&&y<=0||(c+=lh(nf(y)+p)*864e5,p=0,y=0),x.milliseconds=c%1e3,I=Me(c/1e3),x.seconds=I%60,$=Me(I/60),x.minutes=$%60,G=Me($/60),x.hours=G%24,p+=Me(G/24),He=Me(ch(p)),y+=He,p-=lh(nf(He)),Le=Me(y/12),y%=12,x.days=p,x.months=y,x.years=Le,this}function ch(c){return c*4800/146097}function nf(c){return c*146097/4800}function Y1(c){if(!this.isValid())return NaN;var p,y,x=this._milliseconds;if(c=Gt(c),c==="month"||c==="quarter"||c==="year")switch(p=this._days+x/864e5,y=this._months+ch(p),c){case"month":return y;case"quarter":return y/3;case"year":return y/12}else switch(p=this._days+Math.round(nf(this._months)),c){case"week":return p/7+x/6048e5;case"day":return p+x/864e5;case"hour":return p*24+x/36e5;case"minute":return p*1440+x/6e4;case"second":return p*86400+x/1e3;case"millisecond":return Math.floor(p*864e5)+x;default:throw new Error("Unknown unit "+c)}}function J1(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+ke(this._months/12)*31536e6:NaN}function _o(c){return function(){return this.as(c)}}var Q1=_o("ms"),X1=_o("s"),Z1=_o("m"),e0=_o("h"),t0=_o("d"),r0=_o("w"),o0=_o("M"),s0=_o("Q"),n0=_o("y");function a0(){return Or(this)}function i0(c){return c=Gt(c),this.isValid()?this[c+"s"]():NaN}function _s(c){return function(){return this.isValid()?this._data[c]:NaN}}var l0=_s("milliseconds"),c0=_s("seconds"),f0=_s("minutes"),u0=_s("hours"),d0=_s("days"),p0=_s("months"),m0=_s("years");function h0(){return Me(this.days()/7)}var vo=Math.round,tn={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function g0(c,p,y,x,I){return I.relativeTime(p||1,!!y,c,x)}function y0(c,p,y,x){var I=Or(c).abs(),$=vo(I.as("s")),G=vo(I.as("m")),Le=vo(I.as("h")),He=vo(I.as("d")),Xe=vo(I.as("M")),Jt=vo(I.as("w")),So=vo(I.as("y")),Yo=$<=y.ss&&["s",$]||$<y.s&&["ss",$]||G<=1&&["m"]||G<y.m&&["mm",G]||Le<=1&&["h"]||Le<y.h&&["hh",Le]||He<=1&&["d"]||He<y.d&&["dd",He];return y.w!=null&&(Yo=Yo||Jt<=1&&["w"]||Jt<y.w&&["ww",Jt]),Yo=Yo||Xe<=1&&["M"]||Xe<y.M&&["MM",Xe]||So<=1&&["y"]||["yy",So],Yo[2]=p,Yo[3]=+c>0,Yo[4]=x,g0.apply(null,Yo)}function x0(c){return c===void 0?vo:typeof c=="function"?(vo=c,!0):!1}function b0(c,p){return tn[c]===void 0?!1:p===void 0?tn[c]:(tn[c]=p,c==="s"&&(tn.ss=p-1),!0)}function w0(c,p){if(!this.isValid())return this.localeData().invalidDate();var y=!1,x=tn,I,$;return typeof c=="object"&&(p=c,c=!1),typeof c=="boolean"&&(y=c),typeof p=="object"&&(x=Object.assign({},tn,p),p.s!=null&&p.ss==null&&(x.ss=p.s-1)),I=this.localeData(),$=y0(this,!y,x,I),y&&($=I.pastFuture(+this,$)),I.postformat($)}var af=Math.abs;function rn(c){return(c>0)-(c<0)||+c}function $i(){if(!this.isValid())return this.localeData().invalidDate();var c=af(this._milliseconds)/1e3,p=af(this._days),y=af(this._months),x,I,$,G,Le=this.asSeconds(),He,Xe,Jt,So;return Le?(x=Me(c/60),I=Me(x/60),c%=60,x%=60,$=Me(y/12),y%=12,G=c?c.toFixed(3).replace(/\.?0+$/,""):"",He=Le<0?"-":"",Xe=rn(this._months)!==rn(Le)?"-":"",Jt=rn(this._days)!==rn(Le)?"-":"",So=rn(this._milliseconds)!==rn(Le)?"-":"",He+"P"+($?Xe+$+"Y":"")+(y?Xe+y+"M":"")+(p?Jt+p+"D":"")+(I||x||c?"T":"")+(I?So+I+"H":"")+(x?So+x+"M":"")+(c?So+G+"S":"")):"P0D"}var je=Fi.prototype;je.isValid=dS,je.abs=z1,je.add=K1,je.subtract=G1,je.as=Y1,je.asMilliseconds=Q1,je.asSeconds=X1,je.asMinutes=Z1,je.asHours=e0,je.asDays=t0,je.asWeeks=r0,je.asMonths=o0,je.asQuarters=s0,je.asYears=n0,je.valueOf=J1,je._bubble=j1,je.clone=a0,je.get=i0,je.milliseconds=l0,je.seconds=c0,je.minutes=f0,je.hours=u0,je.days=d0,je.weeks=h0,je.months=p0,je.years=m0,je.humanize=w0,je.toISOString=$i,je.toString=$i,je.toJSON=$i,je.locale=Jm,je.localeData=Xm,je.toIsoString=F("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",$i),je.lang=Qm,oe("X",0,0,"unix"),oe("x",0,0,"valueOf"),he("x",ki),he("X",V_),Qe("X",function(c,p,y){y._d=new Date(parseFloat(c)*1e3)}),Qe("x",function(c,p,y){y._d=new Date(ke(c))});return e.version="2.29.4",t(at),e.fn=ae,e.min=lS,e.max=cS,e.now=fS,e.utc=m,e.unix=$1,e.months=N1,e.isDate=f,e.locale=Go,e.invalid=v,e.duration=Or,e.isMoment=O,e.weekdays=V1,e.parseZone=B1,e.localeData=bo,e.isDuration=Di,e.monthsShort=H1,e.weekdaysMin=W1,e.defineLocale=Gc,e.updateLocale=Bv,e.locales=Nv,e.weekdaysShort=q1,e.normalizeUnits=Gt,e.relativeTimeRounding=x0,e.relativeTimeThreshold=b0,e.calendarFormat=RS,e.prototype=ae,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e})});var WM={};lf(WM,{default:()=>Nc});module.exports=C0(WM);var qt=require("obsidian"),$_=require("obsidian"),B_=vs(wa());var lt=require("obsidian");var At=()=>new Map,Ni=o=>{let e=At();return o.forEach((t,r)=>{e.set(r,t)}),e},Ur=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},ph=(o,e)=>{let t=[];for(let[r,s]of o)t.push(e(s,r));return t},mh=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var Qr=()=>new Set;var Hi=o=>o[o.length-1];var hh=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},$r=Array.from;var ff=Array.isArray;var Vi=class{constructor(){this._observers=At()}on(e,t){return Ur(this._observers,e,Qr).add(t),t}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return $r((this._observers.get(e)||At()).values()).forEach(r=>r(...t))}destroy(){this._observers=At()}},sn=class{constructor(){this._observers=At()}on(e,t){Ur(this._observers,e,Qr).add(t)}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return $r((this._observers.get(e)||At()).values()).forEach(r=>r(...t))}destroy(){this._observers=At()}};var lr=Math.floor;var nn=Math.abs;var an=(o,e)=>o<e?o:e,Br=(o,e)=>o>e?o:e,jM=Number.isNaN;var qi=o=>o!==0?o<0:1/o<0;var df=Number.MAX_SAFE_INTEGER,YM=Number.MIN_SAFE_INTEGER,JM=1<<31;var gh=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&lr(o)===o),QM=Number.isNaN,XM=Number.parseInt;var P0=String.fromCharCode,ZM=String.fromCodePoint,eE=P0(65535),A0=o=>o.toLowerCase(),F0=/^\s*/g,D0=o=>o.replace(F0,""),M0=/([A-Z])/g,pf=(o,e)=>D0(o.replace(M0,t=>`${e}${A0(t)}`));var E0=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},fn=typeof TextEncoder!="undefined"?new TextEncoder:null,R0=o=>fn.encode(o),xh=fn?R0:E0;var cn=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});cn&&cn.decode(new Uint8Array).length===1&&(cn=null);var Ss=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Is=()=>new Ss;var O0=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var gr=o=>{let e=new Uint8Array(O0(o)),t=0;for(let r=0;r<o.bufs.length;r++){let s=o.bufs[r];e.set(s,t),t+=s.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},U0=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(Br(t,e)*2),o.cpos=0)},Ft=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var zi=Ft;var Re=(o,e)=>{for(;e>127;)Ft(o,128|127&e),e=lr(e/128);Ft(o,127&e)},Ki=(o,e)=>{let t=qi(e);for(t&&(e=-e),Ft(o,(e>63?128:0)|(t?64:0)|63&e),e=lr(e/64);e>0;)Ft(o,(e>127?128:0)|127&e),e=lr(e/128)},hf=new Uint8Array(3e4),$0=hf.length/3,B0=(o,e)=>{if(e.length<$0){let t=fn.encodeInto(e,hf).written||0;Re(o,t);for(let r=0;r<t;r++)Ft(o,hf[r])}else Dt(o,xh(e))},N0=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Re(o,r);for(let s=0;s<r;s++)Ft(o,t.codePointAt(s))},ko=fn&&fn.encodeInto?B0:N0;var Sa=(o,e)=>{let t=o.cbuf.length,r=o.cpos,s=an(t-r,e.length),n=e.length-s;o.cbuf.set(e.subarray(0,s),r),o.cpos+=s,n>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(Br(t*2,n)),o.cbuf.set(e.subarray(s)),o.cpos=n)},Dt=(o,e)=>{Re(o,e.byteLength),Sa(o,e)},gf=(o,e)=>{U0(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},H0=(o,e)=>gf(o,4).setFloat32(0,e,!1),V0=(o,e)=>gf(o,8).setFloat64(0,e,!1),q0=(o,e)=>gf(o,8).setBigInt64(0,e,!1);var wh=new DataView(new ArrayBuffer(4)),W0=o=>(wh.setFloat32(0,o),wh.getFloat32(0)===o),dn=(o,e)=>{switch(typeof e){case"string":Ft(o,119),ko(o,e);break;case"number":gh(e)&&nn(e)<=2147483647?(Ft(o,125),Ki(o,e)):W0(e)?(Ft(o,124),H0(o,e)):(Ft(o,123),V0(o,e));break;case"bigint":Ft(o,122),q0(o,e);break;case"object":if(e===null)Ft(o,126);else if(ff(e)){Ft(o,117),Re(o,e.length);for(let t=0;t<e.length;t++)dn(o,e[t])}else if(e instanceof Uint8Array)Ft(o,116),Dt(o,e);else{Ft(o,118);let t=Object.keys(e);Re(o,t.length);for(let r=0;r<t.length;r++){let s=t[r];ko(o,s),dn(o,e[s])}}break;case"boolean":Ft(o,e?120:121);break;default:Ft(o,127)}},va=class extends Ss{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Re(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var _h=o=>{o.count>0&&(Ki(o.encoder,o.count===1?o.s:-o.s),o.count>1&&Re(o.encoder,o.count-2))},ks=class{constructor(){this.encoder=new Ss,this.s=0,this.count=0}write(e){this.s===e?this.count++:(_h(this),this.count=1,this.s=e)}toUint8Array(){return _h(this),gr(this.encoder)}};var vh=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);Ki(o.encoder,e),o.count>1&&Re(o.encoder,o.count-2)}},pn=class{constructor(){this.encoder=new Ss,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(vh(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return vh(this),gr(this.encoder)}},Wi=class{constructor(){this.sarr=[],this.s="",this.lensE=new ks}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Ss;return this.sarr.push(this.s),this.s="",ko(e,this.sarr.join("")),Sa(e,this.lensE.toUint8Array()),gr(e)}};var Tr=o=>new Error(o),Nr=()=>{throw Tr("Method unimplemented")},Pr=()=>{throw Tr("Unexpected case")};var Sh=Tr("Unexpected end of array"),kh=Tr("Integer out of Range"),mn=class{constructor(e){this.arr=e,this.pos=0}},Vr=o=>new mn(o),Ih=o=>o.pos!==o.arr.length;var z0=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},Ut=o=>z0(o,Ee(o));var Ls=o=>o.arr[o.pos++];var Ee=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let s=o.arr[o.pos++];if(e=e+(s&127)*t,t*=128,s<128)return e;if(e>df)throw kh}throw Sh},ji=o=>{let e=o.arr[o.pos++],t=e&63,r=64,s=(e&64)>0?-1:1;if(!(e&128))return s*t;let n=o.arr.length;for(;o.pos<n;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return s*t;if(t>df)throw kh}throw Sh};var K0=o=>{let e=Ee(o);if(e===0)return"";{let t=String.fromCodePoint(Ls(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(Ls(o));else for(;e>0;){let r=e<1e4?e:1e4,s=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,s),e-=r}return decodeURIComponent(escape(t))}},G0=o=>cn.decode(Ut(o)),Hr=cn?G0:K0;var bf=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},j0=o=>bf(o,4).getFloat32(0,!1),Y0=o=>bf(o,8).getFloat64(0,!1),J0=o=>bf(o,8).getBigInt64(0,!1);var Q0=[o=>{},o=>null,ji,j0,Y0,J0,o=>!1,o=>!0,Hr,o=>{let e=Ee(o),t={};for(let r=0;r<e;r++){let s=Hr(o);t[s]=hn(o)}return t},o=>{let e=Ee(o),t=[];for(let r=0;r<e;r++)t.push(hn(o));return t},Ut],hn=o=>Q0[127-Ls(o)](o),ka=class extends mn{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Ih(this)?this.count=Ee(this)+1:this.count=-1),this.count--,this.s}};var Cs=class extends mn{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=ji(this);let e=qi(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ee(this)+2)}return this.count--,this.s}};var gn=class extends mn{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=ji(this),t=e&1;this.diff=lr(e/2),this.count=1,t&&(this.count=Ee(this)+2)}return this.s+=this.diff,this.count--,this.s}},Gi=class{constructor(e){this.decoder=new Cs(e),this.str=Hr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var oE=crypto.subtle,Lh=crypto.getRandomValues.bind(crypto);var Ia=()=>Lh(new Uint32Array(1))[0];var X0=[1e7]+-1e3+-4e3+-8e3+-1e11,yn=()=>X0.replace(/[018]/g,o=>(o^Ia()&15>>o/4).toString(16));var Ts=Date.now;var Io=o=>new Promise(o);var Z0=Promise.all.bind(Promise);var _f=o=>o===void 0?null:o;var vf=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Ph=new vf,tk=!0;try{typeof localStorage!="undefined"&&localStorage&&(Ph=localStorage,tk=!1)}catch(o){}var Ah=Ph;var Fh=Object.assign,ok=Object.keys,Dh=(o,e)=>{for(let t in o)e(o[t],t)};var La=o=>ok(o).length;var Mh=o=>{for(let e in o)return!1;return!0},sk=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},Sf=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),kf=(o,e)=>o===e||La(o)===La(e)&&sk(o,(t,r)=>(t!==void 0||Sf(e,r))&&e[r]===t);var Ca=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&Ca(o,e,t+1)}};var Rh=o=>o,nk=(o,e)=>o===e;var xn=(o,e)=>{if(o==null||e==null)return nk(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!xn(o.get(t),e.get(t)))return!1;break}case Object:if(La(o)!==La(e))return!1;for(let t in o)if(!Sf(o,t)||!xn(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!xn(o[t],e[t]))return!1;break;default:return!1}return!0},Oh=(o,e)=>e.includes(o);var Ta=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var aE=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,Xr,ak=[],ik=()=>{if(Xr===void 0)if(Ta){Xr=At();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&Xr.set(e,""),e=r):e!==null?(Xr.set(e,r),e=null):ak.push(r)}e!==null&&Xr.set(e,"")}else typeof location=="object"?(Xr=At(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");Xr.set(`--${pf(e,"-")}`,t),Xr.set(`-${pf(e,"-")}`,t)}})):Xr=At();return Xr},Lf=o=>ik().has(o);var Cf=o=>Ta?_f(process.env[o.toUpperCase().replaceAll("-","_")]):_f(Ah.getItem(o));var lk=o=>Lf("--"+o)||Cf(o)!==null,iE=lk("production"),Uh=Ta&&Oh(process.env.FORCE_COLOR,["true","1","2"]),$h=!Lf("no-colors")&&(!Ta||process.stdout.isTTY||Uh)&&(!Ta||Lf("color")||Uh||Cf("COLORTERM")!==null||(Cf("TERM")||"").includes("color"));var fk=o=>new Uint8Array(o);var Bh=o=>{let e=fk(o.byteLength);return e.set(o),e};var Tf=class{constructor(e,t){this.left=e,this.right=t}},Qt=(o,e)=>new Tf(o,e);var Nh=(o,e)=>o.forEach(t=>e(t.left,t.right));var Zr=typeof document!="undefined"?document:{},dk=o=>Zr.createElement(o),pk=()=>Zr.createDocumentFragment(),mk=o=>Zr.createTextNode(o),lE=typeof DOMParser!="undefined"?new DOMParser:null;var hk=(o,e)=>(Nh(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var gk=o=>{let e=pk();for(let t=0;t<o.length;t++)qh(e,o[t]);return e},Hh=(o,e)=>(qh(o,gk(e)),o);var Pa=(o,e=[],t=[])=>Hh(hk(dk(o),e),t);var bn=mk;var Vh=o=>ph(o,(e,t)=>`${t}:${e};`).join("");var qh=(o,e)=>o.appendChild(e),cE=Zr.ELEMENT_NODE,fE=Zr.TEXT_NODE,uE=Zr.CDATA_SECTION_NODE,dE=Zr.COMMENT_NODE,pE=Zr.DOCUMENT_NODE,mE=Zr.DOCUMENT_TYPE_NODE,hE=Zr.DOCUMENT_FRAGMENT_NODE;var eo=Symbol;var Aa=eo(),Fa=eo(),Af=eo(),Ff=eo(),Df=eo(),Da=eo(),Mf=eo(),Ma=eo(),Ef=eo(),zh=o=>{var s;o.length===1&&((s=o[0])==null?void 0:s.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let n=o[r];n===void 0?e.push("undefined"):n.constructor===String||n.constructor===Number?e.push(n):n.constructor===Object&&t.push(JSON.stringify(n))}return t};var gE=Ts();var bk={[Aa]:Qt("font-weight","bold"),[Fa]:Qt("font-weight","normal"),[Af]:Qt("color","blue"),[Df]:Qt("color","green"),[Ff]:Qt("color","grey"),[Da]:Qt("color","red"),[Mf]:Qt("color","purple"),[Ma]:Qt("color","orange"),[Ef]:Qt("color","black")},wk=o=>{var a;o.length===1&&((a=o[0])==null?void 0:a.constructor)===Function&&(o=o[0]());let e=[],t=[],r=At(),s=[],n=0;for(;n<o.length;n++){let i=o[n],l=bk[i];if(l!==void 0)r.set(l.left,l.right);else{if(i===void 0)break;if(i.constructor===String||i.constructor===Number){let f=Vh(r);n>0||f.length>0?(e.push("%c"+i),t.push(f)):e.push(i)}else break}}for(n>0&&(s=t,s.unshift(e.join("")));n<o.length;n++){let i=o[n];i instanceof Symbol||s.push(i)}return s},_k=$h?wk:zh,Kh=(...o)=>{console.log(..._k(o)),vk.forEach(e=>e.print(o))};var vk=Qr();var Gh=o=>({[Symbol.iterator](){return this},next:o}),jh=(o,e)=>Gh(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),Ji=(o,e)=>Gh(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var Ra=class{constructor(e,t){this.clock=e,this.len=t}},Ps=class{constructor(){this.clients=new Map}},cg=(o,e,t)=>e.clients.forEach((r,s)=>{let n=o.doc.store.clients.get(s);for(let a=0;a<r.length;a++){let i=r[a];xg(o,n,i.clock,i.len,t)}}),Ck=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let s=lr((t+r)/2),n=o[s],a=n.clock;if(a<=e){if(e<a+n.len)return s;t=s+1}else r=s-1}return null},Jf=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&Ck(t,e.clock)!==null},Qf=o=>{o.clients.forEach(e=>{e.sort((s,n)=>s.clock-n.clock);let t,r;for(t=1,r=1;t<e.length;t++){let s=e[r-1],n=e[t];s.clock+s.len>=n.clock?s.len=Br(s.len,n.clock+n.len-s.clock):(r<t&&(e[r]=n),r++)}e.length=r})},Of=o=>{let e=new Ps;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,s)=>{if(!e.clients.has(s)){let n=r.slice();for(let a=t+1;a<o.length;a++)hh(n,o[a].clients.get(s)||[]);e.clients.set(s,n)}});return Qf(e),e},ol=(o,e,t,r)=>{Ur(o.clients,e,()=>[]).push(new Ra(t,r))},Xf=()=>new Ps,Tk=o=>{let e=Xf();return o.clients.forEach((t,r)=>{let s=[];for(let n=0;n<t.length;n++){let a=t[n];if(a.deleted){let i=a.id.clock,l=a.length;if(n+1<t.length)for(let f=t[n+1];n+1<t.length&&f.deleted;f=t[++n+1])l+=f.length;s.push(new Ra(i,l))}}s.length>0&&e.clients.set(r,s)}),e},es=(o,e)=>{Re(o.restEncoder,e.clients.size),$r(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),Re(o.restEncoder,t);let s=r.length;Re(o.restEncoder,s);for(let n=0;n<s;n++){let a=r[n];o.writeDsClock(a.clock),o.writeDsLen(a.len)}})},Oa=o=>{let e=new Ps,t=Ee(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let s=Ee(o.restDecoder),n=Ee(o.restDecoder);if(n>0){let a=Ur(e.clients,s,()=>[]);for(let i=0;i<n;i++)a.push(new Ra(o.readDsClock(),o.readDsLen()))}}return e},Qh=(o,e,t)=>{let r=new Ps,s=Ee(o.restDecoder);for(let n=0;n<s;n++){o.resetDsCurVal();let a=Ee(o.restDecoder),i=Ee(o.restDecoder),l=t.clients.get(a)||[],f=St(t,a);for(let u=0;u<i;u++){let d=o.readDsClock(),m=d+o.readDsLen();if(d<f){f<m&&ol(r,a,f,m-f);let g=ro(l,d),h=l[g];for(!h.deleted&&h.id.clock<d&&(l.splice(g+1,0,dl(e,h,d-h.id.clock)),g++);g<l.length&&(h=l[g++],h.id.clock<m);)h.deleted||(m<h.id.clock+h.length&&l.splice(g,0,dl(e,h,m-h.id.clock)),h.delete(e))}else ol(r,a,d,m-d)}}if(r.clients.size>0){let n=new Lo;return Re(n.restEncoder,0),es(n,r),n.toUint8Array()}return null};var fg=Ia,yr=class extends Vi{constructor({guid:e=yn(),collectionid:t=null,gc:r=!0,gcFilter:s=()=>!0,meta:n=null,autoLoad:a=!1,shouldLoad:i=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=fg(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new ll,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=i,this.autoLoad=a,this.meta=n,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Io(f=>{this.on("load",()=>{this.isLoaded=!0,f(this)})});let l=()=>Io(f=>{let u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),f())};this.on("sync",u)});this.on("sync",f=>{f===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=f===void 0||f===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&Ze(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set($r(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Ze(this,e,t)}get(e,t=Ct){let r=Ur(this.share,e,()=>{let n=new t;return n._integrate(this,null),n}),s=r.constructor;if(t!==Ct&&s!==t)if(s===Ct){let n=new t;n._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=n}),n._start=r._start;for(let a=n._start;a!==null;a=a.right)a.parent=n;return n._length=r._length,this.share.set(e,n),n._integrate(this,null),n}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,to)}getText(e=""){return this.get(e,os)}getMap(e=""){return this.get(e,Co)}getXmlElement(e=""){return this.get(e,ss)}getXmlFragment(e=""){return this.get(e,To)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){$r(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new yr({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Ze(e.parent.doc,r=>{let s=t.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},vn=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ee(this.restDecoder)}readDsLen(){return Ee(this.restDecoder)}},sl=class extends vn{readLeftID(){return Ve(Ee(this.restDecoder),Ee(this.restDecoder))}readRightID(){return Ve(Ee(this.restDecoder),Ee(this.restDecoder))}readClient(){return Ee(this.restDecoder)}readInfo(){return Ls(this.restDecoder)}readString(){return Hr(this.restDecoder)}readParentInfo(){return Ee(this.restDecoder)===1}readTypeRef(){return Ee(this.restDecoder)}readLen(){return Ee(this.restDecoder)}readAny(){return hn(this.restDecoder)}readBuf(){return Bh(Ut(this.restDecoder))}readJSON(){return JSON.parse(Hr(this.restDecoder))}readKey(){return Hr(this.restDecoder)}},Uf=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ee(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Ee(this.restDecoder)+1;return this.dsCurrVal+=e,e}},ts=class extends Uf{constructor(e){super(e),this.keys=[],Ee(e),this.keyClockDecoder=new gn(Ut(e)),this.clientDecoder=new Cs(Ut(e)),this.leftClockDecoder=new gn(Ut(e)),this.rightClockDecoder=new gn(Ut(e)),this.infoDecoder=new ka(Ut(e),Ls),this.stringDecoder=new Gi(Ut(e)),this.parentInfoDecoder=new ka(Ut(e),Ls),this.typeRefDecoder=new Cs(Ut(e)),this.lenDecoder=new Cs(Ut(e))}readLeftID(){return new Zo(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Zo(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return hn(this.restDecoder)}readBuf(){return Ut(this.restDecoder)}readJSON(){return hn(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},Sn=class{constructor(){this.restEncoder=Is()}toUint8Array(){return gr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Re(this.restEncoder,e)}writeDsLen(e){Re(this.restEncoder,e)}},As=class extends Sn{writeLeftID(e){Re(this.restEncoder,e.client),Re(this.restEncoder,e.clock)}writeRightID(e){Re(this.restEncoder,e.client),Re(this.restEncoder,e.clock)}writeClient(e){Re(this.restEncoder,e)}writeInfo(e){zi(this.restEncoder,e)}writeString(e){ko(this.restEncoder,e)}writeParentInfo(e){Re(this.restEncoder,e?1:0)}writeTypeRef(e){Re(this.restEncoder,e)}writeLen(e){Re(this.restEncoder,e)}writeAny(e){dn(this.restEncoder,e)}writeBuf(e){Dt(this.restEncoder,e)}writeJSON(e){ko(this.restEncoder,JSON.stringify(e))}writeKey(e){ko(this.restEncoder,e)}},nl=class{constructor(){this.restEncoder=Is(),this.dsCurrVal=0}toUint8Array(){return gr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,Re(this.restEncoder,t)}writeDsLen(e){e===0&&Pr(),Re(this.restEncoder,e-1),this.dsCurrVal+=e}},Lo=class extends nl{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new pn,this.clientEncoder=new ks,this.leftClockEncoder=new pn,this.rightClockEncoder=new pn,this.infoEncoder=new va(zi),this.stringEncoder=new Wi,this.parentInfoEncoder=new va(zi),this.typeRefEncoder=new ks,this.lenEncoder=new ks}toUint8Array(){let e=Is();return Re(e,0),Dt(e,this.keyClockEncoder.toUint8Array()),Dt(e,this.clientEncoder.toUint8Array()),Dt(e,this.leftClockEncoder.toUint8Array()),Dt(e,this.rightClockEncoder.toUint8Array()),Dt(e,gr(this.infoEncoder)),Dt(e,this.stringEncoder.toUint8Array()),Dt(e,gr(this.parentInfoEncoder)),Dt(e,this.typeRefEncoder.toUint8Array()),Dt(e,this.lenEncoder.toUint8Array()),Sa(e,gr(this.restEncoder)),gr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){dn(this.restEncoder,e)}writeBuf(e){Dt(this.restEncoder,e)}writeJSON(e){dn(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},Pk=(o,e,t,r)=>{r=Br(r,e[0].id.clock);let s=ro(e,r);Re(o.restEncoder,e.length-s),o.writeClient(t),Re(o.restEncoder,r);let n=e[s];n.write(o,r-n.id.clock);for(let a=s+1;a<e.length;a++)e[a].write(o,0)},Zf=(o,e,t)=>{let r=new Map;t.forEach((s,n)=>{St(e,n)>s&&r.set(n,s)}),pl(e).forEach((s,n)=>{t.has(n)||r.set(n,0)}),Re(o.restEncoder,r.size),$r(r.entries()).sort((s,n)=>n[0]-s[0]).forEach(([s,n])=>{Pk(o,e.clients.get(s),s,n)})},Ak=(o,e)=>{let t=At(),r=Ee(o.restDecoder);for(let s=0;s<r;s++){let n=Ee(o.restDecoder),a=new Array(n),i=o.readClient(),l=Ee(o.restDecoder);t.set(i,{i:0,refs:a});for(let f=0;f<n;f++){let u=o.readInfo();switch(31&u){case 0:{let d=o.readLen();a[f]=new cr(Ve(i,l),d),l+=d;break}case 10:{let d=Ee(o.restDecoder);a[f]=new fr(Ve(i,l),d),l+=d;break}default:{let d=(u&192)===0,m=new ft(Ve(i,l),null,(u&128)===128?o.readLeftID():null,null,(u&64)===64?o.readRightID():null,d?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,d&&(u&32)===32?o.readString():null,Ug(o,u));a[f]=m,l+=m.length}}}}return t},Fk=(o,e,t)=>{let r=[],s=$r(t.keys()).sort((g,h)=>g-h);if(s.length===0)return null;let n=()=>{if(s.length===0)return null;let g=t.get(s[s.length-1]);for(;g.refs.length===g.i;)if(s.pop(),s.length>0)g=t.get(s[s.length-1]);else return null;return g},a=n();if(a===null)return null;let i=new ll,l=new Map,f=(g,h)=>{let _=l.get(g);(_==null||_>h)&&l.set(g,h)},u=a.refs[a.i++],d=new Map,m=()=>{for(let g of r){let h=g.id.client,_=t.get(h);_?(_.i--,i.clients.set(h,_.refs.slice(_.i)),t.delete(h),_.i=0,_.refs=[]):i.clients.set(h,[g]),s=s.filter(w=>w!==h)}r.length=0};for(;;){if(u.constructor!==fr){let h=Ur(d,u.id.client,()=>St(e,u.id.client))-u.id.clock;if(h<0)r.push(u),f(u.id.client,u.id.clock-1),m();else{let _=u.getMissing(o,e);if(_!==null){r.push(u);let w=t.get(_)||{refs:[],i:0};if(w.refs.length===w.i)f(_,St(e,_)),m();else{u=w.refs[w.i++];continue}}else(h===0||h<u.length)&&(u.integrate(o,h),d.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(a!==null&&a.i<a.refs.length)u=a.refs[a.i++];else{if(a=n(),a===null)break;u=a.refs[a.i++]}}if(i.clients.size>0){let g=new Lo;return Zf(g,i,new Map),Re(g.restEncoder,0),{missing:l,update:g.toUint8Array()}}return null},Dk=(o,e)=>Zf(o,e.doc.store,e.beforeState),Mk=(o,e,t,r=new ts(o))=>Ze(e,s=>{s.local=!1;let n=!1,a=s.doc,i=a.store,l=Ak(r,a),f=Fk(s,i,l),u=i.pendingStructs;if(u){for(let[m,g]of u.missing)if(g<St(i,m)){n=!0;break}if(f){for(let[m,g]of f.missing){let h=u.missing.get(m);(h==null||h>g)&&u.missing.set(m,g)}u.update=cl([u.update,f.update])}}else i.pendingStructs=f;let d=Qh(r,s,i);if(i.pendingDs){let m=new ts(Vr(i.pendingDs));Ee(m.restDecoder);let g=Qh(m,s,i);d&&g?i.pendingDs=cl([d,g]):i.pendingDs=d||g}else i.pendingDs=d;if(n){let m=i.pendingStructs.update;i.pendingStructs=null,ug(s.doc,m)}},t,!1);var ug=(o,e,t,r=ts)=>{let s=Vr(e);Mk(s,o,t,new r(s))},Fo=(o,e,t)=>ug(o,e,t,sl),Ek=(o,e,t=new Map)=>{Zf(o,e.store,t),es(o,Tk(e.store))},Rk=(o,e=new Uint8Array([0]),t=new Lo)=>{let r=dg(e);Ek(t,o,r);let s=[t.toUint8Array()];if(o.store.pendingDs&&s.push(o.store.pendingDs),o.store.pendingStructs&&s.push(jk(o.store.pendingStructs.update,e)),s.length>1){if(t.constructor===As)return Kk(s.map((n,a)=>a===0?n:Jk(n)));if(t.constructor===Lo)return cl(s)}return s[0]},Es=(o,e)=>Rk(o,e,new As),Ok=o=>{let e=new Map,t=Ee(o.restDecoder);for(let r=0;r<t;r++){let s=Ee(o.restDecoder),n=Ee(o.restDecoder);e.set(s,n)}return e},dg=o=>Ok(new vn(Vr(o))),pg=(o,e)=>(Re(o.restEncoder,e.size),$r(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{Re(o.restEncoder,t),Re(o.restEncoder,r)}),o),Uk=(o,e)=>pg(o,pl(e.store)),$k=(o,e=new nl)=>(o instanceof Map?pg(e,o):Uk(e,o),e.toUint8Array()),mg=o=>$k(o,new Sn),$f=class{constructor(){this.l=[]}},Xh=()=>new $f,Zh=(o,e)=>o.l.push(e),eg=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(s=>e!==s),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},hg=(o,e,t)=>Ca(o.l,[e,t]),Zo=class{constructor(e,t){this.client=e,this.clock=t}},_n=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,Ve=(o,e)=>new Zo(o,e);var gg=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw Pr()};var al=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let s=(n,a)=>{let i=n.get("ds"),l=n.get("ids"),f=u=>this.clients.set(u,a);i.observe(u=>{u.changes.added.forEach(d=>{d.content.getContent().forEach(m=>{m instanceof Uint8Array&&this.dss.set(a,Of([this.dss.get(a)||Xf(),Oa(new vn(Vr(m)))]))})})}),this.dss.set(a,Of(i.map(u=>Oa(new vn(Vr(u)))))),l.observe(u=>u.changes.added.forEach(d=>d.content.getContent().forEach(f))),l.forEach(f)};t.observe(n=>{n.keysChanged.forEach(a=>s(t.get(a),a))}),t.forEach(s)}setUserMapping(e,t,r,{filter:s=()=>!0}={}){let n=this.yusers,a=n.get(r);a||(a=new Co,a.set("ids",new to),a.set("ds",new to),n.set(r,a)),a.get("ids").push([t]),n.observe(i=>{setTimeout(()=>{let l=n.get(r);if(l!==a){a=l,this.clients.forEach((d,m)=>{r===d&&a.get("ids").push([m])});let f=new Sn,u=this.dss.get(r);u&&(es(f,u),a.get("ds").push([f.toUint8Array()]))}},0)}),e.on("afterTransaction",i=>{setTimeout(()=>{let l=a.get("ds"),f=i.deleteSet;if(i.local&&f.clients.size>0&&s(i,f)){let u=new Sn;es(u,f),l.push([u.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(Jf(r,e))return t;return null}},il=class{constructor(e,t,r,s=0){this.type=e,this.tname=t,this.item=r,this.assoc=s}};var eu=o=>new il(o.type==null?null:Ve(o.type.client,o.type.clock),o.tname||null,o.item==null?null:Ve(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),Bf=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},Bk=(o,e,t=0)=>new Bf(o,e,t),Qi=(o,e,t)=>{let r=null,s=null;return o._item===null?s=gg(o):r=Ve(o._item.id.client,o._item.id.clock),new il(r,s,e,t)},tu=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return Qi(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return Qi(o,Ve(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return Qi(o,r.lastId,t);r=r.right}return Qi(o,null,t)};var ru=(o,e)=>{let t=e.store,r=o.item,s=o.type,n=o.tname,a=o.assoc,i=null,l=0;if(r!==null){if(St(t,r.client)<=r.clock)return null;let f=lg(t,r),u=f.item;if(!(u instanceof ft))return null;if(i=u.parent,i._item===null||!i._item.deleted){l=u.deleted||!u.countable?0:f.diff+(a>=0?0:1);let d=u.left;for(;d!==null;)!d.deleted&&d.countable&&(l+=d.length),d=d.left}}else{if(n!==null)i=e.get(n);else if(s!==null){if(St(t,s.client)<=s.clock)return null;let{item:f}=lg(t,s);if(f instanceof ft&&f.content instanceof Fr)i=f.content.type;else return null}else throw Pr();a>=0?l=i._length:l=0}return Bk(i,l,o.assoc)},ou=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&_n(o.item,e.item)&&_n(o.type,e.type)&&o.assoc===e.assoc,Nf=class{constructor(e,t){this.ds=e,this.sv=t}};var Nk=(o,e)=>new Nf(o,e),LE=Nk(Xf(),new Map);var wn=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!Jf(e.ds,o.id),Hf=(o,e)=>{let t=Ur(o.meta,Hf,Qr),r=o.doc.store;t.has(e)||(e.sv.forEach((s,n)=>{s<St(r,n)&&rs(o,Ve(n,s))}),cg(o,e.ds,s=>{}),t.add(e))};var ll=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},pl=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let s=t[t.length-1];e.set(r,s.id.clock+s.length)}),e},St=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},yg=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Pr()}t.push(e)},ro=(o,e)=>{let t=0,r=o.length-1,s=o[r],n=s.id.clock;if(n===e)return r;let a=lr(e/(n+s.length-1)*r);for(;t<=r;){if(s=o[a],n=s.id.clock,n<=e){if(e<n+s.length)return a;t=a+1}else r=a-1;a=lr((t+r)/2)}throw Pr()},Hk=(o,e)=>{let t=o.clients.get(e.client);return t[ro(t,e.clock)]},el=Hk,Vf=(o,e,t)=>{let r=ro(e,t),s=e[r];return s.id.clock<t&&s instanceof ft?(e.splice(r+1,0,dl(o,s,t-s.id.clock)),r+1):r},rs=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[Vf(o,t,e.clock)]},tg=(o,e,t)=>{let r=e.clients.get(t.client),s=ro(r,t.clock),n=r[s];return t.clock!==n.id.clock+n.length-1&&n.constructor!==cr&&r.splice(s+1,0,dl(o,n,t.clock-n.id.clock+1)),n},Vk=(o,e,t)=>{let r=o.clients.get(e.id.client);r[ro(r,e.id.clock)]=t},xg=(o,e,t,r,s)=>{if(r===0)return;let n=t+r,a=Vf(o,e,t),i;do i=e[a++],n<i.id.clock+i.length&&Vf(o,e,n),s(i);while(a<e.length&&e[a].id.clock<n)},qf=class{constructor(e,t,r){this.doc=e,this.deleteSet=new Ps,this.beforeState=pl(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},rg=(o,e)=>e.deleteSet.clients.size===0&&!mh(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Qf(e.deleteSet),Dk(o,e),es(o,e.deleteSet),!0),og=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&Ur(o.changed,e,Qr).add(t)},tl=(o,e)=>{let t=o[e],r=o[e-1],s=e;for(;s>0;t=r,r=o[--s-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof ft&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let n=e-s;return n&&o.splice(e+1-n,n),n},qk=(o,e,t)=>{for(let[r,s]of o.clients.entries()){let n=e.clients.get(r);for(let a=s.length-1;a>=0;a--){let i=s[a],l=i.clock+i.len;for(let f=ro(n,i.clock),u=n[f];f<n.length&&u.id.clock<l;u=n[++f]){let d=n[f];if(i.clock+i.len<=d.id.clock)break;d instanceof ft&&d.deleted&&!d.keep&&t(d)&&d.gc(e,!1)}}}},Wk=(o,e)=>{o.clients.forEach((t,r)=>{let s=e.clients.get(r);for(let n=t.length-1;n>=0;n--){let a=t[n],i=an(s.length-1,1+ro(s,a.clock+a.len-1));for(let l=i,f=s[l];l>0&&f.id.clock>=a.clock;f=s[l])l-=1+tl(s,l)}})};var bg=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,s=r.store,n=t.deleteSet,a=t._mergeStructs;try{Qf(n),t.afterState=pl(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let i=[];t.changed.forEach((l,f)=>i.push(()=>{(f._item===null||!f._item.deleted)&&f._callObserver(t,l)})),i.push(()=>{t.changedParentTypes.forEach((l,f)=>{f._dEH.l.length>0&&(f._item===null||!f._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=f,u._path=null}),l.sort((u,d)=>u.path.length-d.path.length),hg(f._dEH,l,t))})}),i.push(()=>r.emit("afterTransaction",[t,r])),Ca(i,[]),t._needFormattingCleanup&&iI(t)}finally{r.gc&&qk(n,s,r.gcFilter),Wk(n,s),t.afterState.forEach((u,d)=>{let m=t.beforeState.get(d)||0;if(m!==u){let g=s.clients.get(d),h=Br(ro(g,m),1);for(let _=g.length-1;_>=h;)_-=1+tl(g,_)}});for(let u=a.length-1;u>=0;u--){let{client:d,clock:m}=a[u].id,g=s.clients.get(d),h=ro(g,m);h+1<g.length&&tl(g,h+1)>1||h>0&&tl(g,h)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(Kh(Ma,Aa,"[yjs] ",Fa,Da,"Changed the client-id because another client seems to be using it."),r.clientID=fg()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let u=new As;rg(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let u=new Lo;rg(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}let{subdocsAdded:i,subdocsLoaded:l,subdocsRemoved:f}=t;(i.size>0||f.size>0||l.size>0)&&(i.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),f.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:i,removed:f},r,t]),f.forEach(u=>u.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):bg(o,e+1)}}},Ze=(o,e,t=null,r=!0)=>{let s=o._transactionCleanups,n=!1,a=null;o._transaction===null&&(n=!0,o._transaction=new qf(o,t,r),s.push(o._transaction),s.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{a=e(o._transaction)}finally{if(n){let i=o._transaction===s[0];o._transaction=null,i&&bg(s,0)}}return a};function*zk(o){let e=Ee(o.restDecoder);for(let t=0;t<e;t++){let r=Ee(o.restDecoder),s=o.readClient(),n=Ee(o.restDecoder);for(let a=0;a<r;a++){let i=o.readInfo();if(i===10){let l=Ee(o.restDecoder);yield new fr(Ve(s,n),l),n+=l}else if(31&i){let l=(i&192)===0,f=new ft(Ve(s,n),null,(i&128)===128?o.readLeftID():null,null,(i&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(i&32)===32?o.readString():null,Ug(o,i));yield f,n+=f.length}else{let l=o.readLen();yield new cr(Ve(s,n),l),n+=l}}}}var Ua=class{constructor(e,t){this.gen=zk(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===fr);return this.curr}};var $a=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},Kk=o=>cl(o,sl,As);var Gk=(o,e)=>{if(o.constructor===cr){let{client:t,clock:r}=o.id;return new cr(Ve(t,r+e),o.length-e)}else if(o.constructor===fr){let{client:t,clock:r}=o.id;return new fr(Ve(t,r+e),o.length-e)}else{let t=o,{client:r,clock:s}=t.id;return new ft(Ve(r,s+e),null,Ve(r,s+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},cl=(o,e=ts,t=Lo)=>{if(o.length===1)return o[0];let r=o.map(u=>new e(Vr(u))),s=r.map(u=>new Ua(u,!0)),n=null,a=new t,i=new $a(a);for(;s=s.filter(m=>m.curr!==null),s.sort((m,g)=>{if(m.curr.id.client===g.curr.id.client){let h=m.curr.id.clock-g.curr.id.clock;return h===0?m.curr.constructor===g.curr.constructor?0:m.curr.constructor===fr?1:-1:h}else return g.curr.id.client-m.curr.id.client}),s.length!==0;){let u=s[0],d=u.curr.id.client;if(n!==null){let m=u.curr,g=!1;for(;m!==null&&m.id.clock+m.length<=n.struct.id.clock+n.struct.length&&m.id.client>=n.struct.id.client;)m=u.next(),g=!0;if(m===null||m.id.client!==d||g&&m.id.clock>n.struct.id.clock+n.struct.length)continue;if(d!==n.struct.id.client)Qo(i,n.struct,n.offset),n={struct:m,offset:0},u.next();else if(n.struct.id.clock+n.struct.length<m.id.clock)if(n.struct.constructor===fr)n.struct.length=m.id.clock+m.length-n.struct.id.clock;else{Qo(i,n.struct,n.offset);let h=m.id.clock-n.struct.id.clock-n.struct.length;n={struct:new fr(Ve(d,n.struct.id.clock+n.struct.length),h),offset:0}}else{let h=n.struct.id.clock+n.struct.length-m.id.clock;h>0&&(n.struct.constructor===fr?n.struct.length-=h:m=Gk(m,h)),n.struct.mergeWith(m)||(Qo(i,n.struct,n.offset),n={struct:m,offset:0},u.next())}}else n={struct:u.curr,offset:0},u.next();for(let m=u.curr;m!==null&&m.id.client===d&&m.id.clock===n.struct.id.clock+n.struct.length&&m.constructor!==fr;m=u.next())Qo(i,n.struct,n.offset),n={struct:m,offset:0}}n!==null&&(Qo(i,n.struct,n.offset),n=null),su(i);let l=r.map(u=>Oa(u)),f=Of(l);return es(a,f),a.toUint8Array()},jk=(o,e,t=ts,r=Lo)=>{let s=dg(e),n=new r,a=new $a(n),i=new t(Vr(o)),l=new Ua(i,!1);for(;l.curr;){let u=l.curr,d=u.id.client,m=s.get(d)||0;if(l.curr.constructor===fr){l.next();continue}if(u.id.clock+u.length>m)for(Qo(a,u,Br(m-u.id.clock,0)),l.next();l.curr&&l.curr.id.client===d;)Qo(a,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===d&&l.curr.id.clock+l.curr.length<=m;)l.next()}su(a);let f=Oa(i);return es(n,f),n.toUint8Array()};var wg=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:gr(o.encoder.restEncoder)}),o.encoder.restEncoder=Is(),o.written=0)},Qo=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&wg(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),Re(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},su=o=>{wg(o);let e=o.encoder.restEncoder;Re(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];Re(e,r.written),Sa(e,r.restEncoder)}},Yk=(o,e,t,r)=>{let s=new t(Vr(o)),n=new Ua(s,!1),a=new r,i=new $a(a);for(let f=n.curr;f!==null;f=n.next())Qo(i,e(f),0);su(i);let l=Oa(s);return es(a,l),a.toUint8Array()};var Jk=o=>Yk(o,Rh,ts,As),sg="You must not compute changes after the event-handler fired.",kn=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Qk(this.currentTarget,this.target))}deletes(e){return Jf(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Tr(sg);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(s=>{if(s!==null){let n=t._map.get(s),a,i;if(this.adds(n)){let l=n.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(n))if(l!==null&&this.deletes(l))a="delete",i=Hi(l.content.getContent());else return;else l!==null&&this.deletes(l)?(a="update",i=Hi(l.content.getContent())):(a="add",i=void 0)}else if(this.deletes(n))a="delete",i=Hi(n.content.getContent());else return;e.set(s,{action:a,oldValue:i})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Tr(sg);let t=this.target,r=Qr(),s=Qr(),n=[];if(e={added:r,deleted:s,delta:n,keys:this.keys},this.transaction.changed.get(t).has(null)){let i=null,l=()=>{i&&n.push(i)};for(let f=t._start;f!==null;f=f.right)f.deleted?this.deletes(f)&&!this.adds(f)&&((i===null||i.delete===void 0)&&(l(),i={delete:0}),i.delete+=f.length,s.add(f)):this.adds(f)?((i===null||i.insert===void 0)&&(l(),i={insert:[]}),i.insert=i.insert.concat(f.content.getContent()),r.add(f)):((i===null||i.retain===void 0)&&(l(),i={retain:0}),i.retain+=f.length);i!==null&&i.retain===void 0&&l()}this._changes=e}return e}},Qk=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)s.deleted||r++,s=s.right;t.unshift(r)}e=e._item.parent}return t},_g=80,nu=0,Wf=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=nu++}},Xk=o=>{o.timestamp=nu++},vg=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=nu++},Zk=(o,e,t)=>{if(o.length>=_g){let r=o.reduce((s,n)=>s.timestamp<n.timestamp?s:n);return vg(r,e,t),r}else{let r=new Wf(e,t);return o.push(r),r}},ml=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((n,a)=>nn(e-n.index)<nn(e-a.index)?n:a),r=o._start,s=0;for(t!==null&&(r=t.p,s=t.index,Xk(t));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return t!==null&&nn(t.index-s)<r.parent.length/_g?(vg(t,r,s),t):Zk(o._searchMarker,r,s)},Ba=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let s=o[r];if(t>0){let n=s.p;for(n.marker=!1;n&&(n.deleted||!n.countable);)n=n.left,n&&!n.deleted&&n.countable&&(s.index-=n.length);if(n===null||n.marker===!0){o.splice(r,1);continue}s.p=n,n.marker=!0}(e<s.index||t>0&&e===s.index)&&(s.index=Br(e,s.index+t))}};var hl=(o,e,t)=>{let r=o,s=e.changedParentTypes;for(;Ur(s,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;hg(r._eH,t,e)},Ct=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Xh(),this._dEH=Xh(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Nr()}clone(){throw Nr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Zh(this._eH,e)}observeDeep(e){Zh(this._dEH,e)}unobserve(e){eg(this._eH,e)}unobserveDeep(e){eg(this._dEH,e)}toJSON(){}},Sg=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,s=[],n=o._start;for(;n!==null&&r>0;){if(n.countable&&!n.deleted){let a=n.content.getContent();if(a.length<=e)e-=a.length;else{for(let i=e;i<a.length&&r>0;i++)s.push(a[i]),r--;e=0}}n=n.right}return s},kg=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}t=t.right}return e};var Na=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let s=r.content.getContent();for(let n=0;n<s.length;n++)e(s[n],t++,o)}r=r.right}},Ig=(o,e)=>{let t=[];return Na(o,(r,s)=>{t.push(e(r,s,o))}),t},eI=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let s=t[r++];return t.length<=r&&(t=null),{done:!1,value:s}}}},Lg=(o,e)=>{let t=ml(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},fl=(o,e,t,r)=>{let s=t,n=o.doc,a=n.clientID,i=n.store,l=t===null?e._start:t.right,f=[],u=()=>{f.length>0&&(s=new ft(Ve(a,St(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Ao(f)),s.integrate(o,0),f=[])};r.forEach(d=>{if(d===null)f.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:f.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:s=new ft(Ve(a,St(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Fs(new Uint8Array(d))),s.integrate(o,0);break;case yr:s=new ft(Ve(a,St(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Ms(d)),s.integrate(o,0);break;default:if(d instanceof Ct)s=new ft(Ve(a,St(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Fr(d)),s.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Cg=()=>Tr("Length exceeded!"),Tg=(o,e,t,r)=>{if(t>e._length)throw Cg();if(t===0)return e._searchMarker&&Ba(e._searchMarker,t,r.length),fl(o,e,null,r);let s=t,n=ml(e,t),a=e._start;for(n!==null&&(a=n.p,t-=n.index,t===0&&(a=a.prev,t+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(t<=a.length){t<a.length&&rs(o,Ve(a.id.client,a.id.clock+t));break}t-=a.length}return e._searchMarker&&Ba(e._searchMarker,s,r.length),fl(o,e,a,r)},tI=(o,e,t)=>{let s=(e._searchMarker||[]).reduce((n,a)=>a.index>n.index?a:n,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return fl(o,e,s,t)},Pg=(o,e,t,r)=>{if(r===0)return;let s=t,n=r,a=ml(e,t),i=e._start;for(a!==null&&(i=a.p,t-=a.index);i!==null&&t>0;i=i.right)!i.deleted&&i.countable&&(t<i.length&&rs(o,Ve(i.id.client,i.id.clock+t)),t-=i.length);for(;r>0&&i!==null;)i.deleted||(r<i.length&&rs(o,Ve(i.id.client,i.id.clock+r)),i.delete(o),r-=i.length),i=i.right;if(r>0)throw Cg();e._searchMarker&&Ba(e._searchMarker,s,-n+r)},ul=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},au=(o,e,t,r)=>{let s=e._map.get(t)||null,n=o.doc,a=n.clientID,i;if(r==null)i=new Ao([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:i=new Ao([r]);break;case Uint8Array:i=new Fs(r);break;case yr:i=new Ms(r);break;default:if(r instanceof Ct)i=new Fr(r);else throw new Error("Unexpected content type")}new ft(Ve(a,St(n.store,a)),s,s&&s.lastId,null,null,e,t,i).integrate(o,0)},iu=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Ag=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Fg=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var rI=(o,e)=>{let t={};return o._map.forEach((r,s)=>{let n=r;for(;n!==null&&(!e.sv.has(n.id.client)||n.id.clock>=(e.sv.get(n.id.client)||0));)n=n.left;n!==null&&wn(n,e)&&(t[s]=n.content.getContent()[n.length-1])}),t},Xi=o=>jh(o.entries(),e=>!e[1].deleted),zf=class extends kn{constructor(e,t){super(e,t),this._transaction=t}},to=class extends Ct{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new to;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new to}clone(){let e=new to;return e.insert(0,this.toArray().map(t=>t instanceof Ct?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),hl(this,e,new zf(this,e))}insert(e,t){this.doc!==null?Ze(this.doc,r=>{Tg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Ze(this.doc,t=>{tI(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Ze(this.doc,r=>{Pg(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Lg(this,e)}toArray(){return kg(this)}slice(e=0,t=this.length){return Sg(this,e,t)}toJSON(){return this.map(e=>e instanceof Ct?e.toJSON():e)}map(e){return Ig(this,e)}forEach(e){Na(this,e)}[Symbol.iterator](){return eI(this)}_write(e){e.writeTypeRef(SI)}},oI=o=>new to,Kf=class extends kn{constructor(e,t,r){super(e,t),this.keysChanged=r}},Co=class extends Ct{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Co}clone(){let e=new Co;return this.forEach((t,r)=>{e.set(r,t instanceof Ct?t.clone():t)}),e}_callObserver(e,t){hl(this,e,new Kf(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let s=t.content.getContent()[t.length-1];e[r]=s instanceof Ct?s.toJSON():s}}),e}get size(){return[...Xi(this._map)].length}keys(){return Ji(Xi(this._map),e=>e[0])}values(){return Ji(Xi(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Ji(Xi(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ze(this.doc,t=>{ul(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Ze(this.doc,r=>{au(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return iu(this,e)}has(e){return Fg(this,e)}clear(){this.doc!==null?Ze(this.doc,e=>{this.forEach(function(t,r,s){ul(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(kI)}},sI=o=>new Co,Xo=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&kf(o,e),Ha=class{constructor(e,t,r,s){this.left=e,this.right=t,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Pr(),this.right.content.constructor){case bt:this.right.deleted||Tn(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},ng=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case bt:e.right.deleted||Tn(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&rs(o,Ve(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Zi=(o,e,t,r)=>{let s=new Map,n=r?ml(e,t):null;if(n){let a=new Ha(n.p.left,n.p,n.index,s);return ng(o,a,t-n.index)}else{let a=new Ha(null,e._start,0,s);return ng(o,a,t)}},Dg=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===bt&&Xo(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let s=o.doc,n=s.clientID;r.forEach((a,i)=>{let l=t.left,f=t.right,u=new ft(Ve(n,St(s.store,n)),l,l&&l.lastId,f,f&&f.id,e,null,new bt(i,a));u.integrate(o,0),t.right=u,t.forward()})},Tn=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},Mg=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===bt&&Xo((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},Eg=(o,e,t,r)=>{var i;let s=o.doc,n=s.clientID,a=new Map;for(let l in r){let f=r[l],u=(i=t.currentAttributes.get(l))!=null?i:null;if(!Xo(u,f)){a.set(l,u);let{left:d,right:m}=t;t.right=new ft(Ve(n,St(s.store,n)),d,d&&d.lastId,m,m&&m.id,e,null,new bt(l,f)),t.right.integrate(o,0),t.forward()}}return a},Rf=(o,e,t,r,s)=>{t.currentAttributes.forEach((m,g)=>{s[g]===void 0&&(s[g]=null)});let n=o.doc,a=n.clientID;Mg(t,s);let i=Eg(o,e,t,s),l=r.constructor===String?new Ar(r):r instanceof Ct?new Fr(r):new Po(r),{left:f,right:u,index:d}=t;e._searchMarker&&Ba(e._searchMarker,t.index,l.getLength()),u=new ft(Ve(a,St(n.store,a)),f,f&&f.lastId,u,u&&u.id,e,null,l),u.integrate(o,0),t.right=u,t.index=d,t.forward(),Dg(o,e,t,i)},ag=(o,e,t,r,s)=>{let n=o.doc,a=n.clientID;Mg(t,s);let i=Eg(o,e,t,s);e:for(;t.right!==null&&(r>0||i.size>0&&(t.right.deleted||t.right.content.constructor===bt));){if(!t.right.deleted)switch(t.right.content.constructor){case bt:{let{key:l,value:f}=t.right.content,u=s[l];if(u!==void 0){if(Xo(u,f))i.delete(l);else{if(r===0)break e;i.set(l,f)}t.right.delete(o)}else t.currentAttributes.set(l,f);break}default:r<t.right.length&&rs(o,Ve(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new ft(Ve(a,St(n.store,a)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Ar(l)),t.right.integrate(o,0),t.forward()}Dg(o,e,t,i)},Rg=(o,e,t,r,s)=>{var f,u;let n=e,a=At();for(;n&&(!n.countable||n.deleted);){if(!n.deleted&&n.content.constructor===bt){let d=n.content;a.set(d.key,d)}n=n.right}let i=0,l=!1;for(;e!==n;){if(t===e&&(l=!0),!e.deleted){let d=e.content;switch(d.constructor){case bt:{let{key:m,value:g}=d,h=(f=r.get(m))!=null?f:null;(a.get(m)!==d||h===g)&&(e.delete(o),i++,!l&&((u=s.get(m))!=null?u:null)===g&&h!==g&&(h===null?s.delete(m):s.set(m,h))),!l&&!e.deleted&&Tn(s,d);break}}}e=e.right}return i},nI=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===bt){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},aI=o=>{let e=0;return Ze(o.doc,t=>{let r=o._start,s=o._start,n=At(),a=Ni(n);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case bt:Tn(a,s.content);break;default:e+=Rg(t,r,s,n,a),n=Ni(a),r=s;break}s=s.right}}),e},iI=o=>{let e=new Set,t=o.doc;for(let[r,s]of o.afterState.entries()){let n=o.beforeState.get(r)||0;s!==n&&xg(o,t.store.clients.get(r),n,s,a=>{!a.deleted&&a.content.constructor===bt&&a.constructor!==cr&&e.add(a.parent)})}Ze(t,r=>{cg(o,o.deleteSet,s=>{if(s instanceof cr||!s.parent._hasFormatting||e.has(s.parent))return;let n=s.parent;s.content.constructor===bt?e.add(n):nI(r,s)});for(let s of e)aI(s)})},ig=(o,e,t)=>{let r=t,s=Ni(e.currentAttributes),n=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Fr:case Po:case Ar:t<e.right.length&&rs(o,Ve(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}n&&Rg(o,n,e.right,s,e.currentAttributes);let a=(e.left||e.right).parent;return a._searchMarker&&Ba(a._searchMarker,e.index,-r+t),e},Gf=class extends kn{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];Ze(e,r=>{var g,h,_;let s=new Map,n=new Map,a=this.target._start,i=null,l={},f="",u=0,d=0,m=()=>{if(i!==null){let w=null;switch(i){case"delete":d>0&&(w={delete:d}),d=0;break;case"insert":(typeof f=="object"||f.length>0)&&(w={insert:f},s.size>0&&(w.attributes={},s.forEach((v,M)=>{v!==null&&(w.attributes[M]=v)}))),f="";break;case"retain":u>0&&(w={retain:u},Mh(l)||(w.attributes=Fh({},l))),u=0;break}w&&t.push(w),i=null}};for(;a!==null;){switch(a.content.constructor){case Fr:case Po:this.adds(a)?this.deletes(a)||(m(),i="insert",f=a.content.getContent()[0],m()):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=1):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=1);break;case Ar:this.adds(a)?this.deletes(a)||(i!=="insert"&&(m(),i="insert"),f+=a.content.str):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=a.length):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=a.length);break;case bt:{let{key:w,value:v}=a.content;if(this.adds(a)){if(!this.deletes(a)){let M=(g=s.get(w))!=null?g:null;Xo(M,v)?v!==null&&a.delete(r):(i==="retain"&&m(),Xo(v,(h=n.get(w))!=null?h:null)?delete l[w]:l[w]=v)}}else if(this.deletes(a)){n.set(w,v);let M=(_=s.get(w))!=null?_:null;Xo(M,v)||(i==="retain"&&m(),l[w]=M)}else if(!a.deleted){n.set(w,v);let M=l[w];M!==void 0&&(Xo(M,v)?M!==null&&a.delete(r):(i==="retain"&&m(),v===null?delete l[w]:l[w]=v))}a.deleted||(i==="insert"&&m(),Tn(s,a.content));break}}a=a.right}for(m();t.length>0;){let w=t[t.length-1];if(w.retain!==void 0&&w.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},os=class extends Ct{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new os}clone(){let e=new os;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new Gf(this,e,t);hl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Ar&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Ze(this.doc,r=>{let s=new Ha(null,this._start,0,new Map);for(let n=0;n<e.length;n++){let a=e[n];if(a.insert!==void 0){let i=!t&&typeof a.insert=="string"&&n===e.length-1&&s.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof i!="string"||i.length>0)&&Rf(r,this,s,i,a.attributes||{})}else a.retain!==void 0?ag(r,this,s,a.retain,a.attributes||{}):a.delete!==void 0&&ig(r,s,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let s=[],n=new Map,a=this.doc,i="",l=this._start;function f(){if(i.length>0){let d={},m=!1;n.forEach((h,_)=>{m=!0,d[_]=h});let g={insert:i};m&&(g.attributes=d),s.push(g),i=""}}let u=()=>{for(;l!==null;){if(wn(l,e)||t!==void 0&&wn(l,t))switch(l.content.constructor){case Ar:{let d=n.get("ychange");e!==void 0&&!wn(l,e)?(d===void 0||d.user!==l.id.client||d.type!=="removed")&&(f(),n.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!wn(l,t)?(d===void 0||d.user!==l.id.client||d.type!=="added")&&(f(),n.set("ychange",r?r("added",l.id):{type:"added"})):d!==void 0&&(f(),n.delete("ychange")),i+=l.content.str;break}case Fr:case Po:{f();let d={insert:l.content.getContent()[0]};if(n.size>0){let m={};d.attributes=m,n.forEach((g,h)=>{m[h]=g})}s.push(d);break}case bt:wn(l,e)&&(f(),Tn(n,l.content));break}l=l.right}f()};return e||t?Ze(a,d=>{e&&Hf(d,e),t&&Hf(d,t),u()},"cleanup"):u(),s}insert(e,t,r){if(t.length<=0)return;let s=this.doc;s!==null?Ze(s,n=>{let a=Zi(n,this,e,!r);r||(r={},a.currentAttributes.forEach((i,l)=>{r[l]=i})),Rf(n,this,a,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let s=this.doc;s!==null?Ze(s,n=>{let a=Zi(n,this,e,!r);Rf(n,this,a,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?Ze(r,s=>{ig(s,Zi(s,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let s=this.doc;s!==null?Ze(s,n=>{let a=Zi(n,this,e,!1);a.right!==null&&ag(n,this,a,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Ze(this.doc,t=>{ul(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Ze(this.doc,r=>{au(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return iu(this,e)}getAttributes(){return Ag(this)}_write(e){e.writeTypeRef(II)}},lI=o=>new os,Ea=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===ss||t.constructor===To)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},To=class extends Ct{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new To}clone(){let e=new To;return e.insert(0,this.toArray().map(t=>t instanceof Ct?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Ea(this,e)}querySelector(e){e=e.toUpperCase();let r=new Ea(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),$r(new Ea(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){hl(this,e,new jf(this,t,e))}toString(){return Ig(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),Na(this,n=>{s.insertBefore(n.toDOM(e,t,r),null)}),s}insert(e,t){this.doc!==null?Ze(this.doc,r=>{Tg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Ze(this.doc,r=>{let s=e&&e instanceof Ct?e._item:e;fl(r,this,s,t)});else{let r=this._prelimContent,s=e===null?0:r.findIndex(n=>n===e)+1;if(s===0&&e!==null)throw Tr("Reference item not found");r.splice(s,0,...t)}}delete(e,t=1){this.doc!==null?Ze(this.doc,r=>{Pg(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return kg(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Lg(this,e)}slice(e=0,t=this.length){return Sg(this,e,t)}forEach(e){Na(this,e)}_write(e){e.writeTypeRef(CI)}},cI=o=>new To,ss=class extends To{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new ss(this.nodeName)}clone(){let e=new ss(this.nodeName),t=this.getAttributes();return Dh(t,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof Ct?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let i in e)r.push(i);r.sort();let s=r.length;for(let i=0;i<s;i++){let l=r[i];t.push(l+'="'+e[l]+'"')}let n=this.nodeName.toLocaleLowerCase(),a=t.length>0?" "+t.join(" "):"";return`<${n}${a}>${super.toString()}</${n}>`}removeAttribute(e){this.doc!==null?Ze(this.doc,t=>{ul(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Ze(this.doc,r=>{au(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return iu(this,e)}hasAttribute(e){return Fg(this,e)}getAttributes(e){return e?rI(this,e):Ag(this)}toDOM(e=document,t={},r){let s=e.createElement(this.nodeName),n=this.getAttributes();for(let a in n){let i=n[a];typeof i=="string"&&s.setAttribute(a,i)}return Na(this,a=>{s.appendChild(a.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(LI),e.writeKey(this.nodeName)}},fI=o=>new ss(o.readKey()),jf=class extends kn{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},In=class extends Co{constructor(e){super(),this.hookName=e}_copy(){return new In(this.hookName)}clone(){let e=new In(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let s=t[this.hookName],n;return s!==void 0?n=s.createDom(this):n=document.createElement(this.hookName),n.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(TI),e.writeKey(this.hookName)}},uI=o=>new In(o.readKey()),Ln=class extends os{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Ln}clone(){let e=new Ln;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let s=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{let t=[];for(let s in e.attributes){let n=[];for(let a in e.attributes[s])n.push({key:a,value:e.attributes[s][a]});n.sort((a,i)=>a.key<i.key?-1:1),t.push({nodeName:s,attrs:n})}t.sort((s,n)=>s.nodeName<n.nodeName?-1:1);let r="";for(let s=0;s<t.length;s++){let n=t[s];r+=`<${n.nodeName}`;for(let a=0;a<n.attrs.length;a++){let i=n.attrs[a];r+=` ${i.key}="${i.value}"`}r+=">"}r+=e.insert;for(let s=t.length-1;s>=0;s--)r+=`</${t[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(PI)}},dI=o=>new Ln,Va=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Nr()}mergeWith(e){return!1}write(e,t,r){throw Nr()}integrate(e,t){throw Nr()}},pI=0,cr=class extends Va{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),yg(e.doc.store,this)}write(e,t){e.writeInfo(pI),e.writeLen(this.length-t)}getMissing(e,t){return null}},Fs=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Fs(this.content)}splice(e){throw Nr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},mI=o=>new Fs(o.readBuf()),Ds=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ds(this.len)}splice(e){let t=new Ds(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){ol(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},hI=o=>new Ds(o.readLen()),Og=(o,e)=>new yr({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),Ms=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ms(Og(this.doc.guid,this.opts))}splice(e){throw Nr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},gI=o=>new Ms(Og(o.readString(),o.readAny())),Po=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Po(this.embed)}splice(e){throw Nr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},yI=o=>new Po(o.readJSON()),bt=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new bt(this.key,this.value)}splice(e){throw Nr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},xI=o=>new bt(o.readKey(),o.readJSON()),Cn=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Cn(this.arr)}splice(e){let t=new Cn(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let n=this.arr[s];e.writeString(n===void 0?"undefined":JSON.stringify(n))}}getRef(){return 2}},bI=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let s=o.readString();s==="undefined"?t.push(void 0):t.push(JSON.parse(s))}return new Cn(t)},Ao=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ao(this.arr)}splice(e){let t=new Ao(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let n=this.arr[s];e.writeAny(n)}}getRef(){return 8}},wI=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new Ao(t)},Ar=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ar(this.str)}splice(e){let t=new Ar(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},_I=o=>new Ar(o.readString()),vI=[oI,sI,lI,fI,cI,uI,dI],SI=0,kI=1,II=2,LI=3,CI=4,TI=5,PI=6,Fr=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Fr(this.type._copy())}splice(e){throw Nr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},AI=o=>new Fr(vI[o.readTypeRef()](o)),lg=(o,e)=>{let t=e,r=0,s;do r>0&&(t=Ve(t.client,t.clock+r)),s=el(o,t),r=t.clock-s.id.clock,t=s.redone;while(t!==null&&s instanceof ft);return{item:s,diff:r}};var dl=(o,e,t)=>{let{client:r,clock:s}=e.id,n=new ft(Ve(r,s+t),e,Ve(r,s+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&n.markDeleted(),e.keep&&(n.keep=!0),e.redone!==null&&(n.redone=Ve(e.redone.client,e.redone.clock+t)),e.right=n,n.right!==null&&(n.right.left=n),o._mergeStructs.push(n),n.parentSub!==null&&n.right===null&&n.parent._map.set(n.parentSub,n),e.length=t,n};var ft=class extends Va{constructor(e,t,r,s,n,a,i,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=s,this.rightOrigin=n,this.parent=a,this.parentSub=i,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=St(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=St(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Zo&&this.id.client!==this.parent.client&&this.parent.clock>=St(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=tg(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=rs(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===cr||this.right&&this.right.constructor===cr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ft&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ft&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Zo){let r=el(t,this.parent);r.constructor===cr?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=tg(e,e.doc.store,Ve(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let n=new Set,a=new Set;for(;s!==null&&s!==this.right;){if(a.add(s),n.add(s),_n(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,n.clear();else if(_n(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&a.has(el(e.doc.store,s.origin)))n.has(el(e.doc.store,s.origin))||(r=s,n.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),yg(e.doc.store,this),this.content.integrate(e,this),og(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new cr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ve(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&_n(e.origin,this.lastId)&&this.right===e&&_n(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),ol(e.deleteSet,this.id.client,this.id.clock,this.length),og(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Pr();this.content.gc(e),t?Vk(e,this,new cr(this.id,this.length)):this.content=new Ds(this.length)}write(e,t){let r=t>0?Ve(this.id.client,this.id.clock+t-1):this.origin,s=this.rightOrigin,n=this.parentSub,a=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(n===null?0:32);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){let i=this.parent;if(i._item!==void 0){let l=i._item;if(l===null){let f=gg(i);e.writeParentInfo(!0),e.writeString(f)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else i.constructor===String?(e.writeParentInfo(!0),e.writeString(i)):i.constructor===Zo?(e.writeParentInfo(!1),e.writeLeftID(i)):Pr();n!==null&&e.writeString(n)}this.content.write(e,t)}},Ug=(o,e)=>FI[e&31](o),FI=[()=>{Pr()},hI,bI,mI,_I,yI,xI,AI,wI,gI,()=>{Pr()}],DI=10,fr=class extends Va{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Pr()}write(e,t){e.writeInfo(DI),Re(e.restEncoder,this.length-t)}getMissing(e,t){return null}},$g=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},Bg="__ $YJS$ __";$g[Bg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");$g[Bg]=!0;var Rs=o=>Io((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),Ng=(o,e)=>Io((t,r)=>{let s=indexedDB.open(o);s.onupgradeneeded=n=>e(n.target.result),s.onerror=n=>r(Tr(n.target.error)),s.onsuccess=n=>{let a=n.target.result;a.onversionchange=()=>{a.close()},t(a)}}),Hg=o=>Rs(indexedDB.deleteDatabase(o)),Vg=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),oo=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(s=>OI(r,s))},Os=(o,e)=>Rs(o.count(e)),qg=(o,e)=>Rs(o.get(e)),lu=(o,e)=>Rs(o.delete(e)),Wg=(o,e,t)=>Rs(o.put(e,t));var gl=(o,e)=>Rs(o.add(e)),zg=(o,e,t)=>Rs(o.getAll(e,t));var MI=(o,e,t)=>{let r=null;return RI(o,e,s=>(r=s,!1),t).then(()=>r)},Kg=(o,e=null)=>MI(o,e,"prev");var EI=(o,e)=>Io((t,r)=>{o.onerror=r,o.onsuccess=async s=>{let n=s.target.result;if(n===null||await e(n)===!1)return t();n.continue()}});var RI=(o,e,t,r="next")=>EI(o.openKeyCursor(e,r),s=>t(s.key)),OI=(o,e)=>o.objectStore(e);var Gg=(o,e)=>IDBKeyRange.upperBound(o,e),jg=(o,e)=>IDBKeyRange.lowerBound(o,e);var fu="custom",Yg="updates",Jg=500,Qg=(o,e=()=>{},t=()=>{})=>{let[r]=oo(o.db,[Yg]);return zg(r,jg(o._dbref,!1)).then(s=>{o._destroyed||(e(r),Ze(o.doc,()=>{s.forEach(n=>Fo(o.doc,n))},o,!1),t(r))}).then(()=>Kg(r).then(s=>{o._dbref=s+1})).then(()=>Os(r).then(s=>{o._dbsize=s})).then(()=>r)},UI=(o,e=!0)=>Qg(o).then(t=>{(e||o._dbsize>=Jg)&&gl(t,Es(o.doc)).then(()=>lu(t,Gg(o._dbref,!0))).then(()=>Os(t).then(r=>{o._dbsize=r}))});var Pn=class extends sn{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=Ng(e,r=>Vg(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Io(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Qg(this,a=>gl(a,Es(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,s)=>{if(this.db&&s!==this){let[n]=oo(this.db,[Yg]);gl(n,r),++this._dbsize>=Jg&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{UI(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{Hg(this.name)})}get(e){return this._db.then(t=>{let[r]=oo(t,[fu],"readonly");return qg(r,e)})}set(e,t){return this._db.then(r=>{let[s]=oo(r,[fu]);return Wg(s,t,e)})}del(e){return this._db.then(t=>{let[r]=oo(t,[fu]);return lu(r,e)})}};var _r=vs(wa());var Xg=0,yl=1,Zg=2,xl=(o,e)=>{Re(o,Xg);let t=mg(e);Dt(o,t)},uu=(o,e,t)=>{Re(o,yl),Dt(o,Es(e,t))},$I=(o,e,t)=>uu(e,t,Ut(o)),ey=(o,e,t)=>{try{Fo(e,Ut(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},ty=(o,e)=>{Re(o,Zg),Dt(o,e)},BI=ey,ry=(o,e,t,r)=>{let s=Ee(o);switch(s){case Xg:$I(o,e,t);break;case yl:ey(o,t,r);break;case Zg:BI(o,t,r);break;default:throw new Error("Unknown message type")}return s};var HI=0;var oy=(o,e,t)=>{switch(Ee(o)){case HI:t(e,Hr(o))}};var du=3e4,bl=class extends sn{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=Ts();this.getLocalState()!==null&&du/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((s,n)=>{n!==this.clientID&&du<=t-s.lastUpdated&&this.states.has(n)&&r.push(n)}),r.length>0&&wl(this,r,"timeout")},lr(du/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),s=r===void 0?0:r.clock+1,n=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:Ts()});let a=[],i=[],l=[],f=[];e===null?f.push(t):n==null?e!=null&&a.push(t):(i.push(t),xn(n,e)||l.push(t)),(a.length>0||l.length>0||f.length>0)&&this.emit("change",[{added:a,updated:l,removed:f},"local"]),this.emit("update",[{added:a,updated:i,removed:f},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},wl=(o,e,t)=>{let r=[];for(let s=0;s<e.length;s++){let n=e[s];if(o.states.has(n)){if(o.states.delete(n),n===o.clientID){let a=o.meta.get(n);o.meta.set(n,{clock:a.clock+1,lastUpdated:Ts()})}r.push(n)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},An=(o,e,t=o.states)=>{let r=e.length,s=Is();Re(s,r);for(let n=0;n<r;n++){let a=e[n],i=t.get(a)||null,l=o.meta.get(a).clock;Re(s,a),Re(s,l),ko(s,JSON.stringify(i))}return gr(s)};var sy=(o,e,t)=>{let r=Vr(e),s=Ts(),n=[],a=[],i=[],l=[],f=Ee(r);for(let u=0;u<f;u++){let d=Ee(r),m=Ee(r),g=JSON.parse(Hr(r)),h=o.meta.get(d),_=o.states.get(d),w=h===void 0?0:h.clock;(w<m||w===m&&g===null&&o.states.has(d))&&(g===null?d===o.clientID&&o.getLocalState()!=null?m++:o.states.delete(d):o.states.set(d,g),o.meta.set(d,{clock:m,lastUpdated:s}),h===void 0&&g!==null?n.push(d):h!==void 0&&g===null?l.push(d):g!==null&&(xn(g,_)||i.push(d),a.push(d)))}(n.length>0||i.length>0||l.length>0)&&o.emit("change",[{added:n,updated:i,removed:l},t]),(n.length>0||a.length>0||l.length>0)&&o.emit("update",[{added:n,updated:a,removed:l},t])};var Dn=()=>new Map,cy=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},fy=()=>new Set,WI=Array.from,AE=Array.isArray,uy=String.fromCharCode,FE=String.fromCodePoint,DE=uy(65535),zI=o=>o.toLowerCase(),KI=/^\s*/g,GI=o=>o.replace(KI,""),jI=/([A-Z])/g,ny=(o,e)=>GI(o.replace(jI,t=>`${e}${zI(t)}`)),YI=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},Wa=typeof TextEncoder!="undefined"?new TextEncoder:null,JI=o=>Wa.encode(o),QI=Wa?JI:YI,pu=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});pu&&pu.decode(new Uint8Array).length===1&&(pu=null);var ay=o=>o===void 0?null:o,XI=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},dy=new XI,bu=!0;try{typeof localStorage!="undefined"&&(dy=localStorage,bu=!1)}catch(o){}var py=dy,ZI=o=>bu||addEventListener("storage",o),eL=o=>bu||removeEventListener("storage",o),tL=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},rL=(o,e)=>e.includes(o),Rn=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),my=typeof window!="undefined"&&typeof document!="undefined"&&!Rn,ME=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,so,oL=[],sL=()=>{if(so===void 0)if(Rn){so=Dn();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&so.set(e,""),e=r):e!==null?(so.set(e,r),e=null):oL.push(r)}e!==null&&so.set(e,"")}else typeof location=="object"?(so=Dn(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");so.set(`--${ny(e,"-")}`,t),so.set(`-${ny(e,"-")}`,t)}})):so=Dn();return so},hu=o=>sL().has(o),gu=o=>ay(Rn?process.env[o.toUpperCase()]:py.getItem(o)),nL=o=>hu("--"+o)||gu(o)!==null,EE=nL("production"),iy=Rn&&rL(process.env.FORCE_COLOR,["true","1","2"]),RE=!hu("no-colors")&&(!Rn||process.stdout.isTTY||iy)&&(!Rn||hu("color")||iy||gu("COLORTERM")!==null||(gu("TERM")||"").includes("color")),hy=Math.floor,gy=(o,e)=>o<e?o:e,aL=(o,e)=>o>e?o:e,OE=Number.isNaN,iL=Math.pow,yy=128,lL=1<<17,cL=1<<18,fL=1<<19,uL=1<<20,dL=1<<21,pL=1<<22,mL=1<<23,hL=1<<24,gL=1<<25,yL=1<<26,xL=1<<27,bL=1<<28,wL=1<<29,_L=1<<30,UE=1<<31,_l=127,$E=lL-1,BE=cL-1,NE=fL-1,HE=uL-1,VE=dL-1,qE=pL-1,WE=mL-1,zE=hL-1,KE=gL-1,GE=yL-1,jE=xL-1,YE=bL-1,JE=wL-1,QE=_L-1,vL=Number.MAX_SAFE_INTEGER,XE=Number.MIN_SAFE_INTEGER,ZE=1<<31,eR=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&hy(o)===o),tR=Number.isNaN,rR=Number.parseInt,SL=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},qr=()=>new SL,wu=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},Dr=o=>{let e=new Uint8Array(wu(o)),t=0;for(let r=0;r<o.bufs.length;r++){let s=o.bufs[r];e.set(s,t),t+=s.length}return e.set(wy(o.cbuf.buffer,0,o.cpos),t),e},vl=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},Xt=(o,e)=>{for(;e>_l;)vl(o,yy|_l&e),e=hy(e/128);vl(o,_l&e)},yu=new Uint8Array(3e4),kL=yu.length/3,IL=(o,e)=>{if(e.length<kL){let t=Wa.encodeInto(e,yu).written||0;Xt(o,t);for(let r=0;r<t;r++)vl(o,yu[r])}else Mn(o,QI(e))},LL=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Xt(o,r);for(let s=0;s<r;s++)vl(o,t.codePointAt(s))},oR=Wa&&Wa.encodeInto?IL:LL,CL=(o,e)=>{let t=o.cbuf.length,r=o.cpos,s=gy(t-r,e.length),n=e.length-s;o.cbuf.set(e.subarray(0,s),r),o.cpos+=s,n>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(aL(t*2,n)),o.cbuf.set(e.subarray(s)),o.cpos=n)},Mn=(o,e)=>{Xt(o,e.byteLength),CL(o,e)},sR=new DataView(new ArrayBuffer(4)),xy=o=>new Error(o),TL=xy("Unexpected end of array"),PL=xy("Integer out of Range"),AL=class{constructor(o){this.arr=o,this.pos=0}},FL=o=>new AL(o),DL=(o,e)=>{let t=wy(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},ML=o=>DL(o,by(o)),by=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let s=o.arr[o.pos++];if(e=e+(s&_l)*t,t*=128,s<yy)return e;if(e>vL)throw PL}throw TL},EL=o=>new Uint8Array(o),wy=(o,e,t)=>new Uint8Array(o,e,t),RL=o=>new Uint8Array(o),OL=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=uy(o[t]);return btoa(e)},UL=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),$L=o=>{let e=atob(o),t=EL(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},BL=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},NL=my?OL:UL,HL=my?$L:BL,_y=new Map,VL=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:HL(e.newValue||"")}),ZI(this._onChange)}postMessage(o){py.setItem(this.room,NL(RL(o)))}close(){eL(this._onChange)}},qL=typeof BroadcastChannel=="undefined"?VL:BroadcastChannel,_u=o=>cy(_y,o,()=>{let e=fy(),t=new qL(o);return t.onmessage=r=>e.forEach(s=>s(r.data,"broadcastchannel")),{bc:t,subs:e}}),WL=(o,e)=>(_u(o).subs.add(e),e),zL=(o,e)=>{let t=_u(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),_y.delete(o)),r},Fn=(o,e,t=null)=>{let r=_u(o);r.bc.postMessage(e),r.subs.forEach(s=>s(e,t))},xu=Date.now,KL=class{constructor(){this._observers=Dn()}on(o,e){cy(this._observers,o,fy).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return WI((this._observers.get(o)||Dn()).values()).forEach(t=>t(...e))}destroy(){this._observers=Dn()}},GL=o=>tL(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),Us=0,vy=3,En=1,jL=2,za=[];za[Us]=(o,e,t,r,s)=>{Xt(o,Us);let n=ry(e,o,t.doc,t);r&&n===yl&&!t.synced&&(t.synced=!0)};za[vy]=(o,e,t,r,s)=>{Xt(o,En),Mn(o,An(t.awareness,Array.from(t.awareness.getStates().keys())))};za[En]=(o,e,t,r,s)=>{sy(t.awareness,ML(e),t)};za[jL]=(o,e,t,r,s)=>{oy(e,t.doc,(n,a)=>YL(t,a))};var ly=3e4,YL=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),Sy=(o,e,t)=>{let r=FL(e),s=qr(),n=by(r),a=o.messageHandlers[n];return a?a(s,r,o,t,n):console.error("Unable to compute message"),s},ky=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=xu();let r=Sy(o,new Uint8Array(t.data),!0);wu(r)>1&&e.send(Dr(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,wl(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(ky,gy(iL(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=xu(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=qr();if(Xt(t,Us),xl(t,o.doc),e.send(Dr(t)),o.awareness.getLocalState()!==null){let r=qr();Xt(r,En),Mn(r,An(o.awareness,[o.doc.clientID])),e.send(Dr(r))}},o.emit("status",[{status:"connecting"}])}},mu=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&Fn(o.bcChannel,e,o)},Iy=class extends KL{constructor(o,e,t,{connect:r=!0,awareness:s=new bl(t),params:n={},WebSocketPolyfill:a=WebSocket,resyncInterval:i=-1,maxBackoffTime:l=2500,disableBc:f=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let u=GL(n);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(u.length===0?"":"?"+u),this.roomname=e,this.doc=t,this._WS=a,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=f,this.wsUnsuccessfulReconnects=0,this.messageHandlers=za.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,i>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let d=qr();Xt(d,Us),xl(d,t),this.ws.send(Dr(d))}},i)),this._bcSubscriber=(d,m)=>{if(m!==this){let g=Sy(this,new Uint8Array(d),!1);wu(g)>1&&Fn(this.bcChannel,Dr(g),this)}},this._updateHandler=(d,m)=>{if(m!==this){let g=qr();Xt(g,Us),ty(g,d),mu(this,Dr(g))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:d,updated:m,removed:g},h)=>{let _=d.concat(m).concat(g),w=qr();Xt(w,En),Mn(w,An(s,_)),mu(this,Dr(w))},this._unloadHandler=()=>{wl(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var d;this.wsconnected&&ly<xu()-this.wsLastMessageReceived&&((d=this.ws)==null||d.close())},ly/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(WL(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=qr();Xt(o,Us),xl(o,this.doc),Fn(this.bcChannel,Dr(o),this);let e=qr();Xt(e,Us),uu(e,this.doc),Fn(this.bcChannel,Dr(e),this);let t=qr();Xt(t,vy),Fn(this.bcChannel,Dr(t),this);let r=qr();Xt(r,En),Mn(r,An(this.awareness,[this.doc.clientID])),Fn(this.bcChannel,Dr(r),this)}disconnectBc(){let o=qr();Xt(o,En),Mn(o,An(this.awareness,[this.doc.clientID],new Map)),mu(this,Dr(o)),this.bcconnected&&(zL(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(ky(this),this.connectBc())}};var Et=new WeakMap,Ly=!1;function kl(o){Ly=o}var Wr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3},Zt,er,Sl=[];function Cy(o,e,t,r){er=o,Zt=t,r&&(Wr={...Wr,...r}),e.setInterval(vu,Wr.batchInterval)}async function vu(){if(Sl.length===0)return;let o=[...Sl];Sl.length=0;for(let e=0;e<Wr.maxRetries;e++)try{await JL();let t=o.map(Ty).join(`
`)+`
`;await er.append(Zt,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===Wr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function JL(){let o=await er.stat(Zt);if(o&&o.size>Wr.maxFileSize){for(let e=Wr.maxBackups;e>0;e--){let t=`${Zt}.${e}`,r=`${Zt}.${e+1}`;await er.exists(t)&&(e===Wr.maxBackups?await er.remove(t):await er.rename(t,r))}await er.exists(Zt)&&await er.rename(Zt,`${Zt}.1`),await er.write(Zt,"")}}function Ty(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}function QL(o,e){return e?t=>(o.notify(t.name+`
`+t.message),t):t=>(o.notify(t.name+`:
An error has occurred, please reload Obsidian.`),t)}var XL=["token","authorization","email"];function ZL(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var s;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&XL.some(n=>t.toLowerCase().includes(n.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(s=r.stack)==null?void 0:s.split(`
`).map(n=>n.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function Ae(o,e="log"){return(...t)=>{if(Ly){let r=new Date().toISOString(),s=new Error().stack,n=s?s.split(`
`)[2].trim():"",a=t.map(ZL).join(" "),i={timestamp:r,level:e,message:`${o}: ${a}`,callerInfo:n};Wr.disableConsole||console[e](Ty(i)),Sl.push(i)}}}async function Il(){let o=[];await er.exists(Zt)&&o.push(Zt);for(let e=1;e<=Wr.maxBackups;e++){let t=`${Zt}.${e}`;await er.exists(t)&&o.push(t)}return o}async function Py(){let o=[];if(await er.exists(Zt)){let e=await er.read(Zt);o.push(e)}for(let e=1;e<=Wr.maxBackups;e++){let t=`${Zt}.${e}`;if(await er.exists(t)){let r=await er.read(t);o.push(r)}}return o.reverse().join(`
`)}var Mt=class{constructor(e){let t=e||this.constructor.name;this.debug=Ae(`[${t}]`,"debug"),this.log=Ae(`[${t}]`,"log"),this.warn=Ae(`[${t}]`,"warn"),this.error=Ae(`[${t}]`,"error")}setLoggers(e){this.debug=Ae(`[${e}]`,"debug"),this.log=Ae(`[${e}]`,"log"),this.warn=Ae(`[${e}]`,"warn"),this.error=Ae(`[${e}]`,"error")}},eC=!1;function Ay(o){return QL(o,eC)}var Su=class{constructor(){this.platform="s3rn";this.product="relay"}},ku=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},Do=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},zr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},Mo=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.fileId=r;this.platform="s3rn";this.product="relay"}},Iu=class{constructor(e,t,r,s,n,a){this.relayId=e;this.folderId=t;this.fileId=r;this.hash=s;this.contentType=n;this.contentLength=a;this.platform="s3rn";this.product="relay"}},no=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},Eo=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},Ka=class{constructor(e,t){this.folderId=e;this.fileId=t;this.platform="s3rn";this.product="relay"}},Tt=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}if("fileId"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");if(t+=`:file:${e.fileId}`,"hash"in e&&e.hash&&"contentType"in e&&"contentLength"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");t+=`:sha256:${e.hash}`,t+=`:contentType:${e.contentType}`,t+=`:contentLength:${e.contentLength}`}}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,s,n,a,i,l,f,u,d,m,g,h,_]=t;if(!this.validateUUID(n))throw new Error("Invalid UUID");if(i&&!this.validateUUID(i))throw new Error("Invalid UUID");if(f&&!this.validateUUID(f))throw new Error("Invalid UUID");if(r==="relay"&&s==="relay"&&a==="folder"&&l==="doc")return new zr(n,i,f);if(r==="relay"&&s==="relay"&&a==="folder"&&l==="file"&&u==="hash"&&m==="contentType"&&h==="contentLength")return new Iu(n,i,f,d,g,_);if(r==="relay"&&s==="relay"&&a==="folder"&&l==="file")return new Mo(n,i,f);if(r==="relay"&&s==="relay"&&a=="folder")return new Do(n,i);if(r==="relay"&&s==="folder"&&a==="document")return new Eo(n,i);if(r==="relay"&&s==="folder")return new no(n);if(r==="relay"&&s==="relay")return new ku(n);if(s===void 0)return new Su;throw new Error("Invalid s3rn format for the given product type")}};function tC(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function Fy(o){let e=JSON.stringify(o),t=tC(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var Ll={enableUpdateYDocFromDiskBuffer:!1,enableDocumentStatus:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableHTTPSync:!1,enableSyncMenu:!0,enableDocumentServer:!1,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableDesyncPill:!1,enableAutomaticUpdatesOption:!1,enableAttachmentSync:!0,enableNetworkLogging:!1};function rC(){return new Proxy({},{get:(o,e)=>e})}var ao=rC();var On=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...s)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...s)},t)}}};var $t=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return $t.instance||($t.instance=new $t(new On),Et.set(this.instance,"postie")),$t.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let s={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(s),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Ae("[postie]","debug");for(let[t,r]of this.mailboxes){for(let s of r)t(s),e("send",s.constructor.name,t),this.deliveredMailLog.push({sender:s,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Ae("[postie]","warn")("All Mail Log:"),this.prettyPrintMailLog(this.allMailLog)}prettyPrintDeliveredMailLog(){Ae("[postie]","warn")("Delivered Mail Log:"),this.prettyPrintMailLog(this.deliveredMailLog)}prettyPrintMailLog(e){let t=Ae("[postie]","warn");e.forEach((r,s)=>{t(`Mail #${s+1}:`),t(`  Timestamp: ${new Date(r.timestamp).toISOString()}`),t(`  Transaction ID: ${r.transactionId}`),t(`  Sender: ${r.sender.observableName||r.sender.constructor.name}`),t(`  Recipient: ${r.recipient.name||"Anonymous function"}`),t(`  Recipient Origin: ${r.recipientOrigin||"Unknown"}`),t("---")})}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let s=200,n=t.replace(/\s+/g," ").slice(0,s);return n.length===s&&(n+="..."),`AnonymousFunction(${n})`}static destroy(){$t.instance&&($t.instance.mailboxes=null,$t.instance.allMailLog=[],$t.instance.deliveredMailLog=[],$t.instance.timeProvider.destroy(),$t.instance.timeProvider=null,$t.instance.isDelivering=!1,$t.instance.isInTransaction=!1,$t.instance.currentTransactionId=0,$t._destroyed=!0,$t.instance=void 0)}},Mr=$t;Mr._destroyed=!1;var Lu=new Map;function Dy(){for(let[,o]of Lu)o();Lu.clear()}var it=class extends Mt{constructor(t){super();this.observableName=t;this.destroyed=!1;Lu.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)Mr.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),Mr.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};function et(){return{...Rt.getInstance().flags}}function Ro(o,e,t=()=>{}){Rt.getInstance().flags[o]?e():t()}function My(o,e,t=()=>{}){o.forEach(r=>{if(Rt.getInstance().flags[r]){e();return}}),t()}var Rt=class extends it{constructor(){super();this.flags=Ll}async applyServerFlags(t){if(!this.settings)return;let s=t.filter(n=>n.override).reduce((n,a)=>(n[a.name]=a.value,n),{});this.log("applying server flags",s),await this.settings.update(n=>({...n,...s}),!0)}static getInstance(){return Rt.instance||(Rt.instance=new Rt),Rt.instance}setSettings(t){this.settings=t,this.settings.subscribe(r=>{this.flags={...this.flags,...r},this.notifyListeners()})}getFlag(t){return this.flags[t]}setFlag(t,r){this.settings&&this.settings.update(s=>({...s,[t]:r}))}static destroy(){Rt.instance=null}};var oC={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function Ey(o,e,t){let r={token:o.token},s=new Iy(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&s.awareness.setLocalStateField("user",{name:t.name,color:t.color.color,colorLight:t.color.light}),s}var $s=class extends Mt{constructor(t,r,s,n){var f;super();this.guid=t;this._s3rn=r;this.tokenStore=s;this.loginManager=n;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=n;let a=(f=this.loginManager)==null?void 0:f.user;this.ydoc=new yr,et().enableDocumentHistory&&(this.ydoc.gc=!1),a&&new al(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,a.id),this.tokenStore=s,this.clientToken=this.tokenStore.getTokenSync(Tt.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=Ey(this.clientToken,this.ydoc,a);let i=this.providerConnectionErrorSubscription(u=>{this.log(`[${this.path}] disconnection event`,u);let d=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),d&&this.connect()});i.on(),this._offConnectionError=i.off;let l=this.providerStateSubscription(u=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${Fy(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(Tt.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,s=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!s}return!1}refreshProvider(t){var a;this.clientToken=t;let r=new yr,s=Ey(t,r),n=s.url;if(this._provider){if(this._provider.url!==n){this._provider.url=n,this._provider.wsUnsuccessfulReconnects=0;let i=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${i}`),(a=this._provider.ws)==null||a.close()}}else throw new Error("missing provider!");s.awareness.destroy(),s.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:oC[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=s=>{s.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}reset(){this.disconnect(),this.clientToken={token:"",url:"",docId:"-",expiryTime:0}}_injectIntent(t){return s=>{t({status:s.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var ns=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},Cl=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=s=>{s.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((s,n)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>n(l.error),l.onsuccess=()=>s()}catch(a){n(a)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{try{let i=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);i.onerror=()=>s(i.error),i.onsuccess=()=>r(i.result?i.result.contents:null)}catch(n){s(n)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{try{let i=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);i.onerror=()=>s(i.error),i.onsuccess=()=>r()}catch(n){s(n)}})}};var as=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=s=>{if(this.currentPromise&&this.resolver){let n=this.resolver;n(s),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let s=r(t);if(s)return s}return this.currentPromise||(this.currentPromise=new Promise((s,n)=>{this.resolver=s,this.timeoutId=window.setTimeout(()=>{Ae("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[a,i]=this.checkFunction();a&&r(i)},3e3),this.promiseFunction().then(a=>{this.timeoutId&&clearTimeout(this.timeoutId),s(a)},a=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,n(a)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},Tl=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{Ae("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function Pl(o,...e){return new Promise((t,r)=>{let s=window.setTimeout(()=>{Ae("[Promise]","error")("Promise stuck after 3s:",...e)},3e3);o.then(n=>{clearTimeout(s),t(n)},n=>{clearTimeout(s),r(n)})})}var sC={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/json",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",m4a:"audio/x-m4a",flac:"audio/flac",ogg:"audio/ogg",oga:"audio/ogg",opus:"audio/opus",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",mkv:"video/x-matroska","3gp":"video/3gpp"};function Un(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return sC[e]||"application/octet-stream"}function Bs(o){return o instanceof kt}var kt=class extends $s{constructor(t,r,s,n){let a=n.relayId?new zr(n.relayId,n.guid,r):new Eo(n.guid,r);super(r,a,n.tokenStore,s);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=n,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let i=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new Pn(i,this.ydoc)}catch(i){throw this.warn("Unable to open persistence.",this.guid),console.error(i),i}this.whenSynced().then(()=>{let i=l=>{let f=l.transaction.origin;l.changes.keys.size!==0&&f!=this&&this.updateStats()};this.ytext.observe(i),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(i)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",Tt.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),Ro(ao.enableDeltaLogging,()=>{let i=l=>{var u,d;let f="";f+=`Transaction origin: ${l.transaction.origin} ${(d=(u=l.transaction.origin)==null?void 0:u.constructor)==null?void 0:d.name}
`;for(let m of l.changes.delta)f+=`insert: ${m.insert}

retain: ${m.retain}

delete: ${m.delete}
`;this.debug(f)};this.ytext.observe(i),this.unsubscribes.push(()=>{this.ytext.unobserve(i)})}),this._tfile=null}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let s=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(n=>null);return s!==null&&s!==""?r=s:r=await this._parent.read(this),this.setDiskBuffer(r.replace(`\r
`,`
`))}catch(s){throw console.error(s),s}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new ns(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,s=this.text!==r;return s||this.clearDiskBuffer(),s}async connect(){return this.sharedFolder.s3rn instanceof no?!1:(this.s3rn instanceof Eo&&(this.sharedFolder.relayId?this.s3rn=new zr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Eo(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new as(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new as(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return Un(this.path)}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=oo(this._persistence.db,["updates"],"readonly"),r=await Os(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(s=>{s()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}async read(){return this.text}async rename(t){this.move(t)}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var is=class extends it{constructor(){super();this._set=new Set}add(t){return this._set.add(t),this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let s of this._set)t(s)&&r.push(s);return r}};var Oo=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let s=r.split(`${this.namespace}${this.seperator}`)[1],n=this.get(s);e.call(t,n,s,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var Cu=require("obsidian");function Tu(o){return o instanceof xr}var xr=class extends Mt{constructor(t,r,s,n){super();this.path=t;this.guid=r;this.relayManager=s;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=n,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let a=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));a instanceof Cu.TFolder?(this._tfolder=a,this.ready=!0):(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(i=>{this._tfolder=i,this.ready=!0})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,n.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r,s){return console.log("virtualpath for new syncfolder",r.getVirtualPath(s.path)),new xr(r.getVirtualPath(s.path),yn(),t,r)}disconnect(){this.connected=!1}move(t){t!==this.path&&(this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}static checkPath(t){var s;return!((s=t.split("/").pop())==null?void 0:s.includes("."))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Cu.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async rename(t){this.move(t)}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this.relayManager=null,this._tfolder=null}};var io=vs(wa());var Al,nC=new Uint8Array(16);function Pu(){if(!Al&&(Al=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Al))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Al(nC)}var Bt=[];for(let o=0;o<256;++o)Bt.push((o+256).toString(16).slice(1));function Ry(o,e=0){return Bt[o[e+0]]+Bt[o[e+1]]+Bt[o[e+2]]+Bt[o[e+3]]+"-"+Bt[o[e+4]]+Bt[o[e+5]]+"-"+Bt[o[e+6]]+Bt[o[e+7]]+"-"+Bt[o[e+8]]+Bt[o[e+9]]+"-"+Bt[o[e+10]]+Bt[o[e+11]]+Bt[o[e+12]]+Bt[o[e+13]]+Bt[o[e+14]]+Bt[o[e+15]]}var aC=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Au={randomUUID:aC};function iC(o,e,t){if(Au.randomUUID&&!e&&!o)return Au.randomUUID();o=o||{};let r=o.random||(o.rng||Pu)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return Ry(r)}var $n=iC;var lC={images:"image",audio:"audio",videos:"video",pdfs:"pdf",otherTypes:"file"};function Fu(o){return(o==null?void 0:o.type)==="markdown"}function Oy(o){return(o==null?void 0:o.type)==="folder"}function ja(o){return{version:0,id:o,type:"markdown"}}function Fl(o){return{version:0,id:o,type:"folder"}}function Uy(o,e,t,r,s){return s||(s=Date.now()),{version:0,id:e,type:o,mimetype:t,synctime:s,hash:r}}var Du=class extends it{constructor(t,r){super();this.syncSettings=t;this.configs=r;this.protocols=new Map;r=r||Du.defaults,r.forEach(([s,n])=>this.protocols.set(s,n)),this.unsubscribes.push(t.subscribe(s=>{this.updateFromSettings(s)}))}setEnabled(t,r){let s=this.protocols.get(t);s&&(s.enabled=r)}canSync(t,r){var a,i;if(t.endsWith(".md")||!((a=t.split("/").pop())==null?void 0:a.includes(".")))return!0;if(!et().enableAttachmentSync)return!1;if(r){let l=this.protocols.get(r.type);return l?l.enabled&&r.version<=l.maxVersion:!1}let n=this.getTypeForPath(t);return!!((i=this.protocols.get(n))!=null&&i.enabled)}updateFromSettings(t){Object.entries(lC).forEach(([r,s])=>{this.setEnabled(s,t[r])})}getEnabledFileSyncTypes(){if(!et().enableAttachmentSync)return["markdown"];let t=[];return this.protocols.forEach((r,s)=>{r!=null&&r.enabled&&s!=="folder"&&t.push(s)}),t}getTypeForPath(t){let r=Un(t);for(let[s,n]of this.protocols)if(n.mimetypes.includes(r))return s;return"file"}},Ga=Du;Ga.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}],["image",{maxVersion:0,mimetypes:["image/png","image/jpeg","image/gif","image/svg+xml","image/webp","image/avif","image/bmp"],enabled:!0}],["pdf",{maxVersion:0,mimetypes:["application/pdf"],enabled:!0}],["audio",{maxVersion:0,mimetypes:["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/x-m4a","audio/ogg","audio/opus"],enabled:!0}],["video",{maxVersion:0,mimetypes:["video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"],enabled:!0}],["file",{maxVersion:0,mimetypes:["application/octet-stream"],enabled:!1}]];var Dl=class extends it{constructor(t,r,s,n){super();this.ydoc=t;this.namespace=r;this.pendingUpload=s;this.syncSettingsManager=n;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new Ga(this.syncSettingsManager)}assertVPath(t){if(t.startsWith(this.namespace+io.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let s=this.pendingUpload.get(t);s&&(this.pendingUpload.set(r,s),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let n=this.overlay.get(t);n&&(this.overlay.set(r,n),this.overlay.delete(t));let a=this.meta.get(t);Oy(a)?this.moveFolder(t,r):a&&(this.set(r,a),this.delete(t))}new(t){this.assertVPath(t);let r=$n();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,s)=>{this.deleteSet.has(s)||t(r,s)}),this.overlay.forEach((r,s)=>{this.deleteSet.has(s)||t(r,s)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}set(t,r){this.assertVPath(t),Fu(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let s=this.meta.get(t);s&&s.id===r.id&&s.mimetype==r.mimetype&&s.type===r.type&&s.hash===r.hash||(this.log("metadata write (path, existing, meta)",t,s,r),this.meta.set(t,r),this.pendingUpload.has(t)&&this.pendingUpload.delete(t))}processFolderOperation(t){let r=new Map,s=new Map;t.changes.keys.forEach((n,a)=>{if(n.action==="delete"){let i=n.oldValue;(i==null?void 0:i.type)==="folder"&&r.set(i.id,a)}else if(n.action==="add"||n.action==="update"){let i=this.meta.get(a);(i==null?void 0:i.type)==="folder"&&s.set(i.id,a)}}),r.forEach((n,a)=>{let i=s.get(a);if(i&&n!==i){this.log(`Detected folder move from ${n} to ${i}`);let l=new Map;this.meta.forEach((f,u)=>{u.startsWith(i+io.sep)&&l.set(u,f)}),this.renames.set(n,i),this.log("setting alias",n,i),this.log("paths to move",l),l.forEach((f,u)=>{let d=u.slice(i.length),m=n+d;this.renames.set(m,u),this.log("setting alias",m,u)})}})}start(){Ro(ao.enableDeltaLogging,()=>{let s=n=>{var i,l;let a="";a+=`Transaction origin: ${n.transaction.origin}${(l=(i=n.transaction.origin)==null?void 0:i.constructor)==null?void 0:l.name}
`,n.changes.keys.forEach((f,u)=>{f.action==="add"&&(a+=`Added ${u}: ${this.get(u)}
`),f.action==="update"&&(a+=`Updated ${u}: ${this.get(u)}
`),f.action==="delete"&&(a+=`Deleted ${u}
`)}),this.debug(a)};this.legacyIds.observe(s),this.meta.observe(s),this.unsubscribes.push(()=>{this.legacyIds.unobserve(s)}),this.unsubscribes.push(()=>{this.meta.unobserve(s)})});let t=async s=>{if(s.changes.keys.size===0){this.log("no changes detected");return}s.transaction.origin!=this&&(this.processFolderOperation(s),this.notifyListeners())},r=async s=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)}),this.unsubscribes.push(this.typeRegistry.subscribe(()=>{this.log("type registry change"),this.notifyListeners()}))}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let s=this.getMeta(t);if(s)return s.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),s=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let n=this.legacyIds.get(t),a=ja(n);return this.overlay.set(t,a),a}if(r){if(Fu(r)&&!s){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((n,a)=>{let i;if(this.meta.forEach((l,f)=>{l.type==="markdown"&&l.id===n&&f!==a&&(i=f)}),i){let l=(0,io.dirname)(i),f=(0,io.dirname)(a);l!==f&&t.set(l,f)}}),Array.from(t.entries()).sort(([n],[a])=>a.length-n.length).forEach(([n,a])=>{r.has(n)||(this.moveFolder(n,a),r.add(n))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let s=new Map;this.meta.forEach((a,i)=>{(i===t||i.startsWith(t+io.sep))&&s.set(i,a)}),this.overlay.forEach((a,i)=>{(i===t||i.startsWith(t+io.sep))&&s.set(i,a)});let n=this.meta.get(t);n&&(this.meta.set(r,n),this.meta.delete(t)),s.forEach((a,i)=>{if(i===t)return;let l=i.slice(t.length),f=r+l;this.move(i,f)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.set(t,r)}migrateFile(t,r){var i;if(this.assertVPath(r),((i=this.meta.get(r))==null?void 0:i.id)===t)return;let s=new Set,n=r.split(io.sep),a="";for(let l=0;l<n.length-1;l++)a=n.slice(0,l+1).join(io.sep),s.add(a);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,ja(t))),s.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let f=$n();console.log("creating folder path",l,f),this.overlay.set(l,Fl(f))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function $y(o,e,t=(r,s)=>r.substring(s.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,s){let n=r[s];return typeof n=="function"?function(...a){return a.length>0&&typeof a[0]=="string"&&(a[0]=t(a[0],e)),n.apply(r,a)}:n}})}var zy=require("obsidian"),Ky=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkFetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(Ky.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=Wy()));var Pt=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",s=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.5.1"}),n={url:t,method:r,body:e==null?void 0:e.body,headers:s,throw:!1},a;if(a=await(0,zy.requestUrl)(n),!a.arrayBuffer.byteLength)return new Response(null,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});let i=new Response(a.arrayBuffer,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});if(Object.defineProperty(i,"json",{value:async()=>JSON.parse(a.text)}),et().enableNetworkLogging){let f=a.status>=500?"error":a.status>=400?"warn":"debug",u=a.text,d;if((a.headers["content-type"]||"").includes("application/json"))try{d=JSON.parse(u)}catch(g){}Ae("[CustomFetch]",f)(a.status.toString(),r,t,d||u)}if(a.status>=500)throw new Error(a.text);return i};var tr=class extends Error{constructor(e){var t,r,s,n;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,tr.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof tr||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(n=(s=(r=this.originalError)==null?void 0:r.cause)==null?void 0:s.message)!=null&&n.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},Ml=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function vC(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||SC,s=0;for(;s<o.length;){let n=o.indexOf("=",s);if(n===-1)break;let a=o.indexOf(";",s);if(a===-1)a=o.length;else if(a<n){s=o.lastIndexOf(";",n-1)+1;continue}let i=o.slice(s,n).trim();if(t[i]===void 0){let l=o.slice(n+1,a).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[i]=r(l)}catch(f){t[i]=l}}s=a+1}return t}function Gy(o,e,t){let r=Object.assign({},t||{}),s=r.encode||kC;if(!Ml.test(o))throw new TypeError("argument name is invalid");let n=s(e);if(n&&!Ml.test(n))throw new TypeError("argument val is invalid");let a=o+"="+n;if(r.maxAge!=null){let i=r.maxAge-0;if(isNaN(i)||!isFinite(i))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(i)}if(r.domain){if(!Ml.test(r.domain))throw new TypeError("option domain is invalid");a+="; Domain="+r.domain}if(r.path){if(!Ml.test(r.path))throw new TypeError("option path is invalid");a+="; Path="+r.path}if(r.expires){if(!function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");a+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":a+="; Priority=Low";break;case"medium":a+="; Priority=Medium";break;case"high":a+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}function SC(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function kC(o){return encodeURIComponent(o)}var Jy;function El(o){if(o)try{let e=decodeURIComponent(Jy(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function Qy(o,e=0){let t=El(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}Jy=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,s=0,n=0,a="";r=e.charAt(n++);~r&&(t=s%4?64*t+r:r,s++%4)?a+=String.fromCharCode(255&t>>(-2*s&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};var jy="pb_auth",Ja=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!Qy(this.token)}get isAdmin(){return El(this.token).type==="admin"}get isAuthRecord(){return El(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=jy){let r=vC(e||"")[t]||"",s={};try{s=JSON.parse(r),(typeof s===null||typeof s!="object"||Array.isArray(s))&&(s={})}catch(n){}this.save(s.token||"",s.model||null)}exportToCookie(e,t=jy){var l,f;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},s=El(this.token);r.expires=s!=null&&s.exp?new Date(1e3*s.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let n={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},a=Gy(t,JSON.stringify(n),e),i=typeof Blob!="undefined"?new Blob([a]).size:a.length;if(n.model&&i>4096){n.model={id:(l=n==null?void 0:n.model)==null?void 0:l.id,email:(f=n==null?void 0:n.model)==null?void 0:f.email};let u=["collectionId","username","verified"];for(let d in this.model)u.includes(d)&&(n.model[d]=this.model[d]);a=Gy(t,JSON.stringify(n),e)}return a}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},Eu=class extends Ja{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},Uo=class{constructor(e){this.client=e}},Ru=class extends Uo{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,s,n,a){return a=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:s,duration:n}},a),this.client.send("/api/settings/apple/generate-client-secret",a)}},Qa=class extends Uo{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(s=>{var n;return s.items=((n=s.items)==null?void 0:n.map(a=>this.decode(a)))||[],s})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var s;if(!((s=r==null?void 0:r.items)!=null&&s.length))throw new tr({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new tr({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(s=>this.decode(s))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],s=async n=>this.getList(n,e||500,t).then(a=>{let i=a.items;return r=r.concat(i),i.length==a.perPage?s(n+1):r});return s(1)}};function br(o,e,t,r){let s=r!==void 0;return s||t!==void 0?s?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function Mu(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var Ou=class extends Qa{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(s=>{var n,a;return((n=this.client.authStore.model)==null?void 0:n.id)===s.id&&((a=this.client.authStore.model)==null?void 0:a.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,n;return r&&((s=this.client.authStore.model)==null?void 0:s.id)===e&&((n=this.client.authStore.model)==null?void 0:n.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,s){let n={method:"POST",body:{identity:e,password:t}};n=br("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",n,r,s);let a=n.autoRefreshThreshold;delete n.autoRefreshThreshold,n.autoRefresh||Mu(this.client);let i=await this.client.send(this.baseCrudPath+"/auth-with-password",n);return i=this.authResponse(i),a&&function(f,u,d,m){Mu(f);let g=f.beforeSend,h=f.authStore.model,_=f.authStore.onChange((w,v)=>{(!w||(v==null?void 0:v.id)!=(h==null?void 0:h.id)||(v!=null&&v.collectionId||h!=null&&h.collectionId)&&(v==null?void 0:v.collectionId)!=(h==null?void 0:h.collectionId))&&Mu(f)});f._resetAutoRefresh=function(){_(),f.beforeSend=g,delete f._resetAutoRefresh},f.beforeSend=async(w,v)=>{var E;let M=f.authStore.token;if((E=v.query)!=null&&E.autoRefresh)return g?g(w,v):{url:w,sendOptions:v};let R=f.authStore.isValid;if(R&&Qy(f.authStore.token,u))try{await d()}catch(O){R=!1}R||await m();let D=v.headers||{};for(let O in D)if(O.toLowerCase()=="authorization"&&M==D[O]&&f.authStore.token){D[O]=f.authStore.token;break}return v.headers=D,g?g(w,v):{url:w,sendOptions:v}}}(this.client,a,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},n))),i}async authRefresh(e,t){let r={method:"POST"};return r=br("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=br("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,n){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=br("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",a,s,n),this.client.send(this.baseCrudPath+"/confirm-password-reset",a).then(()=>!0)}},IC=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function Xy(o){if(o){o.query=o.query||{};for(let e in o)IC.includes(e)||(o.query[e]=o[e],delete o[e])}}var Rl=class extends Uo{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var a;if(!e)throw new Error("topic must be set.");let s=e;if(r){Xy(r);let i="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));s+=(s.includes("?")?"&":"?")+i}let n=function(i){let l=i,f;try{f=JSON.parse(l==null?void 0:l.data)}catch(u){}t(f||{})};return this.subscriptions[s]||(this.subscriptions[s]=[]),this.subscriptions[s].push(n),this.isConnected?this.subscriptions[s].length===1?await this.submitSubscriptions():(a=this.eventSource)==null||a.addEventListener(s,n):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,n)}async unsubscribe(e){var r;let t=!1;if(e){let s=this.getSubscriptionsByTopic(e);for(let n in s)if(this.hasSubscriptionListeners(n)){for(let a of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,a);delete this.subscriptions[n],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let s in this.subscriptions)if((s+"?").startsWith(e)){t=!0;for(let n of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,n);delete this.subscriptions[s]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var n;let r=!1,s=this.getSubscriptionsByTopic(e);for(let a in s){if(!Array.isArray(this.subscriptions[a])||!this.subscriptions[a].length)continue;let i=!1;for(let l=this.subscriptions[a].length-1;l>=0;l--)this.subscriptions[a][l]===t&&(i=!0,delete this.subscriptions[a][l],this.subscriptions[a].splice(l,1),(n=this.eventSource)==null||n.removeEventListener(a,t));i&&(this.subscriptions[a].length||delete this.subscriptions[a],r||this.hasSubscriptionListeners(a)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let s in this.subscriptions)if((r=this.subscriptions[s])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let s of this.pendingConnects)s.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let s in r)for(let n of r[s])n(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new tr(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},Uu=class extends Qa{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(s=>{var n,a,i;return((n=this.client.authStore.model)==null?void 0:n.id)!==(s==null?void 0:s.id)||((a=this.client.authStore.model)==null?void 0:a.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,n,a;return!r||((s=this.client.authStore.model)==null?void 0:s.id)!==e||((n=this.client.authStore.model)==null?void 0:n.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,s){let n={method:"POST",body:{identity:e,password:t}};return n=br("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/auth-with-password",n).then(a=>this.authResponse(a))}async authWithOAuth2Code(e,t,r,s,n,a,i){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:s,createData:n}};return l=br("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,a,i),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then(f=>this.authResponse(f))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(l=>l.name===t.provider);if(!r)throw new tr(new Error(`Missing or invalid provider "${t.provider}".`));let s=this.client.buildUrl("/api/oauth2-redirect"),n=new Rl(this.client),a=null;function i(){a==null||a.close(),n.unsubscribe()}return t.urlCallback||(a=Yy(void 0)),new Promise(async(l,f)=>{var u;try{await n.subscribe("@oauth2",async h=>{let _=n.clientId;try{if(!h.state||_!==h.state)throw new Error("State parameters don't match.");let w=Object.assign({},t);delete w.provider,delete w.scopes,delete w.createData,delete w.urlCallback;let v=await this.authWithOAuth2Code(r.name,h.code,r.codeVerifier,s,t.createData,w);l(v)}catch(w){f(new tr(w))}i()});let d={state:n.clientId};(u=t.scopes)!=null&&u.length&&(d.scope=t.scopes.join(" "));let m=this._replaceQueryParams(r.authUrl+s,d);await(t.urlCallback||function(h){a?a.location.href=h:a=Yy(h)})(m)}catch(d){i(),f(new tr(d))}})}async authRefresh(e,t){let r={method:"POST"};return r=br("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(s=>this.authResponse(s))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=br("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,n){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=br("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",a,s,n),this.client.send(this.baseCollectionPath+"/confirm-password-reset",a).then(()=>!0)}async requestVerification(e,t,r){let s={method:"POST",body:{email:e}};return s=br("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-verification",s).then(()=>!0)}async confirmVerification(e,t,r){let s={method:"POST",body:{token:e}};return s=br("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",s).then(()=>!0)}async requestEmailChange(e,t,r){let s={method:"POST",body:{newEmail:e}};return s=br("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",s).then(()=>!0)}async confirmEmailChange(e,t,r,s){let n={method:"POST",body:{token:e,password:t}};return n=br("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/confirm-email-change",n).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,s="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),s=e.substring(e.indexOf("?")+1));let n={},a=s.split("&");for(let i of a){if(i=="")continue;let l=i.split("=");n[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let i in t)t.hasOwnProperty(i)&&(t[i]==null?delete n[i]:n[i]=t[i]);s="";for(let i in n)n.hasOwnProperty(i)&&(s!=""&&(s+="&"),s+=encodeURIComponent(i.replace(/%20/g,"+"))+"="+encodeURIComponent(n[i].replace(/%20/g,"+")));return s!=""?r+"?"+s:r}};function Yy(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new tr(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,s=window.innerHeight;e=e>r?r:e,t=t>s?s:t;let n=r/2-e/2,a=s/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+a+",left="+n+",resizable,menubar=no")}var $u=class extends Qa{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},Bu=class extends Uo{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new tr({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},Nu=class extends Uo{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},Hu=class extends Uo{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let s=[];s.push("api"),s.push("files"),s.push(encodeURIComponent(e.collectionId||e.collectionName)),s.push(encodeURIComponent(e.id)),s.push(encodeURIComponent(t));let n=this.client.buildUrl(s.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let a=new URLSearchParams(r);n+=(n.includes("?")?"&":"?")+a}return n}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},Vu=class extends Uo{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},Bn=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new Eu,this.admins=new Ou(this),this.collections=new $u(this),this.files=new Hu(this),this.logs=new Bu(this),this.settings=new Ru(this),this.realtime=new Rl(this),this.health=new Nu(this),this.backups=new Vu(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Uu(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let s=t[r];switch(typeof s){case"boolean":case"number":s=""+s;break;case"string":s="'"+s.replace(/'/g,"\\'")+"'";break;default:s=s===null?"null":s instanceof Date?"'"+s.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(s).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",s)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let s=Object.assign({},await this.beforeSend(r,t));s.url!==void 0||s.options!==void 0?(r=s.url||r,t=s.options||t):Object.keys(s).length&&(t=s,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let s=this.serializeQueryParams(t.query);s&&(r+=(r.includes("?")?"&":"?")+s),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async s=>{let n={};try{n=await s.json()}catch(a){}if(this.afterSend&&(n=await this.afterSend(s,n)),s.status>=400)throw new tr({url:s.url,status:s.status,data:n});return n}).catch(s=>{throw new tr(s)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),Xy(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let s=new AbortController;this.cancelControllers[r]=s,t.signal=s.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let s=this.normalizeFormDataValue(e[r]),n=Array.isArray(s)?s:[s];if(n.length)for(let a of n)t.append(r,a);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let s of r)if(typeof Blob!="undefined"&&s instanceof Blob||typeof File!="undefined"&&s instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let s=e[r],n=encodeURIComponent(r);if(Array.isArray(s))for(let a of s)t.push(n+"="+encodeURIComponent(a));else s instanceof Date?t.push(n+"="+encodeURIComponent(s.toISOString())):typeof s!==null&&typeof s=="object"?t.push(n+"="+encodeURIComponent(JSON.stringify(s))):t.push(n+"="+encodeURIComponent(s))}return t.join("&")}};var Ol=class extends Mt{constructor(t){super();this.pb=new Bn("https://auth.system3.md",t.loginManager.authStore),this.tokenStore=t.tokenStore}async readFile(t){if(!t.meta)throw new Error("cannot pull file with missing hash");let r=t.meta.hash,s=await this.tokenStore.getFileToken(Tt.encode(t.s3rn),r,t.mimetype,0),i=(await(await Pt(s.baseUrl+"/download-url",{method:"GET",headers:{Authorization:`Bearer ${s.token}`}})).json()).downloadUrl;return(await Pt(i)).arrayBuffer()}async writeFile(t){let r=await t.caf.read(),s=await t.caf.hash();if(this.log("writeFile",s),!(r&&s))throw new Error("invalid caf");let n=await this.tokenStore.getFileToken(Tt.encode(t.s3rn),s,t.mimetype,r.byteLength),a=await Pt(n.baseUrl+"/upload-url",{method:"POST",headers:{Authorization:`Bearer ${n.token}`}}),i=await a.json();if(a.status!==200)throw new Error(i.error);let l=i.uploadUrl;await Pt(l,{method:"PUT",headers:{"Content-Type":t.mimetype},body:r})}destroy(){this.pb.cancelAllRequests(),this.pb=null,this.tokenStore=null}};var ur=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var Ul=class extends it{constructor(t,r){super();this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.log("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),s=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(s)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},wr=class extends it{constructor(t,r){super();this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new ur("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new ur(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let n=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([i])=>n.test(i)).reduce((i,[l,f])=>(i[l]=f,i),{})}let s=this.getNestedValue(t);return s===void 0?{}:s}async set(t){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new ur("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let s=this.patterns.find(this.isWildcardPattern);if(s){if(this.path.length===1){let l=new RegExp(`^${s.wildcardPattern}$`),f={...r};return Object.entries(t).forEach(([u,d])=>{l.test(u)&&(f[u]=d)}),f}let n={...r},a=n;this.path.forEach(l=>{a[l]=a[l]||{},a=a[l]});let i=new RegExp(`^${s.wildcardPattern}$`);return Object.entries(t).forEach(([l,f])=>{i.test(l)&&(a[l]=f)}),n}return this.setNestedValue(r,t)})}catch(r){let s=r instanceof Error?r.message:"Unknown error";throw new ur(`Failed to set value at path ${this.getPath()}: ${s}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let s=this.get(),n=t(s);!r&&JSON.stringify(s)===JSON.stringify(n)||await this.set(n)}async flush(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(i=>i),s=[],n=[],a=[];return r.forEach((i,l)=>{let f=i.match(/^\[(\w+)=(.+)\]$/),u=i.match(/^\((.+?)\)$/);if(f){let[,d,m]=f,g=l>0?n[l-1]:i.split("[")[0];a.push({type:"arrayMatch",key:d,value:m,level:l}),s.push(i),n.push(g)}else if(u){let[,d]=u;a.push({type:"wildcard",wildcardPattern:this.createPatternRegex(d),level:l}),s.push(i),n.push(i)}else s.push(i),n.push(i)}),[s,n,a]}getNestedValue(t){let r=t,s=this.patterns.find(this.isWildcardPattern);if(s&&this.path.length===1){let a=new RegExp(`^${s.wildcardPattern}$`);return Object.entries(r).filter(([l])=>a.test(l)).reduce((l,[f,u])=>(l[f]=u,l),{})}let n=this.patterns[0];if((n==null?void 0:n.type)==="arrayMatch"){let a=this.basePath[0];if(!Array.isArray(r[a]))return;let i=r[a].find(f=>f[n.key]===n.value);if(!i)return;let l=this.basePath.slice(n.level+1);if(l.length>0){let f=i;for(let u of l){if(!f||typeof f!="object")return;f=f[u]}return f}return i}for(let a=0;a<this.basePath.length;a++){if(!r)return;r=r[this.basePath[a]]}return r}setNestedValue(t,r){let s={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];s[l]||(s[l]=[]);let f=s[l].findIndex(d=>d[n.key]===n.value),u=this.basePath.slice(n.level+1);if(f>=0)if(u.length>0){let d=s[l][f];for(let g=0;g<u.length-1;g++){let h=u[g];d[h]=d[h]||{},d=d[h]}let m=u[u.length-1];d[m]=r}else s[l][f]={...s[l][f],...r,[n.key]:n.value};else if(u.length>0){let d={[n.key]:n.value},m=d;for(let h=0;h<u.length-1;h++){let _=u[h];m[_]={},m=m[_]}let g=u[u.length-1];m[g]=r,s[l].push(d)}else s[l].push({...r,[n.key]:n.value});return s}let a=s;for(let l=0;l<this.basePath.length-1;l++){let f=this.basePath[l];a[f]=a[f]||{},a=a[f]}let i=this.basePath[this.basePath.length-1];return a[i]=r,s}getParent(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new wr(this.settings,t)}getChild(t,r){let s=[...this.path,t].join("/");return r?r(this.settings,s):(this.log("getChild",this.path,t,s,this.patterns),new wr(this.settings,s))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(f=>f[s.key]!==s.value),r[l].length===0&&delete r[l]),r}let n=r,a=this.basePath.slice(0,-1);for(let l of a){if(!n[l])return r;n=n[l]}let i=this.basePath[this.basePath.length-1];return delete n[i],r})}subscribe(t){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var ls=class extends wr{constructor(t,r,s=!0){super(t,r);this.enabled=s}isExtensionEnabled(t){var n,a;let s=(t.split(".").pop()||"").toLowerCase();if(s==="md")return!0;if(!this.enabled||!et().enableAttachmentSync)return!1;for(let[i,l]of Object.entries(ls.schema)){let f=i;if(((n=this.get()[f])!=null?n:l.defaultEnabled)&&l.extensions.includes(s))return!0}return(a=this.get().otherTypes)!=null?a:ls.schema.otherTypes.defaultEnabled}getCategory(t){var n;let r=ls.schema[t];return{enabled:(n=this.get()[t])!=null?n:r.defaultEnabled,name:r.name,description:r.description,extensions:r.extensions}}getCategories(){return Object.keys(ls.schema).reduce((t,r)=>(t[r]=this.getCategory(r),t),{})}async toggleCategory(t,r){await this.update(s=>({...s,[t]:r})),this.log(`setting ${t} to ${r}`),this.notifyListeners()}async resetToDefault(){await this.update(()=>({...ls.defaultFlags}))}},cs=ls;cs.schema={images:{name:"Images",description:"Sync image files (.bmp, .png, .jpg, .jpeg, .gif, .svg, .webp, .avif)",extensions:["bmp","png","jpg","jpeg","gif","svg","webp","avif"],defaultEnabled:!0},audio:{name:"Audio",description:"Sync audio files (.mp3, .wav, .m4a, .3gp, .flac, .ogg, .oga, .opus)",extensions:["mp3","wav","m4a","3gp","flac","ogg","oga","opus"],defaultEnabled:!0},videos:{name:"Videos",description:"Sync video files (.mp4, .webm, .ogv, .mov, .mkv)",extensions:["mp4","webm","ogv","mov","mkv"],defaultEnabled:!0},pdfs:{name:"PDFs",description:"Sync PDF files (.pdf)",extensions:["pdf"],defaultEnabled:!0},otherTypes:{name:"Other Files",description:"Sync unsupported file types",extensions:[],defaultEnabled:!1}},cs.defaultFlags=Object.fromEntries(Object.entries(ls.schema).map(([t,r])=>[t,r.defaultEnabled]));var Xa=require("obsidian");async function Zy(o){let e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function $o(o){return!!o&&o instanceof Za}var $l=class extends Mt{constructor(t){super();this.db=null;this.setLoggers("[ContentAddressedFileStore]"),this.dbName=`${t}-relay-hashes`,this.ready=this.openDB()}async openDB(){return new Promise((t,r)=>{let s=indexedDB.open(this.dbName,1);s.onupgradeneeded=n=>{let a=s.result;a.objectStoreNames.contains("files")||a.createObjectStore("files",{keyPath:"path"})},s.onsuccess=n=>{this.db=s.result,t()},s.onerror=n=>{this.error("Error opening ContentAddressedFile database:",s.error),r(s.error)}})}async saveHash(t,r,s){if(await this.ready,!!this.db)return new Promise((n,a)=>{if(!this.db)return;let f=this.db.transaction(["files"],"readwrite").objectStore("files").put({path:t,hash:r,modifiedAt:s});f.onsuccess=()=>n(),f.onerror=()=>{this.error("Error saving hash:",f.error),a(f.error)}})}async getHash(t){return await this.ready,this.db?new Promise((r,s)=>{if(!this.db)return null;let i=this.db.transaction(["files"],"readonly").objectStore("files").get(t);i.onsuccess=()=>{r(i.result||null)},i.onerror=()=>{this.error("Error retrieving hash:",i.error),s(i.error)}}):null}async removeHash(t){if(await this.ready,!!this.db)return new Promise((r,s)=>{if(!this.db)return null;let i=this.db.transaction(["files"],"readwrite").objectStore("files").delete(t);i.onsuccess=()=>r(),i.onerror=()=>{this.error("Error removing hash:",i.error),s(i.error)}})}destroy(){this.db&&(this.db.close(),this.db=null)}},qu=class extends Mt{constructor(t,r,s,n){super();this.vault=t;this.path=r;this.metadataCache=s;this.store=n;this.content=null;this._tfile=null;let a=this.vault.getAbstractFileByPath(r);a&&a instanceof Xa.TFile&&(this._tfile=a)}get tfile(){if(!this._tfile){let t=this.vault.getAbstractFileByPath(this.path);if(t&&t instanceof Xa.TFile)this._tfile=t;else throw new Error("missing tfile")}return this._tfile}async loadHashFromStore(){try{let t=await this.store.getHash(this.path);if(t&&t.modifiedAt===this.tfile.stat.mtime)return t.hash}catch(t){this.warn("Failed to load hash from store:",t)}}get modifiedAt(){if(!this.tfile)throw new Error("missing tfile");return this.tfile.stat.mtime}async read(){this.log("reading content from disk");let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),s=await Zy(r);try{await this.store.saveHash(this.path,s,t)}catch(n){this.warn("Failed to save hash to store:",n)}return r}exists(){if(this._tfile)return!0;let t=this.vault.getAbstractFileByPath(this.path);return t&&t instanceof Xa.TFile?(this._tfile=t,!0):!1}async clear(){this._tfile=null,this.store.removeHash(this.path).catch(t=>{this.warn("Failed to remove hash from store:",t)})}async hash(){let t=await this.loadHashFromStore();if(t)return t;if(await this.read(),t=await this.loadHashFromStore(),!t)throw new Error("missing hash");return t}destroy(){this.vault=null,this._tfile=null,this.metadataCache=null}},Za=class extends it{constructor(t,r,s,n,a){super();this.path=t;this.guid=r;this.metadataCache=s;this.hashStore=n;this.ready=!1;this.connected=!0;this.offFileInfo=()=>{};this.uploadError=void 0;this.s3rn=a.relayId?new Mo(a.relayId,a.guid,r):new Ka(a.guid,r),this._parent=a,this.setLoggers(`[SharedFile](${this.path})`),this.name=this.path.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault;let i=this.sharedFolder.syncStore.typeRegistry.getTypeForPath(t);if(!i)throw new Error("unexpected synctype");this.type=i,this.caf=new qu(this.vault,this.sharedFolder.getPath(t),this.metadataCache,this.hashStore),this.log("created")}get mimetype(){return Un(this.path)}disconnect(){}get inMeta(){return!!this.sharedFolder.syncStore.getMeta(this.path)}move(t){t!==this.path&&(this.debug("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedFile](${this.path})`))}get lastModified(){return this.stat.mtime}async push(){if(this.log("push"),!this.sharedFolder.connected)return this.log("skipping push -- folder is disconnected"),"";if(!this.sharedFolder.syncStore.canSync(this.path))return this.log("skipping push -- filetype is disabled"),"";let t=await this.caf.hash(),r=this.sharedFolder.syncStore.getMeta(this.path);if(!r||t&&r.hash!==t)try{await this.sharedFolder.cas.writeFile(this),this.sharedFolder.markUploaded(this),this.uploadError=void 0,this.notifyListeners()}catch(s){let n="Failed to push file";try{n=s.toString().slice(7)}catch(a){}this.uploadError=n,this.notifyListeners()}return await this.caf.hash()}async sync(){var r;this.log("sync");let t=this.sharedFolder.syncStore.getMeta(this.path);t?await this.caf.hash()!==t.hash&&(t.synctime>this.stat.mtime?(this.warn("synctime",t.synctime,(r=this.meta)==null?void 0:r.synctime,this.stat.mtime),await this.pull()):await this.push()):await this.push()}shouldPull(t){return!this.tfile||t.synctime>this.stat.mtime}async pull(){this.log("pull");let t=this.sharedFolder.syncStore.getMeta(this.path);if(t?this.meta=t:this.warn("meta fail",t),!this.meta)throw new Error("cannot pull without meta");if(this.caf.exists()&&await this.caf.hash()===this.meta.hash)return;let r=await this.sharedFolder.cas.readFile(this);await this.vault.adapter.writeBinary(this.sharedFolder.getPath(this.path),r),await this.caf.hash()}get tfile(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Xa.TFile)return t;throw new Error("TFile API used before file existed")}get stat(){return this.tfile.stat}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.s3rn instanceof no?!1:(this.s3rn instanceof Eo&&(this.sharedFolder.relayId?this.s3rn=new Mo(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Ka(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected)))}async read(){return this.vault.read(this.tfile)}async rename(t){this.move(t)}async delete(){return await this.caf.clear(),this.vault.delete(this.tfile)}async write(t){this.vault.adapter.write(this.tfile.path,t),await this.caf.hash()}async append(t){this.vault.append(this.tfile,t),await this.caf.hash()}cleanup(){}destroy(){var t;(t=this.offFileInfo)==null||t.call(this),this.offFileInfo=null,this._parent=null,this.metadataCache=null,this.caf.destroy()}};var Wu=class extends is{constructor(){super(...arguments);this.notifyListeners=(0,lt.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let s=this.find(n=>n.guid===t.guid);return s&&s!==t&&(this.error("duplicate guid",s,t),this._set.delete(s)),this._set.add(t),r&&this.notifyListeners(),this}},Bl=class extends $s{constructor(t,r,s,n,a,i,l,f,u,d,m,g,h,_=!0){var v;let w=h?new Do(h,r):new no(r);super(r,w,l,n);this.appId=t;this.metadataCache=u;this.hashStore=d;this.backgroundSync=m;this._settings=g;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],s=this.placeHold(t);t.forEach(n=>{let a=this.getVirtualPath(n.path),i=s.contains(a);if(xr.checkPath(a)){let l=this.getSyncFolder(a,!1);r.push(l)}else if(kt.checkExtension(a))if(i){let l=this.uploadDoc(a,!1);r.push(l)}else{let l=this.getDoc(a,!1);r.push(l)}else if(this.syncStore.canSync(a))if(i){let l=this.uploadSyncFile(a,!1);r.push(l)}else{let l=this.downloadSyncFile(a,!1);r.push(l)}}),r.length>0&&this.fset.update()};this.path=s,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=i,this.vault=a,this.files=new Map,this.fset=new Wu,this.pendingUpload=new Oo(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.relayManager=f,this.relayId=h,this.diskBufferStore=new Cl,this._shouldConnect=(v=this.settings.connect)!=null?v:!0,this.authoritative=!_,this.syncSettingsManager=this._settings.getChild("sync",(M,R)=>new cs(M,R)),this.syncStore=new Dl(this.ydoc,this.path,this.pendingUpload,this.syncSettingsManager),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(M=>{this.remote=M.find(R=>R.guid==this.guid)})),this.proxy=$y(this,this.path,M=>this.getVirtualPath(M));try{this._persistence=new Pn(this.guid,this.ydoc)}catch(M){throw this.warn("Unable to open persistence.",this.guid),console.error(M),M}n.loggedIn&&this.connect(),this.cas=new Ol(this),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",Tt.encode(this.s3rn))}catch(M){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),Et.set(this,this.path)}get server(){return this._server}set server(t){if(t===this._server)return;this.warn("server changed -- reinitializing all connections");let r=this.shouldConnect;this.reset();let s=[];this.fset.forEach(n=>{n instanceof $s&&(n.connected&&s.push(n),n.reset())}),this.tokenStore.clear(n=>{var a;return!!(this.relayId&&((a=n.token)!=null&&a.docId.startsWith(this.relayId)))}),r&&(this.connect(),s.forEach(n=>{n.connect()})),this._server=t}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof lt.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path);if(t instanceof lt.TFolder&&!xr.checkPath)throw new Error("logical error");let s=this.getVirtualPath(t.path),n=this.syncStore.canSync(s),a=this.syncSettingsManager.isExtensionEnabled(s);return r&&n&&a}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof lt.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return lt.Vault.recurseChildren(t,s=>{s!==t&&r.push(s)}),r.filter(s=>this.isSyncableTFile(s))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof Do&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new Do(this.relayId,this.guid):new no(this.guid),this._settings.update(s=>({...s,relay:this.relayId})),t&&(this._server=t.relay.provider,this.unsubscribes.push(t.relay.subscribe(s=>{s.guid===this.relayId&&(this.server=s.provider)}))),this.server=t==null?void 0:t.relay.provider,this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=oo(this._persistence.db,["updates"],"readonly"),r=await Os(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new as(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new as(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,s,n){if(n==null||n.push(`${s.path} was renamed to ${this.getPath(r)}`),s instanceof lt.TFile){let a=(0,_r.dirname)(r);this.existsSync(a)||(await this.mkdir(a),n==null||n.push(`creating directory ${a}`))}await this.fileManager.renameFile(s,(0,lt.normalizePath)(this.getPath(r))).then(()=>{t.move(r)})}async _handleServerCreate(t,r){let s=(0,_r.dirname)(t);if(this.existsSync(s)||(await this.mkdir(s),r==null||r.push(`creating directory ${s}`)),kt.checkExtension(t))return r==null||r.push(`created local file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(xr.checkPath(t))return this.getSyncFolder(t,!1);if(this.syncStore.canSync(t))return this.downloadSyncFile(t,!1);throw new Error("unexpected file")}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,s,n){let a=this.files.get(t),i=this.syncStore.getMeta(r);if(!i)return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r))return a&&$o(a)&&a.shouldPull(i)?{op:"update",path:r,promise:a.pull()}:{op:"noop",path:r,promise:Promise.resolve()};if(s.has(t)&&a){let f=this.getPath(a.path),u=this.vault.getAbstractFileByPath(f);if(u){let d=this._handleServerRename(a,r,u,n);return{op:"rename",path:r,from:f,to:r,promise:d}}}let l=this._handleServerCreate(r,n);return{op:"create",path:r,promise:l}}cleanupExtraLocalFiles(t,r){let s=this.getSyncFiles(),n=[],a=s.filter(f=>f instanceof lt.TFolder),i=s.filter(f=>f instanceof lt.TFile),l=f=>{var w,v;let u=this.isSyncableTFile(f),d=this.checkPath(f.path),m=t.contains(f.path.slice(this.path.length)),g=this.pendingUpload.has(this.getVirtualPath(f.path)),h=this.getVirtualPath(f.path),_=((w=this._provider)==null?void 0:w.synced)&&((v=this._persistence)==null?void 0:v.synced);if(d&&u&&!m&&!g&&_){r.push(`deleted local file ${h} for remotely deleted doc`);let M=this.vault.adapter.trashLocal(f.path);n.push({op:"delete",path:h,promise:M})}};return i.forEach(l),a.forEach(l),n}syncByType(t,r,s,n){t.forEach((a,i)=>{this._assertNamespacing(i),n.contains(a.type)&&(this._assertNamespacing(i),s.push(this.applyRemoteState(a.id,i,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let s=this.syncFileTreePromise.getPromise();return s.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),s}let r=async()=>{try{let s=[],n=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,n,s,["folder"])},this),await Promise.all(s.map(u=>u.promise)),this.ydoc.transact(async()=>{this.syncByType(t,n,s,this.syncStore.typeRegistry.getEnabledFileSyncTypes()),this.syncStore.commit()},this);let a=s.filter(u=>u.op==="create"),i=s.filter(u=>u.op==="rename"),l=s.map(u=>u.path);await Promise.all([...a,...i].map(u=>Pl(u.promise,u)));let f=this.cleanupExtraLocalFiles(l,n);[...s,...f].every(u=>u.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...s,...f])),(i.length>0||a.length>0||f.length>0)&&this.fset.update(),n.length>0&&this.log(`syncFileTree diff:
`+n.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new Tl(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,_r.join)(this.path,t.path);return this.vault.adapter.read((0,lt.normalizePath)(r))}existsSync(t){let r=(0,lt.normalizePath)((0,_r.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,_r.join)(this.path,t.path);return this.vault.adapter.exists((0,lt.normalizePath)(r))}flush(t,r){let s=(0,_r.join)(this.path,t.path);return this.log("writing to ",(0,lt.normalizePath)(s)),this.vault.adapter.write((0,lt.normalizePath)(s),r)}getPath(t){return(0,_r.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,_r.join)(this.path,t);return this.vault.adapter.mkdir((0,lt.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+_r.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof lt.TFile?r:null}getDoc(t,r=!0){let s=this.syncStore.get(t);if(s!==void 0){let n=this.files.get(s);if(n!==void 0){if(n.move(t),!Bs(n))throw new Error("unexpected ifile type");return n}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!(n instanceof lt.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([n]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}async markUploaded(t){if(Bs(t)){let r=ja(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}if(Tu(t)){let r=Fl(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}if($o(t)){let r=this.syncStore.typeRegistry.getTypeForPath(t.path);if(!r)throw new Error("unexpected sync type");let s=await t.caf.hash();if(!s)throw new Error("file hash not yet computed");let n=this.syncStore.getMeta(this.path);if(n&&t.caf.value===n.hash)return;let a=Uy(r,t.guid,t.mimetype,s,t.stat.mtime);this.log("new meta",a),this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,a)},this);return}}getFile(t,r=!0){let s=this.syncStore.get(t);if(s){let n=this.files.get(s);if(n)return n}return kt.checkExtension(t)?this.getDoc(t):xr.checkPath(t)?this.getSyncFolder(t,r):this.syncStore.canSync(t)?this.getSyncFile(t,r):null}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(s=>{let n=this.getVirtualPath(s.path);this.syncStore.has(n)||(this.log("place hold new",n),this.syncStore.new(n),r.push(n))})},this),r}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let s=this.files.get(r);if(!Bs(s))throw new Error("unexpected ifile type");return s}viewSyncFile(t){let r=this.syncStore.get(t);if(!r)return;let s=this.files.get(r);if(!$o(s))throw new Error("unexpected ifile type");return s}getOrCreateDoc(t,r){let s=this.files.get(t)||new kt(r,t,this.loginManager,this);if(!Bs(s))throw new Error("unexpected ifile type");return s.move(r),s}async downloadDoc(t,r=!0){if(!kt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error(`called download on item that is not in ids ${t}`);let n=this.getOrCreateDoc(s,t);return n.markOrigin("remote"),Pl(this.backgroundSync.enqueueDownload(n),n.path),this.files.set(s,n),this.fset.add(n,r),n}uploadDoc(t,r=!0){if(!kt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.getOrCreateDoc(s,t),a=n.getOrigin(),i=this.awaitingUpdates();return(async()=>{if(!await this.exists(n))throw new Error(`Upload failed, doc does not exist at ${t}`);let[f,u,d]=await Promise.all([this.read(n),a,i]),m=n.ydoc.getText("contents");!d&&u===void 0&&(this.log(`[${n.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{m.insert(0,f)},this._persistence),n.markOrigin("local"),this.log(`[${n.path}] Uploading file`),await this.backgroundSync.enqueueSync(n),this.markUploaded(n))})(),this.files.set(s,n),this.fset.add(n,r),n}createDoc(t,r=!0){if(!kt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateDoc(s,t);return(async()=>this.whenReady().then(async()=>{var i;let a=await n.getServerSynced();((i=n.tfile)==null?void 0:i.stat.size)===0&&!a?this.backgroundSync.enqueueDownload(n):this.pendingUpload.get(n.path)&&this.backgroundSync.enqueueSync(n)}))(),this.files.set(s,n),this.fset.add(n,r),n}getOrCreateSyncFolder(t,r){let s=this.files.get(t)||new xr(r,t,this.relayManager,this);if(!Tu(s))throw new Error("unexpected ifile type");return s.move(r),s}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateSyncFolder(s,t);return this.files.set(s,n),this.fset.add(n,r),n}getOrCreateSyncFile(t,r,s){let n=this.files.get(t)||new Za(r,t,this.metadataCache,this.hashStore,this);if(!$o(n))throw new Error("unexpected ifile type");return n.move(r),this.files.set(t,n),n}downloadSyncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error(`called download on item that is not in ids ${t}`);let n=this.syncStore.getMeta(t);if(!n||!n.hash)return this.uploadSyncFile(t,r);let a=this.getOrCreateSyncFile(s,t,n.hash);return Pl(a.pull()),this.files.set(s,a),this.fset.add(a,r),a}uploadSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!n)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(n instanceof lt.TFile))throw new Error(`Upload failed, expected file at ${t}`);let a=this.getOrCreateSyncFile(s,t,n);return(async()=>{if(!this.existsSync(t))throw new Error(`Upload failed, file does not exist at ${t}`);await a.push()})(),this.fset.add(a,r),a}getSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!n)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(n instanceof lt.TFile))throw new Error(`Upload failed, expected file at ${t}`);let a=this.getOrCreateSyncFile(s,t,n);return this.syncStore.getMeta(t)?a.pull():(this.log("get syncfile missing meta"),a.push()),this.files.set(s,a),this.fset.add(a,r),a}uploadFile(t,r=!0){if(kt.checkExtension(t))return this.uploadDoc(t,r);if(xr.checkPath(t))return this.getSyncFolder(t,r);if(this.syncStore.canSync(t))return this.uploadSyncFile(t,r);throw new Error("unexpectedly unable to upload")}deleteFile(t){let r=this.syncStore.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let s=this.files.get(r);s&&(s.cleanup(),this.fset.delete(s)),this.files.delete(r)},this)}renameFile(t,r){let s=t.path,n="",a="";try{n=this.getVirtualPath(s)}catch(i){this.log("Moving out of shared folder")}try{a=this.getVirtualPath(r)}catch(i){this.log("Moving in from outside of shared folder")}if(!(!n&&!a))if(a){let i=this.syncStore.get(a);if(!i)return;let l=this.files.get(i);if(!n)this.ydoc.transact(()=>{this.syncStore.delete(a)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(i);else{if(!this.syncStore.get(a))return;let u=[];l instanceof xr&&this.syncStore.forEach((d,m)=>{if(m.startsWith(a+_r.sep)){let g=m.replace(a,n);u.push([d.id,m,g])}}),this.ydoc.transact(()=>{this.syncStore.move(a,n),l&&l.move(n),u.forEach(d=>{let[m,g,h]=d;this.syncStore.move(g,h);let _=this.files.get(m);_&&_.move(h)})},this),this.syncStore.resolveMove(a)}}else{if(this.assertPath(s),!this.syncStore.canSync(n))return;this.placeHold([t]),this.uploadFile(n)}}destroy(){var t,r,s;this.destroyed=!0,this.unsubscribes.forEach(n=>{n()}),this.files.forEach(n=>{n.destroy(),this.files.delete(n.guid)}),this.syncStore.destroy(),this.syncSettingsManager.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,this.syncSettingsManager=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(s=this.syncFileTreePromise)==null||s.destroy(),this.syncFileTreePromise=null}},Nl=class extends is{constructor(t,r,s,n){super();this.relayManager=t;this.vault=r;this.settings=n;this.update=(0,lt.debounce)(this.notifyListeners,100);this.folderBuilder=s,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(a=>{let i=!1;this.items().forEach(l=>{let f=a.find(u=>u.guid==l.guid);l.remote!=f&&(i=!0),l.remote=f}),i&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(s=>s.filter(n=>n.guid!==t.guid)),r}lookup(t){let r=this.find(s=>s.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(s=>{if(!this.vault.getFolderByPath(s.path)){this.warn(`Invalid settings, ${s.path} does not exist`);return}this._new(s.path,s.guid,s==null?void 0:s.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,s,n){let a=this.find(u=>u.path==t&&u.guid==r);if(a)return a;let i=this.find(u=>u.guid==r);if(i)throw new Error(`This folder is already mounted at ${i.path}.`);if(this.find(u=>u.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let f=this.folderBuilder(t,r,s,n);return this._set.add(f),f}new(t,r,s,n){let a=this._new(t,r,s,n);return this.notifyListeners(),a}};var rc=require("@codemirror/state"),Qn=require("obsidian");function J(){}function ce(o,e){for(let t in e)o[t]=e[t];return o}function ex(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function zu(o){return o()}function Vl(){return Object.create(null)}function Ie(o){o.forEach(zu)}function ut(o){return typeof o=="function"}function Q(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var Hl;function Ku(o,e){return o===e?!0:(Hl||(Hl=document.createElement("a")),Hl.href=e,o===Hl.href)}function tx(o){return Object.keys(o).length===0}function rr(o,...e){if(o==null){for(let r of e)r(void 0);return J}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function me(o,e,t){o.$$.on_destroy.push(rr(e,t))}function ge(o,e,t,r){if(o){let s=rx(o,e,t,r);return o[0](s)}}function rx(o,e,t,r){return o[1]&&r?ce(t.ctx.slice(),o[1](r(e))):t.ctx}function ye(o,e,t,r){if(o[2]&&r){let s=o[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){let n=[],a=Math.max(e.dirty.length,s.length);for(let i=0;i<a;i+=1)n[i]=e.dirty[i]|s[i];return n}return e.dirty|s}return e.dirty}function xe(o,e,t,r,s,n){if(s){let a=rx(e,t,r,n);o.p(a,s)}}function be(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Se(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function Gu(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function Nn(o){return o==null?"":o}function ox(o,e,t){return o.set(t),e}function sx(o){return o&&ut(o.destroy)?o.destroy:J}var Ns=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Hn=class{constructor(e){mt(this,"_listeners","WeakMap"in Ns?new WeakMap:void 0);mt(this,"_observer");mt(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let s of t)Hn.entries.set(s.target,s),(r=this._listeners.get(s.target))==null||r(s)})}};Hn.entries="WeakMap"in Ns?new WeakMap:void 0;var nx=!1;function ax(){nx=!0}function ix(){nx=!1}function S(o,e){o.appendChild(e)}function Fe(o,e,t){let r=lx(o);if(!r.getElementById(e)){let s=T("style");s.id=e,s.textContent=t,TC(r,s)}}function lx(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function TC(o,e){return S(o.head||o,e),e.sheet}function C(o,e,t){o.insertBefore(e,t||null)}function L(o){o.parentNode&&o.parentNode.removeChild(o)}function tt(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function T(o){return document.createElement(o)}function Kr(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function z(o){return document.createTextNode(o)}function U(){return z(" ")}function Ce(){return z("")}function re(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function cx(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function b(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function ei(o,e){for(let t in e)b(o,t,e[t])}function fx(o){return Array.from(o.childNodes)}function se(o,e){e=""+e,o.data!==e&&(o.data=e)}function or(o,e){o.value=e==null?"":e}function de(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function qe(o,e,t){o.classList.toggle(e,!!t)}function ql(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var Vn=class{constructor(e=!1){mt(this,"is_svg",!1);mt(this,"e");mt(this,"n");mt(this,"t");mt(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=Kr(t.nodeName):this.e=T(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)C(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(L)}};function ux(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function qn(o,e){return new o(e)}var fs;function vr(o){fs=o}function ti(){if(!fs)throw new Error("Function called outside component initialization");return fs}function sr(o){ti().$$.on_mount.push(o)}function ju(o){ti().$$.on_destroy.push(o)}function Nt(){let o=ti();return(e,t,{cancelable:r=!1}={})=>{let s=o.$$.callbacks[e];if(s){let n=ql(e,t,{cancelable:r});return s.slice().forEach(a=>{a.call(o,n)}),!n.defaultPrevented}return!0}}function Gr(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var Hs=[];var Er=[],zn=[],dx=[],EC=Promise.resolve(),Ju=!1;function px(){Ju||(Ju=!0,EC.then(oi))}function ri(o){zn.push(o)}var Yu=new Set,Wn=0;function oi(){if(Wn!==0)return;let o=fs;do{try{for(;Wn<Hs.length;){let e=Hs[Wn];Wn++,vr(e),RC(e.$$)}}catch(e){throw Hs.length=0,Wn=0,e}for(vr(null),Hs.length=0,Wn=0;Er.length;)Er.pop()();for(let e=0;e<zn.length;e+=1){let t=zn[e];Yu.has(t)||(Yu.add(t),t())}zn.length=0}while(Hs.length);for(;dx.length;)dx.pop()();Ju=!1,Yu.clear(),vr(o)}function RC(o){if(o.fragment!==null){o.update(),Ie(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(ri)}}function mx(o){let e=[],t=[];zn.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),zn=e}var Wl=new Set,Vs;function we(){Vs={r:0,c:[],p:Vs}}function _e(){Vs.r||Ie(Vs.c),Vs=Vs.p}function k(o,e){o&&o.i&&(Wl.delete(o),o.i(e))}function P(o,e,t,r){if(o&&o.o){if(Wl.has(o))return;Wl.add(o),Vs.c.push(()=>{Wl.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function Kn(o,e){let t=e.token={};function r(s,n,a,i){if(e.token!==t)return;e.resolved=i;let l=e.ctx;a!==void 0&&(l=l.slice(),l[a]=i);let f=s&&(e.current=s)(l),u=!1;e.block&&(e.blocks?e.blocks.forEach((d,m)=>{m!==n&&d&&(we(),P(d,1,1,()=>{e.blocks[m]===d&&(e.blocks[m]=null)}),_e())}):e.block.d(1),f.c(),k(f,1),f.m(e.mount(),e.anchor),u=!0),e.block=f,e.blocks&&(e.blocks[n]=f),u&&oi()}if(ex(o)){let s=ti();if(o.then(n=>{vr(s),r(e.then,1,e.value,n),vr(null)},n=>{if(vr(s),r(e.catch,2,e.error,n),vr(null),!e.hasCatch)throw n}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function zl(o,e,t){let r=e.slice(),{resolved:s}=o;o.current===o.then&&(r[o.value]=s),o.current===o.catch&&(r[o.error]=s),o.block.p(r,t)}function De(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function hx(o,e){P(o,1,1,()=>{e.delete(o.key)})}function gx(o,e,t,r,s,n,a,i,l,f,u,d){let m=o.length,g=n.length,h=m,_={};for(;h--;)_[o[h].key]=h;let w=[],v=new Map,M=new Map,R=[];for(h=g;h--;){let A=d(s,n,h),F=t(A),V=a.get(F);V?r&&R.push(()=>V.p(A,e)):(V=f(F,A),V.c()),v.set(F,w[h]=V),F in _&&M.set(F,Math.abs(h-_[F]))}let D=new Set,E=new Set;function O(A){k(A,1),A.m(i,u),a.set(A.key,A),u=A.first,g--}for(;m&&g;){let A=w[g-1],F=o[m-1],V=A.key,q=F.key;A===F?(u=A.first,m--,g--):v.has(q)?!a.has(V)||D.has(V)?O(A):E.has(q)?m--:M.get(V)>M.get(q)?(E.add(V),O(A)):(D.add(q),m--):(l(F,a),m--)}for(;m--;){let A=o[m];v.has(A.key)||l(A,a)}for(;g;)O(w[g-1]);return Ie(R),w}function Ue(o,e){let t={},r={},s={$$scope:1},n=o.length;for(;n--;){let a=o[n],i=e[n];if(i){for(let l in a)l in i||(r[l]=1);for(let l in i)s[l]||(t[l]=i[l],s[l]=1);o[n]=i}else for(let l in a)s[l]=1}for(let a in r)a in t||(t[a]=void 0);return t}function We(o){return typeof o=="object"&&o!==null?o:{}}var OC=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],UC=new Set([...OC]);function H(o){o&&o.c()}function B(o,e,t){let{fragment:r,after_update:s}=o.$$;r&&r.m(e,t),ri(()=>{let n=o.$$.on_mount.map(zu).filter(ut);o.$$.on_destroy?o.$$.on_destroy.push(...n):Ie(n),o.$$.on_mount=[]}),s.forEach(ri)}function N(o,e){let t=o.$$;t.fragment!==null&&(mx(t.after_update),Ie(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function BC(o,e){o.$$.dirty[0]===-1&&(Hs.push(o),px(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function ee(o,e,t,r,s,n,a=null,i=[-1]){let l=fs;vr(o);let f=o.$$={fragment:null,ctx:[],props:n,update:J,not_equal:s,bound:Vl(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Vl(),dirty:i,skip_bound:!1,root:e.target||l.$$.root};a&&a(f.root);let u=!1;if(f.ctx=t?t(o,e.props||{},(d,m,...g)=>{let h=g.length?g[0]:m;return f.ctx&&s(f.ctx[d],f.ctx[d]=h)&&(!f.skip_bound&&f.bound[d]&&f.bound[d](h),u&&BC(o,d)),m}):[],f.update(),u=!0,Ie(f.before_update),f.fragment=r?r(f.ctx):!1,e.target){if(e.hydrate){ax();let d=fx(e.target);f.fragment&&f.fragment.l(d),d.forEach(L)}else f.fragment&&f.fragment.c();e.intro&&k(o.$$.fragment),B(o,e.target,e.anchor),ix(),oi()}vr(l)}var NC;typeof HTMLElement=="function"&&(NC=class extends HTMLElement{constructor(e,t,r){super();mt(this,"$$ctor");mt(this,"$$s");mt(this,"$$c");mt(this,"$$cn",!1);mt(this,"$$d",{});mt(this,"$$r",!1);mt(this,"$$p_d",{});mt(this,"$$l",{});mt(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let s=this.$$c.$on(e,t);this.$$l_u.set(t,s)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let s=this.$$l_u.get(t);s&&(s(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(n){return()=>{let a;return{c:function(){a=T("slot"),n!=="default"&&b(a,"name",n)},m:function(f,u){C(f,a,u)},d:function(f){f&&L(a)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=ux(this);for(let n of this.$$s)n in r&&(t[n]=[e(n)]);for(let n of this.attributes){let a=this.$$g_p(n.name);a in this.$$d||(this.$$d[a]=Qu(a,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let s=()=>{this.$$r=!0;for(let n in this.$$p_d)if(this.$$d[n]=this.$$c.$$.ctx[this.$$c.$$.props[n]],this.$$p_d[n].reflect){let a=Qu(n,this.$$d[n],this.$$p_d,"toAttribute");a==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,a)}this.$$r=!1};this.$$c.$$.after_update.push(s),s();for(let n in this.$$l)for(let a of this.$$l[n]){let i=this.$$c.$on(n,a);this.$$l_u.set(a,i)}this.$$l={}}}attributeChangedCallback(e,t,r){var s;this.$$r||(e=this.$$g_p(e),this.$$d[e]=Qu(e,r,this.$$p_d,"toProp"),(s=this.$$c)==null||s.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Qu(o,e,t,r){var n;let s=(n=t[o])==null?void 0:n.type;if(e=s==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(s){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(s){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var X=class{constructor(){mt(this,"$$");mt(this,"$$set")}$destroy(){N(this,1),this.$destroy=J}$on(e,t){if(!ut(t))return J;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!tx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var yx="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(yx);var HC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Xu=HC;function xx(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function Zu(o){let e,t=[o[12]],r={};for(let s=0;s<t.length;s+=1)r=ce(r,t[s]);return{c(){e=Kr(o[11]),ei(e,r)},m(s,n){C(s,e,n)},p(s,n){ei(e,r=Ue(t,[n&32&&s[12]]))},d(s){s&&L(e)}}}function bx(o){let e=o[11],t,r=o[11]&&Zu(o);return{c(){r&&r.c(),t=Ce()},m(s,n){r&&r.m(s,n),C(s,t,n)},p(s,n){s[11]?e?Q(e,s[11])?(r.d(1),r=Zu(s),e=s[11],r.c(),r.m(t.parentNode,t)):r.p(s,n):(r=Zu(s),e=s[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=s[11])},d(s){s&&L(t),r&&r.d(s)}}}function VC(o){let e,t,r,s,n,a=De(o[5]),i=[];for(let m=0;m<a.length;m+=1)i[m]=bx(xx(o,a,m));let l=o[10].default,f=ge(l,o,o[9],null),u=[Xu,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:s=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],d={};for(let m=0;m<u.length;m+=1)d=ce(d,u[m]);return{c(){e=Kr("svg");for(let m=0;m<i.length;m+=1)i[m].c();t=Ce(),f&&f.c(),ei(e,d)},m(m,g){C(m,e,g);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(e,null);S(e,t),f&&f.m(e,null),n=!0},p(m,[g]){if(g&32){a=De(m[5]);let h;for(h=0;h<a.length;h+=1){let _=xx(m,a,h);i[h]?i[h].p(_,g):(i[h]=bx(_),i[h].c(),i[h].m(e,t))}for(;h<i.length;h+=1)i[h].d(1);i.length=a.length}f&&f.p&&(!n||g&512)&&xe(f,l,m,m[9],n?ye(l,m[9],g,null):be(m[9]),null),ei(e,d=Ue(u,[Xu,g&128&&m[7],(!n||g&4)&&{width:m[2]},(!n||g&4)&&{height:m[2]},(!n||g&2)&&{stroke:m[1]},(!n||g&28&&r!==(r=m[4]?Number(m[3])*24/Number(m[2]):m[3]))&&{"stroke-width":r},(!n||g&257&&s!==(s=m[6]("lucide-icon","lucide",m[0]?`lucide-${m[0]}`:"",m[8].class)))&&{class:s}]))},i(m){n||(k(f,m),n=!0)},o(m){P(f,m),n=!1},d(m){m&&L(e),tt(i,m),f&&f.d(m)}}}function qC(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],s=Gu(e,r),{$$slots:n={},$$scope:a}=e,{name:i=void 0}=e,{color:l="currentColor"}=e,{size:f=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:d=!1}=e,{iconNode:m}=e,g=(...h)=>h.filter((_,w,v)=>Boolean(_)&&v.indexOf(_)===w).join(" ");return o.$$set=h=>{t(8,e=ce(ce({},e),Se(h))),t(7,s=Gu(e,r)),"name"in h&&t(0,i=h.name),"color"in h&&t(1,l=h.color),"size"in h&&t(2,f=h.size),"strokeWidth"in h&&t(3,u=h.strokeWidth),"absoluteStrokeWidth"in h&&t(4,d=h.absoluteStrokeWidth),"iconNode"in h&&t(5,m=h.iconNode),"$$scope"in h&&t(9,a=h.$$scope)},e=Se(e),[i,l,f,u,d,m,g,s,e,a,n]}var ed=class extends X{constructor(e){super(),ee(this,e,qC,VC,Q,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},ze=ed;function WC(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function zC(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],s={$$slots:{default:[WC]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function KC(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var td=class extends X{constructor(e){super(),ee(this,e,KC,zC,Q,{})}},rd=td;function GC(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function jC(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],s={$$slots:{default:[GC]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function YC(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var od=class extends X{constructor(e){super(),ee(this,e,YC,jC,Q,{})}},sd=od;function JC(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function QC(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],s={$$slots:{default:[JC]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function XC(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var nd=class extends X{constructor(e){super(),ee(this,e,XC,QC,Q,{})}},ad=nd;function ZC(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function e2(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],s={$$slots:{default:[ZC]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function t2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var id=class extends X{constructor(e){super(),ee(this,e,t2,e2,Q,{})}},ld=id;function r2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function o2(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],s={$$slots:{default:[r2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function s2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var cd=class extends X{constructor(e){super(),ee(this,e,s2,o2,Q,{})}},fd=cd;function n2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function a2(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],s={$$slots:{default:[n2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function i2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var ud=class extends X{constructor(e){super(),ee(this,e,i2,a2,Q,{})}},si=ud;function l2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function c2(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],s={$$slots:{default:[l2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function f2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var dd=class extends X{constructor(e){super(),ee(this,e,f2,c2,Q,{})}},ni=dd;function u2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function d2(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],s={$$slots:{default:[u2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function p2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var pd=class extends X{constructor(e){super(),ee(this,e,p2,d2,Q,{})}},md=pd;function m2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function h2(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],s={$$slots:{default:[m2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function g2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var hd=class extends X{constructor(e){super(),ee(this,e,g2,h2,Q,{})}},gd=hd;function y2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function x2(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],s={$$slots:{default:[y2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function b2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var yd=class extends X{constructor(e){super(),ee(this,e,b2,x2,Q,{})}},xd=yd;function w2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function _2(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],s={$$slots:{default:[w2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function v2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var bd=class extends X{constructor(e){super(),ee(this,e,v2,_2,Q,{})}},Bo=bd;function S2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function k2(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],s={$$slots:{default:[S2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function I2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var wd=class extends X{constructor(e){super(),ee(this,e,I2,k2,Q,{})}},_d=wd;function L2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function C2(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],s={$$slots:{default:[L2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function T2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var vd=class extends X{constructor(e){super(),ee(this,e,T2,C2,Q,{})}},Sd=vd;function P2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function A2(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],s={$$slots:{default:[P2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function F2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var kd=class extends X{constructor(e){super(),ee(this,e,F2,A2,Q,{})}},Id=kd;function D2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function M2(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],s={$$slots:{default:[D2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function E2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Ld=class extends X{constructor(e){super(),ee(this,e,E2,M2,Q,{})}},Cd=Ld;function R2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function O2(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],s={$$slots:{default:[R2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function U2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Td=class extends X{constructor(e){super(),ee(this,e,U2,O2,Q,{})}},qs=Td;function $2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function B2(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],s={$$slots:{default:[$2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function N2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Pd=class extends X{constructor(e){super(),ee(this,e,N2,B2,Q,{})}},Ad=Pd;function H2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function V2(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],s={$$slots:{default:[H2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function q2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Fd=class extends X{constructor(e){super(),ee(this,e,q2,V2,Q,{})}},ai=Fd;function W2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function z2(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],s={$$slots:{default:[W2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function K2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Dd=class extends X{constructor(e){super(),ee(this,e,K2,z2,Q,{})}},Md=Dd;function G2(o){Fe(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function j2(o){let e,t,r,s,n,a;return t=new Bo({props:{class:"svg-icon inline-icon"}}),{c(){var i;e=T("button"),H(t.$$.fragment),b(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),b(e,"aria-label",s=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),b(e,"tabindex","0"),b(e,"data-filename",n=(i=o[0].view.file)==null?void 0:i.name)},m(i,l){C(i,e,l),B(t,e,null),a=!0},p(i,l){var f;(!a||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(i[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&b(e,"class",r),(!a||l&1&&s!==(s=i[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&b(e,"aria-label",s),(!a||l&1&&n!==(n=(f=i[0].view.file)==null?void 0:f.name))&&b(e,"data-filename",n)},i(i){a||(k(t.$$.fragment,i),a=!0)},o(i){P(t.$$.fragment,i),a=!1},d(i){i&&L(e),N(t)}}}function Y2(o){let e,t,r,s,n,a,i,l,f,u,d,m,g;return t=new Bo({props:{class:"svg-icon inline-icon"}}),l=new qs({props:{class:"svg-icon inline-icon"}}),{c(){var h;e=T("button"),H(t.$$.fragment),a=U(),i=T("button"),H(l.$$.fragment),b(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),b(e,"aria-label",s=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),b(e,"tabindex","0"),b(e,"data-filename",n=(h=o[0].view.file)==null?void 0:h.name),b(i,"class",f="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),b(i,"aria-label",u=`${o[2].relay.name} (${o[1].status})`),b(i,"tabindex","0")},m(h,_){C(h,e,_),B(t,e,null),C(h,a,_),C(h,i,_),B(l,i,null),d=!0,m||(g=[re(i,"click",o[3]),re(i,"keypress",o[4])],m=!0)},p(h,_){var w;(!d||_&1&&r!==(r="clickable-icon view-action system3-view-action "+(h[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&b(e,"class",r),(!d||_&1&&s!==(s=h[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&b(e,"aria-label",s),(!d||_&1&&n!==(n=(w=h[0].view.file)==null?void 0:w.name))&&b(e,"data-filename",n),(!d||_&2&&f!==(f="system3-"+h[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&b(i,"class",f),(!d||_&6&&u!==(u=`${h[2].relay.name} (${h[1].status})`))&&b(i,"aria-label",u)},i(h){d||(k(t.$$.fragment,h),k(l.$$.fragment,h),d=!0)},o(h){P(t.$$.fragment,h),P(l.$$.fragment,h),d=!1},d(h){h&&(L(e),L(a),L(i)),N(t),N(l),m=!1,Ie(g)}}}function J2(o){let e,t,r,s,n=[Y2,j2],a=[];function i(l,f){return l[2]?0:1}return e=i(o,-1),t=a[e]=n[e](o),{c(){t.c(),r=Ce()},m(l,f){a[e].m(l,f),C(l,r,f),s=!0},p(l,[f]){let u=e;e=i(l,f),e===u?a[e].p(l,f):(we(),P(a[u],1,1,()=>{a[u]=null}),_e(),t=a[e],t?t.p(l,f):(t=a[e]=n[e](l),t.c()),k(t,1),t.m(r.parentNode,r))},i(l){s||(k(t),s=!0)},o(l){P(t),s=!1},d(l){l&&L(r),a[e].d(l)}}}function Q2(o,e,t){let{view:r}=e,{state:s}=e,{remote:n}=e,a={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},i=()=>{r.toggleConnection()},l=f=>{f.key==="Enter"&&i()};return o.$$set=f=>{"view"in f&&t(0,r=f.view),"state"in f&&t(1,s=f.state),"remote"in f&&t(2,n=f.remote)},[r,s,n,i,l]}var Ed=class extends X{constructor(e){super(),ee(this,e,Q2,J2,Q,{view:0,state:1,remote:2},G2)}},wx=Ed;var Gn=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let s=e.querySelector(".system3-banner");if(!s){s=document.createElement("div"),s.classList.add("system3-banner");let n=s.createSpan();n.setText(this.text),s.appendChild(n),r.appendChild(s);let a=async()=>{await this.onClick()&&this.destroy()};s.addEventListener("click",a)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var Kl=require("@codemirror/state"),_x=require("@codemirror/view");function ii(o,e){let t=Object.keys(e).map(r=>X2(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function X2(o,e,t){let r=o[e],s=o.hasOwnProperty(e),n=s?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},a=t(n);return r&&Object.setPrototypeOf(a,r),Object.setPrototypeOf(i,a),o[e]=i,l;function i(...f){return a===n&&o[e]===i&&l(),a.apply(this,f)}function l(){o[e]===i&&(s?o[e]=n:delete o[e]),a!==n&&(a=n,Object.setPrototypeOf(i,r||Function))}}var vx=vs(Rd());var Z2=25,n6=Kl.Facet.define({combine(o){return o[o.length-1]}}),Od=Kl.Annotation.define(),Ud=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};var r,s,n,a;if(this.editor=e,this.connectionManager=this.editor.state.field(us),this.view=(r=this.connectionManager)==null?void 0:r.findView(e),!this.view||(this.log=Ae(`[LiveCMPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"log"),this.warn=Ae(`[LiveCMPluginValue][${(n=this.view.view.file)==null?void 0:n.path}]`,"warn"),this.debug=Ae(`[LiveCMPluginValue][${(a=this.view.view.file)==null?void 0:a.path}]`,"debug"),this.debug("created"),!this.view.document))return;let t=this;this.uninstallMonkeyPatch=ii(this.view.view,{setViewData(i){return function(l,f){return f&&(No(t.view)&&t.view.document.text===l&&(t.view.tracking=!0),t.resync()),i.call(this,l,f)}}}),this.view.document.connected?this.resync():this.view.document.onceConnected().then(()=>{this.resync()}),this._observer=async(i,l)=>{if(!No(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(l.origin!==this){let f=i.delta,u=[],d=0;for(let m=0;m<f.length;m++){let g=f[m];g.insert!=null?u.push({from:d,to:d,insert:g.insert}):g.delete!=null?(u.push({from:d,to:d+g.delete,insert:""}),d+=g.delete):g.retain!=null&&(d+=g.retain)}!this.view.tracking||et().enableEditorTweens&&this.keyFrameCounter>Z2?(this.keyFrameCounter=0,u=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),No(this.view)&&(e.dispatch({changes:u,annotations:[Od.of(this.editor)]}),this.view.tracking=!0)}},this.observer=(i,l)=>{var f;try{(f=this._observer)==null||f.call(this,i,l)}catch(u){u instanceof RangeError&&No(this.view)&&(this.view.tracking=!1)}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new vx.default,s=r.diff_main(t,e);r.diff_cleanupSemantic(s);let n=[],a=0;for(let[i,l]of s)switch(i){case 0:a+=l.length;break;case 1:n.push({from:a,to:a,insert:l}),a+=l.length;break;case-1:n.push({from:a,to:a+l.length,insert:""});break}return n}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(No(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();No(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[Od.of(this.editor)]})}}async getKeyFrame(e=!1){return!No(this.view)||this.destroyed?[]:this.view.document.text===this.view.view.getViewData()?(this.view.tracking=!0,[]):(this.warn(`|${this.view.document.text}|
|${this.view.view.getViewData()}|`),this.warn("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(this.view.tracking||this.view.checkStale(),No(this.view)&&!this.destroyed?[this.getBufferChange(this.view.document.text,e)]:[]))}update(e){var s,n,a,i;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Od)===this.editor)return;let t=e.view;this.view=(s=this.connectionManager)==null?void 0:s.findView(t);let r=(a=(n=this.view)==null?void 0:n.document)==null?void 0:a.ytext;r&&((i=r.doc)==null||i.transact(()=>{let l=0;e.changes.iterChanges((f,u,d,m,g)=>{let h=g.sliceString(0,g.length,`
`);f!==u&&r.delete(f+l,u-f),h.length>0&&r.insert(f+l,h),l+=h.length-(u-f)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.uninstallMonkeyPatch&&(this.uninstallMonkeyPatch(),this.uninstallMonkeyPatch=void 0),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Sx=_x.ViewPlugin.fromClass(Ud);var Gl=require("@codemirror/state"),dr=require("@codemirror/view");var kx=dr.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),eT=Gl.Annotation.define(),$d=class extends dr.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return Pa("span",[Qt("class","cm-ySelectionCaret"),Qt("style",`background-color: ${this.color}; border-color: ${this.color}`)],[bn("\u2060"),Pa("div",[Qt("class","cm-ySelectionCaretDot")]),bn("\u2060"),Pa("div",[Qt("class","cm-ySelectionInfo")],[bn(this.name)]),bn("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},Bd=class{constructor(e){var r,s;this.editor=e,this.decorations=Gl.RangeSet.of([]),this.connectionManager=this.editor.state.field(us);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof ds){this.view=t;let n=(s=this.view.document)==null?void 0:s._provider;this._listener=({added:a,updated:i,removed:l},f,u)=>{a.concat(i).concat(l).findIndex(m=>{var g;return m!==((g=this._awareness)==null?void 0:g.doc.clientID)})>=0&&e.dispatch({annotations:[eT.of([])]})},n&&(this._awareness=n.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var f,u,d,m;let t=e.view;this.view=(f=this.connectionManager)==null?void 0:f.findView(t);let r=(d=(u=this.view)==null?void 0:u.document)==null?void 0:d.ytext;if(!(this.view&&r&&r.doc))return;let s=(m=this.view.document)==null?void 0:m._provider;if(!s)return;this._awareness=s.awareness;let n=this._awareness,a=r.doc,i=[],l=this._awareness.getLocalState();if(l!=null){let g=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),h=g?e.state.selection.main:null,_=l.cursor==null?null:eu(l.cursor.anchor),w=l.cursor==null?null:eu(l.cursor.head);if(h!=null){let v=tu(r,h.anchor),M=tu(r,h.head);(l.cursor==null||!ou(_,v)||!ou(w,M))&&n.setLocalStateField("cursor",{anchor:v,head:M})}else l.cursor!=null&&g&&n.setLocalStateField("cursor",null)}n.getStates().forEach((g,h)=>{if(h===n.doc.clientID)return;let _=g.cursor;if(_==null||_.anchor==null||_.head==null)return;let w=ru(_.anchor,a),v=ru(_.head,a);if(w==null||v==null||w.type!==r||v.type!==r)return;if(w.index>e.state.doc.length||v.index>e.state.doc.length){Ae("[RemoteSelections]","warn")(`cursor positions (${w.index}, ${v.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=dr.Decoration.none;return}let{color:M="#30bced",name:R="Anonymous"}=g.user||{},D=g.user&&g.user.colorLight||M+"33",E=an(w.index,v.index),O=Br(w.index,v.index),A=e.view.state.doc.lineAt(E),F=e.view.state.doc.lineAt(O);if(A.number===F.number)i.push({from:E,to:O,value:dr.Decoration.mark({attributes:{style:`background-color: ${D}`},class:"cm-ySelection"})});else{i.push({from:E,to:A.from+A.length,value:dr.Decoration.mark({attributes:{style:`background-color: ${D}`},class:"cm-ySelection"})}),i.push({from:F.from,to:O,value:dr.Decoration.mark({attributes:{style:`background-color: ${D}`},class:"cm-ySelection"})});for(let V=A.number+1;V<F.number;V++){let q=e.view.state.doc.line(V).from;i.push({from:q,to:q,value:dr.Decoration.line({attributes:{style:`background-color: ${D}`,class:"cm-yLineSelection"}})})}}i.push({from:v.index,to:v.index,value:dr.Decoration.widget({side:v.index-w.index>0?-1:1,block:!1,widget:new $d(M,R)})})}),this.decorations=dr.Decoration.set(i,!0)}},Ix=dr.ViewPlugin.fromClass(Bd,{decorations:o=>o.decorations});var jl=require("@codemirror/state"),Ho=require("@codemirror/view"),Lx=require("@codemirror/view");var x6=jl.Annotation.define(),Hd=class extends Lx.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},Nd=jl.StateEffect.define(),Vd=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(us),this.decorations=Ho.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,s)=>{this.updateFromMetadata(s),this.editor.dispatch({effects:Nd.of(null)})},!this.connectionManager){Ae("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=Ae(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var r,s;if(this.connectionManager&&this.app&&((s=(r=this.view)==null?void 0:r.document)!=null&&s.tfile)){this.connectionManager.onMeta(this.view.document.tfile,this.cb);let n=this.app.metadataCache.getFileCache(this.view.document.tfile);n&&(this.updateFromMetadata(n),this.editor.dispatch({effects:Nd.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(Ho.EditorView.decorations).forEach(s=>{(typeof s=="function"?s(e):s).between(0,e.state.doc.length,(a,i,l)=>{var d;(((d=l.spec)==null?void 0:d.class)||"").contains("cm-formatting-link-end")&&t.push({from:a,to:i})})}),t}updateFromMetadata(e){var r,s,n,a;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((s=(r=this.view)==null?void 0:r.document)!=null&&s.sharedFolder)||!((a=(n=this.view)==null?void 0:n.document)!=null&&a.tfile))return;let t=new Map;for(let i of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}for(let i of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(s){this.metadata.delete(t)}}updateFromEditor(e){var n,a,i,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((a=(n=this.view)==null?void 0:n.document)!=null&&a.sharedFolder)||!((l=(i=this.view)==null?void 0:i.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),s=this.findInternalLinks(this.editor);for(let f of s){let u=null;for(let[g,h]of r)if(f.from<=h.to&&f.to>=h.from){u=h,r.delete(g);break}if(!u)continue;let d=this.app.metadataCache.getFirstLinkpathDest(u.link,this.view.document.path);d&&!this.view.document.sharedFolder.checkPath(d.path)&&t.push(f.from)}t.filter(f=>f<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>Ho.Decoration.widget({widget:new Hd,side:1}).range(t));e.length>0?this.decorations=Ho.Decoration.set(e,!0):this.decorations=Ho.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(s=>s.is(Nd))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},Cx=Ho.ViewPlugin.fromClass(Vd,{decorations:o=>o.decorations});function Vo(){}Vo.prototype={diff:function(e,t){var r,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=s.callback;typeof s=="function"&&(n=s,s={}),this.options=s;var a=this;function i(D){return n?(setTimeout(function(){n(void 0,D)},0),!0):D}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,f=e.length,u=1,d=l+f;s.maxEditLength&&(d=Math.min(d,s.maxEditLength));var m=(r=s.timeout)!==null&&r!==void 0?r:1/0,g=Date.now()+m,h=[{oldPos:-1,lastComponent:void 0}],_=this.extractCommon(h[0],t,e,0);if(h[0].oldPos+1>=f&&_+1>=l)return i([{value:this.join(t),count:t.length}]);var w=-1/0,v=1/0;function M(){for(var D=Math.max(w,-u);D<=Math.min(v,u);D+=2){var E=void 0,O=h[D-1],A=h[D+1];O&&(h[D-1]=void 0);var F=!1;if(A){var V=A.oldPos-D;F=A&&0<=V&&V<l}var q=O&&O.oldPos+1<f;if(!F&&!q){h[D]=void 0;continue}if(!q||F&&O.oldPos+1<A.oldPos?E=a.addToPath(A,!0,void 0,0):E=a.addToPath(O,void 0,!0,1),_=a.extractCommon(E,t,e,D),E.oldPos+1>=f&&_+1>=l)return i(tT(a,E.lastComponent,t,e,a.useLongestToken));h[D]=E,E.oldPos+1>=f&&(v=Math.min(v,D-1)),_+1>=l&&(w=Math.max(w,D+1))}u++}if(n)(function D(){setTimeout(function(){if(u>d||Date.now()>g)return n();M()||D()},0)})();else for(;u<=d&&Date.now()<=g;){var R=M();if(R)return R}},addToPath:function(e,t,r,s){var n=e.lastComponent;return n&&n.added===t&&n.removed===r?{oldPos:e.oldPos+s,lastComponent:{count:n.count+1,added:t,removed:r,previousComponent:n.previousComponent}}:{oldPos:e.oldPos+s,lastComponent:{count:1,added:t,removed:r,previousComponent:n}}},extractCommon:function(e,t,r,s){for(var n=t.length,a=r.length,i=e.oldPos,l=i-s,f=0;l+1<n&&i+1<a&&this.equals(t[l+1],r[i+1]);)l++,i++,f++;return f&&(e.lastComponent={count:f,previousComponent:e.lastComponent}),e.oldPos=i,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function tT(o,e,t,r,s){for(var n=[],a;e;)n.push(e),a=e.previousComponent,delete e.previousComponent,e=a;n.reverse();for(var i=0,l=n.length,f=0,u=0;i<l;i++){var d=n[i];if(d.removed){if(d.value=o.join(r.slice(u,u+d.count)),u+=d.count,i&&n[i-1].added){var g=n[i-1];n[i-1]=n[i],n[i]=g}}else{if(!d.added&&s){var m=t.slice(f,f+d.count);m=m.map(function(_,w){var v=r[u+w];return v.length>_.length?v:_}),d.value=o.join(m)}else d.value=o.join(t.slice(f,f+d.count));f+=d.count,d.added||(u+=d.count)}}var h=n[l-1];return l>1&&typeof h.value=="string"&&(h.added||h.removed)&&o.equals("",h.value)&&(n[l-2].value+=h.value,n.pop()),n}var w6=new Vo;function rT(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Tx=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Px=/\S/,Gd=new Vo;Gd.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!Px.test(o)&&!Px.test(e)};Gd.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Tx.test(e[t])&&Tx.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Ax(o,e,t){return t=rT(t,{ignoreWhitespace:!0}),Gd.diff(o,e,t)}var jd=new Vo;jd.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var s=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=s:(this.options.ignoreWhitespace&&(s=s.trim()),e.push(s))}return e};function oT(o,e,t){return jd.diff(o,e,t)}var sT=new Vo;sT.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var nT=new Vo;nT.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function Yl(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Yl=function(e){return typeof e}:Yl=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yl(o)}function qd(o){return aT(o)||iT(o)||lT(o)||cT()}function aT(o){if(Array.isArray(o))return Wd(o)}function iT(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function lT(o,e){if(o){if(typeof o=="string")return Wd(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Wd(o,e)}}function Wd(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function cT(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var fT=Object.prototype.toString,li=new Vo;li.useLongestToken=!0;li.tokenize=jd.tokenize;li.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,s=r===void 0?function(n,a){return typeof a=="undefined"?t:a}:r;return typeof o=="string"?o:JSON.stringify(zd(o,null,null,s),s,"  ")};li.equals=function(o,e){return Vo.prototype.equals.call(li,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function zd(o,e,t,r,s){e=e||[],t=t||[],r&&(o=r(s,o));var n;for(n=0;n<e.length;n+=1)if(e[n]===o)return t[n];var a;if(fT.call(o)==="[object Array]"){for(e.push(o),a=new Array(o.length),t.push(a),n=0;n<o.length;n+=1)a[n]=zd(o[n],e,t,r,s);return e.pop(),t.pop(),a}if(o&&o.toJSON&&(o=o.toJSON()),Yl(o)==="object"&&o!==null){e.push(o),a={},t.push(a);var i=[],l;for(l in o)o.hasOwnProperty(l)&&i.push(l);for(i.sort(),n=0;n<i.length;n+=1)l=i[n],a[l]=zd(o[l],e,t,r,l);e.pop(),t.pop()}else a=o;return a}var Kd=new Vo;Kd.tokenize=function(o){return o.slice()};Kd.join=Kd.removeEmpty=function(o){return o};function Fx(o,e,t,r,s,n,a){a||(a={}),typeof a.context=="undefined"&&(a.context=4);var i=oT(t,r,a);if(!i)return;i.push({value:"",lines:[]});function l(v){return v.map(function(M){return" "+M})}for(var f=[],u=0,d=0,m=[],g=1,h=1,_=function(M){var R=i[M],D=R.lines||R.value.replace(/\n$/,"").split(`
`);if(R.lines=D,R.added||R.removed){var E;if(!u){var O=i[M-1];u=g,d=h,O&&(m=a.context>0?l(O.lines.slice(-a.context)):[],u-=m.length,d-=m.length)}(E=m).push.apply(E,qd(D.map(function(W){return(R.added?"+":"-")+W}))),R.added?h+=D.length:g+=D.length}else{if(u)if(D.length<=a.context*2&&M<i.length-2){var A;(A=m).push.apply(A,qd(l(D)))}else{var F,V=Math.min(D.length,a.context);(F=m).push.apply(F,qd(l(D.slice(0,V))));var q={oldStart:u,oldLines:g-u+V,newStart:d,newLines:h-d+V,lines:m};if(M>=i.length-2&&D.length<=a.context){var Z=/\n$/.test(t),j=/\n$/.test(r),K=D.length==0&&m.length>q.oldLines;!Z&&K&&t.length>0&&m.splice(q.oldLines,0,"\\ No newline at end of file"),(!Z&&!K||!j)&&m.push("\\ No newline at end of file")}f.push(q),u=0,d=0,m=[]}g+=D.length,h+=D.length}},w=0;w<i.length;w++)_(w);return{oldFileName:o,newFileName:e,oldHeader:s,newHeader:n,hunks:f}}var Ex=require("obsidian");var Jl=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var Ql=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let s=0,n=0;for(let a=0;a<r.lines.length;a+=1){let i=r.lines[a];if(i.startsWith("+")||i.startsWith("-")){let l=a,f=l;for(;f<r.lines.length-1&&(r.lines[f+1].startsWith("+")||r.lines[f+1].startsWith("-"));)f+=1;let u=r.lines.slice(l,f+1).filter(m=>m.startsWith("-")).map(m=>m.slice(1)),d=r.lines.slice(l,f+1).filter(m=>m.startsWith("+")).map(m=>m.slice(1));t.push(new Jl({file1Start:r.oldStart+l-n-1,file2Start:r.newStart+l-s-1,file1Lines:u,file2Lines:d})),s+=u.length,n+=d.length,a+=f-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function Yd(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function ci(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function fi(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function Yn(o){return o!==""?o:"\u200E"}var pr=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var lo=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var Qd=require("obsidian");var Dx=vs(Rd());var mr=class extends it{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,s]of this._map)if(t(s,r))return s}some(t){for(let[r,s]of this._map)if(t(s,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let s=new Jd(this,t);return this._derivedMaps.set(t,s),s}},Jd=class extends mr{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,s)=>{this.predicate(r,s)&&t.set(s,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function ui(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let s=Math.min(t.length,r.length);for(let n=0;n<s;n++)if(t[n]!==r[n]){if(n===t.length-1){let a=t[n].match(/\d+/g),i=r[n].match(/\d+/g);if(a&&i){let l=parseInt(a[0]),f=parseInt(i[0]);if(l!==f)return l-f}}return t[n].localeCompare(r[n])}return t.length-r.length}function Mx(o,e){let t=o.getText("contents"),r=t.toString(),s=new Dx.diff_match_patch,n=s.diff_main(r,e);s.diff_cleanupSemantic(n);let a=0,i=Ae("[updateYDocFromDiskBuffer]","debug");i("Updating YDoc:"),i("Current content length:",r.length),i("Disk buffer length:",e.length),n.length!=0&&(o.transact(()=>{for(let[l,f]of n)switch(l){case 1:i(`Inserting "${f}" at position ${a}`),t.insert(a,f),a+=f.length;break;case 0:i(`Keeping "${f}" (length: ${f.length})`),a+=f.length;break;case-1:i(`Deleting "${f}" at position ${a}`),t.delete(a,f.length);break}}),i("Update complete. New content length:",t.toString().length))}var Xl=class extends Mt{constructor(t,r,s,n=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=s;this.concurrency=n;this.activeSync=new is;this.activeDownloads=new is;this.syncGroups=new mr;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;Et.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,s=0,n=0,a=0,i=0;this.syncGroups.forEach(d=>{t+=d.total,r+=d.completed,s+=d.syncs,n+=d.completedSyncs,a+=d.downloads,i+=d.completedDownloads});let l=t>0?r/t*100:0,f=s>0?n/s*100:0,u=a>0?i/a*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(f),downloadPercent:Math.round(u),totalItems:t,completedItems:r,syncItems:s,completedSyncs:n,downloadItems:a,completedDownloads:i}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let s=r.total>0?r.completed/r.total*100:0,n=r.syncs>0?r.completedSyncs/r.syncs*100:0,a=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(s),syncPercent:Math.round(n),downloadPercent:Math.round(a),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,s)=>{let n=this.getGroupProgress(s);n&&t.push(n)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(s=>s.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let s=r.doc;await this.syncDocument(s),r.status="completed";let n=this.syncCompletionCallbacks.get(r.guid);n&&(n.resolve(),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.debug(`[Sync Progress] Before: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completedSyncs++,a.completed++,this.debug(`[Sync Progress] After: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completed===a.total&&(a.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,a))}catch(s){r.status="failed";let n=this.syncCompletionCallbacks.get(r.guid);n&&(n.reject(s instanceof Error?s:new Error(String(s))),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.error("[Sync Failed]",s),a.status="failed",this.syncGroups.set(r.sharedFolder,a))}finally{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1,this.syncQueue.length>0&&!this.isPaused&&this.syncQueue.some(s=>s.sharedFolder.connected)&&this.processSyncQueue()}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(s=>s.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{await this.getDocument(r.doc),r.status="completed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let n=this.syncGroups.get(r.sharedFolder);n&&(n.completedDownloads++,n.completed++,n.completed===n.total&&(n.status="completed"),this.syncGroups.set(r.sharedFolder,n))}catch(s){r.status="failed";let n=this.downloadCompletionCallbacks.get(r.guid);n&&(n.reject(s instanceof Error?s:new Error(String(s))),this.downloadCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(a.status="failed",this.syncGroups.set(r.sharedFolder,a)),this.error("[processDownloadQueue]",s)}finally{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1,this.downloadQueue.length>0&&!this.isPaused&&this.downloadQueue.some(s=>s.sharedFolder.connected)&&this.processDownloadQueue()}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?new Promise((l,f)=>{i.resolve=l,i.reject=f}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},n=this.syncGroups.get(r);n?(n.total++,n.syncs++):n={sharedFolder:r,total:1,completed:0,status:"pending",downloads:0,syncs:1,completedDownloads:0,completedSyncs:0},this.syncGroups.set(r,n),this.inProgressSyncs.add(t.guid);let a=new Promise((i,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.syncQueue.push(s),this.syncQueue.sort(ui),this.processSyncQueue(),a}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let i=this.downloadCompletionCallbacks.get(t.guid);return i?(this.processDownloadQueue(),new Promise((l,f)=>{i.resolve=l,i.reject=f})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,s=this.syncGroups.get(r);s||(s={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),s.downloads++,s.total++,this.syncGroups.set(r,s);let n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let a=new Promise((i,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.downloadQueue.push(n),this.downloadQueue.sort(ui),this.processDownloadQueue(),a}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(Bs),s={sharedFolder:t,total:r.length,completed:0,status:"pending",downloads:0,syncs:r.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,s);let n=[...r].sort(ui);for(let a of n)this.enqueueDocumentForGroupSync(a);s.status="running",this.syncGroups.set(t,s)}async enqueueDocumentForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueDocumentForGroupSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?(this.processSyncQueue(),new Promise((i,l)=>{a.resolve=i,a.reject=l})):Promise.resolve()}let r=t.sharedFolder,s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let n=new Promise((a,i)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:i})});return this.syncQueue.push(s),this.syncQueue.sort(ui),this.processSyncQueue(),n}getAuthHeader(t){var r;return{Authorization:et().enableDocumentServer?`Bearer ${t.token}`:`Bearer ${(r=this.loginManager.user)==null?void 0:r.token}`}}getBaseUrl(t,r){var i;let s=new URL(t.url);s.protocol="https:";let n=s.pathname.split("/");n.pop(),n.push(t.docId),s.pathname=n.join("/");let a=((i=t.baseUrl)==null?void 0:i.replace(/\/$/,""))||s.toString();return et().enableDocumentServer?a:`https://api.system3.md/relay/${r.relayId}/doc/${r.documentId}`}async downloadItem(t){let r=t.s3rn;if(this.log("[downloadItem]",t.path,`${Tt.encode(r)}`),!(r instanceof zr))throw new Error("Unable to decode S3RN");let s=await t.getProviderToken(),n=this.getAuthHeader(s),a=this.getBaseUrl(s,r),i=`${a}/as-update`,l=await(0,Qd.requestUrl)({url:i,method:"GET",headers:n});return l.status===200?this.debug("[downloadItem]",r.documentId,l.status):this.error("[downloadItem]",r.documentId,a,l.status,l.text),l}async syncDocumentWebsocket(t){let r=t.text,s="";try{s=await t.sharedFolder.read(t)}catch(l){}if(!(r===s)&&s)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=t.onceProviderSynced(),i=t.intent;return t.connect(),i==="disconnected"&&!t.userLock&&await a,i==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(Tt.encode(t.s3rn))),!0}async uploadItem(t){let r=t.s3rn;if(this.log("[uploadItem]",`${Tt.encode(r)}`),!(r instanceof zr))throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let s=await t.getProviderToken(),n={"Content-Type":"application/octet-stream",...this.getAuthHeader(s)},a=Es(t.ydoc),l=`${this.getBaseUrl(s,r)}/update`,f=await(0,Qd.requestUrl)({url:l,method:"POST",headers:n,body:a.buffer,throw:!1});return f.status===200?this.debug("[uploadItem]",r.documentId,f.status,f.text):this.error("[uploadItem]",r.documentId,l,f.status,f.text),f}async getDocument(t,r=3,s=3e3){try{let n=t.text,a="";try{a=await t.sharedFolder.read(t)}catch(_){}let i=n===a,l=a!=="",u=(await this.downloadItem(t)).arrayBuffer,d=new Uint8Array(u),m=new yr;Fo(m,d);let g=m.getMap("users");if(m.getText("contents").toString()===""){if(g.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",g.size,r,s),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,s*2)},s);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),Fo(t.ydoc,d),l&&!i){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(n){throw this.error(n),n}}async syncItem(t){let r=t.text,s="";try{s=await t.sharedFolder.read(t)}catch(m){}if(!(r===s))return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=await this.downloadItem(t);if(a.status!==200)return this.log("server returned an error."),!1;let i=a.arrayBuffer,l=new Uint8Array(i),f=new yr;Fo(f,l);let u=f.getText("contents").toString();return f.getMap("users").size>0&&u===r||(Fo(t.ydoc,l),t.sharedFolder.flush(t,t.text),this.uploadItem(t)),!0}async syncDocument(t){var r;try{et().enableHTTPSync&&((r=t.sharedFolder.remote)!=null&&r.relay.provider)?await this.syncItem(t):(this.debug("fallback to websocket sync"),await this.syncDocumentWebsocket(t))}catch(s){console.error(s);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},s=this.activeSync.subscribe(()=>r()),n=this.activeDownloads.subscribe(()=>r()),a=this.syncGroups.subscribe(()=>r());return()=>{s(),n(),a()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var Zl=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof kt){Mx(e.ydoc,t);return}else if(e instanceof ns){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,s=this.difference.file2Lines.length>0;s&&r?(new pr({text:"Accept Top (Editor)",onClick:n=>this.acceptTopClick(n,this.difference)}).build(t),lo.build(t),new pr({text:"Accept Bottom (Local Disk)",onClick:n=>this.acceptBottomClick(n,this.difference)}).build(t),lo.build(t),new pr({text:"Accept All",onClick:n=>this.acceptAllClick(n,this.difference)}).build(t),lo.build(t),new pr({text:"Accept None",onClick:n=>this.acceptNoneClick(n,this.difference)}).build(t)):r?(new pr({text:"Keep in Editor",onClick:n=>this.insertFile1Difference(n,this.difference)}).build(t),lo.build(t),new pr({text:"Discard in Editor",onClick:n=>this.discardFile1Difference(n,this.difference)}).build(t)):s&&(new pr({text:"Accept from Local Disk",onClick:n=>this.insertFile2Difference(n,this.difference)}).build(t),lo.build(t),new pr({text:"Discard on Disk",onClick:n=>this.discardFile2Difference(n,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=ci({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=ci({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),s=ci({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s);let n=ci({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=fi({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let s=fi({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=Yd({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=Yd({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,s),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=fi({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=fi({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var Jn="system3-differences-view";async function Rx(o,e){o.detachLeavesOfType(Jn);let t=o.getLeaf(!0);t.setViewState({type:Jn,active:!0,state:e}),o.revealLeaf(t)}var ec=class extends Ex.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[]}async getContent(t){return t instanceof kt?t.text:t instanceof ns?t.contents:await this.app.vault.cachedRead(t)}getViewType(){return Jn}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,s;if(((r=this.state)==null?void 0:r.file1)==null||((s=this.state)==null?void 0:s.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(n=>n.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(n=>n.trimEnd());let t=Fx(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));this.fileDifferences=Ql.fromParsedDiff(t),this.fileDifferences.differences.length===0&&this.leaf.detach()}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new pr({text:"Keep Editor Contents",onClick:async s=>{s.preventDefault(),await this.acceptAllFromLeft()}}).build(r),lo.build(r),new pr({text:"Accept All from Local Disk",onClick:async s=>{s.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async acceptAllFromLeft(){!this.state||!this.fileDifferences||(await this.app.vault.modify(this.state.file2,this.file1Content||""),this.leaf.detach())}async acceptAllFromRight(){!this.state||!this.fileDifferences||(await this.app.vault.modify(this.state.file1,this.file2Content||""),this.leaf.detach())}buildLines(t){var a,i,l;let r=0,s=0,n=Math.max(((a=this.file1Lines)==null?void 0:a.length)||0,((i=this.file2Lines)==null?void 0:i.length)||0);for(;r<=n||s<=n;){let f=(l=this.fileDifferences)==null?void 0:l.differences.find(u=>u.file1Start===r&&u.file2Start===s);if(f!=null){let u=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(u,f),r+=f.file1Lines.length,s+=f.file2Lines.length}else{let u=r<=s?this.file1Lines[r]:this.file2Lines[s];t.createDiv({text:Yn(u),cls:"file-diff__line"}),r+=1,s+=1}}}buildDifferenceVisualizer(t,r){var s;(s=this.state)!=null&&s.showMergeOption&&new Zl(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let n=0;n<r.file1Lines.length;n+=1){let a=r.file1Lines[n],i=r.file2Lines[n],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),f=this.buildDiffLine(a,i,"file-diff_top-line__character");(n<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),n!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(f)}for(let n=0;n<r.file2Lines.length;n+=1){let a=r.file1Lines[n],i=r.file2Lines[n],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),f=this.buildDiffLine(i,a,"file-diff_bottom-line__character");(n==0&&r.file1Lines.length>0||n>0)&&l.classList.add("file-diff__no-top-border"),n<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(f)}}buildDiffLine(t,r,s){let n=document.createElement("div");if(t!=null&&t.length===0)n.textContent=Yn(t);else if(t!=null&&r!=null){let a=Ax(r,t);for(let i of a){if(i.removed)continue;let l=document.createElement("span");l.textContent=Yn(i.value),i.added&&l.classList.add(s),n.appendChild(l)}}else if(t!=null&&r==null){let a=document.createElement("span");a.textContent=Yn(t),a.classList.add(s),n.appendChild(a)}else n.textContent=Yn(t);return n}scrollToFirstDifference(){var s;if(((s=this.fileDifferences)==null?void 0:s.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var pT=3;function Xd(o,e){o.iterateAllLeaves(t=>{t.view instanceof Qn.MarkdownView&&e(t.view)})}function mT(o,e){var t,r,s,n;if(o.length!==e.length)return!1;for(let a=0;a<o.length;a++)if(((t=o[a].view.file)==null?void 0:t.path)!==((r=e[a].view.file)==null?void 0:r.path)||((s=o[a].document)==null?void 0:s.path)!==((n=e[a].document)==null?void 0:n.path))return!1;return!0}var Zd=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new Gn(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function No(o){return o instanceof ds&&o.document!==void 0&&o.document.text!==void 0}var ds=class{constructor(e,t,r,s=!0,n=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=s,this.canConnect=n,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new Gn(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new Gn(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new wx({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.document.userLock=!0,this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect(),this.document.userLock=!1}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},tc=class{constructor(e,t,r,s){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=s,this.refreshQueue=[],this._compartment=new rc.Compartment,this.log=Ae("[LiveViews]","log"),this.warn=Ae("[LiveViews]","warn"),this.metadataListeners=new Map;let n=(l,f,u)=>{let d=this.metadataListeners.get(l);d==null||d(f,u)},a=this.app.metadataCache.on("changed",n);this.offListeners.push(()=>{this.app.metadataCache.offref(a)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let i=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(f=>{this.views.forEach(u=>{var d;((d=u.document)==null?void 0:d.sharedFolder)===l&&u.offlineBanner()})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,f)=>{this.sharedFolders.has(f)||(l(),this.folderListeners.delete(f))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,i(l))})})),Et.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([us.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){Rx(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return Xd(this.workspace,t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);s&&e.add(s)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(Xd(this.workspace,r=>{var a;let s=(a=r.file)==null?void 0:a.path;if(!s)return;let n=this.sharedFolders.lookup(s);n&&e.add(n)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return Xd(this.workspace,async t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);if(s)if(this.loginManager.loggedIn)if(s.ready){let a=s.proxy.getDoc(r),i=new ds(this,t,a);e.push(i)}else this.log(`Folder not ready, skipping views. folder=${s.path}`);else{let a=new Zd(this,t,()=>this.loginManager.openLoginPage());e.push(a)}}),e}findView(e){return this.views.find(t=>t.view.editor.cm===e)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof ds).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=pT){let r=this.workspace.getActiveViewOfType(Qn.MarkdownView),s=0,n=e.sort((i,l)=>l.view.leaf.activeTime-i.view.leaf.activeTime),a=new Set;for(let i of n)i instanceof ds&&(i.view===r||a.has(i.document)?(i.canConnect=!0,a.add(i.document)):s<t?(i.canConnect=!0,a.add(i.document),s++):i.canConnect=!1);return s>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${s-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(s=>{let n=e.find(a=>{if(s.document==a.document&&s.view==a.view)return!0});n?(r.push(s),e.remove(n)):t.push(s)}),e.forEach(s=>{r.push(s)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,s=Ae(r,"debug"),n=(d,m)=>{s(d,m.map(g=>{var h;return{type:g.constructor.name,file:(h=g.document)==null?void 0:h.path,canConnect:g.canConnect}}))};if(s("Refresh"),this.destroyed)return!1;await this.foldersReady();let a=[];try{a=await this.getViews()}catch(d){return this.warn("[System 3][Relay][Live Views] error getting views",d),!1}let i=this.findFolders();if(i.length===0&&a.length===0)return this.extensions.length!==0&&(s("Unexpected plugins loaded."),this.wipe()),n("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?i.forEach(d=>{d.connect()}):this.sharedFolders.forEach(d=>{d.disconnect()});let[l,f]=this.deduplicate(a);if(n("Releasing Views",f),this.releaseViews(f),f.length===0&&mT(l,this.views)){let d=await this.viewsAttachedWithConnectionPool(this.views);n("Attached Views",d)}else{let d=await this.viewsReady(l);n("Ready Views",d);let m=await this.viewsAttachedWithConnectionPool(d);n("Attached Views",m),this.views=l}s("loading plugins"),this.load();let u=Qn.moment.utc();return s(`refresh completed in ${u.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=Ae(e,"warn"),r=Qn.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let s=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=s().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(us.init(()=>this)),Sx,kx,Ix,Cx]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},us=rc.StateField.define({create(o){},update(o,e){return o}});var Xn=require("obsidian");function hT(o){Fe(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function Ox(o){let e,t,r,s;return{c(){e=T("span"),t=z(o[3]),r=z("%"),b(e,"class",s="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),de(e,"opacity","1")},m(n,a){C(n,e,a),S(e,t),S(e,r)},p(n,a){a&8&&se(t,n[3]),a&16&&s!==(s="system3-progress-text system3-"+n[4]+" svelte-1siabfk")&&b(e,"class",s)},d(n){n&&L(e)}}}function gT(o){let e,t,r;return t=new Bo({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=T("span"),H(t.$$.fragment),b(e,"class","notebook system3-icon svelte-1siabfk"),b(e,"aria-label","Tracking Changes")},m(s,n){C(s,e,n),B(t,e,null),r=!0},p:J,i(s){r||(k(t.$$.fragment,s),r=!0)},o(s){P(t.$$.fragment,s),r=!1},d(s){s&&L(e),N(t)}}}function yT(o){let e,t,r,s,n,a,i,l;return t=new Bo({props:{class:"inline-icon",style:"width: 0.8em"}}),n=new qs({props:{class:"inline-icon"}}),{c(){var f;e=T("span"),H(t.$$.fragment),r=U(),s=T("span"),H(n.$$.fragment),b(e,"class","notebook system3-icon hidden svelte-1siabfk"),b(e,"aria-label","Tracking Changes"),b(s,"class",a="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),b(s,"aria-label",i=`${((f=o[2])==null?void 0:f.relay.name)||"Relay Server"} (${o[0]})`)},m(f,u){C(f,e,u),B(t,e,null),C(f,r,u),C(f,s,u),B(n,s,null),l=!0},p(f,u){var d;(!l||u&1&&a!==(a="satellite system3-icon system3-"+f[0]+" svelte-1siabfk"))&&b(s,"class",a),(!l||u&5&&i!==(i=`${((d=f[2])==null?void 0:d.relay.name)||"Relay Server"} (${f[0]})`))&&b(s,"aria-label",i)},i(f){l||(k(t.$$.fragment,f),k(n.$$.fragment,f),l=!0)},o(f){P(t.$$.fragment,f),P(n.$$.fragment,f),l=!1},d(f){f&&(L(e),L(r),L(s)),N(t),N(n)}}}function xT(o){let e,t,r,s,n,a=o[5]&&Ox(o),i=[yT,gT],l=[];function f(u,d){return u[1]?0:1}return r=f(o,-1),s=l[r]=i[r](o),{c(){e=T("div"),a&&a.c(),t=U(),s.c(),b(e,"class","system3-folder-icons svelte-1siabfk")},m(u,d){C(u,e,d),a&&a.m(e,null),S(e,t),l[r].m(e,null),n=!0},p(u,[d]){u[5]?a?a.p(u,d):(a=Ox(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null);let m=r;r=f(u,d),r===m?l[r].p(u,d):(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),s=l[r],s?s.p(u,d):(s=l[r]=i[r](u),s.c()),k(s,1),s.m(e,null))},i(u){n||(k(s),n=!0)},o(u){P(s),n=!1},d(u){u&&L(e),a&&a.d(),l[r].d()}}}function bT(o,e,t){let r,{status:s="disconnected"}=e,{relayId:n}=e,{remote:a}=e,{progress:i=0}=e,{syncStatus:l="pending"}=e;return o.$$set=f=>{"status"in f&&t(0,s=f.status),"relayId"in f&&t(1,n=f.relayId),"remote"in f&&t(2,a=f.remote),"progress"in f&&t(3,i=f.progress),"syncStatus"in f&&t(4,l=f.syncStatus)},o.$$.update=()=>{if(o.$$.dirty&24){e:t(5,r=(l!=="completed"||i<100)&&i>0)}},[s,n,a,i,l,r]}var ep=class extends X{constructor(e){super(),ee(this,e,bT,xT,Q,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},hT)}},Ux=ep;function wT(o){Fe(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function _T(o){let e,t,r;return{c(){e=T("div"),t=T("span"),r=z(o[0]),b(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),b(e,"aria-label",o[1])},m(s,n){C(s,e,n),S(e,t),S(t,r)},p(s,[n]){n&1&&se(r,s[0]),n&2&&b(e,"aria-label",s[1])},i:J,o:J,d(s){s&&L(e)}}}function vT(o,e,t){let{text:r}=e,{label:s}=e;return o.$$set=n=>{"text"in n&&t(0,r=n.text),"label"in n&&t(1,s=n.label)},[r,s]}var tp=class extends X{constructor(e){super(),ee(this,e,vT,_T,Q,{text:0,label:1},wT)}},rp=tp;function ST(o){Fe(o,"svelte-1ljf67u",".system3-uploadpill.svelte-1ljf67u{text-wrap:nowrap}")}function kT(o){let e,t,r,s;return{c(){e=T("div"),t=T("span"),r=z(o[0]),b(e,"class","nav-file-tag system3-uploadpill svelte-1ljf67u"),b(e,"aria-label",o[1]),b(e,"style",s=o[2]?`color:${o[2]}`:"")},m(n,a){C(n,e,a),S(e,t),S(t,r)},p(n,[a]){a&1&&se(r,n[0]),a&2&&b(e,"aria-label",n[1]),a&4&&s!==(s=n[2]?`color:${n[2]}`:"")&&b(e,"style",s)},i:J,o:J,d(n){n&&L(e)}}}function IT(o,e,t){let{text:r}=e,{label:s}=e,{color:n}=e;return o.$$set=a=>{"text"in a&&t(0,r=a.text),"label"in a&&t(1,s=a.label),"color"in a&&t(2,n=a.color)},[r,s,n]}var op=class extends X{constructor(e){super(),ee(this,e,IT,kT,Q,{text:0,label:1,color:2},ST)}},$x=op;var sp=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,s)=>{for(let n of r)n.type==="childList"&&e.nextSibling&&(t(e),s.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},qo=class{visitFolder(e,t,r,s){return null}visitFile(e,t,r,s){return null}},np=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new sp(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},ap=class extends qo{visitFolder(e,t,r,s){return s&&s.path===e.path?r||new np(t.selfEl,s):(r&&r.destroy(),null)}},ip=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(n=>{n.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new Ux({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let s=[];s.push(this.sharedFolder.subscribe(this.el,n=>{this.pill.$set({status:n.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),s.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,n=>{n&&this.pill.$set({progress:n.percent,syncStatus:n.status})})),this.unsubscribe=()=>s.forEach(n=>n())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},lp=class extends qo{visitFolder(e,t,r,s){return s&&s.path===e.path?r||new ip(t.selfEl,s):(r&&r.destroy(),null)}},cp=class{constructor(e,t,r,s){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=s;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},fp=class extends qo{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,s,n){return n&&n.ready&&n.checkPath(t.path)&&kt.checkExtension(t.path)?s||new cp(r.el,t.path,this.activeSync,this.activeDownloads):(s&&s.destroy(),null)}},up=class{constructor(e,t){this.el=e;this.file=t;this.unsubscribes=[];this.el.querySelectorAll(".system3-uploadpill").forEach(s=>{s.remove()});let r=s=>{var n;if(s.inMeta)(n=this.pill)==null||n.$destroy();else{let a=s.uploadError||"pending",i=s.uploadError?"var(--red)":void 0;this.pill?this.pill.$set({text:a,color:i}):this.pill=new $x({target:this.el,props:{text:a,color:i}})}};this.unsubscribes.push(this.file.subscribe(s=>{r(s)}))}destroy(){var e;this.unsubscribes.forEach(t=>t()),(e=this.pill)==null||e.$destroy(),this.el.querySelectorAll(".system3-uploadpill").forEach(t=>{t.remove()})}},dp=class extends qo{visitFile(e,t,r,s){if(s&&s.ready)try{let n=s.proxy.viewSyncFile(e.path);if(n&&$o(n)&&s.isSyncableTFile(e)&&s.connected)return r&&r.file===n?r:new up(t.selfEl,n)}catch(n){}return r&&r.destroy(),null}},pp=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new rp({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},mp=class extends qo{visitFile(e,t,r,s){return s&&s.checkPath(e.path)&&!s.isSyncableTFile(e)?r||new pp(t.selfEl):(r&&r.destroy(),null)}},hp=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,s=>{this.docStatus(s)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},gp=class extends qo{visitFile(e,t,r,s){if(s)try{let n=s.getVirtualPath(e.path),a=s.syncStore.get(n);if(!a)return null;let i=s.files.get(a);return!(i instanceof kt)||!i?null:r||new hp(t.el,i,e)}catch(n){return null}return r&&r.destroy(),null}},yp=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new rp({target:this.el,props:{text:"DESYNC",label:"File content does not match document content"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},xp=class extends qo{visitFile(e,t,r,s){if(s&&kt.checkExtension(e.path)){let n=s.proxy.viewDoc(e.path);if(!n||!n.ready)return null;if(e.stat.size!==n.stat.size)return r||new yp(t.selfEl)}return r&&r.destroy(),null}},oc=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let s of this.visitors)this.storage.set(s,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(n=>n.path===e.path)||t,s=this.getFileExplorerItem(this.fileExplorer,e);s&&this.storage.forEach((n,a)=>{let i=n.get(s),l=a.visitFolder(e,s,i,r);i&&!l?n.delete(s):l&&n.set(s,l)}),e.children.forEach(n=>{if(n instanceof Xn.TFolder)this.walk(n,r);else if(n instanceof Xn.TFile){let a=this.getFileExplorerItem(this.fileExplorer,n);if(!a)return;this.storage.forEach((i,l)=>{let f=i.get(a),u=l.visitFile(n,a,f,r);f&&!u?i.delete(a):u&&i.set(a,u)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},sc=class{constructor(e,t,r,s){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=s,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.unsubscribes=[],this.unsubscribes.push(s.activeSync.subscribe(()=>this.quickRefresh()),s.activeDownloads.subscribe(()=>this.quickRefresh()),s.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(n=>{My([ao.enableDocumentStatus],()=>{this.offDocumentListeners.get(n)||this.offDocumentListeners.set(n,n.fset.on(()=>{this.refresh()}))}),n.whenReady().then(()=>{this.refresh()}),this.unsubscribes.push(n.syncSettingsManager.subscribe(a=>{this.quickRefresh()})),this.unsubscribes.push(n.subscribe(this,()=>{this.quickRefresh()}))}),this.refresh()}),this.offLayoutChange=(()=>{let n=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(n)}})()}makeVisitors(){let e=[];return e.push(new ap),e.push(new lp),Ro(ao.enableDocumentStatus,()=>{e.push(new gp),e.push(new fp(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),e.push(new dp),Ro(ao.enableDesyncPill,()=>{e.push(new xp)}),e.push(new mp),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let s=this.treeState.get(r)||new oc(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,s);for(let n of t){let a=this.vault.getAbstractFileByPath(n);a instanceof Xn.TFolder&&s.walk(a)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new oc(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let s=this.vault.getAbstractFileByPath("/");s instanceof Xn.TFolder&&r.walk(s)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.unsubscribes.forEach(t=>t()),this.unsubscribes.length=0,this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var Gb=require("obsidian");function Ge(o,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function i(u){try{f(r.next(u))}catch(d){a(d)}}function l(u){try{f(r.throw(u))}catch(d){a(d)}}function f(u){u.done?n(u.value):s(u.value).then(i,l)}f((r=r.apply(o,e||[])).next())})}var ps=require("obsidian");function LT(o){let e,t,r;return{c(){e=Kr("svg"),t=Kr("g"),r=Kr("path"),b(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),b(r,"fill","#5865F2"),b(r,"fill-rule","nonzero"),b(e,"width",o[0]),b(e,"height",o[0]),b(e,"viewBox","0 -28.5 256 256"),b(e,"version","1.1"),b(e,"xmlns","http://www.w3.org/2000/svg"),b(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),b(e,"preserveAspectRatio","xMidYMid")},m(s,n){C(s,e,n),S(e,t),S(t,r)},p(s,[n]){n&1&&b(e,"width",s[0]),n&1&&b(e,"height",s[0])},i:J,o:J,d(s){s&&L(e)}}}function CT(o,e,t){let{size:r="1em"}=e;return o.$$set=s=>{"size"in s&&t(0,r=s.size)},[r]}var bp=class extends X{constructor(e){super(),ee(this,e,CT,LT,Q,{size:0})}},nc=bp;function TT(o){Fe(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function Bx(o){let e,t,r,s,n,a,i,l,f,u,d,m,g;return i=new nc({props:{size:20}}),{c(){e=T("div"),t=T("div"),r=U(),s=T("div"),n=T("span"),a=T("a"),H(i.$$.fragment),l=U(),f=T("span"),f.textContent="Join the community",b(t,"class","arrow svelte-4t8k3t"),b(a,"href","https://discord.system3.md"),b(a,"target","_blank"),b(a,"rel","noopener noreferrer"),b(a,"class","menu-item svelte-4t8k3t"),de(n,"text-align","center"),de(n,"display","flex"),b(s,"class","menu-content svelte-4t8k3t"),b(e,"class","menu-dropdown svelte-4t8k3t")},m(h,_){C(h,e,_),S(e,t),S(e,r),S(e,s),S(s,n),S(n,a),B(i,a,null),S(a,l),S(a,f),d=!0,m||(g=sx(u=o[1].call(null,e)),m=!0)},i(h){d||(k(i.$$.fragment,h),d=!0)},o(h){P(i.$$.fragment,h),d=!1},d(h){h&&L(e),N(i),m=!1,g()}}}function PT(o){let e,t,r,s,n,a,i;r=new _d({props:{size:"20px"}});let l=o[0]&&Bx(o);return{c(){e=T("div"),t=T("button"),H(r.$$.fragment),s=U(),l&&l.c(),b(t,"class","menu-button svelte-4t8k3t"),b(e,"class","menu-container svelte-4t8k3t")},m(f,u){C(f,e,u),S(e,t),B(r,t,null),S(e,s),l&&l.m(e,null),n=!0,a||(i=re(t,"click",cx(o[2])),a=!0)},p(f,[u]){f[0]?l?u&1&&k(l,1):(l=Bx(f),l.c(),k(l,1),l.m(e,null)):l&&(we(),P(l,1,1,()=>{l=null}),_e())},i(f){n||(k(r.$$.fragment,f),k(l),n=!0)},o(f){P(r.$$.fragment,f),P(l),n=!1},d(f){f&&L(e),N(r),l&&l.d(),a=!1,i()}}}function AT(o,e,t){let r=!1;function s(a){let i=l=>{let f=document.querySelector(".menu-button");!a.contains(l.target)&&l.target!==f&&!(f!=null&&f.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",i)},0),{destroy(){document.removeEventListener("click",i)}}}function n(a){a.stopPropagation(),t(0,r=!r)}return[r,s,n]}var wp=class extends X{constructor(e){super(),ee(this,e,AT,PT,Q,{},TT)}},Nx=wp;function FT(o){Fe(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function DT(o){let e,t;return{c(){e=Kr("svg"),t=Kr("path"),b(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),b(e,"class","relay-text svelte-ycfe1d"),b(e,"width",o[0]),b(e,"height",o[1]),b(e,"viewBox","0 0 154.24573 66.293579"),b(e,"xmlns","http://www.w3.org/2000/svg")},m(r,s){C(r,e,s),S(e,t)},p:J,i:J,o:J,d(r){r&&L(e)}}}function MT(o,e,t){let{size:r=64}=e,s=r,n=r/2;return o.$$set=a=>{"size"in a&&t(2,r=a.size)},[s,n,r]}var _p=class extends X{constructor(e){super(),ee(this,e,MT,DT,Q,{size:2},FT)}},ac=_p;function ET(o){Fe(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function RT(o){let e,t,r,s,n,a;return e=new ac({props:{size:140}}),{c(){H(e.$$.fragment),t=U(),r=T("p"),r.textContent="Real-time collaboration in Obsidian",s=U(),n=T("p"),n.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,b(r,"class","subtitle svelte-120r7kg"),b(n,"class","description svelte-120r7kg")},m(i,l){B(e,i,l),C(i,t,l),C(i,r,l),C(i,s,l),C(i,n,l),a=!0},p:J,i(i){a||(k(e.$$.fragment,i),a=!0)},o(i){P(e.$$.fragment,i),a=!1},d(i){i&&(L(t),L(r),L(s),L(n)),N(e,i)}}}var vp=class extends X{constructor(e){super(),ee(this,e,null,RT,Q,{},ET)}},Hx=vp;var ic=require("obsidian");function OT(o){Fe(o,"svelte-1kvxms3",`.help-section.svelte-1kvxms3{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1kvxms3{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1kvxms3{position:relative;max-width:640px;margin:0 auto}.why-google.svelte-1kvxms3:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-google.svelte-1kvxms3{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-google.svelte-1kvxms3:hover{color:var(--text-normal)}.help-content.svelte-1kvxms3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1kvxms3{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1kvxms3{opacity:1;visibility:visible}.popover.svelte-1kvxms3:not(.visible){transition-delay:0s}.arrow.svelte-1kvxms3{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1kvxms3{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function UT(o){let e,t,r,s;return{c(){e=T("div"),t=T("div"),r=U(),s=T("p"),s.textContent=`${qx}`,b(t,"class","arrow svelte-1kvxms3"),b(e,"class","popover svelte-1kvxms3"),qe(e,"visible",o[0])},m(n,a){C(n,e,a),S(e,t),S(e,r),S(e,s),o[9](e)},p(n,a){a&1&&qe(e,"visible",n[0])},d(n){n&&L(e),o[9](null)}}}function $T(o){let e,t=o[0]&&Vx(o);return{c(){t&&t.c(),e=Ce()},m(r,s){t&&t.m(r,s),C(r,e,s)},p(r,s){r[0]?t?t.p(r,s):(t=Vx(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&L(e),t&&t.d(r)}}}function Vx(o){let e,t;return{c(){e=T("div"),t=T("p"),t.textContent=`${qx}`,b(e,"class","help-content svelte-1kvxms3")},m(r,s){C(r,e,s),S(e,t)},p:J,d(r){r&&L(e)}}}function BT(o){let e,t,r,s,n,a,i,l,f,u,d,m;function g(w,v){return w[1]?$T:UT}let h=g(o,-1),_=h(o);return l=new nc({}),{c(){e=T("div"),t=T("div"),r=T("button"),r.textContent="Why sign in with Google?",s=U(),_.c(),n=U(),a=T("div"),i=T("a"),H(l.$$.fragment),f=z(`
		Join the project on Discord`),b(r,"class","why-google svelte-1kvxms3"),qe(r,"mobile",o[1]),b(t,"class","help-container svelte-1kvxms3"),b(e,"class","help-section svelte-1kvxms3"),b(i,"href","https://discord.system3.md"),b(i,"class","discord-link svelte-1kvxms3"),b(a,"class","footer svelte-1kvxms3")},m(w,v){C(w,e,v),S(e,t),S(t,r),o[8](r),S(t,s),_.m(t,null),C(w,n,v),C(w,a,v),S(a,i),B(l,i,null),S(i,f),u=!0,d||(m=[re(r,"mouseenter",o[4]),re(r,"mouseleave",o[5]),re(r,"click",o[6])],d=!0)},p(w,[v]){(!u||v&2)&&qe(r,"mobile",w[1]),h===(h=g(w,v))&&_?_.p(w,v):(_.d(1),_=h(w),_&&(_.c(),_.m(t,null)))},i(w){u||(k(l.$$.fragment,w),u=!0)},o(w){P(l.$$.fragment,w),u=!1},d(w){w&&(L(e),L(n),L(a)),o[8](null),_.d(),N(l),d=!1,Ie(m)}}}var qx="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. An identity provider like Google helps to prevent spam accounts. We may add more sign-in options based on user feedback \u2014 let us know in Discord.";function NT(o,e,t){var r;let s=!1,n=!1,a,i;function l(){n||t(0,s=!0)}function f(){n||t(0,s=!1)}function u(){n&&t(0,s=!s)}function d(g){Er[g?"unshift":"push"](()=>{a=g,t(2,a)})}function m(g){Er[g?"unshift":"push"](()=>{i=g,t(3,i)})}return o.$$.update=()=>{if(o.$$.dirty&128){e:t(1,n=t(7,r=ic.Platform===null||ic.Platform===void 0?void 0:ic.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[s,n,a,i,l,f,u,r,d,m]}var Sp=class extends X{constructor(e){super(),ee(this,e,NT,BT,Q,{},OT)}},Wx=Sp;var zx=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],lc=class{constructor(e,t,r,s,n){this.id=e;this.name=t;this.email=r;this.picture=s;this.token=n;this.color=zx[Ia()%zx.length]}};function HT(o){Fe(o,"svelte-1ym1y1w",".avatar.svelte-1ym1y1w{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.initial.svelte-1ym1y1w{color:var(--text-on-accent)}img.svelte-1ym1y1w{width:100%;height:100%;object-fit:cover}")}function VT(o){let e,t;return{c(){e=T("span"),t=z(o[5]),b(e,"class","initial svelte-1ym1y1w"),de(e,"font-size",o[4])},m(r,s){C(r,e,s),S(e,t)},p(r,s){s&32&&se(t,r[5]),s&16&&de(e,"font-size",r[4])},d(r){r&&L(e)}}}function qT(o){let e,t,r,s;return{c(){e=T("img"),Ku(e.src,t=o[0].picture)||b(e,"src",t),b(e,"alt",o[1]),b(e,"class","svelte-1ym1y1w")},m(n,a){C(n,e,a),r||(s=re(e,"error",o[6]),r=!0)},p(n,a){a&1&&!Ku(e.src,t=n[0].picture)&&b(e,"src",t),a&2&&b(e,"alt",n[1])},d(n){n&&L(e),r=!1,s()}}}function WT(o){let e;function t(n,a){return!n[3]&&n[0].picture?qT:VT}let r=t(o,-1),s=r(o);return{c(){e=T("div"),s.c(),b(e,"class","avatar svelte-1ym1y1w"),de(e,"width",o[2]),de(e,"height",o[2])},m(n,a){C(n,e,a),s.m(e,null)},p(n,[a]){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e,null))),a&4&&de(e,"width",n[2]),a&4&&de(e,"height",n[2])},i:J,o:J,d(n){n&&L(e),s.d()}}}function zT(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function KT(o,e,t){let r,s,n,{user:a}=e,{alt:i="Profile picture"}=e,{size:l="40px"}=e,f=!1;function u(){t(3,f=!0)}return o.$$set=d=>{"user"in d&&t(0,a=d.user),"alt"in d&&t(1,i=d.alt),"size"in d&&t(2,l=d.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=a.name?a.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,s=zT(l))}if(o.$$.dirty&132){e:t(4,n=`${parseFloat(l)/2}${s}`)}},[a,i,l,f,n,r,u,s]}var kp=class extends X{constructor(e){super(),ee(this,e,KT,WT,Q,{user:0,alt:1,size:2},HT)}},Kx=kp;function GT(o){let e,t,r,s,n,a=(o[0].name||"")+"",i,l,f,u,d=(o[0].email||"")+"",m,g,h,_;t=new Kx({props:{size:"2.5em",user:o[0]}});let w=o[2].default,v=ge(w,o,o[1],null);return{c(){e=T("div"),H(t.$$.fragment),r=U(),s=T("div"),n=T("div"),i=z(a),l=U(),f=T("br"),u=U(),m=z(d),g=U(),h=T("div"),v&&v.c(),b(n,"class","setting-item-description"),b(s,"class","setting-item-info"),de(s,"display","grid"),b(h,"class","setting-item-control"),b(e,"class","setting-item")},m(M,R){C(M,e,R),B(t,e,null),S(e,r),S(e,s),S(s,n),S(n,i),S(n,l),S(n,f),S(n,u),S(n,m),S(e,g),S(e,h),v&&v.m(h,null),_=!0},p(M,[R]){let D={};R&1&&(D.user=M[0]),t.$set(D),(!_||R&1)&&a!==(a=(M[0].name||"")+"")&&se(i,a),(!_||R&1)&&d!==(d=(M[0].email||"")+"")&&se(m,d),v&&v.p&&(!_||R&2)&&xe(v,w,M,M[1],_?ye(w,M[1],R,null):be(M[1]),null)},i(M){_||(k(t.$$.fragment,M),k(v,M),_=!0)},o(M){P(t.$$.fragment,M),P(v,M),_=!1},d(M){M&&L(e),N(t),v&&v.d(M)}}}function jT(o,e,t){let{$$slots:r={},$$scope:s}=e,{user:n}=e;return o.$$set=a=>{"user"in a&&t(0,n=a.user),"$$scope"in a&&t(1,s=a.$$scope)},[n,s,r]}var Ip=class extends X{constructor(e){super(),ee(this,e,jT,GT,Q,{user:0})}},Gx=Ip;var cc=require("obsidian");function YT(o){Fe(o,"svelte-5zjjwa",".help-container.svelte-5zjjwa{position:relative;display:inline-block}button.svelte-5zjjwa{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-5zjjwa:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-5zjjwa:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.popover.svelte-5zjjwa{position:absolute;z-index:50;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.popover.left.svelte-5zjjwa{right:100%;margin-right:8px}.popover.right.svelte-5zjjwa{left:0}.arrow.svelte-5zjjwa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-5zjjwa{right:8px}.arrow.right.svelte-5zjjwa{left:8px}p.svelte-5zjjwa{margin:0;color:var(--text-normal)}")}function jx(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),r=U(),s=T("p"),n=z(o[0]),b(t,"class","arrow svelte-5zjjwa"),qe(t,"left",o[4]==="left"),qe(t,"right",o[4]==="right"),b(s,"class","svelte-5zjjwa"),b(e,"class","popover svelte-5zjjwa"),qe(e,"left",o[4]==="left"),qe(e,"right",o[4]==="right")},m(a,i){C(a,e,i),S(e,t),S(e,r),S(e,s),S(s,n),o[9](e)},p(a,i){i&16&&qe(t,"left",a[4]==="left"),i&16&&qe(t,"right",a[4]==="right"),i&1&&se(n,a[0]),i&16&&qe(e,"left",a[4]==="left"),i&16&&qe(e,"right",a[4]==="right")},d(a){a&&L(e),o[9](null)}}}function JT(o){let e,t,r,s,n,a,i;r=new si({props:{size:16}});let l=o[1]&&jx(o);return{c(){e=T("div"),t=T("button"),H(r.$$.fragment),s=U(),l&&l.c(),b(t,"type","button"),b(t,"class","svelte-5zjjwa"),b(e,"class","help-container svelte-5zjjwa")},m(f,u){C(f,e,u),S(e,t),B(r,t,null),o[8](t),S(e,s),l&&l.m(e,null),n=!0,a||(i=[re(t,"mouseenter",o[5]),re(t,"mouseleave",o[6]),re(t,"click",o[7])],a=!0)},p(f,[u]){f[1]?l?l.p(f,u):(l=jx(f),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(f){n||(k(r.$$.fragment,f),n=!0)},o(f){P(r.$$.fragment,f),n=!1},d(f){f&&L(e),N(r),o[8](null),l&&l.d(),a=!1,Ie(i)}}}function QT(o,e,t){let{helpText:r}=e,s=!1,n="right",a,i;function l(){t(1,s=!0)}function f(){t(1,s=!1)}function u(){t(1,s=!s)}function d(g){Er[g?"unshift":"push"](()=>{a=g,t(2,a)})}function m(g){Er[g?"unshift":"push"](()=>{i=g,t(3,i)})}return o.$$set=g=>{"helpText"in g&&t(0,r=g.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(s&&a&&i){let g=a.getBoundingClientRect(),h=i.getBoundingClientRect(),_=window.innerWidth;t(4,n=g.right+h.width>_-20?"left":"right")}}},[r,s,a,i,n,l,f,u,d,m]}var Lp=class extends X{constructor(e){super(),ee(this,e,QT,JT,Q,{helpText:0},YT)}},Yx=Lp;function XT(o){Fe(o,"svelte-1v3t6m3",".setting-item-name.svelte-1v3t6m3{display:flex;align-items:center;gap:8px}.help-button.svelte-1v3t6m3{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-1v3t6m3:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-1v3t6m3:active{color:var(--text-normal)}.help-content.svelte-1v3t6m3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-1v3t6m3{margin:0}")}var ZT=o=>({}),Jx=o=>({}),eP=o=>({}),Qx=o=>({}),tP=o=>({}),Xx=o=>({});function rP(o){let e;return{c(){e=z(o[0])},m(t,r){C(t,e,r)},p(t,r){r&1&&se(e,t[0])},d(t){t&&L(e)}}}function Zx(o){let e,t,r,s,n=[sP,oP],a=[];function i(l,f){return l[3]?0:1}return e=i(o,-1),t=a[e]=n[e](o),{c(){t.c(),r=Ce()},m(l,f){a[e].m(l,f),C(l,r,f),s=!0},p(l,f){let u=e;e=i(l,f),e===u?a[e].p(l,f):(we(),P(a[u],1,1,()=>{a[u]=null}),_e(),t=a[e],t?t.p(l,f):(t=a[e]=n[e](l),t.c()),k(t,1),t.m(r.parentNode,r))},i(l){s||(k(t),s=!0)},o(l){P(t),s=!1},d(l){l&&L(r),a[e].d(l)}}}function oP(o){let e,t;return e=new Yx({props:{helpText:o[1]}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&2&&(n.helpText=r[1]),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function sP(o){let e,t,r,s,n;return t=new si({props:{size:16}}),{c(){e=T("button"),H(t.$$.fragment),b(e,"class","help-button svelte-1v3t6m3"),b(e,"aria-expanded",o[2])},m(a,i){C(a,e,i),B(t,e,null),r=!0,s||(n=re(e,"click",o[4]),s=!0)},p(a,i){(!r||i&4)&&b(e,"aria-expanded",a[2])},i(a){r||(k(t.$$.fragment,a),r=!0)},o(a){P(t.$$.fragment,a),r=!1},d(a){a&&L(e),N(t),s=!1,n()}}}function nP(o){let e,t,r=o[7].description,s=ge(r,o,o[6],Jx);return{c(){e=T("div"),s&&s.c(),b(e,"class","setting-item-description")},m(n,a){C(n,e,a),s&&s.m(e,null),t=!0},p(n,a){s&&s.p&&(!t||a&64)&&xe(s,r,n,n[6],t?ye(r,n[6],a,ZT):be(n[6]),Jx)},i(n){t||(k(s,n),t=!0)},o(n){P(s,n),t=!1},d(n){n&&L(e),s&&s.d(n)}}}function eb(o){let e,t,r;return{c(){e=T("div"),t=T("p"),r=z(o[1]),b(t,"class","svelte-1v3t6m3"),b(e,"class","help-content svelte-1v3t6m3"),qe(e,"expanded",o[2])},m(s,n){C(s,e,n),S(e,t),S(t,r)},p(s,n){n&2&&se(r,s[1]),n&4&&qe(e,"expanded",s[2])},d(s){s&&L(e)}}}function aP(o){let e,t,r,s,n,a,i,l,f,u=o[7].name,d=ge(u,o,o[6],Xx),m=d||rP(o),g=o[1]&&Zx(o),h=o[7].description,_=ge(h,o,o[6],Qx),w=_||nP(o),v=o[1]&&o[2]&&o[3]&&eb(o),M=o[7].default,R=ge(M,o,o[6],null);return{c(){e=T("div"),t=T("div"),r=T("div"),m&&m.c(),s=U(),g&&g.c(),n=U(),w&&w.c(),a=U(),v&&v.c(),i=U(),l=T("div"),R&&R.c(),b(r,"class","setting-item-name svelte-1v3t6m3"),b(t,"class","setting-item-info"),b(l,"class","setting-item-control"),b(e,"class","setting-item setting-item-heading")},m(D,E){C(D,e,E),S(e,t),S(t,r),m&&m.m(r,null),S(r,s),g&&g.m(r,null),S(t,n),w&&w.m(t,null),S(t,a),v&&v.m(t,null),S(e,i),S(e,l),R&&R.m(l,null),f=!0},p(D,[E]){d?d.p&&(!f||E&64)&&xe(d,u,D,D[6],f?ye(u,D[6],E,tP):be(D[6]),Xx):m&&m.p&&(!f||E&1)&&m.p(D,f?E:-1),D[1]?g?(g.p(D,E),E&2&&k(g,1)):(g=Zx(D),g.c(),k(g,1),g.m(r,null)):g&&(we(),P(g,1,1,()=>{g=null}),_e()),_?_.p&&(!f||E&64)&&xe(_,h,D,D[6],f?ye(h,D[6],E,eP):be(D[6]),Qx):w&&w.p&&(!f||E&64)&&w.p(D,f?E:-1),D[1]&&D[2]&&D[3]?v?v.p(D,E):(v=eb(D),v.c(),v.m(t,null)):v&&(v.d(1),v=null),R&&R.p&&(!f||E&64)&&xe(R,M,D,D[6],f?ye(M,D[6],E,null):be(D[6]),null)},i(D){f||(k(m,D),k(g),k(w,D),k(R,D),f=!0)},o(D){P(m,D),P(g),P(w,D),P(R,D),f=!1},d(D){D&&L(e),m&&m.d(D),g&&g.d(),w&&w.d(D),v&&v.d(),R&&R.d(D)}}}function iP(o,e,t){let{$$slots:r={},$$scope:s}=e;var n;let{name:a=""}=e,{helpText:i=void 0}=e,l=!1,f=!1;function u(){f&&t(2,l=!l)}return o.$$set=d=>{"name"in d&&t(0,a=d.name),"helpText"in d&&t(1,i=d.helpText),"$$scope"in d&&t(6,s=d.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,f=t(5,n=cc.Platform===null||cc.Platform===void 0?void 0:cc.Platform.isMobile)!==null&&n!==void 0?n:!1)}},[a,i,l,f,u,n,s,r]}var Cp=class extends X{constructor(e){super(),ee(this,e,iP,aP,Q,{name:0,helpText:1},XT)}},Ye=Cp;var Zn=[];function lP(o,e){return{subscribe:ve(o,e).subscribe}}function ve(o,e=J){let t,r=new Set;function s(i){if(Q(o,i)&&(o=i,t)){let l=!Zn.length;for(let f of r)f[1](),Zn.push(f,o);if(l){for(let f=0;f<Zn.length;f+=2)Zn[f][0](Zn[f+1]);Zn.length=0}}}function n(i){s(i(o))}function a(i,l=J){let f=[i,l];return r.add(f),r.size===1&&(t=e(s,n)||J),i(o),()=>{r.delete(f),r.size===0&&t&&(t(),t=null)}}return{set:s,update:n,subscribe:a}}function co(o,e,t){let r=!Array.isArray(o),s=r?[o]:o;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let n=e.length<2;return lP(t,(a,i)=>{let l=!1,f=[],u=0,d=J,m=()=>{if(u)return;d();let h=e(r?f[0]:f,a,i);n?a(h):d=ut(h)?h:J},g=s.map((h,_)=>rr(h,w=>{f[_]=w,u&=~(1<<_),l&&m()},()=>{u|=1<<_}));return l=!0,m(),function(){Ie(g),d(),l=!1}})}function cP(o){Fe(o,"svelte-xcpzqp",`.continue.svelte-xcpzqp{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-xcpzqp{color:var(--text-muted)}.link.svelte-xcpzqp:hover{color:var(--text-normal)}.not-working.svelte-xcpzqp{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-xcpzqp{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-xcpzqp:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-xcpzqp{height:auto;padding:0;color:var(--text-faint)}.welcome.svelte-xcpzqp{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-xcpzqp{height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-xcpzqp:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-xcpzqp:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}`)}function fP(o){let e,t,r,s,n,a,i;t=new Hx({});function l(h,_){return h[3]?pP:dP}let f=l(o,[-1,-1]),u=f(o);function d(h,_){if(h[5])return hP;if(h[4])return mP}let m=d(o,[-1,-1]),g=m&&m(o);return a=new Wx({}),{c(){e=T("div"),H(t.$$.fragment),r=U(),u.c(),s=U(),g&&g.c(),n=U(),H(a.$$.fragment),b(e,"class","welcome svelte-xcpzqp")},m(h,_){C(h,e,_),B(t,e,null),S(e,r),u.m(e,null),S(e,s),g&&g.m(e,null),C(h,n,_),B(a,h,_),i=!0},p(h,_){f===(f=l(h,_))&&u?u.p(h,_):(u.d(1),u=f(h),u&&(u.c(),u.m(e,s))),m===(m=d(h,_))&&g?g.p(h,_):(g&&g.d(1),g=m&&m(h),g&&(g.c(),g.m(e,null)))},i(h){i||(k(t.$$.fragment,h),k(a.$$.fragment,h),i=!0)},o(h){P(t.$$.fragment,h),P(a.$$.fragment,h),i=!1},d(h){h&&(L(e),L(n)),N(t),u.d(),g&&g.d(),N(a,h)}}}function uP(o){let e,t,r,s,n,a,i;e=new Ye({props:{$$slots:{name:[yP],default:[gP]},$$scope:{ctx:o}}}),r=new Ye({props:{name:"Account"}}),n=new Gx({props:{user:o[2].user,$$slots:{default:[xP]},$$scope:{ctx:o}}});let l=o[18].default,f=ge(l,o,o[25],null);return{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),H(n.$$.fragment),a=U(),f&&f.c()},m(u,d){B(e,u,d),C(u,t,d),B(r,u,d),C(u,s,d),B(n,u,d),C(u,a,d),f&&f.m(u,d),i=!0},p(u,d){let m={};d[0]&33554432&&(m.$$scope={dirty:d,ctx:u}),e.$set(m);let g={};d[0]&4&&(g.user=u[2].user),d[0]&33554432&&(g.$$scope={dirty:d,ctx:u}),n.$set(g),f&&f.p&&(!i||d[0]&33554432)&&xe(f,l,u,u[25],i?ye(l,u[25],d,null):be(u[25]),null)},i(u){i||(k(e.$$.fragment,u),k(r.$$.fragment,u),k(n.$$.fragment,u),k(f,u),i=!0)},o(u){P(e.$$.fragment,u),P(r.$$.fragment,u),P(n.$$.fragment,u),P(f,u),i=!1},d(u){u&&(L(t),L(s),L(a)),N(e,u),N(r,u),N(n,u),f&&f.d(u)}}}function dP(o){let e,t,r,s,n;return{c(){e=T("a"),t=T("button"),r=z("Sign in with Google"),b(t,"class","google-sign-in-button svelte-xcpzqp"),t.disabled=o[4],b(e,"href",o[1]),b(e,"target","_blank")},m(a,i){C(a,e,i),S(e,t),S(t,r),s||(n=re(t,"click",o[21]),s=!0)},p(a,i){i[0]&16&&(t.disabled=a[4]),i[0]&2&&b(e,"href",a[1])},d(a){a&&L(e),s=!1,n()}}}function pP(o){let e,t,r,s;return{c(){e=T("button"),t=z("Sign in with Google"),b(e,"class","google-sign-in-button svelte-xcpzqp"),e.disabled=o[4]},m(n,a){C(n,e,a),S(e,t),r||(s=re(e,"click",(0,ps.debounce)(o[20])),r=!0)},p(n,a){a[0]&16&&(e.disabled=n[4])},d(n){n&&L(e),r=!1,s()}}}function mP(o){let e,t,r,s,n,a,i,l;return{c(){e=T("div"),t=T("p"),t.textContent="Continue in your browser...",r=U(),s=T("p"),n=z(`Not working?
					`),a=T("button"),a.textContent="(try again)",b(t,"class","continue svelte-xcpzqp"),b(a,"class","link link-button svelte-xcpzqp"),b(s,"class","not-working svelte-xcpzqp")},m(f,u){C(f,e,u),S(e,t),S(e,r),S(e,s),S(s,n),S(s,a),i||(l=re(a,"click",o[24]),i=!0)},p:J,d(f){f&&L(e),i=!1,l()}}}function hP(o){let e,t,r,s,n,a,i,l,f,u,d,m=o[6]&&tb(o);return{c(){e=T("p"),t=z(o[5]),r=z("."),s=T("br"),n=U(),m&&m.c(),a=U(),i=T("p"),l=z(`Not working?
				`),f=T("button"),f.textContent="(try again)",b(f,"class","link link-button svelte-xcpzqp"),b(i,"class","not-working svelte-xcpzqp")},m(g,h){C(g,e,h),S(e,t),S(e,r),S(e,s),S(e,n),m&&m.m(e,null),C(g,a,h),C(g,i,h),S(i,l),S(i,f),u||(d=re(f,"click",o[23]),u=!0)},p(g,h){h[0]&32&&se(t,g[5]),g[6]?m?m.p(g,h):(m=tb(g),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(g){g&&(L(e),L(a),L(i)),m&&m.d(),u=!1,d()}}}function tb(o){let e,t,r,s;return{c(){e=z("Already logged in? "),t=T("button"),t.textContent="(click here)",b(t,"class","link link-button svelte-xcpzqp")},m(n,a){C(n,e,a),C(n,t,a),r||(s=re(t,"click",(0,ps.debounce)(o[22])),r=!0)},p:J,d(n){n&&(L(e),L(t)),r=!1,s()}}}function gP(o){let e,t;return e=new Nx({}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function yP(o){let e,t;return e=new ac({props:{slot:"name"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p:J,i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function xP(o){let e,t,r;return{c(){e=T("button"),e.textContent="Logout"},m(s,n){C(s,e,n),t||(r=re(e,"click",(0,ps.debounce)(o[19])),t=!0)},p:J,d(s){s&&L(e),t=!1,r()}}}function bP(o){let e,t,r,s,n=[uP,fP],a=[];function i(l,f){return l[2].hasUser&&l[2].user?0:1}return e=i(o,[-1,-1]),t=a[e]=n[e](o),{c(){t.c(),r=Ce()},m(l,f){a[e].m(l,f),C(l,r,f),s=!0},p(l,f){let u=e;e=i(l,f),e===u?a[e].p(l,f):(we(),P(a[u],1,1,()=>{a[u]=null}),_e(),t=a[e],t?t.p(l,f):(t=a[e]=n[e](l),t.c()),k(t,1),t.m(r.parentNode,r))},i(l){s||(k(t),s=!0)},o(l){P(t),s=!1},d(l){l&&L(r),a[e].d(l)}}}function wP(o,e,t){let r,s,n,a=J,i=()=>(a(),a=rr(_,fe=>t(2,n=fe)),_),l,f,u,d;o.$$.on_destroy.push(()=>a());let{$$slots:m={},$$scope:g}=e,{plugin:h}=e,_,w=ve(!ps.Platform.isIosApp);me(o,w,fe=>t(3,l=fe));let v=ve(!1);me(o,v,fe=>t(4,f=fe)),i(_=h.loginManager);let M=ve(!1);me(o,M,fe=>t(6,d=fe));let R=ve(!1),D=ve(!0);me(o,D,fe=>t(28,r=fe));let E=ve("please wait...");me(o,E,fe=>t(1,s=fe));let O,A,F=ve("");me(o,F,fe=>t(5,u=fe));function V(){return Ge(this,void 0,void 0,function*(){h.loginManager.logout(),R.set(!1),M.set(!1)})}function q(){return Ge(this,void 0,void 0,function*(){try{yield h.loginManager.login()}catch(fe){w.set(!1),R.set(!1),s&&s!=="please wait..."&&(window.open(s,"_blank"),W())}})}let Z=ve(h.loginManager.pb);function j(){Z.set(h.loginManager.pb)}function K(){try{let fe=r?Pt:fetch;O=void 0,E.set("please wait..."),_.initiateManualOAuth2CodeFlow(fe).then(([oe,Ne,It])=>{O=Ne,A=It,E.set(oe)}).catch(oe=>{let Ne=oe.message;throw Ne=Ne,F.set(Ne),R.set(!1),oe})}catch(fe){F.set(fe.message)}}sr(()=>{R.set(!1),K()});function W(){return Ge(this,void 0,void 0,function*(){if(!(!O||!A))return yield h.loginManager.poll(O,A).then(fe=>{R.set(!0),v.set(!1),F.set("")}).catch(fe=>{M.set(!0),v.set(!1),R.set(!1),F.set(fe.message)})})}function te(fe){let oe=fe.target;oe.focus(),oe.select(),navigator.clipboard.writeText(oe.value).then(()=>new ps.Notice("Invite link copied")).catch(Ne=>{}),W()}let Te=()=>{V()},ie=async()=>{v.set(!0),await q()},Pe=()=>{v.set(!0),W()},Ke=()=>{W()},Oe=()=>{v.set(!1),w.set(!1),F.set(""),K()},pe=()=>{v.set(!1),w.set(!1)};return o.$$set=fe=>{"plugin"in fe&&t(17,h=fe.plugin),"$$scope"in fe&&t(25,g=fe.$$scope)},[_,s,n,l,f,u,d,w,v,M,D,E,F,V,q,K,W,h,m,Te,ie,Pe,Ke,Oe,pe,g]}var Tp=class extends X{constructor(e){super(),ee(this,e,wP,bP,Q,{plugin:17},cP,[-1,-1])}},rb=Tp;function ob(o,e,t){let r=o.slice();return r[5]=e[t],r}var _P=o=>({}),sb=o=>({}),vP=o=>({}),nb=o=>({});function SP(o){let e;return{c(){e=z(o[0])},m(t,r){C(t,e,r)},p(t,r){r&1&&se(e,t[0])},d(t){t&&L(e)}}}function kP(o){let e,t=De(o[1]),r=[];for(let s=0;s<t.length;s+=1)r[s]=ab(ob(o,t,s));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=Ce()},m(s,n){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(s,n);C(s,e,n)},p(s,n){if(n&2){t=De(s[1]);let a;for(a=0;a<t.length;a+=1){let i=ob(s,t,a);r[a]?r[a].p(i,n):(r[a]=ab(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&L(e),tt(r,s)}}}function ab(o){let e;return{c(){e=T("div"),e.textContent=`${o[5]} `},m(t,r){C(t,e,r)},p:J,d(t){t&&L(e)}}}function IP(o){let e,t=o[1].length>0&&kP(o);return{c(){t&&t.c(),e=Ce()},m(r,s){t&&t.m(r,s),C(r,e,s)},p(r,s){r[1].length>0&&t.p(r,s)},d(r){r&&L(e),t&&t.d(r)}}}function LP(o){let e,t,r,s,n,a,i,l,f=o[4].name,u=ge(f,o,o[3],nb),d=u||SP(o),m=o[4].description,g=ge(m,o,o[3],sb),h=g||IP(o),_=o[4].default,w=ge(_,o,o[3],null);return{c(){e=T("div"),t=T("div"),r=T("div"),d&&d.c(),s=U(),n=T("div"),h&&h.c(),a=U(),i=T("div"),w&&w.c(),b(r,"class","setting-item-name"),de(r,"display","grid"),de(r,"align-items","center"),b(n,"class","setting-item-description"),b(t,"class","setting-item-info"),de(t,"display","grid"),b(i,"class","setting-item-control"),b(e,"class","setting-item")},m(v,M){C(v,e,M),S(e,t),S(t,r),d&&d.m(r,null),S(t,s),S(t,n),h&&h.m(n,null),S(e,a),S(e,i),w&&w.m(i,null),l=!0},p(v,[M]){u?u.p&&(!l||M&8)&&xe(u,f,v,v[3],l?ye(f,v[3],M,vP):be(v[3]),nb):d&&d.p&&(!l||M&1)&&d.p(v,l?M:-1),g&&g.p&&(!l||M&8)&&xe(g,m,v,v[3],l?ye(m,v[3],M,_P):be(v[3]),sb),w&&w.p&&(!l||M&8)&&xe(w,_,v,v[3],l?ye(_,v[3],M,null):be(v[3]),null)},i(v){l||(k(d,v),k(h,v),k(w,v),l=!0)},o(v){P(d,v),P(h,v),P(w,v),l=!1},d(v){v&&L(e),d&&d.d(v),h&&h.d(v),w&&w.d(v)}}}function CP(o,e,t){let{$$slots:r={},$$scope:s}=e,{name:n=""}=e,{description:a}=e,i=a!==void 0?a.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,n=l.name),"description"in l&&t(2,a=l.description),"$$scope"in l&&t(3,s=l.$$scope)},[n,i,a,s,r]}var Pp=class extends X{constructor(e){super(),ee(this,e,CP,LP,Q,{name:0,description:2})}},Be=Pp;function TP(o){Fe(o,"svelte-tyruzk",".setting-item-control.svelte-tyruzk{width:unset !important;margin-top:unset !important}.setting-item.svelte-tyruzk{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-tyruzk{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-tyruzk{min-width:0}.truncate.svelte-tyruzk *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var PP=o=>({}),ib=o=>({}),AP=o=>({}),lb=o=>({});function FP(o){let e;return{c(){e=z(o[0])},m(t,r){C(t,e,r)},p(t,r){r&1&&se(e,t[0])},d(t){t&&L(e)}}}function cb(o){let e,t;return{c(){e=T("div"),t=z(o[1]),b(e,"class","setting-item-description")},m(r,s){C(r,e,s),S(e,t)},p(r,s){s&2&&se(t,r[1])},d(r){r&&L(e)}}}function DP(o){let e,t=o[1]&&cb(o);return{c(){t&&t.c(),e=Ce()},m(r,s){t&&t.m(r,s),C(r,e,s)},p(r,s){r[1]?t?t.p(r,s):(t=cb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&L(e),t&&t.d(r)}}}function MP(o){let e,t,r,s,n,a,i,l=o[3].name,f=ge(l,o,o[2],lb),u=f||FP(o),d=o[3].description,m=ge(d,o,o[2],ib),g=m||DP(o),h=o[3].default,_=ge(h,o,o[2],null);return{c(){e=T("div"),t=T("div"),r=T("div"),u&&u.c(),s=U(),g&&g.c(),n=U(),a=T("div"),_&&_.c(),b(r,"class","setting-item-name truncate svelte-tyruzk"),b(t,"class","setting-item-info svelte-tyruzk"),b(a,"class","setting-item-control svelte-tyruzk"),b(e,"class","setting-item svelte-tyruzk")},m(w,v){C(w,e,v),S(e,t),S(t,r),u&&u.m(r,null),S(t,s),g&&g.m(t,null),S(e,n),S(e,a),_&&_.m(a,null),i=!0},p(w,[v]){f?f.p&&(!i||v&4)&&xe(f,l,w,w[2],i?ye(l,w[2],v,AP):be(w[2]),lb):u&&u.p&&(!i||v&1)&&u.p(w,i?v:-1),m?m.p&&(!i||v&4)&&xe(m,d,w,w[2],i?ye(d,w[2],v,PP):be(w[2]),ib):g&&g.p&&(!i||v&2)&&g.p(w,i?v:-1),_&&_.p&&(!i||v&4)&&xe(_,h,w,w[2],i?ye(h,w[2],v,null):be(w[2]),null)},i(w){i||(k(u,w),k(g,w),k(_,w),i=!0)},o(w){P(u,w),P(g,w),P(_,w),i=!1},d(w){w&&L(e),u&&u.d(w),g&&g.d(w),_&&_.d(w)}}}function EP(o,e,t){let{$$slots:r={},$$scope:s}=e,{name:n=""}=e,{description:a=""}=e;return o.$$set=i=>{"name"in i&&t(0,n=i.name),"description"in i&&t(1,a=i.description),"$$scope"in i&&t(2,s=i.$$scope)},[n,a,s,r]}var Ap=class extends X{constructor(e){super(),ee(this,e,EP,MP,Q,{name:0,description:1},TP)}},Ht=Ap;function RP(o){Fe(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function OP(o){let e,t,r,s,n;return t=new Ad({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=T("div"),H(t.$$.fragment),b(e,"class","clickable-icon extra-setting-button svelte-y529x8"),b(e,"aria-label","Options"),b(e,"role","button"),b(e,"tabindex","0")},m(a,i){C(a,e,i),B(t,e,null),r=!0,s||(n=[re(e,"click",o[0]),re(e,"keydown",o[0])],s=!0)},p:J,i(a){r||(k(t.$$.fragment,a),r=!0)},o(a){P(t.$$.fragment,a),r=!1},d(a){a&&L(e),N(t),s=!1,Ie(n)}}}function UP(o){let e=Nt();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var Fp=class extends X{constructor(e){super(),ee(this,e,UP,OP,Q,{},RP)}},Ws=Fp;function $P(o){let e,t,r,s,n,a;t=new qs({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let i=o[3].default,l=ge(i,o,o[2],null);return{c(){e=T("span"),H(t.$$.fragment),r=U(),l&&l.c(),b(e,"role","button"),b(e,"tabindex","0"),de(e,"display","flex"),de(e,"align-items","center"),de(e,"width","100%")},m(f,u){C(f,e,u),B(t,e,null),S(e,r),l&&l.m(e,null),s=!0,n||(a=[re(e,"keypress",o[0]),re(e,"click",o[0])],n=!0)},p(f,[u]){l&&l.p&&(!s||u&4)&&xe(l,i,f,f[2],s?ye(i,f[2],u,null):be(f[2]),null)},i(f){s||(k(t.$$.fragment,f),k(l,f),s=!0)},o(f){P(t.$$.fragment,f),P(l,f),s=!1},d(f){f&&L(e),N(t),l&&l.d(f),n=!1,Ie(a)}}}function BP(o,e,t){let{$$slots:r={},$$scope:s}=e,{relay:n=void 0}=e,a=Nt();function i(){n&&a("manageRelay",{relay:n})}return o.$$set=l=>{"relay"in l&&t(1,n=l.relay),"$$scope"in l&&t(2,s=l.$$scope)},[i,n,s,r]}var Dp=class extends X{constructor(e){super(),ee(this,e,BP,$P,Q,{relay:1})}},ms=Dp;function NP(o){let e,t,r,s,n,a;t=new gd({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let i=o[3].default,l=ge(i,o,o[2],null);return{c(){e=T("span"),H(t.$$.fragment),r=U(),l&&l.c(),b(e,"role","button"),b(e,"tabindex","0"),de(e,"display","inline-flex"),de(e,"align-items","center"),de(e,"width","100%")},m(f,u){C(f,e,u),B(t,e,null),S(e,r),l&&l.m(e,null),s=!0,n||(a=[re(e,"keypress",o[0]),re(e,"click",o[0])],n=!0)},p(f,[u]){l&&l.p&&(!s||u&4)&&xe(l,i,f,f[2],s?ye(i,f[2],u,null):be(f[2]),null)},i(f){s||(k(t.$$.fragment,f),k(l,f),s=!0)},o(f){P(t.$$.fragment,f),P(l,f),s=!1},d(f){f&&L(e),N(t),l&&l.d(f),n=!1,Ie(a)}}}function HP(o,e,t){let{$$slots:r={},$$scope:s}=e,{folder:n=void 0}=e,a=Nt();function i(){var l;n&&a("manageSharedFolder",{folder:n,relay:(l=n.remote)===null||l===void 0?void 0:l.relay})}return o.$$set=l=>{"folder"in l&&t(1,n=l.folder),"$$scope"in l&&t(2,s=l.$$scope)},[i,n,s,r]}var Mp=class extends X{constructor(e){super(),ee(this,e,HP,NP,Q,{folder:1})}},fo=Mp;function VP(o){let e,t=o[0].name+"",r;return{c(){e=T("span"),r=z(t),de(e,"overflow","hidden"),de(e,"text-overflow","ellipsis"),de(e,"white-space","nowrap")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n&1&&t!==(t=s[0].name+"")&&se(r,t)},d(s){s&&L(e)}}}function fb(o){let e,t,r,s,n;return t=new rd({props:{size:16,class:"svg-icon"}}),s=new ms({props:{relay:o[1],$$slots:{default:[qP]},$$scope:{ctx:o}}}),s.$on("manageRelay",o[3]),{c(){e=T("span"),H(t.$$.fragment),r=U(),H(s.$$.fragment),de(e,"width","16px"),de(e,"flex-shrink","0"),de(e,"display","flex"),de(e,"justify-content","center")},m(a,i){C(a,e,i),B(t,e,null),C(a,r,i),B(s,a,i),n=!0},p(a,i){let l={};i&2&&(l.relay=a[1]),i&17&&(l.$$scope={dirty:i,ctx:a}),s.$set(l)},i(a){n||(k(t.$$.fragment,a),k(s.$$.fragment,a),n=!0)},o(a){P(t.$$.fragment,a),P(s.$$.fragment,a),n=!1},d(a){a&&(L(e),L(r)),N(t),N(s,a)}}}function qP(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=T("span"),r=z(t),de(e,"flex","1"),de(e,"min-width","0"),de(e,"text-overflow","ellipsis"),de(e,"white-space","nowrap")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n&1&&t!==(t=s[0].remote.relay.name+"")&&se(r,t)},d(s){s&&L(e)}}}function WP(o){let e,t,r,s,n;r=new fo({props:{folder:o[0],$$slots:{default:[VP]},$$scope:{ctx:o}}}),r.$on("manageSharedFolder",o[2]);let a=o[0].remote&&fb(o);return{c(){e=T("span"),t=T("span"),H(r.$$.fragment),s=U(),a&&a.c(),de(t,"display","inline-flex"),de(t,"align-items","center"),de(t,"width","200px"),de(t,"min-width","200px"),de(t,"flex-shrink","0"),de(e,"display","inline-flex"),de(e,"align-items","center"),de(e,"width","100%"),de(e,"gap","8px")},m(i,l){C(i,e,l),S(e,t),B(r,t,null),S(e,s),a&&a.m(e,null),n=!0},p(i,[l]){let f={};l&1&&(f.folder=i[0]),l&17&&(f.$$scope={dirty:l,ctx:i}),r.$set(f),i[0].remote?a?(a.p(i,l),l&1&&k(a,1)):(a=fb(i),a.c(),k(a,1),a.m(e,null)):a&&(we(),P(a,1,1,()=>{a=null}),_e())},i(i){n||(k(r.$$.fragment,i),k(a),n=!0)},o(i){P(r.$$.fragment,i),P(a),n=!1},d(i){i&&L(e),N(r),a&&a.d()}}}function zP(o,e,t){let{folder:r}=e,{relay:s}=e;function n(i){Gr.call(this,o,i)}function a(i){Gr.call(this,o,i)}return o.$$set=i=>{"folder"in i&&t(0,r=i.folder),"relay"in i&&t(1,s=i.relay)},[r,s,n,a]}var Ep=class extends X{constructor(e){super(),ee(this,e,zP,WP,Q,{folder:0,relay:1})}},ub=Ep;var ea=require("obsidian");function KP(o){Fe(o,"svelte-yg42fv","input.system3-input-invalid.svelte-yg42fv{border:1px solid var(--color-red) !important}span.faint.svelte-yg42fv{color:var(--text-faint)}")}function db(o,e,t){let r=o.slice();return r[21]=e[t],r}function pb(o,e,t){let r=o.slice();return r[24]=e[t],r}function GP(o){let e,t,r,s,n,a;return{c(){e=T("input"),r=U(),s=T("button"),s.textContent="Join",b(e,"type","text"),b(e,"placeholder","Enter share key"),b(e,"class",t=Nn(o[2]?"system3-input-invalid":"")+" svelte-yg42fv"),b(s,"class","mod-cta")},m(i,l){C(i,e,l),or(e,o[1]),C(i,r,l),C(i,s,l),n||(a=[re(e,"input",o[12]),re(e,"input",o[8]),re(s,"click",function(){ut((0,ea.debounce)(o[13]))&&(0,ea.debounce)(o[13]).apply(this,arguments)})],n=!0)},p(i,l){o=i,l&4&&t!==(t=Nn(o[2]?"system3-input-invalid":"")+" svelte-yg42fv")&&b(e,"class",t),l&2&&e.value!==o[1]&&or(e,o[1])},d(i){i&&(L(e),L(r),L(s)),n=!1,Ie(a)}}}function jP(o){let e;return{c(){e=T("span"),e.textContent="Relay Servers",b(e,"slot","name"),de(e,"display","inline-flex"),de(e,"align-items","center")},m(t,r){C(t,e,r)},p:J,d(t){t&&L(e)}}}function YP(o){let e,t;function r(){return o[15](o[24])}return e=new Ws({}),e.$on("settings",r),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){o=s},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function JP(o){let e;return{c(){e=T("span"),e.textContent="(Untitled Relay Server)",b(e,"class","faint svelte-yg42fv")},m(t,r){C(t,e,r)},p:J,d(t){t&&L(e)}}}function QP(o){let e=o[24].name+"",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p(r,s){s&8&&e!==(e=r[24].name+"")&&se(t,e)},d(r){r&&L(t)}}}function XP(o){let e;function t(n,a){return n[24].name?QP:JP}let r=t(o,-1),s=r(o);return{c(){s.c(),e=Ce()},m(n,a){s.m(n,a),C(n,e,a)},p(n,a){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&L(e),s.d(n)}}}function ZP(o){let e,t;return e=new ms({props:{slot:"name",relay:o[24],t:"name",$$slots:{default:[XP]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[14]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&8&&(n.relay=r[24]),s&134217736&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function mb(o){let e,t;return e=new Ht({props:{$$slots:{name:[ZP],default:[YP]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&134217736&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function eA(o){let e,t,r;return{c(){e=T("button"),e.textContent="Create",b(e,"class","mod-cta")},m(s,n){C(s,e,n),t||(r=re(e,"click",(0,ea.debounce)(o[16])),t=!0)},p:J,d(s){s&&L(e),t=!1,r()}}}function hb(o){let e,t;return e=new Be({props:{description:"Go to a Relay Server's settings page above to share existing folders, or add Shared Folders to your vault."}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function tA(o){let e,t,r;function s(){return o[19](o[21])}return e=new Ws({}),e.$on("settings",function(){ut((0,ea.debounce)(s))&&(0,ea.debounce)(s).apply(this,arguments)}),{c(){H(e.$$.fragment),t=U()},m(n,a){B(e,n,a),C(n,t,a),r=!0},p(n,a){o=n},i(n){r||(k(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){n&&L(t),N(e,n)}}}function rA(o){var r;let e,t;return e=new ub({props:{folder:o[21],relay:(r=o[21].remote)==null?void 0:r.relay,slot:"name"}}),e.$on("manageRelay",o[17]),e.$on("manageSharedFolder",o[18]),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){var i;let a={};n&16&&(a.folder=s[21]),n&16&&(a.relay=(i=s[21].remote)==null?void 0:i.relay),e.$set(a)},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function gb(o){let e,t;return e=new Ht({props:{$$slots:{name:[rA],default:[tA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&134217752&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function oA(o){let e,t,r,s,n,a,i,l,f,u,d,m=o[4].items().length===0,g,h,_;e=new Ye({props:{name:"Join a Relay Server"}}),r=new Be({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[GP]},$$scope:{ctx:o}}}),n=new Ye({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[jP]},$$scope:{ctx:o}}});let w=De(o[3].values().sort(yb)),v=[];for(let A=0;A<w.length;A+=1)v[A]=mb(pb(o,w,A));let M=A=>P(v[A],1,1,()=>{v[A]=null});l=new Be({props:{name:"",description:"",$$slots:{default:[eA]},$$scope:{ctx:o}}}),u=new Ye({props:{name:"Shared Folders",helpText:"Shared Folders enhance local folders by tracking edits. You can see what Relay Server a Shared Folder is connected to below."}});let R=m&&hb(o),D=De(o[4].items()),E=[];for(let A=0;A<D.length;A+=1)E[A]=gb(db(o,D,A));let O=A=>P(E[A],1,1,()=>{E[A]=null});return{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),H(n.$$.fragment),a=U();for(let A=0;A<v.length;A+=1)v[A].c();i=U(),H(l.$$.fragment),f=U(),H(u.$$.fragment),d=U(),R&&R.c(),g=U();for(let A=0;A<E.length;A+=1)E[A].c();h=Ce()},m(A,F){B(e,A,F),C(A,t,F),B(r,A,F),C(A,s,F),B(n,A,F),C(A,a,F);for(let V=0;V<v.length;V+=1)v[V]&&v[V].m(A,F);C(A,i,F),B(l,A,F),C(A,f,F),B(u,A,F),C(A,d,F),R&&R.m(A,F),C(A,g,F);for(let V=0;V<E.length;V+=1)E[V]&&E[V].m(A,F);C(A,h,F),_=!0},p(A,[F]){let V={};F&134217734&&(V.$$scope={dirty:F,ctx:A}),r.$set(V);let q={};if(F&134217728&&(q.$$scope={dirty:F,ctx:A}),n.$set(q),F&72){w=De(A[3].values().sort(yb));let j;for(j=0;j<w.length;j+=1){let K=pb(A,w,j);v[j]?(v[j].p(K,F),k(v[j],1)):(v[j]=mb(K),v[j].c(),k(v[j],1),v[j].m(i.parentNode,i))}for(we(),j=w.length;j<v.length;j+=1)M(j);_e()}let Z={};if(F&134217728&&(Z.$$scope={dirty:F,ctx:A}),l.$set(Z),F&16&&(m=A[4].items().length===0),m?R?F&16&&k(R,1):(R=hb(A),R.c(),k(R,1),R.m(g.parentNode,g)):R&&(we(),P(R,1,1,()=>{R=null}),_e()),F&152){D=De(A[4].items());let j;for(j=0;j<D.length;j+=1){let K=db(A,D,j);E[j]?(E[j].p(K,F),k(E[j],1)):(E[j]=gb(K),E[j].c(),k(E[j],1),E[j].m(h.parentNode,h))}for(we(),j=D.length;j<E.length;j+=1)O(j);_e()}},i(A){if(!_){k(e.$$.fragment,A),k(r.$$.fragment,A),k(n.$$.fragment,A);for(let F=0;F<w.length;F+=1)k(v[F]);k(l.$$.fragment,A),k(u.$$.fragment,A),k(R);for(let F=0;F<D.length;F+=1)k(E[F]);_=!0}},o(A){P(e.$$.fragment,A),P(r.$$.fragment,A),P(n.$$.fragment,A),v=v.filter(Boolean);for(let F=0;F<v.length;F+=1)P(v[F]);P(l.$$.fragment,A),P(u.$$.fragment,A),P(R),E=E.filter(Boolean);for(let F=0;F<E.length;F+=1)P(E[F]);_=!1},d(A){A&&(L(t),L(s),L(a),L(i),L(f),L(d),L(g),L(h)),N(e,A),N(r,A),N(n,A),tt(v,A),N(l,A),N(u,A),R&&R.d(A),tt(E,A)}}}function yb(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function sA(o,e,t){let r,s=J,n=()=>(s(),s=rr(l,q=>t(3,r=q)),l),a;o.$$.on_destroy.push(()=>s());let{plugin:i}=e,{relays:l}=e;n();let f=i.sharedFolders;me(o,f,q=>t(4,a=q));let u="",d=!1,m=Nt();function g(q){q&&m("manageRelay",{relay:q})}function h(q,Z){q&&m("manageSharedFolder",{folder:q,relay:Z})}function _(){t(2,d=!1)}function w(q){return Ge(this,void 0,void 0,function*(){try{let Z=yield i.relayManager.acceptInvitation(q);m("joinRelay",{relay:Z})}catch(Z){t(2,d=!0)}})}function v(){m("createRelay")}function M(){u=this.value,t(1,u)}let R=()=>w(u);function D(q){Gr.call(this,o,q)}let E=q=>{g(q)},O=()=>v();function A(q){Gr.call(this,o,q)}function F(q){Gr.call(this,o,q)}let V=q=>{let Z=r.values().find(j=>{var K;return((K=q.remote)==null?void 0:K.relay.guid)===j.guid});h(q,Z)};return o.$$set=q=>{"plugin"in q&&t(11,i=q.plugin),"relays"in q&&n(t(0,l=q.relays))},[l,u,d,r,a,f,g,h,_,w,v,i,M,R,D,E,O,A,F,V]}var Rp=class extends X{constructor(e){super(),ee(this,e,sA,oA,Q,{plugin:11,relays:0},KP)}},uo=Rp;var ht=require("obsidian");var Ub=vs(wa());function nA(o){let e,t,r,s,n,a,i,l,f;s=new ld({props:{size:16}});let u=o[3].default,d=ge(u,o,o[4],null);return{c(){e=T("span"),t=z(o[1]),r=U(),H(s.$$.fragment),n=U(),a=T("span"),d&&d.c(),b(e,"tabindex","0"),b(e,"role","button"),de(a,"flex","1"),de(a,"min-width","0"),de(a,"text-overflow","ellipsis"),de(a,"white-space","nowrap"),de(a,"overflow","hidden")},m(m,g){C(m,e,g),S(e,t),C(m,r,g),B(s,m,g),C(m,n,g),C(m,a,g),d&&d.m(a,null),i=!0,l||(f=[re(e,"click",o[2]),re(e,"keypress",o[2])],l=!0)},p(m,g){(!i||g&2)&&se(t,m[1]),d&&d.p&&(!i||g&16)&&xe(d,u,m,m[4],i?ye(u,m[4],g,null):be(m[4]),null)},i(m){i||(k(s.$$.fragment,m),k(d,m),i=!0)},o(m){P(s.$$.fragment,m),P(d,m),i=!1},d(m){m&&(L(e),L(r),L(n),L(a)),N(s,m),d&&d.d(m),l=!1,Ie(f)}}}function aA(o){let e,t,r;var s=o[0];function n(a,i){return{props:{$$slots:{default:[nA]},$$scope:{ctx:a}}}}return s&&(t=qn(s,n(o))),{c(){e=T("h4"),t&&H(t.$$.fragment)},m(a,i){C(a,e,i),t&&B(t,e,null),r=!0},p(a,[i]){if(i&1&&s!==(s=a[0])){if(t){we();let l=t;P(l.$$.fragment,1,0,()=>{N(l,1)}),_e()}s?(t=qn(s,n(a,i)),H(t.$$.fragment),k(t.$$.fragment,1),B(t,e,null)):t=null}else if(s){let l={};i&18&&(l.$$scope={dirty:i,ctx:a}),t.$set(l)}},i(a){r||(t&&k(t.$$.fragment,a),r=!0)},o(a){t&&P(t.$$.fragment,a),r=!1},d(a){a&&L(e),t&&N(t)}}}function iA(o,e,t){let{$$slots:r={},$$scope:s}=e,{category:n}=e,{categoryText:a}=e,i=Nt();function l(){i("goBack")}return o.$$set=f=>{"category"in f&&t(0,n=f.category),"categoryText"in f&&t(1,a=f.categoryText),"$$scope"in f&&t(4,s=f.$$scope)},[n,a,l,r,s]}var Op=class extends X{constructor(e){super(),ee(this,e,iA,aA,Q,{category:0,categoryText:1})}},fc=Op;function lA(o){Fe(o,"svelte-1ezpbya",'.system3-disk-usage-container.svelte-1ezpbya{width:100%;background-color:var(--interactive-normal);overflow:hidden}.system3-disk-usage-bar.svelte-1ezpbya{height:0.5rem;background-color:var(--color-accent);transition:width 0.6s ease}.system3-disk-usage-report.svelte-1ezpbya{text-align:center}.system3-disk-usage-bar[data-state="warning"].svelte-1ezpbya{height:0.3rem;background-color:var(--red);transition:width 0.6s ease}')}function cA(o){let e,t,r,s,n,a;return{c(){e=T("div"),t=T("div"),s=U(),n=T("div"),a=z(o[1]),b(t,"class","system3-disk-usage-bar svelte-1ezpbya"),de(t,"width",o[0]+"%"),b(t,"data-state",r=o[0]>90?"warning":""),b(e,"class","system3-disk-usage-container svelte-1ezpbya"),b(n,"class","system3-disk-usage-report svelte-1ezpbya")},m(i,l){C(i,e,l),S(e,t),C(i,s,l),C(i,n,l),S(n,a)},p(i,[l]){l&1&&de(t,"width",i[0]+"%"),l&1&&r!==(r=i[0]>90?"warning":"")&&b(t,"data-state",r),l&2&&se(a,i[1])},i:J,o:J,d(i){i&&(L(e),L(s),L(n))}}}function fA(o,e,t){let{diskUsagePercentage:r=0}=e,{text:s=""}=e;return r=Math.max(0,r),r=Math.min(100,r),console.warn("diskUsage",r),o.$$set=n=>{"diskUsagePercentage"in n&&t(0,r=n.diskUsagePercentage),"text"in n&&t(1,s=n.text)},[r,s]}var Up=class extends X{constructor(e){super(),ee(this,e,fA,cA,Q,{diskUsagePercentage:0,text:1},lA)}},xb=Up;var dc=require("obsidian");function uA(o){let e,t,r=o[0].shared&&bb(o);return{c(){e=T("div"),r&&r.c(),b(e,"class","suggestion-icon")},m(s,n){C(s,e,n),r&&r.m(e,null),t=!0},p(s,n){s[0].shared?r?n&1&&k(r,1):(r=bb(s),r.c(),k(r,1),r.m(e,null)):r&&(we(),P(r,1,1,()=>{r=null}),_e())},i(s){t||(k(r),t=!0)},o(s){P(r),t=!1},d(s){s&&L(e),r&&r.d()}}}function dA(o){let e;return{c(){e=T("span"),e.textContent="Enter to create",b(e,"class","suggestion-action")},m(t,r){C(t,e,r)},p:J,i:J,o:J,d(t){t&&L(e)}}}function bb(o){let e,t;return e=new Bo({props:{class:"svg-icon"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function pA(o){let e,t,r=o[0].folder+"",s,n,a,i,l,f,u=[dA,uA],d=[];function m(g,h){return g[0].exists?1:0}return i=m(o,-1),l=d[i]=u[i](o),{c(){e=T("div"),t=T("div"),s=z(r),n=U(),a=T("div"),l.c(),b(t,"class","suggestion-title"),b(e,"class","suggestion-content"),b(a,"class","suggestion-aux")},m(g,h){C(g,e,h),S(e,t),S(t,s),C(g,n,h),C(g,a,h),d[i].m(a,null),f=!0},p(g,[h]){(!f||h&1)&&r!==(r=g[0].folder+"")&&se(s,r);let _=i;i=m(g,h),i===_?d[i].p(g,h):(we(),P(d[_],1,1,()=>{d[_]=null}),_e(),l=d[i],l?l.p(g,h):(l=d[i]=u[i](g),l.c()),k(l,1),l.m(a,null))},i(g){f||(k(l),f=!0)},o(g){P(l),f=!1},d(g){g&&(L(e),L(n),L(a)),d[i].d()}}}function mA(o,e,t){let{suggestion:r}=e;return o.$$set=s=>{"suggestion"in s&&t(0,r=s.suggestion)},[r]}var $p=class extends X{constructor(e){super(),ee(this,e,mA,pA,Q,{suggestion:0})}},wb=$p;var uc=class extends dc.SuggestModal{constructor(t,r,s){super(t);this.sharedFolders=r;this.onChoose=s;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(n=>n.path)),this.hasRemotes=new Set(this.sharedFolders.filter(n=>n.remote!==void 0).map(n=>n.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?1:!t.exists&&r.exists||t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(i=>{i.$destroy()});let r=t.toLowerCase(),s=[],n=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!n&&s.push({folder:t,exists:!1,shared:!1});let a=i=>{let l=this.sharedPaths.has(i.path),f=this.hasRemotes.has(i.path);if(i.path.toLowerCase().contains(r)&&i.path.length>1&&!f&&s.push({folder:i.path,exists:!0,shared:l}),!l)for(let u of i.children)u instanceof dc.TFolder&&a(u)};return a(this.app.vault.getRoot()),s.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let s=new wb({target:r,props:{suggestion:t}});this.components.push(s)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var Lb=require("obsidian");var Np=require("obsidian");var _b=require("obsidian"),vb=require("obsidian"),pc=class extends vb.AbstractInputSuggest{constructor(t,r,s){super(t,s);this.app=t;this.sharedFolders=r;this.inputEl=s;this.sharedPaths=new Set(this.sharedFolders.map(n=>n.path))}getSuggestions(t){let r=t.toLowerCase(),s=[],n=a=>{if(!this.sharedPaths.has(a.path)){a.path.toLowerCase().contains(r)&&s.push(a.path);for(let l of a.children)l instanceof _b.TFolder&&n(l)}};return n(this.app.vault.getRoot()),s}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function hA(o){let e,t,r,s;return{c(){e=T("div"),t=T("input"),b(t,"type","text"),b(t,"placeholder","/"),b(e,"class","folder-suggest-container")},m(n,a){C(n,e,a),S(e,t),o[5](t),or(t,o[2]),r||(s=[re(t,"input",gA),re(t,"input",o[6])],r=!0)},p(n,[a]){a&4&&t.value!==n[2]&&or(t,n[2])},i:J,o:J,d(n){n&&L(e),o[5](null),r=!1,Ie(s)}}}function gA(){}function yA(o,e,t){let r,s=J,n=()=>(s(),s=rr(u,g=>t(2,r=g)),u);o.$$.on_destroy.push(()=>s());let{app:a}=e,i,l,{sharedFolders:f}=e,{selectedFolder:u=ve()}=e;n(),sr(()=>{l=new pc(a,f,i);let g=h=>{n(t(0,u=h.detail.folder.path))};return i.addEventListener("folder-selected",g),()=>{i.removeEventListener("folder-selected",g)}}),ju(()=>{l&&l.close()});function d(g){Er[g?"unshift":"push"](()=>{i=g,t(1,i)})}function m(){r=this.value,u.set(r)}return o.$$set=g=>{"app"in g&&t(3,a=g.app),"sharedFolders"in g&&t(4,f=g.sharedFolders),"selectedFolder"in g&&n(t(0,u=g.selectedFolder))},[u,i,r,a,f,d,m]}var Bp=class extends X{constructor(e){super(),ee(this,e,yA,hA,Q,{app:3,sharedFolders:4,selectedFolder:0})}},Sb=Bp;function xA(o){Fe(o,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function bA(o){let e,t,r;return{c(){e=T("input"),b(e,"type","text")},m(s,n){C(s,e,n),or(e,o[4]),t||(r=re(e,"input",o[8]),t=!0)},p(s,n){n&16&&e.value!==s[4]&&or(e,s[4])},d(s){s&&L(e),t=!1,r()}}}function wA(o){let e,t;return e=new Sb({props:{app:o[0],sharedFolders:o[2],selectedFolder:o[7]}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.app=r[0]),s&4&&(n.sharedFolders=r[2]),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function kb(o){let e,t;return{c(){e=T("span"),t=z(o[5]),b(e,"class","mod-warning error svelte-hgd3zf")},m(r,s){C(r,e,s),S(e,t)},p(r,s){s&32&&se(t,r[5])},d(r){r&&L(e)}}}function _A(o){let e,t,r,s,n,a,i,l,f,u,d,m,g;s=new Be({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[bA]},$$scope:{ctx:o}}}),a=new Be({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[wA]},$$scope:{ctx:o}}});let h=o[5]&&kb(o);return{c(){e=T("div"),e.textContent="Add to vault",t=U(),r=T("div"),H(s.$$.fragment),n=U(),H(a.$$.fragment),i=U(),l=T("div"),h&&h.c(),f=U(),u=T("button"),u.textContent="Confirm",b(e,"class","modal-title"),b(u,"class","mod-cta"),b(l,"class","modal-button-container"),b(r,"class","modal-content")},m(_,w){C(_,e,w),C(_,t,w),C(_,r,w),B(s,r,null),S(r,n),B(a,r,null),S(r,i),S(r,l),h&&h.m(l,null),S(l,f),S(l,u),d=!0,m||(g=re(u,"click",function(){ut((0,Np.debounce)(o[9]))&&(0,Np.debounce)(o[9]).apply(this,arguments)}),m=!0)},p(_,[w]){o=_;let v={};w&1040&&(v.$$scope={dirty:w,ctx:o}),s.$set(v);let M={};w&1029&&(M.$$scope={dirty:w,ctx:o}),a.$set(M),o[5]?h?h.p(o,w):(h=kb(o),h.c(),h.m(l,f)):h&&(h.d(1),h=null)},i(_){d||(k(s.$$.fragment,_),k(a.$$.fragment,_),d=!0)},o(_){P(s.$$.fragment,_),P(a.$$.fragment,_),d=!1},d(_){_&&(L(e),L(t),L(r)),N(s),N(a),h&&h.d(),m=!1,g()}}}function vA(o,e,t){let r,{app:s}=e,{remoteFolder:n}=e,{sharedFolders:a}=e,{onConfirm:i}=e,l=n.name,f=ve();me(o,f,g=>t(6,r=g));let u="";function d(){l=this.value,t(4,l)}let m=async()=>{i(n,l,r||"").catch(g=>{t(5,u=g.message)})};return o.$$set=g=>{"app"in g&&t(0,s=g.app),"remoteFolder"in g&&t(1,n=g.remoteFolder),"sharedFolders"in g&&t(2,a=g.sharedFolders),"onConfirm"in g&&t(3,i=g.onConfirm)},[s,n,a,i,l,u,r,f,d,m]}var Hp=class extends X{constructor(e){super(),ee(this,e,vA,_A,Q,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},xA)}},Ib=Hp;var mc=class extends Lb.Modal{constructor(t,r,s,n){super(t);this.sharedFolders=r;this.remoteFolder=s;this.onConfirm=n;this.onConfirm=n}onOpen(){let{contentEl:t}=this;this.component=new Ib({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,s,n)=>{await this.onConfirm(r,s,n),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var qp=vs(Cb());function SA(o){Fe(o,"svelte-xzg7gq",".system3-settings-danger-zone.svelte-xzg7gq{margin-top:6em}input.system3-updating.svelte-xzg7gq{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-xzg7gq{border:1px solid var(--color-red) !important}.faint.svelte-xzg7gq{color:var(--text-faint)}")}function Tb(o,e,t){let r=o.slice();return r[52]=e[t],r}function Pb(o,e,t){let r=o.slice();return r[55]=e[t],r}function kA(o){let e;return{c(){e=T("span"),e.textContent="(Untitled Relay Server)",b(e,"class","faint svelte-xzg7gq")},m(t,r){C(t,e,r)},p:J,d(t){t&&L(e)}}}function IA(o){let e=o[0].name+"",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&1&&e!==(e=r[0].name+"")&&se(t,e)},d(r){r&&L(t)}}}function LA(o){let e;function t(n,a){return n[0].name?IA:kA}let r=t(o,[-1,-1]),s=r(o);return{c(){s.c(),e=Ce()},m(n,a){s.m(n,a),C(n,e,a)},p(n,a){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&L(e),s.d(n)}}}function Ab(o){let e,t;return e=new Be({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[CA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&297|s[1]&134217728&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function CA(o){let e,t,r,s;return{c(){e=T("input"),b(e,"type","text"),b(e,"spellcheck","false"),b(e,"placeholder","Example: Shared Notes"),b(e,"class",t=Nn((o[8]?"system3-updating":"")+(o[5]?"":" system3-input-invalid"))+" svelte-xzg7gq")},m(n,a){C(n,e,a),or(e,o[0].name),o[37](e),r||(s=[re(e,"input",o[36]),re(e,"input",o[28])],r=!0)},p(n,a){a[0]&288&&t!==(t=Nn((n[8]?"system3-updating":"")+(n[5]?"":" system3-input-invalid"))+" svelte-xzg7gq")&&b(e,"class",t),a[0]&1&&e.value!==n[0].name&&or(e,n[0].name)},d(n){n&&L(e),o[37](null),r=!1,Ie(s)}}}function TA(o){let e,t;return e=new Ht({props:{$$slots:{name:[DA],default:[AA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&512|s[1]&134217728&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function PA(o){let e,t;return e=new Ht({props:{$$slots:{name:[RA],default:[MA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&1536|s[1]&134217728&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function AA(o){let e,t,r;function s(){return o[41](o[55])}return{c(){e=T("button"),e.textContent="Add to Vault",b(e,"class","mod-cta"),b(e,"aria-label","Add shared folder to vault"),de(e,"max-width","8em")},m(n,a){C(n,e,a),t||(r=re(e,"click",function(){ut((0,ht.debounce)(s))&&(0,ht.debounce)(s).apply(this,arguments)}),t=!0)},p(n,a){o=n},d(n){n&&L(e),t=!1,r()}}}function FA(o){let e=o[55].name+"",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&512&&e!==(e=r[55].name+"")&&se(t,e)},d(r){r&&L(t)}}}function DA(o){let e,t;return e=new fo({props:{slot:"name",$$slots:{default:[FA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&512|s[1]&134217728&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function MA(o){let e,t;function r(){return o[40](o[55])}return e=new Ws({}),e.$on("settings",function(){ut((0,ht.debounce)(r))&&(0,ht.debounce)(r).apply(this,arguments)}),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){o=s},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function EA(o){let e=o[55].name+"",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&512&&e!==(e=r[55].name+"")&&se(t,e)},d(r){r&&L(t)}}}function RA(o){let e,t;function r(...s){return o[38](o[55],...s)}return e=new fo({props:{folder:o[10].find(r),slot:"name",$$slots:{default:[EA]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[39]),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){o=s;let a={};n[0]&1536&&(a.folder=o[10].find(r)),n[0]&512|n[1]&134217728&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function Fb(o){let e,t,r,s,n;function a(...u){return o[35](o[55],...u)}let i=[PA,TA],l=[];function f(u,d){return d[0]&1536&&(e=null),e==null&&(e=!!u[10].find(a)),e?0:1}return t=f(o,[-1,-1]),r=l[t]=i[t](o),{c(){r.c(),s=Ce()},m(u,d){l[t].m(u,d),C(u,s,d),n=!0},p(u,d){o=u;let m=t;t=f(o,d),t===m?l[t].p(o,d):(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),r=l[t],r?r.p(o,d):(r=l[t]=i[t](o),r.c()),k(r,1),r.m(s.parentNode,s))},i(u){n||(k(r),n=!0)},o(u){P(r),n=!1},d(u){u&&L(s),l[t].d(u)}}}function OA(o){let e,t,r;return{c(){e=T("button"),e.textContent="Share a folder",b(e,"class","mod-cta"),b(e,"aria-label","Select a folder to share it with this Relay Server")},m(s,n){C(s,e,n),t||(r=re(e,"click",(0,ht.debounce)(o[42])),t=!0)},p:J,d(s){s&&L(e),t=!1,r()}}}function UA(o){let e=o[11].values().length+"",t,r,s=o[6].userLimit+"",n;return{c(){t=z(e),r=z(" / "),n=z(s)},m(a,i){C(a,t,i),C(a,r,i),C(a,n,i)},p(a,i){i[0]&2048&&e!==(e=a[11].values().length+"")&&se(t,e),i[0]&64&&s!==(s=a[6].userLimit+"")&&se(n,s)},d(a){a&&(L(t),L(r),L(n))}}}function Db(o){let e,t,r;function s(){return o[43](o[52])}return{c(){e=T("button"),e.textContent="Kick",b(e,"class","mod-destructive")},m(n,a){C(n,e,a),t||(r=re(e,"click",function(){ut((0,ht.debounce)(s))&&(0,ht.debounce)(s).apply(this,arguments)}),t=!0)},p(n,a){o=n},d(n){n&&L(e),t=!1,r()}}}function $A(o){let e,t=o[52].role==="Member"&&o[6].owner&&Db(o);return{c(){t&&t.c(),e=U()},m(r,s){t&&t.m(r,s),C(r,e,s)},p(r,s){r[52].role==="Member"&&r[6].owner?t?t.p(r,s):(t=Db(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&L(e),t&&t.d(r)}}}function Mb(o){let e,t;return e=new Be({props:{name:o[52].user.name,description:o[52].role,$$slots:{default:[$A]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&2048&&(n.name=r[52].user.name),s[0]&2048&&(n.description=r[52].role),s[0]&2112|s[1]&134217728&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function BA(o){let e,t,r;return{c(){e=T("input"),e.value=o[4],b(e,"type","text"),e.readOnly=!0,b(e,"id","system3InviteLink")},m(s,n){C(s,e,n),t||(r=re(e,"click",(0,ht.debounce)(o[32])),t=!0)},p(s,n){n[0]&16&&e.value!==s[4]&&(e.value=s[4])},d(s){s&&L(e),t=!1,r()}}}function NA(o){let e,t,r,s;return e=new Ye({props:{name:"Membership"}}),r=new Be({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[VA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment)},m(n,a){B(e,n,a),C(n,t,a),B(r,n,a),s=!0},p(n,a){let i={};a[1]&134217728&&(i.$$scope={dirty:a,ctx:n}),r.$set(i)},i(n){s||(k(e.$$.fragment,n),k(r.$$.fragment,n),s=!0)},o(n){P(e.$$.fragment,n),P(r.$$.fragment,n),s=!1},d(n){n&&L(t),N(e,n),N(r,n)}}}function HA(o){let e,t,r,s,n,a,i,l,f=[WA,qA],u=[];function d(_,w){return _[12]?0:1}e=d(o,[-1,-1]),t=u[e]=f[e](o);let m=[XA,QA],g=[];function h(_,w){return _[13]&&_[13].quota>0?0:1}return s=h(o,[-1,-1]),n=g[s]=m[s](o),i=new Be({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[sF]},$$scope:{ctx:o}}}),{c(){t.c(),r=U(),n.c(),a=U(),H(i.$$.fragment)},m(_,w){u[e].m(_,w),C(_,r,w),g[s].m(_,w),C(_,a,w),B(i,_,w),l=!0},p(_,w){let v=e;e=d(_,w),e===v?u[e].p(_,w):(we(),P(u[v],1,1,()=>{u[v]=null}),_e(),t=u[e],t?t.p(_,w):(t=u[e]=f[e](_),t.c()),k(t,1),t.m(r.parentNode,r));let M=s;s=h(_,w),s===M?g[s].p(_,w):(we(),P(g[M],1,1,()=>{g[M]=null}),_e(),n=g[s],n?n.p(_,w):(n=g[s]=m[s](_),n.c()),k(n,1),n.m(a.parentNode,a));let R={};w[0]&128|w[1]&134217728&&(R.$$scope={dirty:w,ctx:_}),i.$set(R)},i(_){l||(k(t),k(n),k(i.$$.fragment,_),l=!0)},o(_){P(t),P(n),P(i.$$.fragment,_),l=!1},d(_){_&&(L(r),L(a)),u[e].d(_),g[s].d(_),N(i,_)}}}function VA(o){let e,t,r;return{c(){e=T("button"),e.textContent="Leave",b(e,"class","mod-warning")},m(s,n){C(s,e,n),t||(r=re(e,"click",(0,ht.debounce)(o[47])),t=!0)},p:J,d(s){s&&L(e),t=!1,r()}}}function qA(o){let e,t;return e=new Be({props:{name:`Plan: ${o[6].plan}`,description:"",$$slots:{description:[KA],default:[zA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&64&&(n.name=`Plan: ${r[6].plan}`),s[0]&64|s[1]&134217728&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function WA(o){let e,t,r=!o[7].values()[0].active||o[7].values()[0].cancelAt,s,n;e=new Be({props:{name:`Plan: ${o[6].plan}`,description:"",$$slots:{description:[jA],default:[GA]},$$scope:{ctx:o}}});let a=r&&Rb(o);return{c(){H(e.$$.fragment),t=U(),a&&a.c(),s=Ce()},m(i,l){B(e,i,l),C(i,t,l),a&&a.m(i,l),C(i,s,l),n=!0},p(i,l){let f={};l[0]&64&&(f.name=`Plan: ${i[6].plan}`),l[0]&4288|l[1]&134217728&&(f.$$scope={dirty:l,ctx:i}),e.$set(f),l[0]&128&&(r=!i[7].values()[0].active||i[7].values()[0].cancelAt),r?a?(a.p(i,l),l[0]&128&&k(a,1)):(a=Rb(i),a.c(),k(a,1),a.m(s.parentNode,s)):a&&(we(),P(a,1,1,()=>{a=null}),_e())},i(i){n||(k(e.$$.fragment,i),k(a),n=!0)},o(i){P(e.$$.fragment,i),P(a),n=!1},d(i){i&&(L(t),L(s)),N(e,i),a&&a.d(i)}}}function zA(o){let e,t,r;return{c(){e=T("button"),e.textContent="Upgrade",b(e,"class","mod-cta")},m(s,n){C(s,e,n),t||(r=re(e,"click",function(){ut((0,ht.debounce)(o[46]))&&(0,ht.debounce)(o[46]).apply(this,arguments)}),t=!0)},p(s,n){o=s},d(s){s&&L(e),t=!1,r()}}}function KA(o){let e,t=(o[6].cta||"Thanks for supporting Relay development <3")+"",r;return{c(){e=T("fragment"),r=z(t),b(e,"slot","description")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n[0]&64&&t!==(t=(s[6].cta||"Thanks for supporting Relay development <3")+"")&&se(r,t)},d(s){s&&L(e)}}}function Eb(o){let e,t,r;return{c(){e=T("button"),e.textContent="Cancel",b(e,"class","mod-destructive")},m(s,n){C(s,e,n),t||(r=re(e,"click",function(){ut((0,ht.debounce)(o[45]))&&(0,ht.debounce)(o[45]).apply(this,arguments)}),t=!0)},p(s,n){o=s},d(s){s&&L(e),t=!1,r()}}}function GA(o){let e,t,r=o[7].values()[0].active&&!o[7].values()[0].cancelAt,s,n,a,i=r&&Eb(o);return{c(){e=T("button"),e.textContent="Manage",t=U(),i&&i.c(),s=Ce()},m(l,f){C(l,e,f),C(l,t,f),i&&i.m(l,f),C(l,s,f),n||(a=re(e,"click",function(){ut((0,ht.debounce)(o[44]))&&(0,ht.debounce)(o[44]).apply(this,arguments)}),n=!0)},p(l,f){o=l,f[0]&128&&(r=o[7].values()[0].active&&!o[7].values()[0].cancelAt),r?i?i.p(o,f):(i=Eb(o),i.c(),i.m(s.parentNode,s)):i&&(i.d(1),i=null)},d(l){l&&(L(e),L(t),L(s)),i&&i.d(l),n=!1,a()}}}function jA(o){let e,t=o[6].cta+"",r;return{c(){e=T("fragment"),r=z(t),b(e,"slot","description")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n[0]&64&&t!==(t=s[6].cta+"")&&se(r,t)},d(s){s&&L(e)}}}function Rb(o){let e,t;return e=new Be({props:{description:"",$$slots:{name:[JA],default:[YA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&128|s[1]&134217728&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function YA(o){let e=o[15](o[7].values()[0].cancelAt)+"",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&128&&e!==(e=r[15](r[7].values()[0].cancelAt)+"")&&se(t,e)},d(r){r&&L(t)}}}function JA(o){let e;return{c(){e=T("span"),e.textContent="Status: Cancelled",b(e,"slot","name"),b(e,"class","mod-warning")},m(t,r){C(t,e,r)},p:J,d(t){t&&L(e)}}}function QA(o){let e,t;return e=new Ye({props:{name:"Storage"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p:J,i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function XA(o){let e,t,r,s,n,a,i,l,f,u,d,m;return e=new Ye({props:{name:"Storage"}}),r=new xb({props:{diskUsagePercentage:Math.round(o[13].usage*100/o[13].quota)}}),n=new Ht({props:{name:"Usage",description:"Storage for images, audio, video, etc",$$slots:{default:[ZA]},$$scope:{ctx:o}}}),i=new Ht({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[eF]},$$scope:{ctx:o}}}),f=new Ht({props:{name:"File size limit",description:"Maximum supported file size.",$$slots:{default:[tF]},$$scope:{ctx:o}}}),d=new Ye({props:{name:"Danger zone"}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),H(n.$$.fragment),a=U(),H(i.$$.fragment),l=U(),H(f.$$.fragment),u=U(),H(d.$$.fragment)},m(g,h){B(e,g,h),C(g,t,h),B(r,g,h),C(g,s,h),B(n,g,h),C(g,a,h),B(i,g,h),C(g,l,h),B(f,g,h),C(g,u,h),B(d,g,h),m=!0},p(g,h){let _={};h[0]&8192&&(_.diskUsagePercentage=Math.round(g[13].usage*100/g[13].quota)),r.$set(_);let w={};h[0]&8192|h[1]&134217728&&(w.$$scope={dirty:h,ctx:g}),n.$set(w);let v={};h[0]&8192|h[1]&134217728&&(v.$$scope={dirty:h,ctx:g}),i.$set(v);let M={};h[0]&8192|h[1]&134217728&&(M.$$scope={dirty:h,ctx:g}),f.$set(M)},i(g){m||(k(e.$$.fragment,g),k(r.$$.fragment,g),k(n.$$.fragment,g),k(i.$$.fragment,g),k(f.$$.fragment,g),k(d.$$.fragment,g),m=!0)},o(g){P(e.$$.fragment,g),P(r.$$.fragment,g),P(n.$$.fragment,g),P(i.$$.fragment,g),P(f.$$.fragment,g),P(d.$$.fragment,g),m=!1},d(g){g&&(L(t),L(s),L(a),L(l),L(u)),N(e,g),N(r,g),N(n,g),N(i,g),N(f,g),N(d,g)}}}function ZA(o){let e=ra(o[13].usage)+"",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&8192&&e!==(e=ra(r[13].usage)+"")&&se(t,e)},d(r){r&&L(t)}}}function eF(o){let e=ra(o[13].quota)+"",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&8192&&e!==(e=ra(r[13].quota)+"")&&se(t,e)},d(r){r&&L(t)}}}function tF(o){let e=ra(o[13].maxFileSize)+"",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&8192&&e!==(e=ra(r[13].maxFileSize)+"")&&se(t,e)},d(r){r&&L(t)}}}function rF(o){let e,t,r;return{c(){e=T("button"),e.textContent="Destroy",b(e,"class","mod-warning")},m(s,n){C(s,e,n),t||(r=re(e,"click",(0,ht.debounce)(o[29])),t=!0)},p:J,d(s){s&&L(e),t=!1,r()}}}function oF(o){let e,t;return{c(){e=T("button"),e.textContent="Destroy",e.disabled=t=!0,b(e,"class","mod-warning"),b(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,s){C(r,e,s)},p:J,d(r){r&&L(e)}}}function sF(o){let e,t;function r(a,i){return i[0]&128&&(e=null),e==null&&(e=a[7].values().length>0&&!a[7].values()[0].cancelAt),e?oF:rF}let s=r(o,[-1,-1]),n=s(o);return{c(){n.c(),t=Ce()},m(a,i){n.m(a,i),C(a,t,i)},p(a,i){s===(s=r(a,i))&&n?n.p(a,i):(n.d(1),n=s(a),n&&(n.c(),n.m(t.parentNode,t)))},d(a){a&&L(t),n.d(a)}}}function nF(o){let e,t,r,s,n,a,i,l,f,u,d,m,g,h,_,w,v,M,R;e=new fc({props:{category:ms,categoryText:"Relay Servers",$$slots:{default:[LA]},$$scope:{ctx:o}}}),e.$on("goBack",o[25]);let D=o[0].owner&&Ab(o);s=new Ye({props:{name:"Folders on this Relay Server"}});let E=De(o[9].values()),O=[];for(let W=0;W<E.length;W+=1)O[W]=Fb(Pb(o,E,W));let A=W=>P(O[W],1,1,()=>{O[W]=null});i=new Be({props:{description:"",name:"",$$slots:{default:[OA]},$$scope:{ctx:o}}}),f=new Ye({props:{name:"Users",$$slots:{default:[UA]},$$scope:{ctx:o}}});let F=De(o[11].values().sort(Ob)),V=[];for(let W=0;W<F.length;W+=1)V[W]=Mb(Tb(o,F,W));let q=W=>P(V[W],1,1,()=>{V[W]=null});m=new Ye({props:{name:"Sharing"}}),h=new Be({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[BA]},$$scope:{ctx:o}}});let Z=[HA,NA],j=[];function K(W,te){return W[6].owner?0:1}return w=K(o,[-1,-1]),v=j[w]=Z[w](o),{c(){H(e.$$.fragment),t=U(),D&&D.c(),r=U(),H(s.$$.fragment),n=U();for(let W=0;W<O.length;W+=1)O[W].c();a=U(),H(i.$$.fragment),l=U(),H(f.$$.fragment),u=U();for(let W=0;W<V.length;W+=1)V[W].c();d=U(),H(m.$$.fragment),g=U(),H(h.$$.fragment),_=U(),v.c(),M=Ce()},m(W,te){B(e,W,te),C(W,t,te),D&&D.m(W,te),C(W,r,te),B(s,W,te),C(W,n,te);for(let Te=0;Te<O.length;Te+=1)O[Te]&&O[Te].m(W,te);C(W,a,te),B(i,W,te),C(W,l,te),B(f,W,te),C(W,u,te);for(let Te=0;Te<V.length;Te+=1)V[Te]&&V[Te].m(W,te);C(W,d,te),B(m,W,te),C(W,g,te),B(h,W,te),C(W,_,te),j[w].m(W,te),C(W,M,te),R=!0},p(W,te){let Te={};if(te[0]&1|te[1]&134217728&&(Te.$$scope={dirty:te,ctx:W}),e.$set(Te),W[0].owner?D?(D.p(W,te),te[0]&1&&k(D,1)):(D=Ab(W),D.c(),k(D,1),D.m(r.parentNode,r)):D&&(we(),P(D,1,1,()=>{D=null}),_e()),te[0]&134219264|te[1]&1){E=De(W[9].values());let pe;for(pe=0;pe<E.length;pe+=1){let fe=Pb(W,E,pe);O[pe]?(O[pe].p(fe,te),k(O[pe],1)):(O[pe]=Fb(fe),O[pe].c(),k(O[pe],1),O[pe].m(a.parentNode,a))}for(we(),pe=E.length;pe<O.length;pe+=1)A(pe);_e()}let ie={};te[1]&134217728&&(ie.$$scope={dirty:te,ctx:W}),i.$set(ie);let Pe={};if(te[0]&2112|te[1]&134217728&&(Pe.$$scope={dirty:te,ctx:W}),f.$set(Pe),te[0]&1073743936){F=De(W[11].values().sort(Ob));let pe;for(pe=0;pe<F.length;pe+=1){let fe=Tb(W,F,pe);V[pe]?(V[pe].p(fe,te),k(V[pe],1)):(V[pe]=Mb(fe),V[pe].c(),k(V[pe],1),V[pe].m(d.parentNode,d))}for(we(),pe=F.length;pe<V.length;pe+=1)q(pe);_e()}let Ke={};te[0]&16|te[1]&134217728&&(Ke.$$scope={dirty:te,ctx:W}),h.$set(Ke);let Oe=w;w=K(W,te),w===Oe?j[w].p(W,te):(we(),P(j[Oe],1,1,()=>{j[Oe]=null}),_e(),v=j[w],v?v.p(W,te):(v=j[w]=Z[w](W),v.c()),k(v,1),v.m(M.parentNode,M))},i(W){if(!R){k(e.$$.fragment,W),k(D),k(s.$$.fragment,W);for(let te=0;te<E.length;te+=1)k(O[te]);k(i.$$.fragment,W),k(f.$$.fragment,W);for(let te=0;te<F.length;te+=1)k(V[te]);k(m.$$.fragment,W),k(h.$$.fragment,W),k(v),R=!0}},o(W){P(e.$$.fragment,W),P(D),P(s.$$.fragment,W),O=O.filter(Boolean);for(let te=0;te<O.length;te+=1)P(O[te]);P(i.$$.fragment,W),P(f.$$.fragment,W),V=V.filter(Boolean);for(let te=0;te<V.length;te+=1)P(V[te]);P(m.$$.fragment,W),P(h.$$.fragment,W),P(v),R=!1},d(W){W&&(L(t),L(r),L(n),L(a),L(l),L(u),L(d),L(g),L(_),L(M)),N(e,W),D&&D.d(W),N(s,W),tt(O,W),N(i,W),N(f,W),tt(V,W),N(m,W),N(h,W),j[w].d(W)}}}function ra(o,e=2){if(o===0)return"0 MB";let t=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.floor(Math.log(o)/Math.log(t));return(o/Math.pow(t,s)).toFixed(e)+" "+r[s]}function Ob(o,e){return o.role==="Owner"&&e.role!=="Owner"?-1:o.role!=="Owner"&&e.role==="Owner"||o.user.name>e.user.name?1:-1}function aF(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function iF(o,e,t){let r,s,n=J,a=()=>(n(),n=rr(A,le=>t(48,s=le)),A),i,l=J,f=()=>(l(),l=rr(R,le=>t(6,i=le)),R),u,d,m,g,h=J,_=()=>(h(),h=rr(O,le=>t(10,g=le)),O),w,v,M;o.$$.on_destroy.push(()=>n()),o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>h());let{relay:R}=e;f();let D=R.folders;me(o,D,le=>t(9,m=le));let{plugin:E}=e,{sharedFolders:O}=e;_();let{relayRoles:A}=e;a();function F(le){if(!le)return"Active";let Me=(0,qp.default)(),vt=(0,qp.default)(le).diff(Me,"days");return vt<=0?"Subscription has ended":vt===1?"Active for 1 more day":`Active for ${vt} more days`}let V=i.subscriptions;me(o,V,le=>t(7,u=le));let q=co(u,le=>{if(le.values().length===0)return;let Me=le.values()[0];return Me.token||E.relayManager.getSubscriptionToken(Me).then(ke=>{Me.token=ke}),Me});me(o,q,le=>t(12,v=le));let Z=i.storageQuota;me(o,Z,le=>t(13,M=le));let j=s.filter(le=>le.relayId===R.id);me(o,j,le=>t(11,w=le));let K=ve(!0);me(o,K,le=>t(5,r=le));let W;sr(()=>{W&&W.value===""&&W.focus()});let te=Nt();function Te(le){return Ge(this,void 0,void 0,function*(){var Me;if(!(!((Me=E.loginManager)===null||Me===void 0)&&Me.user))return;let ke={relay:le.id,quantity:10,user_email:E.loginManager.user.email},vt=btoa(JSON.stringify(ke)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(E.buildApiUrl(`/subscribe/${vt}`),"_blank")})}function ie(le){return Ge(this,void 0,void 0,function*(){let Me=le.token,ke=le.id;window.open(E.buildApiUrl(`/subscriptions/${ke}/manage?token=${Me}`),"_blank")})}function Pe(le){return Ge(this,void 0,void 0,function*(){let Me=le.token,ke=le.id;window.open(E.buildApiUrl(`/subscriptions/${ke}/cancel?token=${Me}`),"_blank")})}function Ke(){return Ge(this,void 0,void 0,function*(){E.relayManager.leaveRelay(R),te("goBack",{clear:!0})})}function Oe(){return Ge(this,void 0,void 0,function*(){te("goBack",{clear:!0})})}let pe;E.relayManager.getRelayInvitationKey(R).then(le=>{t(4,pe=le)});function fe(le,Me,ke){return Ge(this,void 0,void 0,function*(){let vt=(0,ht.normalizePath)((0,Ub.join)(ke,Me));E.vault.getFolderByPath(vt)===null&&(yield E.vault.createFolder(vt));let Lr=E.sharedFolders.new(vt,le.guid,R.guid,!0);return Lr.remote=le,E.sharedFolders.notifyListeners(),Lr})}let oe=ve(!1);me(o,oe,le=>t(8,d=le));let Ne=E.timeProvider.debounce(()=>{E.relayManager.updateRelay(R).then(()=>{oe.set(!1)})},500),It=le=>{new mc(E.app,O,le,fe).open()};function Wt(){K.set(aF(W.value)),r&&W.value!==""&&(oe.set(!0),Ne())}function zt(){E.relayManager.destroyRelay(R),te("goBack",{})}function dt(le){E.relayManager.kick(le)}function gt(le,Me){le&&te("manageSharedFolder",{folder:le,relay:Me,mount:!1})}function pt(le){let Me=le.target;Me.focus(),Me.select(),navigator.clipboard.writeText(Me.value).then(()=>new ht.Notice("Invite link copied")).catch(ke=>{})}let Kt=new uc(E.app,O,le=>Ge(void 0,void 0,void 0,function*(){let Me=(0,ht.normalizePath)(le),ke=O.find(xs=>xs.path==le);if(ke){let xs=yield E.relayManager.createRemoteFolder(ke,R);ke.remote=xs,ke.connect(),E.sharedFolders.notifyListeners();return}E.vault.getFolderByPath(Me)===null&&(yield E.vault.createFolder(Me));let vt=yn(),Lr=E.sharedFolders.new((0,ht.normalizePath)(le),vt,R.guid,!0),Js=yield E.relayManager.createRemoteFolder(Lr,R);Lr.remote=Js,E.sharedFolders.notifyListeners()})),gs=(le,Me)=>Me.remote===le;function js(){R.name=this.value,f(t(0,R))}function aa(le){Er[le?"unshift":"push"](()=>{W=le,t(3,W)})}let ia=(le,Me)=>Me.remote===le;function Ys(le){Gr.call(this,o,le)}let la=le=>{let Me=g.find(ke=>ke.remote===le);Me&&gt(Me,le.relay)},Ir=le=>{It(le)},st=()=>{Kt.open()},Gt=le=>{dt(le)},mo=()=>{ie(v)},ys=()=>{Pe(v)},_t=()=>{Te(i)},ca=()=>{Ke()};return o.$$set=le=>{"relay"in le&&f(t(0,R=le.relay)),"plugin"in le&&t(34,E=le.plugin),"sharedFolders"in le&&_(t(1,O=le.sharedFolders)),"relayRoles"in le&&a(t(2,A=le.relayRoles))},[R,O,A,W,pe,r,i,u,d,m,g,w,v,M,D,F,V,q,Z,j,K,Te,ie,Pe,Ke,Oe,oe,It,Wt,zt,dt,gt,pt,Kt,E,gs,js,aa,ia,Ys,la,Ir,st,Gt,mo,ys,_t,ca]}var Wp=class extends X{constructor(e){super(),ee(this,e,iF,nF,Q,{relay:0,plugin:34,sharedFolders:1,relayRoles:2},SA,[-1,-1])}},oa=Wp;function lF(o){let e,t,r,s,n,a;return r=new ad({}),{c(){e=T("div"),t=T("div"),H(r.$$.fragment),b(t,"class","clickable-icon"),b(t,"aria-label","Back"),b(t,"tabindex","0"),b(t,"role","button"),b(e,"class","modal-setting-nav-bar")},m(i,l){C(i,e,l),S(e,t),B(r,t,null),s=!0,n||(a=[re(t,"click",o[0]),re(t,"keypress",o[1])],n=!0)},p:J,i(i){s||(k(r.$$.fragment,i),s=!0)},o(i){P(r.$$.fragment,i),s=!1},d(i){i&&L(e),N(r),n=!1,Ie(a)}}}function cF(o){let e=Nt();function t(){e("goBack",{})}function r(s){s.key==="Escape"&&(e("goBack",{}),s.stopPropagation())}return[t,r]}var zp=class extends X{constructor(e){super(),ee(this,e,cF,lF,Q,{})}},$b=zp;var sa=require("obsidian");function Bb(o,e,t){let r=o.slice();return r[28]=e[t][0],r[29]=e[t][1],r}function fF(o){let e=o[1].name+"",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&2&&e!==(e=r[1].name+"")&&se(t,e)},d(r){r&&L(t)}}}function uF(o){let e,t;return e=new Be({props:{description:"This folder is tracking edits, but is not connected to a Relay Server."}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p:J,i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function dF(o){let e,t;return e=new Ht({props:{$$slots:{name:[hF],default:[pF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&64|s[1]&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function pF(o){let e,t;return e=new Ws({}),e.$on("settings",function(){ut((0,sa.debounce)(o[19]))&&(0,sa.debounce)(o[19]).apply(this,arguments)}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){o=r},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function mF(o){let e=o[6].name+"",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&64&&e!==(e=r[6].name+"")&&se(t,e)},d(r){r&&L(t)}}}function hF(o){let e,t;return e=new ms({props:{slot:"name",relay:o[6],$$slots:{default:[mF]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[18]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&64&&(n.relay=r[6]),s[0]&64|s[1]&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Nb(o){let e,t,r,s;e=new Ye({props:{name:"Sync Settings"}});let n=De(o[4]),a=[];for(let l=0;l<n.length;l+=1)a[l]=Hb(Bb(o,n,l));let i=l=>P(a[l],1,1,()=>{a[l]=null});return{c(){H(e.$$.fragment),t=U();for(let l=0;l<a.length;l+=1)a[l].c();r=Ce()},m(l,f){B(e,l,f),C(l,t,f);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,f);C(l,r,f),s=!0},p(l,f){if(f[0]&2200){n=De(l[4]);let u;for(u=0;u<n.length;u+=1){let d=Bb(l,n,u);a[u]?(a[u].p(d,f),k(a[u],1)):(a[u]=Hb(d),a[u].c(),k(a[u],1),a[u].m(r.parentNode,r))}for(we(),u=n.length;u<a.length;u+=1)i(u);_e()}},i(l){if(!s){k(e.$$.fragment,l);for(let f=0;f<n.length;f+=1)k(a[f]);s=!0}},o(l){P(e.$$.fragment,l),a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)P(a[f]);s=!1},d(l){l&&(L(t),L(r)),N(e,l),tt(a,l)}}}function gF(o){let e,t,r,s,n,a,i,l,f,u;function d(...h){return o[20](o[28],...h)}function m(){return o[21](o[28])}function g(){return o[22](o[28])}return{c(){e=T("div"),t=T("div"),r=T("input"),n=U(),a=T("div"),l=U(),b(r,"type","checkbox"),r.checked=s=o[7][o[28]],r.disabled=o[3],b(a,"class","checkbox-toggle"),b(t,"role","checkbox"),b(t,"aria-checked",i=o[7][o[28]]),b(t,"tabindex","0"),b(t,"class","checkbox-container"),qe(t,"is-enabled",o[7][o[28]]),b(e,"class","setting-item-control")},m(h,_){C(h,e,_),S(e,t),S(t,r),S(t,n),S(t,a),C(h,l,_),f||(u=[re(r,"change",d),re(t,"keypress",m),re(t,"click",g)],f=!0)},p(h,_){o=h,_[0]&144&&s!==(s=o[7][o[28]])&&(r.checked=s),_[0]&8&&(r.disabled=o[3]),_[0]&144&&i!==(i=o[7][o[28]])&&b(t,"aria-checked",i),_[0]&144&&qe(t,"is-enabled",o[7][o[28]])},d(h){h&&(L(e),L(l)),f=!1,Ie(u)}}}function Hb(o){let e,t;return e=new Be({props:{name:o[29].name,description:o[29].description,$$slots:{default:[gF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&16&&(n.name=r[29].name),s[0]&16&&(n.description=r[29].description),s[0]&152|s[1]&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function yF(o){let e,t,r;return{c(){e=T("button"),e.textContent="Delete local",b(e,"class","mod-warning")},m(s,n){C(s,e,n),t||(r=re(e,"click",(0,sa.debounce)(o[23])),t=!0)},p:J,d(s){s&&L(e),t=!1,r()}}}function xF(o){let e,t,r,s,n,a,i;return{c(){e=T("button"),t=z("Delete metadata"),b(e,"class",r=o[6]?"mod-disabled":"mod-warning"),e.disabled=s=!!o[6],b(e,"aria-label",n=o[6]?"Metadata is required for sharing.":"")},m(l,f){C(l,e,f),S(e,t),a||(i=re(e,"click",(0,sa.debounce)(o[24])),a=!0)},p(l,f){f[0]&64&&r!==(r=l[6]?"mod-disabled":"mod-warning")&&b(e,"class",r),f[0]&64&&s!==(s=!!l[6])&&(e.disabled=s),f[0]&64&&n!==(n=l[6]?"Metadata is required for sharing.":"")&&b(e,"aria-label",n)},d(l){l&&L(e),a=!1,i()}}}function Vb(o){var s,n,a,i,l;let e,t,r=(((s=o[6])==null?void 0:s.owner)||((i=(a=(n=o[5])==null?void 0:n.remote)==null?void 0:a.creator)==null?void 0:i.id)===((l=o[0].relayManager.user)==null?void 0:l.id))&&qb(o);return{c(){r&&r.c(),e=Ce()},m(f,u){r&&r.m(f,u),C(f,e,u),t=!0},p(f,u){var d,m,g,h,_;(d=f[6])!=null&&d.owner||((h=(g=(m=f[5])==null?void 0:m.remote)==null?void 0:g.creator)==null?void 0:h.id)===((_=f[0].relayManager.user)==null?void 0:_.id)?r?(r.p(f,u),u[0]&97&&k(r,1)):(r=qb(f),r.c(),k(r,1),r.m(e.parentNode,e)):r&&(we(),P(r,1,1,()=>{r=null}),_e())},i(f){t||(k(r),t=!0)},o(f){P(r),t=!1},d(f){f&&L(e),r&&r.d(f)}}}function qb(o){let e,t,r,s;return e=new Ye({props:{name:"Remote Folder"}}),r=new Be({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[bF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment)},m(n,a){B(e,n,a),C(n,t,a),B(r,n,a),s=!0},p(n,a){let i={};a[1]&2&&(i.$$scope={dirty:a,ctx:n}),r.$set(i)},i(n){s||(k(e.$$.fragment,n),k(r.$$.fragment,n),s=!0)},o(n){P(e.$$.fragment,n),P(r.$$.fragment,n),s=!1},d(n){n&&L(t),N(e,n),N(r,n)}}}function bF(o){let e,t,r;return{c(){e=T("button"),e.textContent="Delete remote",b(e,"class","mod-destructive")},m(s,n){C(s,e,n),t||(r=re(e,"click",(0,sa.debounce)(o[14])),t=!0)},p:J,d(s){s&&L(e),t=!1,r()}}}function wF(o){let e,t,r,s,n,a,i,l=o[6]&&et().enableAttachmentSync,f,u,d,m,g,h,_,w,v;e=new fc({props:{category:fo,categoryText:"Shared Folders",$$slots:{default:[fF]},$$scope:{ctx:o}}}),e.$on("goBack",o[12]),r=new Ye({props:{name:"Relay Server"}});let M=[dF,uF],R=[];function D(A,F){return A[6]?0:1}n=D(o,[-1,-1]),a=R[n]=M[n](o);let E=l&&Nb(o);u=new Ye({props:{name:"Local folder"}}),m=new Be({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[yF]},$$scope:{ctx:o}}}),h=new Be({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[xF]},$$scope:{ctx:o}}});let O=o[6]&&Vb(o);return{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),a.c(),i=U(),E&&E.c(),f=U(),H(u.$$.fragment),d=U(),H(m.$$.fragment),g=U(),H(h.$$.fragment),_=U(),O&&O.c(),w=Ce()},m(A,F){B(e,A,F),C(A,t,F),B(r,A,F),C(A,s,F),R[n].m(A,F),C(A,i,F),E&&E.m(A,F),C(A,f,F),B(u,A,F),C(A,d,F),B(m,A,F),C(A,g,F),B(h,A,F),C(A,_,F),O&&O.m(A,F),C(A,w,F),v=!0},p(A,F){let V={};F[0]&2|F[1]&2&&(V.$$scope={dirty:F,ctx:A}),e.$set(V);let q=n;n=D(A,F),n===q?R[n].p(A,F):(we(),P(R[q],1,1,()=>{R[q]=null}),_e(),a=R[n],a?a.p(A,F):(a=R[n]=M[n](A),a.c()),k(a,1),a.m(i.parentNode,i)),F[0]&64&&(l=A[6]&&et().enableAttachmentSync),l?E?(E.p(A,F),F[0]&64&&k(E,1)):(E=Nb(A),E.c(),k(E,1),E.m(f.parentNode,f)):E&&(we(),P(E,1,1,()=>{E=null}),_e());let Z={};F[1]&2&&(Z.$$scope={dirty:F,ctx:A}),m.$set(Z);let j={};F[0]&64|F[1]&2&&(j.$$scope={dirty:F,ctx:A}),h.$set(j),A[6]?O?(O.p(A,F),F[0]&64&&k(O,1)):(O=Vb(A),O.c(),k(O,1),O.m(w.parentNode,w)):O&&(we(),P(O,1,1,()=>{O=null}),_e())},i(A){v||(k(e.$$.fragment,A),k(r.$$.fragment,A),k(a),k(E),k(u.$$.fragment,A),k(m.$$.fragment,A),k(h.$$.fragment,A),k(O),v=!0)},o(A){P(e.$$.fragment,A),P(r.$$.fragment,A),P(a),P(E),P(u.$$.fragment,A),P(m.$$.fragment,A),P(h.$$.fragment,A),P(O),v=!1},d(A){A&&(L(t),L(s),L(i),L(f),L(d),L(g),L(_),L(w)),N(e,A),N(r,A),R[n].d(A),E&&E.d(A),N(u,A),N(m,A),N(h,A),O&&O.d(A)}}}function _F(o,e,t){let r,s,n,a=J,i=()=>(a(),a=rr(m,ie=>t(25,n=ie)),m),l,f;o.$$.on_destroy.push(()=>a());let{plugin:u}=e,{sharedFolder:d}=e,{sharedFolders:m}=e;i();let{relayRoles:g}=e,h=co(n,ie=>ie.find(Pe=>Pe===d));me(o,h,ie=>t(5,s=ie));let _=d.syncSettingsManager;me(o,_,ie=>t(7,f=ie));let w=co([h,g],([ie,Pe])=>{var Ke;return(Ke=Pe.find(Oe=>{var pe;return Oe.relay===((pe=ie==null?void 0:ie.remote)===null||pe===void 0?void 0:pe.relay)}))===null||Ke===void 0?void 0:Ke.relay});me(o,w,ie=>t(6,l=ie));let v=!1;function M(ie,Pe){return Ge(this,void 0,void 0,function*(){if(!v){t(3,v=!0);try{yield _.toggleCategory(ie,Pe),t(4,r=Object.entries(_.getCategories()))}catch(Ke){}finally{t(3,v=!1)}}})}let R;sr(()=>{!d&&R&&R.value===""&&R.focus()});let D=Nt();function E(){return Ge(this,void 0,void 0,function*(){D("goBack",{clear:!0})})}function O(ie){ie&&D("manageRelay",{relay:ie})}function A(){return Ge(this,void 0,void 0,function*(){yield u.relayManager.deleteRemote(d),u.sharedFolders.notifyListeners()})}function F(){return Ge(this,void 0,void 0,function*(){s&&u.sharedFolders.delete(s),D("goBack",{clear:!0})})}function V(){let ie=u.vault.getFolderByPath(d.path);ie&&u.app.vault.trash(ie,!1),D("goBack",{})}function q(ie){Gr.call(this,o,ie)}let Z=()=>{O(l)},j=(ie,Pe)=>M(ie,Pe.currentTarget.checked),K=ie=>M(ie,!f[ie]),W=ie=>M(ie,!f[ie]),te=()=>{V()},Te=()=>{F()};o.$$set=ie=>{"plugin"in ie&&t(0,u=ie.plugin),"sharedFolder"in ie&&t(1,d=ie.sharedFolder),"sharedFolders"in ie&&i(t(2,m=ie.sharedFolders)),"relayRoles"in ie&&t(17,g=ie.relayRoles)};e:t(4,r=Object.entries(_.getCategories()));return[u,d,m,v,r,s,l,f,h,_,w,M,E,O,A,F,V,g,q,Z,j,K,W,te,Te]}var Kp=class extends X{constructor(e){super(),ee(this,e,_F,wF,Q,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:17},null,[-1,-1])}},Gp=Kp;function vF(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function SF(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let s=o[r];switch(t){case"NORMAL":s.type==="TEXT"?e+=s.value:s.type==="STAR"?(t="EMPHASIS",e+="<u>"):s.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":s.type==="TEXT"?e+=s.value:s.type==="STAR"?(t="NORMAL",e+="</u>"):s.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":s.type==="TEXT"?e+=s.value:s.type==="STAR"?e+="*":s.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function jp(o){let e=vF(o);return SF(e)}function kF(o){Fe(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function IF(o){let e,t,r,s,n=o[0].networkStatus.status&&Wb(o);return{c(){e=T("div"),t=T("span"),n&&n.c(),b(t,"class","system3-announcement svelte-d22j3"),de(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),b(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),b(e,"role","button"),b(e,"tabindex","0"),de(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(a,i){C(a,e,i),S(e,t),n&&n.m(t,null),r||(s=[re(e,"click",o[17]),re(e,"keypress",o[18])],r=!0)},p(a,i){a[0].networkStatus.status?n?n.p(a,i):(n=Wb(a),n.c(),n.m(t,null)):n&&(n.d(1),n=null),i&1&&de(t,"color",a[0].networkStatus.status.color?a[0].networkStatus.status.color:"var(--text-on-accent)",1),i&1&&de(e,"background-color",a[0].networkStatus.status.backgroundColor?a[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:J,o:J,d(a){a&&L(e),n&&n.d(),r=!1,Ie(s)}}}function LF(o){let e,t;return e=new $b({}),e.$on("goBack",o[9]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p:J,i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Wb(o){let e,t=jp(o[0].networkStatus.status.status)+"",r;return{c(){e=new Vn(!1),r=Ce(),e.a=r},m(s,n){e.m(t,s,n),C(s,r,n)},p(s,n){n&1&&t!==(t=jp(s[0].networkStatus.status.status)+"")&&e.p(t)},d(s){s&&(L(r),e.d())}}}function CF(o){let e,t;return e=new rb({props:{plugin:o[0],$$slots:{default:[AF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&8388609&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function TF(o){let e,t;return e=new oa({props:{plugin:o[0],relayRoles:o[3],relay:o[2],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageSharedFolder",o[7]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&4&&(n.relay=r[2]),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function PF(o){let e,t;return e=new Gp({props:{plugin:o[0],relayRoles:o[3],sharedFolder:o[1],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageRelay",o[6]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&2&&(n.sharedFolder=r[1]),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function AF(o){let e,t;return e=new uo({props:{relays:o[4],plugin:o[0]}}),e.$on("manageRelay",o[6]),e.$on("manageSharedFolder",o[7]),e.$on("createRelay",o[8]),e.$on("joinRelay",o[11]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function zb(o){let e,t=o[0].version+"",r;return{c(){e=T("span"),r=z(t),b(e,"class","relay-version svelte-d22j3")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n&1&&t!==(t=s[0].version+"")&&se(r,t)},d(s){s&&L(e)}}}function FF(o){let e,t,r,s,n,a,i,l,f,u=[LF,IF],d=[];function m(v,M){return v[2]||v[1]?0:v[0].networkStatus.status?1:-1}~(e=m(o,-1))&&(t=d[e]=u[e](o));let g=[PF,TF,CF],h=[];function _(v,M){return v[1]?0:v[2]?1:2}n=_(o,-1),a=h[n]=g[n](o);let w=o[0].manifest.version!==o[0].version&&zb(o);return{c(){t&&t.c(),r=U(),s=T("div"),a.c(),i=U(),w&&w.c(),l=Ce(),b(s,"class","vertical-tab-content svelte-d22j3")},m(v,M){~e&&d[e].m(v,M),C(v,r,M),C(v,s,M),h[n].m(s,null),C(v,i,M),w&&w.m(v,M),C(v,l,M),f=!0},p(v,[M]){let R=e;e=m(v,M),e===R?~e&&d[e].p(v,M):(t&&(we(),P(d[R],1,1,()=>{d[R]=null}),_e()),~e?(t=d[e],t?t.p(v,M):(t=d[e]=u[e](v),t.c()),k(t,1),t.m(r.parentNode,r)):t=null);let D=n;n=_(v,M),n===D?h[n].p(v,M):(we(),P(h[D],1,1,()=>{h[D]=null}),_e(),a=h[n],a?a.p(v,M):(a=h[n]=g[n](v),a.c()),k(a,1),a.m(s,null)),v[0].manifest.version!==v[0].version?w?w.p(v,M):(w=zb(v),w.c(),w.m(l.parentNode,l)):w&&(w.d(1),w=null)},i(v){f||(k(t),k(a),f=!0)},o(v){P(t),P(a),f=!1},d(v){v&&(L(r),L(s),L(i),L(l)),~e&&d[e].d(v),h[n].d(),w&&w.d(v)}}}function DF(o,e,t){let r,{plugin:s}=e,{path:n=void 0}=e,a=s.app,i=s.relayManager,l=i.relayRoles,f=i.relays;me(o,f,q=>t(16,r=q));let u=s.sharedFolders,d,m=uo,g,h=[{component:uo}],{close:_}=e;function w(q){if(t(2,g=void 0),t(1,d=void 0),q==="/"){t(15,m=uo);return}let Z=new URLSearchParams(q.split("?")[1]||""),j=Z.get("id");if(q.startsWith("/relays")){j?(t(2,g=i.relays.find(K=>K.guid===j)),t(15,m=oa)):t(15,m=uo);return}if(q.startsWith("/shared-folders")){if(j){t(1,d=u.find(W=>W.guid===j));let K=Z.get("relay");K&&t(2,g=i.relays.get(K)),t(15,m=Gp)}return}}function v(q){h.push({currentRelay:g,sharedFolder:d,component:m}),t(2,g=q.detail.relay),t(1,d=void 0),t(15,m=oa)}function M(q){h.push({currentRelay:g,sharedFolder:d,component:m}),t(1,d=q.detail.folder),t(2,g=q.detail.relay)}function R(q){return Ge(this,void 0,void 0,function*(){h.push({currentRelay:g,sharedFolder:d,component:m}),t(2,g=yield s.relayManager.createRelay("")),t(15,m=oa)})}function D(q){if(q.detail.clear){h.length=0,t(2,g=void 0),t(1,d=void 0),t(15,m=uo);return}let Z=h.pop();if(Z)for(;Z;){if(!Z.currentRelay&&!Z.sharedFolder)t(2,g=Z.currentRelay),t(1,d=Z.sharedFolder),t(15,m=Z.component);else if(Z.sharedFolder&&u.has(Z.sharedFolder)){t(2,g=Z.currentRelay),t(1,d=Z.sharedFolder),t(15,m=Z.component);break}else if(Z.currentRelay&&i.relays.get(Z.currentRelay.id)){t(2,g=Z.currentRelay),t(1,d=Z.sharedFolder),t(15,m=Z.component);break}Z=h.pop()}else t(2,g=void 0),t(1,d=void 0),t(15,m=uo)}function E(q){h.length=0,_()}function O(q){t(2,g=q.detail.relay),t(15,m=oa)}function A(){var q;!((q=s.networkStatus.status)===null||q===void 0)&&q.versions&&(s.releaseSettings.get().channel==="stable"?s.installVersion(s.networkStatus.status.versions.stable):s.releaseSettings.get().channel==="beta"&&s.installVersion(s.networkStatus.status.versions.beta))}let F=()=>{var q,Z;(q=s.networkStatus.status)!=null&&q.versions?A():(Z=s.networkStatus.status)!=null&&Z.link&&window.open(s.networkStatus.status.link)},V=()=>{var q,Z;(q=s.networkStatus.status)!=null&&q.versions?A():(Z=s.networkStatus.status)!=null&&Z.link&&window.open(s.networkStatus.status.link)};return o.$$set=q=>{"plugin"in q&&t(0,s=q.plugin),"path"in q&&t(13,n=q.path),"close"in q&&t(14,_=q.close)},o.$$.update=()=>{if(o.$$.dirty&8192){e:n&&w(n)}if(o.$$.dirty&65540){e:g&&!r.has(g.id)&&(t(2,g=void 0),t(15,m=uo))}if(o.$$.dirty&2){e:d&&!u.has(d)&&(t(1,d=void 0),t(15,m=uo))}if(o.$$.dirty&32774){e:(m||g||d)&&setTimeout(()=>{let q=document.querySelector(".vertical-tab-content");q&&(q.scrollTop=0)},0)}},[s,d,g,l,f,u,v,M,R,D,E,O,A,n,_,m,r,F,V]}var Yp=class extends X{constructor(e){super(),ee(this,e,DF,FF,Q,{plugin:0,path:13,close:14},kF)}},Kb=Yp;var hc=class extends Gb.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new Kb({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(t){var r;(r=this.component)==null||r.$set({path:t})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var Jp=require("obsidian");var gc=class extends Ja{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(s){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let s=r;typeof r!="string"&&(s=JSON.stringify(r)),window.localStorage.setItem(t,s)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var yc=class extends it{constructor(t,r,s,n){var i;super();this.beforeLogin=n;let a=Ae("[Pocketbase]","debug");this.authStore=new gc(`pocketbase_auth_${t}`),this.pb=new Bn("https://auth.system3.md",this.authStore),this.pb.beforeSend=(l,f)=>(a(l,f),f.fetch=Pt,f.headers=Object.assign({},f.headers,{"Relay-Version":"0.5.1"}),{url:l,options:f}),this.refreshToken(),s.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(i=this.pb.authStore.model)!=null&&i.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).then(()=>{this.getFlags()}).catch(l=>{l.status===404&&this.logout()}),Et.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,s]=r.split("."),n=JSON.parse(atob(s)),a=new Date(n.exp*1e3),i=new Date,l=Math.ceil((a.getTime()-i.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:a.toLocaleString(),expiresIn:`${l} days`,userId:n.id,email:n.email})}))}setup(t){var r,s;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(r=t==null?void 0:t.meta)==null?void 0:r.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(s=t.meta)==null?void 0:s.rawUser}).then(()=>{this.notifyListeners()}).catch(n=>{this.log(n)}),!0):(this.notifyListeners(),!1)}getFlags(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,Jp.requestUrl)({url:"https://api.system3.md/flags",method:"GET",headers:t}).then(r=>{if(r.status===200){let s=r.json;Rt.getInstance().applyServerFlags(s)}}).catch(r=>{this.log(r)})}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,Jp.requestUrl)({url:"https://api.system3.md/whoami",method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}get hasUser(){return this.user!==void 0}makeUser(t,r){var s,n,a,i;return new lc((s=t.model)==null?void 0:s.id,((n=t.model)==null?void 0:n.name)||(r==null?void 0:r.name),(a=t.model)==null?void 0:a.email,((i=t.model)==null?void 0:i.picture)||(r==null?void 0:r.picture),t.token)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}webviewIntercept(){let t=this.pb.buildUrl("/api/oauth2-redirect"),r="https:\\/\\/accounts\\.google\\.com\\/o\\/oauth2\\/auth";return new RegExp(`^${r}.*?[?&]redirect_uri=${encodeURIComponent(t)}`,"i")}async initiateManualOAuth2CodeFlow(t){this.beforeLogin();let s=(await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError})).authProviders[0],n=this.pb.buildUrl("/api/oauth2-redirect");return[s.authUrl+n,s,async a=>this.pb.collection("users").authWithOAuth2Code(s.name,a,s.codeVerifier,n,{fetch:t}).then(i=>(this.setup(i),i))]}async poll(t,r){let s=0,n=1e3;return new Promise((a,i)=>{let l=setInterval(()=>{if(s+=1,s>=30)return clearInterval(l),i(new Error(`Auth timeout: Timed out after ${s*n/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.state.slice(0,15)).then(f=>{if(f)return clearInterval(l),a(r(f.code))}).catch(f=>{})},n)})}async login(){this.beforeLogin();let t=await this.pb.collection("users").authWithOAuth2({provider:"google"});return this.setup(t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,s)=>{let n=()=>{this.loggedIn&&(this.off(n),r(!0)),r(!1)};this.on(n)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};var Vt=crypto;var po=new TextEncoder,Sr=new TextDecoder,YH=2**32;var jb=o=>{let e=o;typeof e=="string"&&(e=po.encode(e));let t=32768,r=[];for(let s=0;s<e.length;s+=t)r.push(String.fromCharCode.apply(null,e.subarray(s,s+t)));return btoa(r.join(""))},jr=o=>jb(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Yb=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},zs=o=>{let e=o;e instanceof Uint8Array&&(e=Sr.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Yb(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var Qp={};lf(Qp,{JOSEAlgNotAllowed:()=>pi,JOSEError:()=>Ot,JOSENotSupported:()=>wt,JWEDecryptionFailed:()=>mi,JWEInvalid:()=>kr,JWKInvalid:()=>bc,JWKSInvalid:()=>wc,JWKSMultipleMatchingKeys:()=>_c,JWKSNoMatchingKey:()=>hi,JWKSTimeout:()=>vc,JWSInvalid:()=>Wo,JWSSignatureVerificationFailed:()=>gi,JWTClaimValidationFailed:()=>di,JWTExpired:()=>xc,JWTInvalid:()=>nr});var Ot=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},di=class extends Ot{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},xc=class extends Ot{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},pi=class extends Ot{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},wt=class extends Ot{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},mi=class extends Ot{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},kr=class extends Ot{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},Wo=class extends Ot{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},nr=class extends Ot{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},bc=class extends Ot{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},wc=class extends Ot{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},hi=class extends Ot{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},_c=class extends Ot{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},vc=class extends Ot{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},gi=class extends Ot{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var Sc=Vt.getRandomValues.bind(Vt);function UF(o){return typeof o=="object"&&o!==null}function ar(o){if(!UF(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var YF=Symbol();var nD,Lc,aw;(typeof navigator=="undefined"||!((aw=(Lc=navigator.userAgent)==null?void 0:Lc.startsWith)!=null&&aw.call(Lc,"Mozilla/5.0 ")))&&(nD="jose/v5.3.0");var em={};lf(em,{decode:()=>Cc,encode:()=>aD});var aD=jr,Cc=zs;function tm(o){if(typeof o!="string")throw new nr("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new nr("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new nr("Invalid JWT");if(!e)throw new nr("JWTs must contain a payload");let r;try{r=Cc(e)}catch(n){throw new nr("Failed to base64url decode the payload")}let s;try{s=JSON.parse(Sr.decode(r))}catch(n){throw new nr("Failed to parse the decoded payload as JSON")}if(!ar(s))throw new nr("Invalid JWT Claims Set");return s}var Ks=class extends Error{constructor(e){super(e),this.name="[System3] Relay Error"}};function iw(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function iD(o){let e=tm(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var Tc=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=iD,this.maxConnections=t,this.refreshInterval=null,Et.set(this,"TokenStore")}onRefresh(e){return new Promise((r,s)=>{let n=i=>{r(i)},a=i=>{this.removeFromRefreshQueue(e),s(i)};this.refresh(e,n,a)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=s=>{this.onTokenRefreshed(e,s),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let s=this.tokenMap.get(e),n=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...s,token:t,expiryTime:r}),n(t),this.log(`Token refreshed for ${s.friendlyName} (${e})`)}}onRefreshFailure(e){let t=this.tokenMap.get(e),r=(t==null?void 0:t.attempts)||0+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){let s=this._activePromises.get(e);if(s)return s;this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:0}),this.callbacks.set(e,r);let n=this.onRefresh(e).then(a=>(this.onTokenRefreshed(e,a),this._activePromises.delete(e),a)).catch(a=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),a});return this._activePromises.set(e,n),n}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new Ks("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let s=this.tokenMap.get(e);if(s.token&&this.isTokenValid(s))return this.callbacks.set(e,r),s.friendlyName=t,r(s.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(s.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),s=Array.from(this.tokenMap.entries()).sort((n,a)=>n[1].expiryTime-a[1].expiryTime);for(let[n,{friendlyName:a,expiryTime:i,attempts:l}]of s){if(!e(n))continue;let f=i-r,u="";f>0?u=`expires in ${iw(f-this.expiryMargin)}`:u="expired",t.push(`${n} (${a}): ${l} attempts, (${u})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${iw(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(e){e?this.tokenMap.forEach((t,r)=>{e(t)&&(this.tokenMap.delete(r),this.refreshQueue.delete(r))}):(this.tokenMap.clear(),this.refreshQueue.clear())}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};function lD(o){return o.expiryTime||0}function cD(o,e){return(...t)=>e(o,...t)}async function fD(o,e,t,r){var f;let s=Ae("[TokenStore][Refresh]","debug"),n=Ae("[TokenStore][Refresh]","error");s(`${e}`);let a=Tt.decode(e),i;if(a instanceof zr)i=JSON.stringify({docId:a.documentId,relay:a.relayId,folder:a.folderId});else if(a instanceof Do)i=JSON.stringify({docId:a.folderId,relay:a.relayId,folder:a.folderId});else if(a instanceof Mo)i=JSON.stringify({docId:a.fileId,relay:a.relayId,folder:a.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(f=o.user)==null?void 0:f.token}`,"Relay-Version":"0.5.1"};try{let u=await Pt("https://api.system3.md/token",{method:"POST",headers:l,body:i});if(!u.ok){s(u.status,await u.text()),r(Error(`Received status code ${u.status} from an API.`));return}let d=await u.json();t(d)}catch(u){n(u,i),r(u)}}var Pc=class extends Tc{constructor(t,r,s,n=5){super({log:Ae("[LiveTokenStore]","debug"),refresh:cD(t,fD),getJwtExpiry:lD,getStorage:function(){return new Oo("TokenStore/"+s)},getTimeProvider:()=>r},n);this.loginManager=t}async getFileTokenFromNetwork(t,r,s,n){let a=`${t}${r}`,i=this._activePromises.get(a);if(i)return i;this.tokenMap.set(t,{token:null,expiryTime:0,attempts:0});let l=this.fetchFileToken(t,r,s,n).then(f=>{let u=this.getJwtExpiry(f),d=this.tokenMap.get(a);return this.tokenMap.set(r,{...d,token:f,expiryTime:u}),this._activePromises.delete(a),f}).catch(f=>{throw this._activePromises.delete(a),f});return this._activePromises.set(a,l),l}async fetchFileToken(t,r,s,n){var m;let a=Ae("[TokenStore][Fetch]","debug");a(`${t}`);let i=Tt.decode(t),l;if(i instanceof Mo)l=JSON.stringify({docId:i.fileId,relay:i.relayId,folder:i.folderId,hash:r,contentType:s,contentLength:n});else throw new Error("No remote to connect to");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let f={Authorization:`Bearer ${(m=this.loginManager.user)==null?void 0:m.token}`,"Relay-Version":"0.5.1"},u=await Pt("https://api.system3.md/file-token",{method:"POST",headers:f,body:l});if(!u.ok){a(u.status,await u.text());let g=await u.json();throw new Error(g.error)}return await u.json()}async getFileToken(t,r,s,n){let a=`${t}${r}`,i=this.tokenMap.get(a);return i&&i.token&&this.isTokenValid(i)?(this.log("token was valid, cache hit!"),this._activePromises.delete(a),Promise.resolve(i.token)):this.getFileTokenFromNetwork(t,r,s,n)}};var lw=require("obsidian");var rm=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Ae("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,lw.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.5.1"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},cw=rm;function om(o){return typeof o.id=="string"}function uD(o){return typeof o.name=="string"}var sm=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function fw(o){return typeof o.aggregate_root=="object"}function uw(o){return typeof o.acl=="object"}var xi=class{get aggregate_root(){}get acl(){}},nm=class extends it{constructor(t,r){super();this.storageQuota=t;this.relays=r}update(t){return this.storageQuota=t,this}get id(){return this.storageQuota.id}get quota(){return this.storageQuota.quota}get pending(){return this.storageQuota.pending}get usage(){return this.storageQuota.usage}get maxFileSize(){return this.storageQuota.max_file_size}get updated(){return this.storageQuota.updated}get created(){return this.storageQuota.created}},am=class{constructor(e,t){this.storageQuota=e;this.relays=t;this.collectionName="storage_quotas"}items(){return this.storageQuota.values()}clear(){this.storageQuota.clear()}get(e){return this.storageQuota.get(e)}ingest(e){let t=this.storageQuota.get(e.id);if(t)return t.update(e),this.storageQuota.notifyListeners(),t;let r=new nm(e,this.relays);return this.storageQuota.set(e.id,r),r}delete(e){this.storageQuota.delete(e)}},Ac=class extends xi{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}update(t){return this.user=t,this}},im=class extends xi{constructor(t,r,s){super();this.remoteFolder=t;this.relays=r;this.users=s}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},lm=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new im(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},cm=class{constructor(e,t,r,s,n,a,i,l){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=n;this.subscriptions=a;this.storageQuotas=i;this.user=l;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new Fc(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},fm=class{constructor(e,t,r,s){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=s}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new hm(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},um=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new gm(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},dm=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new Ac(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},pm=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new ym(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},mm=class extends Mt{constructor(t){super();this.collections=new Map,this.relationships=new Map;for(let r of t)this.collections.set(r.collectionName,r);Et.set(this,"Store")}getCollection(t){let r=this.collections.get(t);if(!r)throw this.error("No collection found for",t),new Error("No collection found for "+t);return r}clear(){let t=Mr.getInstance();t.beginTransaction(),this.collections.forEach(r=>{r.clear()}),this.collections.clear(),this.relationships.clear(),t.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(t){return this.ingestBatch(t==null?void 0:t.items)}ingestBatch(t){if(t)return t.map(r=>this.ingest(r))}ingest(t){let r=Mr.getInstance();r.beginTransaction();let s=this._ingest(t);return r.commitTransaction(),s}_ingest(t){if(!t)return;let r,s=this.collections.get(t.collectionName);if(s?r=s.ingest(t):this.error("No collection found for record",t),fw(r)){let n=r.aggregate_root;if(n){let a=t.id,i=this.relationships.get(n.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(n.join(":"),i)}}if(uw(r)){let n=r.acl;if(n){let a=t.id,i=this.relationships.get(n.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(n.join(":"),i)}}if(t.expand)for(let[,n]of Object.entries(t.expand))Array.isArray(n)?this.ingestBatch(n):this.ingest(n);return r}delete(t){this.cascade(t.collectionName,t.id)}graphviz(){let t=`digraph G {
`;for(let[r,s]of this.collections)for(let n of s.items()){if(!om(n)){this.warn("record has no id",n);continue}let a=r+"_"+n.id;if(uD(n)&&(a=r+"_"+n.name),t+=`  ${r}_${n.id} [label="${a}"];
`,om(n)&&fw(n)&&n.aggregate_root){let[i,l]=n.aggregate_root;t+=`  ${r}_${n.id} -> ${i}_${l};
`}if(om(n)&&uw(n)&&n.acl){let[i,l]=n.acl;t+=`  ${r}_${n.id} -> ${i}_${l} [style=dotted];
`}}return t+="}",t}cascade(t,r){let s=this.collections.get(t),n=this.relationships.get([t,r].join(":")),a=Mr.getInstance();a.beginTransaction(),s&&(this.warn("cascade delete parent",t,r),s.delete(r)),this.relationships.delete([t,r].join(":"));for(let i of n||[]){let[l,f]=i.split(":");this.warn("cascade delete child",l,f),this.getCollection(l)&&this.cascade(l,f)}a.commitTransaction()}},hm=class extends xi{constructor(t,r,s,n){super();this.users=s,this.roles=n,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},gm=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get aggregate_root(){return["relays",this.relayInvitation.relay]}},ym=class extends it{constructor(t,r,s){super();this.subscription=t;this.relays=r;this.users=s}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},Fc=class extends it{constructor(t,r,s,n,a,i,l){super();this.relay=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=n;this._subscriptions=a;this.storageQuotas=i;this.user=l}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get userLimit(){return this.relay.user_limit}get role(){var s;let t=this.relay.creator===this.user.id,r=(s=this.relayRoles.find(n=>n.relayId===this.relay.id&&n.userId===this.user.id))==null?void 0:s.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get storageQuota(){return this.storageQuotas.find(t=>t.id===this.relay.storage_quota)}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(s=>s.relayId===this.id&&s.userId===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}get provider(){return this.relay.provider}},Dc=class extends Mt{constructor(t){super();this.loginManager=t;this.destroyed=!1;this.pb=this.loginManager.pb,this.users=new mr("users"),this.relays=new mr("relays"),this.remoteFolders=new mr("remote folders"),this.relayInvitations=new mr("relay invitations"),this.relayRoles=new mr("relay roles"),this.roles=new mr("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new mr("subscriptions"),this.storageQuotas=new mr("storage quotas"),this._offLoginManager=this.loginManager.on(()=>{this.login()}),this.setUser(),this.user&&(Et.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user)return;if(!this.pb){console.warn("no pb!");return}if(this.store)return;let t=new sm(this.roles),r=new dm(this.users),s=new cm(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.user),n=new fm(this.relayRoles,this.relays,this.users,this.roles),a=new um(this.relayInvitations,this.relays,this.roles),i=new lm(this.remoteFolders,this.relays,this.users),l=new pm(this.subscriptions,this.relays,this.users),f=new am(this.storageQuotas,this.relays);this.store=new mm([t,r,s,n,a,i,l,f])}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new Ac(this.authUser),this.users.set(this.user.id,this.user))}login(){this.setUser(),this.buildGraph(),this.subscribe(),this.update()}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async getRelayInvitationKey(t){if(!this.pb)return"";let r=this.relayInvitations.find(s=>s.relay.id===t.id);return r!=null&&r.key?r.key:this.pb.collection("relay_invitations").getList(0,200).then(s=>{s.items.forEach(a=>{var i;(i=this.store)==null||i.ingest(a)});let n=this.relayInvitations.find(a=>a.relay.id===t.id);return n?n.key:""})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,s=await this.pb.send(r,{method:"POST"});if(s!==200)throw new Error("Token API failed");return s.json().token}async subscribe(){var s;if(!this.pb||!this.pb.authStore.isValid||((s=this.pb.authStore.model)==null?void 0:s.id)===void 0)return;let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","subscriptions_via_relay.relay.storage_quota","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]}],r=(n,a)=>{var i,l;this.debug(`[Event]: ${n}`,a.action,a.record),a.action==="delete"?(i=this.store)==null||i.delete(a.record):(l=this.store)==null||l.ingest(a.record)};for(let n of t)this.pb.collection(n.name).subscribe("*",a=>r(n.name,a),{expand:n.expand.join(","),fetch:Pt})}async update(){let t=(s,n={})=>{var a;return!this.pb||!this.pb.authStore.isValid||((a=this.pb.authStore.model)==null?void 0:a.id)===void 0?Promise.resolve([]):(typeof n=="function"&&(n=n(this.pb.authStore.model.id)),this.pb.collection(s).getFullList(n))};[t("users",s=>({filter:`id="${s}"`,expand:["relay_roles_via_user","relay_roles_via_user.relay","relay_roles_via_user.relay.storage_quota","relay_roles_via_user.role"].join(",")})),t("relay_roles",{expand:"user"}),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("subscriptions",{expand:"relay,user"})].forEach(async s=>{let n=await s;for(let a of n)!this.destroyed&&this.store&&this.store.ingest(a)})}async acceptInvitation(t){var n;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})});this.debug("[InviteAccept]",r);let s=(n=this.store)==null?void 0:n.ingest(r);if(!s)throw new Error("Failed to accept invitation");return s}async createRelay(t){var a;let r=$n(),s=await((a=this.pb)==null?void 0:a.collection("relays").create({guid:r,name:t,path:null},{expand:"relay_roles_via_relay,relay_invitations_via_relay,storage_quota"}));if(!s)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let n=new Fc(s,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.user);return this.relays.set(n.id,n),n}async updateRelay(t){var n;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),s=(n=this.store)==null?void 0:n.ingest(r);if(!s)throw new Error("Failed to update relay");return s}async deleteRemote(t){var s;t.remote=void 0;let r=this.remoteFolders.find(n=>n.guid===t.guid);return r?(await((s=this.pb)==null?void 0:s.collection("shared_folders").delete(r.id)),t.remote=void 0,!0):!1}async createRemoteFolder(t,r){var a,i;if(!this.pb)throw new Error("Failed to create folder");let s=await this.pb.collection("shared_folders").create({name:t.name,guid:t.guid,relay:r.id,creator:(a=this.user)==null?void 0:a.id,private:!1},{expand:"relay"}),n=(i=this.store)==null?void 0:i.ingest(s);if(!n)throw new Error("Failed to create folder");return n}async destroyRelay(t){var r,s;return(r=this.store)==null||r.cascade("relays",t.id),await((s=this.pb)==null?void 0:s.collection("relays").delete(t.id)),!0}async leaveRelay(t){var s,n;let r=this.relayRoles.find(a=>{var i;return a.userId===((i=this.user)==null?void 0:i.id)&&a.relayId===t.id});r?await((s=this.pb)==null?void 0:s.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(n=this.store)==null||n.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}destroy(){var t,r,s;this.destroyed=!0,(t=this._offLoginManager)==null||t.call(this),this._offLoginManager=null,(r=this.pb)==null||r.cancelAllRequests(),this.loginManager=null,(s=this.store)==null||s.destroy(),this.pb=null,this.authUser=null,this.store=null}};var N_=require("obsidian");var gw=require("obsidian");var mw=require("obsidian");function dD(o){Fe(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function dw(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function pw(o){let e,t,r,s=o[8]+"",n,a,i,l,f=o[8]+"",u,d,m,g,h,_,w,v,M,R,D,E;function O(){return o[6](o[8])}function A(){return o[7](o[8])}return{c(){e=T("div"),t=T("div"),r=T("div"),n=z(s),a=U(),i=T("div"),l=z("Toggle "),u=z(f),d=z(" on or off"),m=U(),g=T("div"),h=T("div"),_=T("input"),v=U(),M=T("div"),b(r,"class","setting-item-name"),b(i,"class","setting-item-description"),b(t,"class","setting-item-info"),b(_,"type","checkbox"),b(_,"tabindex","-1"),_.checked=w=o[9],b(M,"class","checkbox-toggle"),b(h,"role","checkbox"),b(h,"aria-checked",R=o[9]),b(h,"tabindex","0"),b(h,"class","checkbox-container svelte-4kkvmr"),qe(h,"is-enabled",o[9]),b(g,"class","setting-item-control"),b(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(F,V){C(F,e,V),S(e,t),S(t,r),S(r,n),S(t,a),S(t,i),S(i,l),S(i,u),S(i,d),S(e,m),S(e,g),S(g,h),S(h,_),S(h,v),S(h,M),D||(E=[re(h,"keypress",O),re(h,"click",A)],D=!0)},p(F,V){o=F,V&2&&s!==(s=o[8]+"")&&se(n,s),V&2&&f!==(f=o[8]+"")&&se(u,f),V&2&&w!==(w=o[9])&&(_.checked=w),V&2&&R!==(R=o[9])&&b(h,"aria-checked",R),V&2&&qe(h,"is-enabled",o[9])},d(F){F&&L(e),D=!1,Ie(E)}}}function pD(o){let e,t,r,s,n,a,i,l,f,u=De(Object.entries(o[1])),d=[];for(let m=0;m<u.length;m+=1)d[m]=pw(dw(o,u,m));return{c(){e=T("div"),t=T("h2"),t.textContent="Feature Flags",r=U();for(let m=0;m<d.length;m+=1)d[m].c();s=U(),n=T("div"),a=T("div"),i=T("button"),i.textContent="Apply",b(i,"aria-label","apply flag settings"),b(i,"tabindex","0"),b(a,"class","setting-item-control"),b(n,"class","setting-item"),b(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(m,g){C(m,e,g),S(e,t),S(e,r);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(e,null);S(e,s),S(e,n),S(n,a),S(a,i),l||(f=[re(i,"click",function(){ut(o[0])&&o[0].apply(this,arguments)}),re(i,"keypress",function(){ut(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(m,[g]){if(o=m,g&26){u=De(Object.entries(o[1]));let h;for(h=0;h<u.length;h+=1){let _=dw(o,u,h);d[h]?d[h].p(_,g):(d[h]=pw(_),d[h].c(),d[h].m(e,s))}for(;h<d.length;h+=1)d[h].d(1);d.length=u.length}},i:J,o:J,d(m){m&&L(e),tt(d,m),l=!1,Ie(f)}}}function mD(o,e,t){let r,s,{reload:n}=e,a=Rt.getInstance();me(o,a,d=>t(5,s=d));function i(d){let m=!r[d];t(1,r[d]=m,r),a.setFlag(d,r[d])}function l(d){return d in r}sr(()=>{Object.keys(r).forEach(d=>{let m=document.getElementById(`toggle-${d}`);m&&(0,mw.setIcon)(m,"check")})});let f=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)},u=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)};return o.$$set=d=>{"reload"in d&&t(0,n=d.reload)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(1,r=Object.assign({},s.flags))}},[n,r,a,i,l,s,f,u]}var xm=class extends X{constructor(e){super(),ee(this,e,mD,pD,Q,{reload:0},dD)}},hw=xm;var Mc=class extends gw.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new hw({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Lw=require("obsidian");var kw=require("obsidian");function yw(o,e,t){let r=o.slice();return r[13]=e[t],r}function xw(o,e,t){let r=o.slice();return r[16]=e[t],r}function hD(o){let e,t,r;return{c(){e=T("button"),e.textContent="Refresh"},m(s,n){C(s,e,n),t||(r=re(e,"click",(0,kw.debounce)(o[12])),t=!0)},p:J,d(s){s&&L(e),t=!1,r()}}}function gD(o){let e=navigator.userAgent+"",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p:J,d(r){r&&L(t)}}}function yD(o){let e;return{c(){e=z(o[1])},m(t,r){C(t,e,r)},p(t,r){r&2&&se(e,t[1])},d(t){t&&L(e)}}}function xD(o){let e;return{c(){e=z(o[2])},m(t,r){C(t,e,r)},p(t,r){r&4&&se(e,t[2])},d(t){t&&L(e)}}}function bD(o){let e;return{c(){e=z(o[3])},m(t,r){C(t,e,r)},p(t,r){r&8&&se(e,t[3])},d(t){t&&L(e)}}}function wD(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=z(e)},m(r,s){C(r,t,s)},p(r,s){s&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&se(t,e)},d(r){r&&L(t)}}}function bw(o){let e,t=`${o[16]}`,r,s;return{c(){e=T("div"),r=z(t),s=U()},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&16&&t!==(t=`${n[16]}`)&&se(r,t)},d(n){n&&L(e)}}}function _D(o){let e,t=De(Object.keys(o[4].cancelControllers)),r=[];for(let s=0;s<t.length;s+=1)r[s]=bw(xw(o,t,s));return{c(){e=T("div");for(let s=0;s<r.length;s+=1)r[s].c();b(e,"slot","description")},m(s,n){C(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&16){t=De(Object.keys(s[4].cancelControllers));let a;for(a=0;a<t.length;a+=1){let i=xw(s,t,a);r[a]?r[a].p(i,n):(r[a]=bw(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&L(e),tt(r,s)}}}function ww(o){let e,t=`${o[13]}`,r,s;return{c(){e=T("div"),r=z(t),s=U()},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&32&&t!==(t=`${n[13]}`)&&se(r,t)},d(n){n&&L(e)}}}function vD(o){let e,t=De(o[5]),r=[];for(let s=0;s<t.length;s+=1)r[s]=ww(yw(o,t,s));return{c(){e=T("div");for(let s=0;s<r.length;s+=1)r[s].c();b(e,"slot","description")},m(s,n){C(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&32){t=De(s[5]);let a;for(a=0;a<t.length;a+=1){let i=yw(s,t,a);r[a]?r[a].p(i,n):(r[a]=ww(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&L(e),tt(r,s)}}}function SD(o){let e,t,r,s,n,a,i,l,f,u,d,m,g,h,_,w,v,M,R,D,E,O,A;return s=new Ye({props:{name:"Environment",$$slots:{default:[hD]},$$scope:{ctx:o}}}),a=new Be({props:{name:"User Agent",description:"",$$slots:{default:[gD]},$$scope:{ctx:o}}}),l=new Be({props:{name:"Fetch",description:"",$$slots:{default:[yD]},$$scope:{ctx:o}}}),u=new Be({props:{name:"Response",description:"",$$slots:{default:[xD]},$$scope:{ctx:o}}}),m=new Be({props:{name:"Blink Fetch",description:"",$$slots:{default:[bD]},$$scope:{ctx:o}}}),h=new Be({props:{name:"Startup Time",description:"",$$slots:{default:[wD]},$$scope:{ctx:o}}}),w=new Ye({props:{name:"Connections"}}),M=new Be({props:{name:"",description:"",$$slots:{description:[_D]},$$scope:{ctx:o}}}),D=new Ye({props:{name:"Log Files"}}),O=new Be({props:{name:"",description:"",$$slots:{description:[vD]},$$scope:{ctx:o}}}),{c(){e=T("div"),e.textContent="Debug Info",t=U(),r=T("div"),H(s.$$.fragment),n=U(),H(a.$$.fragment),i=U(),H(l.$$.fragment),f=U(),H(u.$$.fragment),d=U(),H(m.$$.fragment),g=U(),H(h.$$.fragment),_=U(),H(w.$$.fragment),v=U(),H(M.$$.fragment),R=U(),H(D.$$.fragment),E=U(),H(O.$$.fragment),b(e,"class","modal-title"),b(r,"class","modal-content")},m(F,V){C(F,e,V),C(F,t,V),C(F,r,V),B(s,r,null),S(r,n),B(a,r,null),S(r,i),B(l,r,null),S(r,f),B(u,r,null),S(r,d),B(m,r,null),S(r,g),B(h,r,null),S(r,_),B(w,r,null),S(r,v),B(M,r,null),S(r,R),B(D,r,null),S(r,E),B(O,r,null),A=!0},p(F,[V]){let q={};V&524288&&(q.$$scope={dirty:V,ctx:F}),s.$set(q);let Z={};V&524288&&(Z.$$scope={dirty:V,ctx:F}),a.$set(Z);let j={};V&524290&&(j.$$scope={dirty:V,ctx:F}),l.$set(j);let K={};V&524292&&(K.$$scope={dirty:V,ctx:F}),u.$set(K);let W={};V&524296&&(W.$$scope={dirty:V,ctx:F}),m.$set(W);let te={};V&524289&&(te.$$scope={dirty:V,ctx:F}),h.$set(te);let Te={};V&524304&&(Te.$$scope={dirty:V,ctx:F}),M.$set(Te);let ie={};V&524320&&(ie.$$scope={dirty:V,ctx:F}),O.$set(ie)},i(F){A||(k(s.$$.fragment,F),k(a.$$.fragment,F),k(l.$$.fragment,F),k(u.$$.fragment,F),k(m.$$.fragment,F),k(h.$$.fragment,F),k(w.$$.fragment,F),k(M.$$.fragment,F),k(D.$$.fragment,F),k(O.$$.fragment,F),A=!0)},o(F){P(s.$$.fragment,F),P(a.$$.fragment,F),P(l.$$.fragment,F),P(u.$$.fragment,F),P(m.$$.fragment,F),P(h.$$.fragment,F),P(w.$$.fragment,F),P(M.$$.fragment,F),P(D.$$.fragment,F),P(O.$$.fragment,F),A=!1},d(F){F&&(L(e),L(t),L(r)),N(s),N(a),N(l),N(u),N(m),N(h),N(w),N(M),N(D),N(O)}}}function _w(){try{return Response.toString()}catch(o){return"undefined"}}function vw(){try{return fetch.toString()}catch(o){return"undefined"}}function Sw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function kD(o,e,t){let r,s,n,a,i,{plugin:l}=e,f=ve(_w());me(o,f,w=>t(2,s=w));let u=ve(vw());me(o,u,w=>t(1,r=w));let d=ve(Sw());me(o,d,w=>t(3,n=w));let m=ve(l.loginManager.pb);me(o,m,w=>t(4,a=w));let g=ve([]);me(o,g,w=>t(5,i=w)),Il().then(w=>{g.set(w)});function h(){f.set(_w()),u.set(vw()),d.set(Sw()),m.set(l.loginManager.pb)}let _=()=>{h()};return o.$$set=w=>{"plugin"in w&&t(0,l=w.plugin)},[l,r,s,n,a,i,f,u,d,m,g,h,_]}var bm=class extends X{constructor(e){super(),ee(this,e,kD,SD,Q,{plugin:0})}},Iw=bm;var Ec=class extends Lw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Iw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Cw=require("obsidian"),Rc=class{notify(e){new Cw.Notice(e)}},Oc=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var Ow=require("obsidian");var Ew=require("obsidian");function ID(o){Fe(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function Tw(o,e,t){let r=o.slice();return r[21]=e[t],r}function LD(o){let e,t,r,s,n,a,i,l,f,u,d,m,g;r=new Be({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),i=new Be({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[PD]},$$scope:{ctx:o}}});let h=o[4]&&Pw(o);return u=new Be({props:{name:"",description:"",$$slots:{default:[FD]},$$scope:{ctx:o}}}),{c(){e=T("div"),t=T("div"),H(r.$$.fragment),s=U(),n=T("textarea"),a=U(),H(i.$$.fragment),l=U(),h&&h.c(),f=U(),H(u.$$.fragment),b(n,"placeholder","Describe the issue here..."),b(n,"class","svelte-jmqfac"),b(t,"class","form-content svelte-jmqfac"),b(e,"class","report-container svelte-jmqfac")},m(_,w){C(_,e,w),S(e,t),B(r,t,null),S(t,s),S(t,n),or(n,o[3]),S(t,a),B(i,t,null),S(t,l),h&&h.m(t,null),S(e,f),B(u,e,null),d=!0,m||(g=re(n,"input",o[13]),m=!0)},p(_,w){w&8&&or(n,_[3]);let v={};w&16777232&&(v.$$scope={dirty:w,ctx:_}),i.$set(v),_[4]?h?(h.p(_,w),w&16&&k(h,1)):(h=Pw(_),h.c(),k(h,1),h.m(t,null)):h&&(we(),P(h,1,1,()=>{h=null}),_e());let M={};w&16777293&&(M.$$scope={dirty:w,ctx:_}),u.$set(M)},i(_){d||(k(r.$$.fragment,_),k(i.$$.fragment,_),k(h),k(u.$$.fragment,_),d=!0)},o(_){P(r.$$.fragment,_),P(i.$$.fragment,_),P(h),P(u.$$.fragment,_),d=!1},d(_){_&&L(e),N(r),N(i),h&&h.d(),N(u),m=!1,g()}}}function CD(o){let e;return{c(){e=T("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',b(e,"class","centered-message svelte-jmqfac")},m(t,r){C(t,e,r)},p:J,i:J,o:J,d(t){t&&L(e)}}}function TD(o){let e,t,r;return t=new Be({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=T("div"),H(t.$$.fragment),b(e,"class","centered-message svelte-jmqfac")},m(s,n){C(s,e,n),B(t,e,null),r=!0},p:J,i(s){r||(k(t.$$.fragment,s),r=!0)},o(s){P(t.$$.fragment,s),r=!1},d(s){s&&L(e),N(t)}}}function PD(o){let e,t,r,s,n,a;return{c(){e=T("div"),t=T("input"),r=U(),s=T("div"),b(t,"type","checkbox"),b(t,"tabindex","-1"),t.checked=o[4],b(s,"class","checkbox-toggle"),b(e,"role","checkbox"),b(e,"aria-checked",o[4]),b(e,"tabindex","0"),b(e,"class","checkbox-container"),qe(e,"is-enabled",o[4])},m(i,l){C(i,e,l),S(e,t),S(e,r),S(e,s),n||(a=[re(e,"keypress",MD),re(e,"click",o[14])],n=!0)},p(i,l){l&16&&(t.checked=i[4]),l&16&&b(e,"aria-checked",i[4]),l&16&&qe(e,"is-enabled",i[4])},d(i){i&&L(e),n=!1,Ie(a)}}}function Pw(o){let e,t;return e=new Be({props:{name:"Logs",description:"",$$slots:{description:[AD]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&16777248&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Aw(o){let e,t=`${o[21]}
`,r,s;return{c(){e=T("div"),r=z(t),s=U()},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&32&&t!==(t=`${n[21]}
`)&&se(r,t)},d(n){n&&L(e)}}}function AD(o){let e,t=De(o[5]),r=[];for(let s=0;s<t.length;s+=1)r[s]=Aw(Tw(o,t,s));return{c(){e=T("div");for(let s=0;s<r.length;s+=1)r[s].c();b(e,"slot","description")},m(s,n){C(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&32){t=De(s[5]);let a;for(a=0;a<t.length;a+=1){let i=Tw(s,t,a);r[a]?r[a].p(i,n):(r[a]=Aw(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&L(e),tt(r,s)}}}function FD(o){let e,t,r,s;return{c(){e=T("button"),t=z("Send"),e.disabled=o[2]},m(n,a){C(n,e,a),S(e,t),r||(s=re(e,"click",o[15]),r=!0)},p(n,a){a&4&&(e.disabled=n[2])},d(n){n&&L(e),r=!1,s()}}}function DD(o){let e,t,r,s,n,a,i=[TD,CD,LD],l=[];function f(u,d){return u[1]?0:u[2]&&!u[1]?1:2}return s=f(o,-1),n=l[s]=i[s](o),{c(){e=T("div"),e.textContent="Send Bug Report",t=U(),r=T("div"),n.c(),b(e,"class","modal-title"),b(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(u,d){C(u,e,d),C(u,t,d),C(u,r,d),l[s].m(r,null),a=!0},p(u,[d]){let m=s;s=f(u,d),s===m?l[s].p(u,d):(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),n=l[s],n?n.p(u,d):(n=l[s]=i[s](u),n.c()),k(n,1),n.m(r,null))},i(u){a||(k(n),a=!0)},o(u){P(n),a=!1},d(u){u&&(L(e),L(t),L(r)),l[s].d()}}}function Fw(){try{return Response.toString()}catch(o){return"undefined"}}function Dw(){try{return fetch.toString()}catch(o){return"undefined"}}function Mw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var MD=()=>{};function ED(o,e,t){let r,s,n,a,i,l,{plugin:f}=e,u=ve(Fw()),d=ve(Dw()),m=ve(Mw()),g=ve("");me(o,g,F=>t(3,n=F));let h=ve(!1);me(o,h,F=>t(4,a=F));let _=ve(!1),w=ve(!1);me(o,w,F=>t(2,s=F));let v=ve(!1);me(o,v,F=>t(1,r=F));let M=ve(f.loginManager.pb);me(o,M,F=>t(6,l=F));let R=ve([]);me(o,R,F=>t(5,i=F)),Il().then(F=>{R.set(F)});function D(){u.set(Fw()),d.set(Dw()),m.set(Mw()),M.set(f.loginManager.pb)}function E(){n=this.value,g.set(n)}let O=()=>{let F=!a;h.set(F)},A=async()=>{var V;let F=`Bug Report

`;if(F+=JSON.stringify({userAgent:navigator.userAgent,manifest:f.manifest,user:(V=l==null?void 0:l.authStore.model)==null?void 0:V.id,loadTime:f.loadTime,description:n},null,2),F+=`

`,h){let q=await Py();F+=q}(0,Ew.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:F,headers:{"Content-Type":"text/plain"}}).then(()=>{v.set(!0)}),w.set(!0)};return o.$$set=F=>{"plugin"in F&&t(0,f=F.plugin)},[f,r,s,n,a,i,l,g,h,w,v,M,R,E,O,A]}var wm=class extends X{constructor(e){super(),ee(this,e,ED,DD,Q,{plugin:0},ID)}},Rw=wm;var Uc=class extends Ow.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Rw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var zw=require("obsidian");async function Uw(o){let{appId:e,filterByAppId:t,onProgress:r}=o,s=await window.indexedDB.databases(),n=s.length,a=[],i=0,l=0,f=0,u=0;for(let d of s)if(d.name){try{let m=await new Promise((g,h)=>{let _=indexedDB.open(d.name);_.onerror=()=>h(_.error),_.onsuccess=w=>g(w.target.result)});try{let g=Array.from(m.objectStoreNames);if(!g.includes("updates")||!g.includes("custom"))continue;let h=m.transaction(["updates","custom"],"readonly"),_=h.objectStore("updates"),w=h.objectStore("custom"),v=await new Promise(R=>{let D=w.get("appId");D.onsuccess=()=>R(D.result||"")});i++;let M=await new Promise((R,D)=>{let E=_.count();E.onsuccess=()=>R(E.result),E.onerror=()=>D(E.error)});if(l+=M,M>0){let R=0;if(await new Promise((D,E)=>{let O=_.openCursor();O.onsuccess=A=>{let F=A.target.result;if(F){let V=F.value instanceof Uint8Array?F.value.byteLength:JSON.stringify(F.value).length;R+=V,F.continue()}else D()},O.onerror=()=>E(O.error)}),f+=R,R>1024*1024&&(!t||v===e)){let D=await new Promise(A=>{let F=w.get("path");F.onsuccess=()=>A(F.result||"")}),E=await new Promise(A=>{let F=w.get("relay");F.onsuccess=()=>A(F.result||"")}),O=!d.name.startsWith(`${e}-relay`);a.push({slug:`${d.name}/${_.name}`,path:D,relay:E,appId:v||"unknown",count:M,estimatedSizeMB:Math.round(R/(1024*1024)*100)/100,isLegacy:O})}}}finally{m.close()}}catch(m){console.error(`Error processing database ${d.name}:`,m);continue}u++,r&&r(u/s.length*100)}return{totalStores:i,totalItems:l,totalSizeMB:Math.round(f/(1024*1024)*100)/100,databaseCount:n,largeStores:a.sort((d,m)=>m.estimatedSizeMB-d.estimatedSizeMB)}}async function $w(o){let[e,t]=o.split("/"),r=await new Promise((s,n)=>{let a=indexedDB.open(e);a.onerror=()=>n(a.error),a.onsuccess=()=>s(a.result)});try{let n=r.transaction(t,"readwrite").objectStore(t);await new Promise((a,i)=>{let l=n.clear();l.onsuccess=()=>a(),l.onerror=()=>i(l.error)})}catch(s){console.error(`Error deleting store: ${o}`,s)}finally{r.close()}}var nj=require("obsidian");function RD(o){Fe(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function Bw(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function Nw(o,e,t){let r=o.slice();return r[22]=e[t],r}function OD(o){let e,t,r,s,n,a=o[0].databaseCount.toLocaleString()+"",i,l,f,u,d,m,g,h,_=o[0].totalStores+"",w,v,M,R,D,E,O=o[0].totalItems.toLocaleString()+"",A,F,V,q,Z,j,K=o[0].totalSizeMB.toFixed(2)+"",W,te,Te,ie,Pe;function Ke(oe,Ne){if(oe[0].databaseCount>45e3)return ND;if(oe[0].databaseCount>4e4)return BD}let Oe=Ke(o,-1),pe=Oe&&Oe(o),fe=o[0].largeStores.length>0&&Hw(o);return{c(){e=T("div"),t=T("div"),r=T("div"),r.textContent="Global Database Limit",s=U(),n=T("div"),i=z(a),l=z(" / 50,000"),f=U(),pe&&pe.c(),u=U(),d=T("div"),m=T("div"),m.textContent="Relay Databases",g=U(),h=T("div"),w=z(_),v=U(),M=T("div"),R=T("div"),R.textContent="Document Updates",D=U(),E=T("div"),A=z(O),F=U(),V=T("div"),q=T("div"),q.textContent="Total Size",Z=U(),j=T("div"),W=z(K),te=z(" MB"),Te=U(),fe&&fe.c(),ie=Ce(),b(r,"class","system3-stat-label svelte-1n3w4sk"),b(n,"class","system3-stat-value svelte-1n3w4sk"),qe(n,"system3-warning",o[0].databaseCount>4e4),qe(n,"system3-critical",o[0].databaseCount>45e3),b(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),b(m,"class","system3-stat-label svelte-1n3w4sk"),b(h,"class","system3-stat-value svelte-1n3w4sk"),b(d,"class","system3-stat-item svelte-1n3w4sk"),b(R,"class","system3-stat-label svelte-1n3w4sk"),b(E,"class","system3-stat-value svelte-1n3w4sk"),b(M,"class","system3-stat-item svelte-1n3w4sk"),b(q,"class","system3-stat-label svelte-1n3w4sk"),b(j,"class","system3-stat-value svelte-1n3w4sk"),b(V,"class","system3-stat-item svelte-1n3w4sk"),b(e,"class","system3-summary-stats svelte-1n3w4sk")},m(oe,Ne){C(oe,e,Ne),S(e,t),S(t,r),S(t,s),S(t,n),S(n,i),S(n,l),S(t,f),pe&&pe.m(t,null),S(e,u),S(e,d),S(d,m),S(d,g),S(d,h),S(h,w),S(e,v),S(e,M),S(M,R),S(M,D),S(M,E),S(E,A),S(e,F),S(e,V),S(V,q),S(V,Z),S(V,j),S(j,W),S(j,te),C(oe,Te,Ne),fe&&fe.m(oe,Ne),C(oe,ie,Ne),Pe=!0},p(oe,Ne){(!Pe||Ne&1)&&a!==(a=oe[0].databaseCount.toLocaleString()+"")&&se(i,a),(!Pe||Ne&1)&&qe(n,"system3-warning",oe[0].databaseCount>4e4),(!Pe||Ne&1)&&qe(n,"system3-critical",oe[0].databaseCount>45e3),Oe!==(Oe=Ke(oe,Ne))&&(pe&&pe.d(1),pe=Oe&&Oe(oe),pe&&(pe.c(),pe.m(t,null))),(!Pe||Ne&1)&&_!==(_=oe[0].totalStores+"")&&se(w,_),(!Pe||Ne&1)&&O!==(O=oe[0].totalItems.toLocaleString()+"")&&se(A,O),(!Pe||Ne&1)&&K!==(K=oe[0].totalSizeMB.toFixed(2)+"")&&se(W,K),oe[0].largeStores.length>0?fe?(fe.p(oe,Ne),Ne&1&&k(fe,1)):(fe=Hw(oe),fe.c(),k(fe,1),fe.m(ie.parentNode,ie)):fe&&(we(),P(fe,1,1,()=>{fe=null}),_e())},i(oe){Pe||(k(fe),Pe=!0)},o(oe){P(fe),Pe=!1},d(oe){oe&&(L(e),L(Te),L(ie)),pe&&pe.d(),fe&&fe.d(oe)}}}function UD(o){let e,t;return{c(){e=T("div"),t=z(o[5]),b(e,"class","system3-error-message svelte-1n3w4sk")},m(r,s){C(r,e,s),S(e,t)},p(r,s){s&32&&se(t,r[5])},i:J,o:J,d(r){r&&L(e)}}}function $D(o){let e,t,r,s,n,a,i;return{c(){e=T("div"),t=T("div"),r=U(),s=T("div"),s.textContent="Analyzing Databases...",n=U(),a=T("div"),i=T("div"),b(t,"class","system3-loading-spinner svelte-1n3w4sk"),b(s,"class","loading-text"),b(i,"class","system3-progress-fill svelte-1n3w4sk"),de(i,"width",o[4]+"%"),b(a,"class","system3-progress-bar svelte-1n3w4sk"),b(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,f){C(l,e,f),S(e,t),S(e,r),S(e,s),S(e,n),S(e,a),S(a,i)},p(l,f){f&16&&de(i,"width",l[4]+"%")},i:J,o:J,d(l){l&&L(e)}}}function BD(o){let e;return{c(){e=T("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,b(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function ND(o){let e;return{c(){e=T("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,b(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function Hw(o){let e,t,r,s;e=new Ye({props:{name:"Large Stores (>1MB)"}});let n=De(o[2]),a=[];for(let l=0;l<n.length;l+=1)a[l]=qw(Bw(o,n,l));let i=l=>P(a[l],1,1,()=>{a[l]=null});return{c(){H(e.$$.fragment),t=U();for(let l=0;l<a.length;l+=1)a[l].c();r=Ce()},m(l,f){B(e,l,f),C(l,t,f);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,f);C(l,r,f),s=!0},p(l,f){if(f&2052){n=De(l[2]);let u;for(u=0;u<n.length;u+=1){let d=Bw(l,n,u);a[u]?(a[u].p(d,f),k(a[u],1)):(a[u]=qw(d),a[u].c(),k(a[u],1),a[u].m(r.parentNode,r))}for(we(),u=n.length;u<a.length;u+=1)i(u);_e()}},i(l){if(!s){k(e.$$.fragment,l);for(let f=0;f<n.length;f+=1)k(a[f]);s=!0}},o(l){P(e.$$.fragment,l),a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)P(a[f]);s=!1},d(l){l&&(L(t),L(r)),N(e,l),tt(a,l)}}}function HD(o){let e,t,r,s,n;function a(){return o[17](o[22])}return{c(){e=T("div"),t=T("button"),t.textContent="Delete",r=U(),b(t,"class","mod-warning"),b(t,"title","Delete all data in this store"),b(e,"class","system3-actions svelte-1n3w4sk")},m(i,l){C(i,e,l),S(e,t),C(i,r,l),s||(n=re(t,"click",a),s=!0)},p(i,l){o=i},d(i){i&&(L(e),L(r)),s=!1,n()}}}function Vw(o){let e,t;return e=new Be({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[HD]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&4&&(n.name=r[22].path||r[22].slug),s&4&&(n.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),s&33554436&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function qw(o){let e,t,r,s;e=new Ye({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let n=De(o[19]),a=[];for(let l=0;l<n.length;l+=1)a[l]=Vw(Nw(o,n,l));let i=l=>P(a[l],1,1,()=>{a[l]=null});return{c(){H(e.$$.fragment),t=U();for(let l=0;l<a.length;l+=1)a[l].c();r=Ce()},m(l,f){B(e,l,f),C(l,t,f);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,f);C(l,r,f),s=!0},p(l,f){let u={};if(f&4&&(u.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(u),f&2052){n=De(l[19]);let d;for(d=0;d<n.length;d+=1){let m=Nw(l,n,d);a[d]?(a[d].p(m,f),k(a[d],1)):(a[d]=Vw(m),a[d].c(),k(a[d],1),a[d].m(r.parentNode,r))}for(we(),d=n.length;d<a.length;d+=1)i(d);_e()}},i(l){if(!s){k(e.$$.fragment,l);for(let f=0;f<n.length;f+=1)k(a[f]);s=!0}},o(l){P(e.$$.fragment,l),a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)P(a[f]);s=!1},d(l){l&&(L(t),L(r)),N(e,l),tt(a,l)}}}function VD(o){let e,t,r,s,n,a,i,l,f,u,d,m,g,h,_,w,v,M=[$D,UD,OD],R=[];function D(E,O){return E[3]?0:E[5]?1:E[0]?2:-1}return~(g=D(o,-1))&&(h=R[g]=M[g](o)),{c(){e=T("div"),e.textContent="Relay database analysis",t=U(),r=T("div"),s=T("div"),n=T("div"),n.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,a=U(),i=T("div"),l=T("div"),f=T("input"),u=U(),d=T("div"),m=U(),h&&h.c(),b(e,"class","modal-title"),b(n,"class","setting-item-info"),b(f,"type","checkbox"),b(f,"tabindex","-1"),f.checked=o[1],b(d,"class","checkbox-toggle"),b(l,"role","checkbox"),b(l,"aria-checked",o[1]),b(l,"tabindex","0"),b(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),qe(l,"is-enabled",o[1]),b(i,"class","setting-item-control"),b(s,"class","setting-item"),b(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(E,O){C(E,e,O),C(E,t,O),C(E,r,O),S(r,s),S(s,n),S(s,a),S(s,i),S(i,l),S(l,f),S(l,u),S(l,d),S(r,m),~g&&R[g].m(r,null),_=!0,w||(v=[re(l,"keypress",o[15]),re(l,"click",o[16])],w=!0)},p(E,[O]){(!_||O&2)&&(f.checked=E[1]),(!_||O&2)&&b(l,"aria-checked",E[1]),(!_||O&2)&&qe(l,"is-enabled",E[1]);let A=g;g=D(E,O),g===A?~g&&R[g].p(E,O):(h&&(we(),P(R[A],1,1,()=>{R[A]=null}),_e()),~g?(h=R[g],h?h.p(E,O):(h=R[g]=M[g](E),h.c()),k(h,1),h.m(r,null)):h=null)},i(E){_||(k(h),_=!0)},o(E){P(h),_=!1},d(E){E&&(L(e),L(t),L(r)),~g&&R[g].d(),w=!1,Ie(v)}}}function qD(o,e,t){let r,s,n,a,i,l;var f;let{plugin:u}=e,d=ve(!0);me(o,d,E=>t(3,a=E));let m=ve(0);me(o,m,E=>t(4,i=E));let g=ve(null);me(o,g,E=>t(0,n=E));let h=ve(null);me(o,h,E=>t(5,l=E));let _=!1;function w(){return Ge(this,void 0,void 0,function*(){d.set(!0),h.set(null);try{let E=yield Uw({appId:u.appId,filterByAppId:!_,onProgress:O=>m.set(O)});g.set(E)}catch(E){h.set(`Analysis failed: ${E.message}`)}finally{d.set(!1)}})}function v(E){return Ge(this,void 0,void 0,function*(){try{yield $w(E),n&&ox(g,n.largeStores=n.largeStores.filter(O=>O.slug!==E),n)}catch(O){h.set(`Failed to delete ${E}: ${O.message}`)}})}sr(()=>{w()});let M=()=>{t(1,_=!_),w()},R=()=>{t(1,_=!_),w()},D=E=>v(E.slug);return o.$$set=E=>{"plugin"in E&&t(12,u=E.plugin)},o.$$.update=()=>{if(o.$$.dirty&8193){e:t(14,r=t(13,f=n==null?void 0:n.largeStores.reduce((E,O)=>{let A=O.relay||"local";return E[A]||(E[A]=[]),E[A].push(O),E},{}))!==null&&f!==void 0?f:{})}if(o.$$.dirty&16384){e:t(2,s=Object.entries(r).sort(([E],[O])=>E==="local"?-1:O==="local"?1:E.localeCompare(O)))}},[n,_,s,a,i,l,d,m,g,h,w,v,u,f,r,M,R,D]}var _m=class extends X{constructor(e){super(),ee(this,e,qD,VD,Q,{plugin:12},RD)}},Ww=_m;var $c=class extends zw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Ww({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var b_=require("obsidian");var{Boolean:o_}=Ns;function WD(o){Fe(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function Kw(o,e,t){let r=o.slice();return r[20]=e[t],r}function Gw(o,e,t){let r=o.slice();return r[23]=e[t],r}function zD(o){return{c:J,m:J,p:J,i:J,o:J,d:J}}function KD(o){let e,t,r=De(r_(o[19].documents)),s=[];for(let a=0;a<r.length;a+=1)s[a]=Zw(Kw(o,r,a));let n=a=>P(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=Ce()},m(a,i){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(a,i);C(a,e,i),t=!0},p(a,i){if(i&8311){r=De(r_(a[19].documents));let l;for(l=0;l<r.length;l+=1){let f=Kw(a,r,l);s[l]?(s[l].p(f,i),k(s[l],1)):(s[l]=Zw(f),s[l].c(),k(s[l],1),s[l].m(e.parentNode,e))}for(we(),l=r.length;l<s.length;l+=1)n(l);_e()}},i(a){if(!t){for(let i=0;i<r.length;i+=1)k(s[i]);t=!0}},o(a){s=s.filter(o_);for(let i=0;i<s.length;i+=1)P(s[i]);t=!1},d(a){a&&L(e),tt(s,a)}}}function jw(o){let e,t=t_(o[23].queueState.timestamp)+"",r;return{c(){e=z("\u2022 "),r=z(t)},m(s,n){C(s,e,n),C(s,r,n)},p(s,n){n&3&&t!==(t=t_(s[23].queueState.timestamp)+"")&&se(r,t)},d(s){s&&(L(e),L(r))}}}function Yw(o){let e,t=o[23].queueState.error+"",r;return{c(){e=T("div"),r=z(t),b(e,"class","error-message svelte-18bqwhy")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n&3&&t!==(t=s[23].queueState.error+"")&&se(r,t)},d(s){s&&L(e)}}}function Jw(o){let e,t,r,s,n,a;t=new Cd({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function i(){return o[10](o[23])}return{c(){e=T("button"),H(t.$$.fragment),r=z(`
							Retry`),b(e,"class","mod-warning svelte-18bqwhy")},m(l,f){C(l,e,f),B(t,e,null),S(e,r),s=!0,n||(a=re(e,"click",i),n=!0)},p(l,f){o=l},i(l){s||(k(t.$$.fragment,l),s=!0)},o(l){P(t.$$.fragment,l),s=!1},d(l){l&&L(e),N(t),n=!1,a()}}}function GD(o){var g,h,_;let e,t,r=o[5](o[23]).text+"",s,n,a,i,l,f,u=((g=o[23].queueState)==null?void 0:g.timestamp)&&jw(o),d=((h=o[23].queueState)==null?void 0:h.error)&&Yw(o),m=((_=o[23].queueState)==null?void 0:_.status)==="failed"&&Jw(o);return{c(){e=T("div"),t=T("span"),s=z(r),n=U(),u&&u.c(),a=U(),d&&d.c(),i=U(),m&&m.c(),l=Ce(),b(t,"class","details svelte-18bqwhy"),b(e,"class","details-container svelte-18bqwhy")},m(w,v){C(w,e,v),S(e,t),S(t,s),S(t,n),u&&u.m(t,null),S(t,a),d&&d.m(t,null),C(w,i,v),m&&m.m(w,v),C(w,l,v),f=!0},p(w,v){var M,R,D;(!f||v&3)&&r!==(r=w[5](w[23]).text+"")&&se(s,r),(M=w[23].queueState)!=null&&M.timestamp?u?u.p(w,v):(u=jw(w),u.c(),u.m(t,a)):u&&(u.d(1),u=null),(R=w[23].queueState)!=null&&R.error?d?d.p(w,v):(d=Yw(w),d.c(),d.m(t,null)):d&&(d.d(1),d=null),((D=w[23].queueState)==null?void 0:D.status)==="failed"?m?(m.p(w,v),v&3&&k(m,1)):(m=Jw(w),m.c(),k(m,1),m.m(l.parentNode,l)):m&&(we(),P(m,1,1,()=>{m=null}),_e())},i(w){f||(k(m),f=!0)},o(w){P(m),f=!1},d(w){w&&(L(e),L(i),L(l)),u&&u.d(),d&&d.d(),m&&m.d(w)}}}function jD(o){let e,t=o[9].default,r=ge(t,o,o[13],null),s=r||GD(o);return{c(){s&&s.c()},m(n,a){s&&s.m(n,a),e=!0},p(n,a){r?r.p&&(!e||a&8192)&&xe(r,t,n,n[13],e?ye(t,n[13],a,null):be(n[13]),null):s&&s.p&&(!e||a&3)&&s.p(n,e?a:-1)},i(n){e||(k(s,n),e=!0)},o(n){P(s,n),e=!1},d(n){s&&s.d(n)}}}function YD(o){let e,t,r,s,n=o[23].path.split("/").pop()+"",a,i;var l=o[5](o[23]).icon;function f(u,d){return{props:{size:16,class:"svg-icon "+u[5](u[23]).iconClass}}}return l&&(t=qn(l,f(o))),{c(){e=T("span"),t&&H(t.$$.fragment),r=U(),s=T("span"),a=z(n),b(e,"slot","name"),b(e,"class","file-name svelte-18bqwhy")},m(u,d){C(u,e,d),t&&B(t,e,null),S(e,r),S(e,s),S(s,a),i=!0},p(u,d){if(d&3&&l!==(l=u[5](u[23]).icon)){if(t){we();let m=t;P(m.$$.fragment,1,0,()=>{N(m,1)}),_e()}l?(t=qn(l,f(u,d)),H(t.$$.fragment),k(t.$$.fragment,1),B(t,e,r)):t=null}else if(l){let m={};d&3&&(m.class="svg-icon "+u[5](u[23]).iconClass),t.$set(m)}(!i||d&3)&&n!==(n=u[23].path.split("/").pop()+"")&&se(a,n)},i(u){i||(t&&k(t.$$.fragment,u),i=!0)},o(u){t&&P(t.$$.fragment,u),i=!1},d(u){u&&L(e),t&&N(t)}}}function Qw(o){let e,t;return e=new Ht({props:{$$slots:{name:[YD],default:[jD]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&8195&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Xw(o){let e,t;return e=new Ht({props:{$$slots:{name:[JD]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&8195&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function JD(o){let e,t,r=e_(o[1](o[20]).remainingCount)+"",s,n,a=o[20].title.toLowerCase()+"",i,l,f,u,d,m,g,h;function _(){return o[11](o[20])}function w(...v){return o[12](o[20],...v)}return{c(){var v;e=T("span"),t=z("...and "),s=z(r),n=z(` more
					`),i=z(a),l=U(),f=T("span"),u=z("(show more)"),m=U(),b(f,"class","show-more-link svelte-18bqwhy"),b(f,"role","button"),b(f,"tabindex","0"),b(f,"aria-label",d=`Show ${((v=o[2][o[20].title])==null?void 0:v.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),b(e,"slot","name"),b(e,"class","more-files svelte-18bqwhy")},m(v,M){C(v,e,M),S(e,t),S(e,s),S(e,n),S(e,i),S(e,l),S(e,f),S(f,u),S(e,m),g||(h=[re(f,"click",_),re(f,"keydown",w)],g=!0)},p(v,M){var R;o=v,M&3&&r!==(r=e_(o[1](o[20]).remainingCount)+"")&&se(s,r),M&1&&a!==(a=o[20].title.toLowerCase()+"")&&se(i,a),M&1&&d!==(d=`Show ${((R=o[2][o[20].title])==null?void 0:R.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&b(f,"aria-label",d)},d(v){v&&L(e),g=!1,Ie(h)}}}function Zw(o){let e,t,r,s=o[1](o[20]).remainingCount>0,n,a;e=new Ye({props:{name:o[20].title}});let i=De(o[1](o[20]).visibleDocs),l=[];for(let d=0;d<i.length;d+=1)l[d]=Qw(Gw(o,i,d));let f=d=>P(l[d],1,1,()=>{l[d]=null}),u=s&&Xw(o);return{c(){H(e.$$.fragment),t=U();for(let d=0;d<l.length;d+=1)l[d].c();r=U(),u&&u.c(),n=Ce()},m(d,m){B(e,d,m),C(d,t,m);for(let g=0;g<l.length;g+=1)l[g]&&l[g].m(d,m);C(d,r,m),u&&u.m(d,m),C(d,n,m),a=!0},p(d,m){let g={};if(m&1&&(g.name=d[20].title),e.$set(g),m&8291){i=De(d[1](d[20]).visibleDocs);let h;for(h=0;h<i.length;h+=1){let _=Gw(d,i,h);l[h]?(l[h].p(_,m),k(l[h],1)):(l[h]=Qw(_),l[h].c(),k(l[h],1),l[h].m(r.parentNode,r))}for(we(),h=i.length;h<l.length;h+=1)f(h);_e()}m&3&&(s=d[1](d[20]).remainingCount>0),s?u?(u.p(d,m),m&3&&k(u,1)):(u=Xw(d),u.c(),k(u,1),u.m(n.parentNode,n)):u&&(we(),P(u,1,1,()=>{u=null}),_e())},i(d){if(!a){k(e.$$.fragment,d);for(let m=0;m<i.length;m+=1)k(l[m]);k(u),a=!0}},o(d){P(e.$$.fragment,d),l=l.filter(o_);for(let m=0;m<l.length;m+=1)P(l[m]);P(u),a=!1},d(d){d&&(L(t),L(r),L(n)),N(e,d),tt(l,d),u&&u.d(d)}}}function QD(o){let e;return{c(){e=T("div"),e.textContent="Loading...",b(e,"class","loading")},m(t,r){C(t,e,r)},p:J,i:J,o:J,d(t){t&&L(e)}}}function XD(o){let e,t,r,s={ctx:o,current:null,token:null,hasCatch:!1,pending:QD,then:KD,catch:zD,value:19,blocks:[,,,]};return Kn(t=o[0],s),{c(){e=Ce(),s.block.c()},m(n,a){C(n,e,a),s.block.m(n,s.anchor=a),s.mount=()=>e.parentNode,s.anchor=e,r=!0},p(n,[a]){o=n,s.ctx=o,a&1&&t!==(t=o[0])&&Kn(t,s)||zl(s,o,a)},i(n){r||(k(s.block),r=!0)},o(n){for(let a=0;a<3;a+=1){let i=s.blocks[a];P(i)}r=!1},d(n){n&&L(e),s.block.d(n),s.token=null,s=null}}}function e_(o){return new Intl.NumberFormat().format(o)}function t_(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),s=Math.floor(r/(1e3*60));if(s<1)return"just now";if(s===1)return"1 minute ago";if(s<60)return`${s} minutes ago`;let n=Math.floor(s/60);if(n===1)return"1 hour ago";if(n<24)return`${n} hours ago`;let a=Math.floor(n/24);return a===1?"yesterday":`${a} days ago`}function r_(o){let e=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="running"}),t=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="failed"}),r=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="pending"}),s=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},s.length>0&&{title:"Completed Files",documents:s}].filter(Boolean)}function ZD(o,e,t){let r,s,n,a,i,{$$slots:l={},$$scope:f}=e,{folder:u}=e,{backgroundSync:d}=e,m={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},g=ve({}),h=co(g,O=>A=>{let F=m[A.title]||m.default,V=O[A.title]||F.initialCount,q=A.documents.slice(0,V),Z=A.documents.length-V;return{visibleCount:V,visibleDocs:q,remainingCount:Z}});me(o,h,O=>t(1,i=O));function _(O){let A=m[O]||m.default;g.update(F=>Object.assign(Object.assign({},F),{[O]:(F[O]||A.initialCount)+A.incrementCount}))}function w(O){return Ge(this,void 0,void 0,function*(){var A;let F=[],V=Array.from(O.docs.values());for(let q of V){let Z=yield q.getOrigin(),j=yield q.getServerSynced(),K={guid:q.guid,path:O.getPath(q.path),doc:q,origin:Z||"unknown",serverSynced:j},W=Array.from(r).find(ie=>ie.guid===q.guid),te=Array.from(s).find(ie=>ie.guid===q.guid),Te=n.find(ie=>ie.guid===q.guid);if(W||te||Te){let ie=W||te||Te;K.queueState={status:ie.status,type:"type"in ie?ie.type:"sync",error:"error"in ie?ie.error:void 0,timestamp:"timestamp"in ie?ie.timestamp:Date.now()}}else Z==="local"&&!j?K.queueState={status:"pending",type:"sync",timestamp:Date.now()}:j?K.queueState={status:"completed",type:"sync",timestamp:Date.now()}:K.queueState={status:"pending",type:"sync",timestamp:Date.now()};F.push(K)}return{folder:O,documents:F,progress:((A=d.getGroupProgress(O))===null||A===void 0?void 0:A.percent)||0}})}function v(O){let{origin:A,serverSynced:F,queueState:V}=O,q=(V==null?void 0:V.status)||"completed",Z=(V==null?void 0:V.type)||"sync";return A==="remote"&&!F&&q==="running"&&Z==="download"?{text:"Downloading",description:"Initial acquisition",icon:md,iconClass:"mod-primary"}:A==="remote"&&!F&&q==="pending"&&Z==="download"?{text:"Queued for Download",description:"Waiting to download",icon:ni,iconClass:""}:A==="remote"&&!F&&q==="failed"&&Z==="download"?{text:"Download stuck",description:"Needs retry",icon:ai,iconClass:"mod-warning"}:A==="local"&&!F&&q==="running"&&Z==="sync"?{text:"Uploading",description:"First-time upload",icon:Md,iconClass:"mod-primary"}:A==="local"&&!F&&q==="pending"&&Z==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:ni,iconClass:""}:A==="local"&&!F&&q==="failed"&&Z==="sync"?{text:"Upload stuck",description:"Needs retry",icon:ai,iconClass:"mod-warning"}:F&&q==="running"&&Z==="sync"?{text:"Syncing",description:"Collaborative update",icon:sd,iconClass:"mod-primary"}:F&&q==="pending"&&Z==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:ni,iconClass:""}:F&&q==="failed"&&Z==="sync"?{text:"Sync stuck",description:"Needs retry",icon:ai,iconClass:"mod-warning"}:F&&q==="completed"?{text:"Complete",description:"Fully synchronized",icon:fd,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:xd,iconClass:""}}function M(O){return Ge(this,void 0,void 0,function*(){var A,F;let V={id:O.guid,guid:O.guid,path:O.path,timestamp:((A=O.queueState)===null||A===void 0?void 0:A.timestamp)||Date.now(),type:((F=O.queueState)===null||F===void 0?void 0:F.type)||"sync",status:"failed",sharedFolderGuid:O.doc.sharedFolder.guid};yield d.retryLogItem(V)})}let R=O=>M(O),D=O=>{_(O.title)},E=(O,A)=>A.key==="Enter"&&_(O.title);return o.$$set=O=>{"folder"in O&&t(7,u=O.folder),"backgroundSync"in O&&t(8,d=O.backgroundSync),"$$scope"in O&&t(13,f=O.$$scope)},o.$$.update=()=>{if(o.$$.dirty&256){e:r=new Set(d.activeSync.items())}if(o.$$.dirty&256){e:s=new Set(d.activeDownloads.items())}if(o.$$.dirty&256){e:n=d.getSyncLog()}if(o.$$.dirty&128){e:t(0,a=w(u))}},[a,i,m,h,_,v,M,u,d,l,R,D,E,f]}var vm=class extends X{constructor(e){super(),ee(this,e,ZD,XD,Q,{folder:7,backgroundSync:8},WD)}},Sm=vm;var{Map:eM}=Ns;function tM(o){Fe(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function s_(o,e,t){let r=o.slice();r[25]=e[t];let s=r[4].get(r[25].guid);return r[26]=s,r}function n_(o){let e,t;return e=new Ye({props:{name:"Sync Status"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function a_(o){let e,t;return e=new Be({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[sM]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&3072&&(n.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),s&396&&(n.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),s&536874496&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function i_(o){let e,t,r,s,n,a,i=[oM,rM],l=[];function f(u,d){return u[9]?0:1}return t=f(o,-1),r=l[t]=i[t](o),{c(){e=T("button"),r.c(),b(e,"class","mod-cta")},m(u,d){C(u,e,d),l[t].m(e,null),s=!0,n||(a=re(e,"click",o[16]),n=!0)},p(u,d){let m=t;t=f(u,d),t!==m&&(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),r=l[t],r||(r=l[t]=i[t](u),r.c()),k(r,1),r.m(e,null))},i(u){s||(k(r),s=!0)},o(u){P(r),s=!1},d(u){u&&L(e),l[t].d(),n=!1,a()}}}function rM(o){let e,t,r;return e=new Sd({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){H(e.$$.fragment),t=z(`
						Pause`)},m(s,n){B(e,s,n),C(s,t,n),r=!0},i(s){r||(k(e.$$.fragment,s),r=!0)},o(s){P(e.$$.fragment,s),r=!1},d(s){s&&L(t),N(e,s)}}}function oM(o){let e,t,r;return e=new Id({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){H(e.$$.fragment),t=z(`
						Resume`)},m(s,n){B(e,s,n),C(s,t,n),r=!0},i(s){r||(k(e.$$.fragment,s),r=!0)},o(s){P(e.$$.fragment,s),r=!1},d(s){s&&L(t),N(e,s)}}}function sM(o){let e,t,r=(o[11]||o[10])&&i_(o);return{c(){r&&r.c(),e=Ce()},m(s,n){r&&r.m(s,n),C(s,e,n),t=!0},p(s,n){s[11]||s[10]?r?(r.p(s,n),n&3072&&k(r,1)):(r=i_(s),r.c(),k(r,1),r.m(e.parentNode,e)):r&&(we(),P(r,1,1,()=>{r=null}),_e())},i(s){t||(k(r),t=!0)},o(s){P(r),t=!1},d(s){s&&L(e),r&&r.d(s)}}}function nM(o){let e=[],t=new eM,r,s,n=De(o[6]),a=i=>i[25].guid;for(let i=0;i<n.length;i+=1){let l=s_(o,n,i),f=a(l);t.set(f,e[i]=p_(f,l))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();r=Ce()},m(i,l){for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(i,l);C(i,r,l),s=!0},p(i,l){l&32851&&(n=De(i[6]),we(),e=gx(e,l,a,1,i,n,t,r.parentNode,hx,p_,r,s_),_e())},i(i){if(!s){for(let l=0;l<n.length;l+=1)k(e[l]);s=!0}},o(i){for(let l=0;l<e.length;l+=1)P(e[l]);s=!1},d(i){i&&L(r);for(let l=0;l<e.length;l+=1)e[l].d(i)}}}function aM(o){let e,t,r,s;return e=new Ye({props:{$$slots:{name:[dM],default:[fM]},$$scope:{ctx:o}}}),r=new Sm({props:{folder:o[5],backgroundSync:o[0]}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment)},m(n,a){B(e,n,a),C(n,t,a),B(r,n,a),s=!0},p(n,a){let i={};a&536875040&&(i.$$scope={dirty:a,ctx:n}),e.$set(i);let l={};a&32&&(l.folder=n[5]),a&1&&(l.backgroundSync=n[0]),r.$set(l)},i(n){s||(k(e.$$.fragment,n),k(r.$$.fragment,n),s=!0)},o(n){P(e.$$.fragment,n),P(r.$$.fragment,n),s=!1},d(n){n&&L(t),N(e,n),N(r,n)}}}function l_(o){let e,t,r,s,n,a=o[26].progress+"",i,l;return{c(){e=T("div"),t=T("div"),r=T("div"),s=U(),n=T("span"),i=z(a),l=z("%"),b(r,"class","progress-value svelte-ztgdsf"),de(r,"width",o[26].progress+"%"),b(t,"class","progress-bar svelte-ztgdsf"),b(n,"class","progress-text svelte-ztgdsf"),b(e,"class","progress-container svelte-ztgdsf")},m(f,u){C(f,e,u),S(e,t),S(t,r),S(e,s),S(e,n),S(n,i),S(n,l)},p(f,u){u&80&&de(r,"width",f[26].progress+"%"),u&80&&a!==(a=f[26].progress+"")&&se(i,a)},d(f){f&&L(e)}}}function iM(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&l_(o);return{c(){t&&t.c(),e=Ce()},m(r,s){t&&t.m(r,s),C(r,e,s)},p(r,s){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,s):(t=l_(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&L(e),t&&t.d(r)}}}function c_(o){let e,t=o[26].running+"",r,s;return{c(){e=T("span"),r=z(t),s=z(" active"),b(e,"class","tag mod-success svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&80&&t!==(t=n[26].running+"")&&se(r,t)},d(n){n&&L(e)}}}function f_(o){let e,t=o[26].failed+"",r,s;return{c(){e=T("span"),r=z(t),s=z(" stuck"),b(e,"class","tag mod-warning svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&80&&t!==(t=n[26].failed+"")&&se(r,t)},d(n){n&&L(e)}}}function u_(o){let e,t=o[26].pending+"",r,s;return{c(){e=T("span"),r=z(t),s=z(" queued"),b(e,"class","tag svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&80&&t!==(t=n[26].pending+"")&&se(r,t)},d(n){n&&L(e)}}}function lM(o){var D,E,O;let e,t,r,s,n,a=o[25].name+"",i,l,f,u,d,m,g,h,_=((D=o[26])==null?void 0:D.running)>0&&c_(o),w=((E=o[26])==null?void 0:E.failed)>0&&f_(o),v=((O=o[26])==null?void 0:O.pending)>0&&u_(o);function M(){return o[22](o[25])}function R(...A){return o[23](o[25],...A)}return{c(){e=T("div"),t=T("span"),r=z("\u25B6"),n=U(),i=z(a),l=U(),f=T("span"),_&&_.c(),u=U(),w&&w.c(),d=U(),v&&v.c(),b(t,"class",s="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),b(f,"class","sync-stats svelte-ztgdsf"),b(e,"class","folder-header svelte-ztgdsf"),b(e,"role","button"),b(e,"tabindex","0"),b(e,"aria-expanded",m=!!o[1][o[25].guid])},m(A,F){C(A,e,F),S(e,t),S(t,r),S(e,n),S(e,i),S(e,l),S(e,f),_&&_.m(f,null),S(f,u),w&&w.m(f,null),S(f,d),v&&v.m(f,null),g||(h=[re(e,"click",M),re(e,"keydown",R)],g=!0)},p(A,F){var V,q,Z;o=A,F&66&&s!==(s="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&b(t,"class",s),F&64&&a!==(a=o[25].name+"")&&se(i,a),((V=o[26])==null?void 0:V.running)>0?_?_.p(o,F):(_=c_(o),_.c(),_.m(f,u)):_&&(_.d(1),_=null),((q=o[26])==null?void 0:q.failed)>0?w?w.p(o,F):(w=f_(o),w.c(),w.m(f,d)):w&&(w.d(1),w=null),((Z=o[26])==null?void 0:Z.pending)>0?v?v.p(o,F):(v=u_(o),v.c(),v.m(f,null)):v&&(v.d(1),v=null),F&66&&m!==(m=!!o[1][o[25].guid])&&b(e,"aria-expanded",m)},d(A){A&&L(e),_&&_.d(),w&&w.d(),v&&v.d(),g=!1,Ie(h)}}}function cM(o){let e,t;return e=new fo({props:{folder:o[25],$$slots:{default:[lM]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&64&&(n.folder=r[25]),s&536870994&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function d_(o){let e,t;return e=new Sm({props:{folder:o[25],backgroundSync:o[0]}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&64&&(n.folder=r[25]),s&1&&(n.backgroundSync=r[0]),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function p_(o,e){let t,r,s,n,a;r=new Ye({props:{$$slots:{name:[cM],default:[iM]},$$scope:{ctx:e}}});let i=e[1][e[25].guid]&&d_(e);return{key:o,first:null,c(){t=Ce(),H(r.$$.fragment),s=U(),i&&i.c(),n=Ce(),this.first=t},m(l,f){C(l,t,f),B(r,l,f),C(l,s,f),i&&i.m(l,f),C(l,n,f),a=!0},p(l,f){e=l;let u={};f&536870994&&(u.$$scope={dirty:f,ctx:e}),r.$set(u),e[1][e[25].guid]?i?(i.p(e,f),f&66&&k(i,1)):(i=d_(e),i.c(),k(i,1),i.m(n.parentNode,n)):i&&(we(),P(i,1,1,()=>{i=null}),_e())},i(l){a||(k(r.$$.fragment,l),k(i),a=!0)},o(l){P(r.$$.fragment,l),P(i),a=!1},d(l){l&&(L(t),L(s),L(n)),N(r,l),i&&i.d(l)}}}function m_(o){let e,t,r,s,n,a=o[12].progress+"",i,l;return{c(){e=T("div"),t=T("div"),r=T("div"),s=U(),n=T("span"),i=z(a),l=z("%"),b(r,"class","progress-value svelte-ztgdsf"),de(r,"width",o[12].progress+"%"),b(t,"class","progress-bar svelte-ztgdsf"),b(n,"class","progress-text svelte-ztgdsf"),b(e,"class","progress-container svelte-ztgdsf")},m(f,u){C(f,e,u),S(e,t),S(t,r),S(e,s),S(e,n),S(n,i),S(n,l)},p(f,u){u&4096&&de(r,"width",f[12].progress+"%"),u&4096&&a!==(a=f[12].progress+"")&&se(i,a)},d(f){f&&L(e)}}}function fM(o){let e,t=(o[12].running>0||o[12].failed>0)&&m_(o);return{c(){t&&t.c(),e=Ce()},m(r,s){t&&t.m(r,s),C(r,e,s)},p(r,s){r[12].running>0||r[12].failed>0?t?t.p(r,s):(t=m_(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&L(e),t&&t.d(r)}}}function h_(o){let e,t=o[12].running+"",r,s;return{c(){e=T("span"),r=z(t),s=z(" active"),b(e,"class","tag mod-success svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&4096&&t!==(t=n[12].running+"")&&se(r,t)},d(n){n&&L(e)}}}function g_(o){let e,t=o[12].failed+"",r,s;return{c(){e=T("span"),r=z(t),s=z(" stuck"),b(e,"class","tag mod-warning svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&4096&&t!==(t=n[12].failed+"")&&se(r,t)},d(n){n&&L(e)}}}function y_(o){let e,t=o[12].pending+"",r,s;return{c(){e=T("span"),r=z(t),s=z(" queued"),b(e,"class","tag svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&4096&&t!==(t=n[12].pending+"")&&se(r,t)},d(n){n&&L(e)}}}function uM(o){let e,t=o[5].name+"",r,s,n,a,i,l=o[12].running>0&&h_(o),f=o[12].failed>0&&g_(o),u=o[12].pending>0&&y_(o);return{c(){e=T("div"),r=z(t),s=U(),n=T("span"),l&&l.c(),a=U(),f&&f.c(),i=U(),u&&u.c(),b(n,"class","sync-stats svelte-ztgdsf"),b(e,"class","folder-header svelte-ztgdsf")},m(d,m){C(d,e,m),S(e,r),S(e,s),S(e,n),l&&l.m(n,null),S(n,a),f&&f.m(n,null),S(n,i),u&&u.m(n,null)},p(d,m){m&32&&t!==(t=d[5].name+"")&&se(r,t),d[12].running>0?l?l.p(d,m):(l=h_(d),l.c(),l.m(n,a)):l&&(l.d(1),l=null),d[12].failed>0?f?f.p(d,m):(f=g_(d),f.c(),f.m(n,i)):f&&(f.d(1),f=null),d[12].pending>0?u?u.p(d,m):(u=y_(d),u.c(),u.m(n,null)):u&&(u.d(1),u=null)},d(d){d&&L(e),l&&l.d(),f&&f.d(),u&&u.d()}}}function dM(o){let e,t;return e=new fo({props:{folder:o[5],$$slots:{default:[uM]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&32&&(n.folder=r[5]),s&536875040&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function pM(o){let e,t,r,s,n,a,i=!o[5]&&n_(o),l=!o[5]&&a_(o),f=[aM,nM],u=[];function d(m,g){return m[5]&&m[12]?0:1}return s=d(o,-1),n=u[s]=f[s](o),{c(){e=T("div"),i&&i.c(),t=U(),l&&l.c(),r=U(),n.c(),b(e,"class","setting-item-container")},m(m,g){C(m,e,g),i&&i.m(e,null),S(e,t),l&&l.m(e,null),S(e,r),u[s].m(e,null),a=!0},p(m,[g]){m[5]?i&&(we(),P(i,1,1,()=>{i=null}),_e()):i?g&32&&k(i,1):(i=n_(m),i.c(),k(i,1),i.m(e,t)),m[5]?l&&(we(),P(l,1,1,()=>{l=null}),_e()):l?(l.p(m,g),g&32&&k(l,1)):(l=a_(m),l.c(),k(l,1),l.m(e,r));let h=s;s=d(m,g),s===h?u[s].p(m,g):(we(),P(u[h],1,1,()=>{u[h]=null}),_e(),n=u[s],n?n.p(m,g):(n=u[s]=f[s](m),n.c()),k(n,1),n.m(e,null))},i(m){a||(k(i),k(l),k(n),a=!0)},o(m){P(i),P(l),P(n),a=!1},d(m){m&&L(e),i&&i.d(),l&&l.d(),u[s].d()}}}function mM(o,e,t){let r,s,n,a,i,l,f,u,d,m,g,{backgroundSync:h}=e,{sharedFolders:_}=e,{focusedFolderGuid:w}=e,v={},M=0,R=0,D=0,E=0,{activeSync:O,activeDownloads:A}=h;me(o,O,j=>t(21,g=j)),me(o,A,j=>t(20,m=j));function F(j){t(1,v[j]=!v[j],v),t(1,v),t(6,r),t(17,_)}function V(){l?h.resume():h.pause()}let q=j=>F(j.guid),Z=(j,K)=>K.key==="Enter"&&F(j.guid);return o.$$set=j=>{"backgroundSync"in j&&t(0,h=j.backgroundSync),"sharedFolders"in j&&t(17,_=j.sharedFolders),"focusedFolderGuid"in j&&t(18,w=j.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072){e:t(6,r=_.items().sort((j,K)=>j.name.localeCompare(K.name)))}if(o.$$.dirty&66){e:r.forEach(j=>{j.guid in v||t(1,v[j.guid]=!0,v)}),t(1,v),t(6,r),t(17,_)}if(o.$$.dirty&393216){e:t(5,s=w?_.items().find(j=>j.guid===w):void 0)}if(o.$$.dirty&3145793){e:t(4,n=new Map(r.map(j=>{var K,W;return[j.guid,{progress:((K=h.getGroupProgress(j))===null||K===void 0?void 0:K.percent)||0,running:[...g.items(),...m.items()].filter(te=>te.sharedFolder.guid===j.guid).length,failed:((W=h.syncGroups.get(j))===null||W===void 0?void 0:W.status)==="failed"?1:0,pending:[...h.pendingSyncs,...h.pendingDownloads].filter(te=>te.sharedFolder.guid===j.guid).length,completed:(()=>{let te=h.syncGroups.get(j);return((te==null?void 0:te.completedSyncs)||0)+((te==null?void 0:te.completedDownloads)||0)})(),sharedFolder:j}]})))}if(o.$$.dirty&48){e:t(12,a=s?n.get(s.guid):void 0)}if(o.$$.dirty&1){e:t(19,i=h.getQueueStatus())}if(o.$$.dirty&524288){e:t(9,l=i.isPaused)}if(o.$$.dirty&524288){e:f=i.syncsActive>0||i.downloadsActive>0}if(o.$$.dirty&16){e:{let j=0,K=0,W=0,te=0;for(let Te of n.values())j+=Te.running,K+=Te.failed,W+=Te.pending,te+=Te.completed;t(2,M=j),t(7,R=K),t(3,D=W),t(8,E=te)}}if(o.$$.dirty&4){e:t(11,u=M>0)}if(o.$$.dirty&8){e:t(10,d=D>0)}},[h,v,M,D,n,s,r,R,E,l,d,u,a,O,A,F,V,_,w,i,m,g,q,Z]}var km=class extends X{constructor(e){super(),ee(this,e,mM,pM,Q,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},tM)}},x_=km;var bi=class extends b_.Modal{constructor(t,r,s,n){super(t);this.backgroundSync=r;this.sharedFolders=s;this.focusedFolderGuid=n}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new x_({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function Im(o){return o.startsWith("v")?o.slice(1):o}function hM(o,e){return o.map((t,r)=>[t,e[r]])}function gM(o,e){try{let t=Im(o).split(".").map(parseInt),r=Im(e).split(".").map(parseInt);for(let[s,n]of hM(t,r))if(s>n)return!0}catch(t){}return!1}var Bc=class extends it{constructor(t,r,s){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=s;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.githubReleases=new Oo("system3-relay/releases"),this.releaseChannels=new Oo("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await Pt("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let s=await r.json();return et().enableNetworkLogging&&this.debug("GitHub releases fetched:",s),s}async fetchLatestRelease(){try{let s="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${s}`);let n=await Pt(s,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`GitHub API error: ${n.status}`);return await n.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],s=r?await this.fetchRepoManifest(r):null;return s?(this.debug("repo manifest",s),s.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<5*60*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t,(await this.fetchReleases()).forEach(n=>{this.githubReleases.set(n.tag_name,n)});let s=await this.fetchLatestRelease();s&&(s.latest=!0,this.githubReleases.set(s.tag_name,s)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<5*60*1e3&&r)return r;this.lastReleaseCheck=t;let s=await this.getReleases();if(s.length===0)return this.debug("No releases found"),null;let n=this.releaseSettings.get().channel;if(!n)return null;let a=await this.fetchLatestTagFromChannel(n);if(!a)return null;let i=s.find(l=>Im(l.tag_name)===a);return i?(this.releaseChannels.set(n,i),this.notifyListeners(),i):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let a=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${a}`);let i=await Pt(a);if(!i.ok)throw new Error("unable to fetch manifest");return await i.json()}catch(s){return this.error("Failed to fetch:",s),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(a=>a.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let s=await Pt(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`Failed to fetch manifest asset: ${s.status}`);let n=await s.json();return et().enableNetworkLogging&&this.debug("manifest fetched:",n),n}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&gM(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let s="system3-relay",n=this.plugin.app.plugins;return await n.disablePlugin(s),await n.enablePlugin(s),!0}catch(s){return this.error("Failed to install update:",s),!1}}applyAutomaticUpdates(){if(this.releaseSettings.get().automaticUpdates){let t=this.getNewRelease();t&&this.installUpdate(t)}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var U_=require("obsidian");var R_=require("obsidian");function yM(o){Fe(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function w_(o,e,t){let r=o.slice();return r[71]=e[t],r}function xM(o){let e,t;return e=new Ht({props:{name:"Automatically install updates",$$slots:{default:[bM]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&128|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function bM(o){let e,t,r,s,n,a;return{c(){e=T("div"),t=T("input"),r=U(),s=T("div"),b(t,"type","checkbox"),t.checked=o[7],b(s,"class","checkbox-toggle"),b(e,"class","checkbox-container svelte-12doke6"),b(e,"role","checkbox"),b(e,"aria-checked",o[7]),b(e,"tabindex","0"),qe(e,"is-enabled",o[7])},m(i,l){C(i,e,l),S(e,t),S(e,r),S(e,s),n||(a=[re(e,"click",o[44]),re(e,"keydown",o[45])],n=!0)},p(i,l){l[0]&128&&(t.checked=i[7]),l[0]&128&&b(e,"aria-checked",i[7]),l[0]&128&&qe(e,"is-enabled",i[7])},d(i){i&&L(e),n=!1,Ie(a)}}}function __(o){let e,t;return e=new Ht({props:{name:"Show all releases",$$slots:{default:[wM]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&64|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function wM(o){let e,t,r,s,n,a;return{c(){e=T("div"),t=T("input"),r=U(),s=T("div"),b(t,"type","checkbox"),t.checked=o[6],b(s,"class","checkbox-toggle"),b(e,"class","checkbox-container svelte-12doke6"),b(e,"role","checkbox"),b(e,"aria-checked",o[6]),b(e,"tabindex","0"),qe(e,"is-enabled",o[6])},m(i,l){C(i,e,l),S(e,t),S(e,r),S(e,s),n||(a=[re(e,"click",o[46]),re(e,"keydown",o[47])],n=!0)},p(i,l){l[0]&64&&(t.checked=i[6]),l[0]&64&&b(e,"aria-checked",i[6]),l[0]&64&&qe(e,"is-enabled",i[6])},d(i){i&&L(e),n=!1,Ie(a)}}}function _M(o){let e,t,r=(!o[1]||o[7])&&v_(o);function s(i,l){if(i[12])return LM;if(i[17])return IM}let n=s(o,[-1,-1,-1]),a=n&&n(o);return{c(){r&&r.c(),e=U(),a&&a.c(),t=Ce()},m(i,l){r&&r.m(i,l),C(i,e,l),a&&a.m(i,l),C(i,t,l)},p(i,l){!i[1]||i[7]?r?r.p(i,l):(r=v_(i),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),n===(n=s(i,l))&&a?a.p(i,l):(a&&a.d(1),a=n&&n(i),a&&(a.c(),a.m(t.parentNode,t)))},d(i){i&&(L(e),L(t)),r&&r.d(i),a&&a.d(i)}}}function vM(o){let e;return{c(){e=T("div"),e.textContent="No matching releases found with the current filter",b(e,"class","no-releases-text svelte-12doke6")},m(t,r){C(t,e,r)},p:J,d(t){t&&L(e)}}}function SM(o){let e;return{c(){e=T("div"),e.textContent="No GitHub releases found",b(e,"class","no-releases-text svelte-12doke6")},m(t,r){C(t,e,r)},p:J,d(t){t&&L(e)}}}function kM(o){let e;return{c(){e=T("div"),e.textContent="Loading GitHub releases...",b(e,"class","loading-text svelte-12doke6")},m(t,r){C(t,e,r)},p:J,d(t){t&&L(e)}}}function v_(o){let e,t,r,s=!o[7]&&!o[9].some(o[43]),n,a=o[5]&&S_(o),i=o[4]&&k_(o),l=s&&I_(o),f=!o[7]&&!o[1]&&L_(o);return{c(){e=T("div"),a&&a.c(),t=U(),i&&i.c(),r=U(),l&&l.c(),n=U(),f&&f.c(),b(e,"class","release-tags-container svelte-12doke6")},m(u,d){C(u,e,d),a&&a.m(e,null),S(e,t),i&&i.m(e,null),S(e,r),l&&l.m(e,null),S(e,n),f&&f.m(e,null)},p(u,d){u[5]?a?a.p(u,d):(a=S_(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null),u[4]?i?i.p(u,d):(i=k_(u),i.c(),i.m(e,r)):i&&(i.d(1),i=null),d[0]&640&&(s=!u[7]&&!u[9].some(u[43])),s?l?l.p(u,d):(l=I_(u),l.c(),l.m(e,n)):l&&(l.d(1),l=null),!u[7]&&!u[1]?f?f.p(u,d):(f=L_(u),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(u){u&&L(e),a&&a.d(),i&&i.d(),l&&l.d(),f&&f.d()}}}function S_(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),t.textContent="Stable",b(t,"class","tag-name svelte-12doke6"),b(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",r=o[10]==="stable"),b(e,"tabindex","0")},m(a,i){C(a,e,i),S(e,t),s||(n=[re(e,"click",o[48]),re(e,"keydown",o[49])],s=!0)},p(a,i){i[0]&1024&&r!==(r=a[10]==="stable")&&b(e,"aria-selected",r)},d(a){a&&L(e),s=!1,Ie(n)}}}function k_(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),t.textContent="Beta",b(t,"class","tag-name svelte-12doke6"),b(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",r=o[10]==="beta"),b(e,"tabindex","0")},m(a,i){C(a,e,i),S(e,t),s||(n=[re(e,"click",o[50]),re(e,"keydown",o[51])],s=!0)},p(a,i){i[0]&1024&&r!==(r=a[10]==="beta")&&b(e,"aria-selected",r)},d(a){a&&L(e),s=!1,Ie(n)}}}function I_(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),t.textContent="Dev",b(t,"class","tag-name svelte-12doke6"),b(e,"class","release-tag-item development-version svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",r=o[11]===o[0].version),b(e,"tabindex","0")},m(a,i){C(a,e,i),S(e,t),s||(n=[re(e,"click",o[52]),re(e,"keydown",o[53])],s=!0)},p(a,i){i[0]&2049&&r!==(r=a[11]===a[0].version)&&b(e,"aria-selected",r)},d(a){a&&L(e),s=!1,Ie(n)}}}function L_(o){let e,t=De(o[9]),r=[];for(let s=0;s<t.length;s+=1)r[s]=C_(w_(o,t,s));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=Ce()},m(s,n){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(s,n);C(s,e,n)},p(s,n){if(n[0]&536873472|n[1]&130){t=De(s[9]);let a;for(a=0;a<t.length;a+=1){let i=w_(s,t,a);r[a]?r[a].p(i,n):(r[a]=C_(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&L(e),tt(r,s)}}}function C_(o){let e,t,r=o[71].tag_name+"",s,n,a,i,l,f;function u(){return o[54](o[71])}function d(...m){return o[55](o[71],...m)}return{c(){e=T("div"),t=T("div"),s=z(r),n=U(),b(t,"class","tag-name svelte-12doke6"),b(e,"class",a="release-tag-item "+(o[29](o[71].tag_name)?"current-version":"")+" "+(E_(o[71])?"pre-release":"")+" svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",i=o[11]===o[71].tag_name),b(e,"tabindex","0")},m(m,g){C(m,e,g),S(e,t),S(t,s),S(e,n),l||(f=[re(e,"click",u),re(e,"keydown",d)],l=!0)},p(m,g){o=m,g[0]&512&&r!==(r=o[71].tag_name+"")&&se(s,r),g[0]&512&&a!==(a="release-tag-item "+(o[29](o[71].tag_name)?"current-version":"")+" "+(E_(o[71])?"pre-release":"")+" svelte-12doke6")&&b(e,"class",a),g[0]&2560&&i!==(i=o[11]===o[71].tag_name)&&b(e,"aria-selected",i)},d(m){m&&L(e),l=!1,Ie(f)}}}function IM(o){let e,t,r,s,n,a,i;return{c(){e=T("div"),t=T("div"),r=z(o[17]),s=U(),n=T("button"),n.textContent="Close",b(t,"class","manifest-error-message svelte-12doke6"),b(n,"class","manifest-close-btn svelte-12doke6"),b(e,"class","manifest-error svelte-12doke6")},m(l,f){C(l,e,f),S(e,t),S(t,r),S(e,s),S(e,n),a||(i=re(n,"click",o[40]),a=!0)},p(l,f){f[0]&131072&&se(r,l[17])},d(l){l&&L(e),a=!1,i()}}}function LM(o){var j;let e,t,r,s,n,a,i=(j=o[41](o[11]))==null?void 0:j.prerelease,l,f,u,d,m,g,h,_,w,v,M=i&&T_(o),R=o[13][o[11]]==="beta-alias"&&P_(o),D=o[13][o[11]]==="stable-alias"&&A_(o);function E(K,W){if(W[0]&18432&&(m=null),W[0]&2048&&(g=null),m==null&&(m=!!((K[41](K[11])||K[14][K[11]]==="stable-alias"||K[14][K[11]]==="beta-alias")&&!K[29](K[11]))),m)return TM;if(g==null&&(g=!!K[29](K[11])),g)return CM}let O=E(o,[-1,-1,-1]),A=O&&O(o);function F(K,W){return K[14][K[11]]==="stable-alias"||K[14][K[11]]==="beta-alias"||K[10]==="development"?MM:K[11]?DM:FM}let V=F(o,[-1,-1,-1]),q=V(o),Z=o[16]&&F_(o);return{c(){e=T("div"),t=T("div"),r=T("h3"),s=z("Release Details: "),n=z(o[11]),a=U(),M&&M.c(),l=U(),R&&R.c(),f=U(),D&&D.c(),u=U(),d=T("div"),A&&A.c(),h=U(),_=T("div"),w=T("div"),q.c(),v=U(),Z&&Z.c(),b(r,"class","svelte-12doke6"),b(d,"class","manifest-header-actions svelte-12doke6"),b(t,"class","manifest-header svelte-12doke6"),b(w,"class","release-changelog-content svelte-12doke6"),b(_,"class","release-changelog svelte-12doke6"),b(e,"class","manifest-container svelte-12doke6")},m(K,W){C(K,e,W),S(e,t),S(t,r),S(r,s),S(r,n),S(r,a),M&&M.m(r,null),S(r,l),R&&R.m(r,null),S(r,f),D&&D.m(r,null),S(t,u),S(t,d),A&&A.m(d,null),S(e,h),S(e,_),S(_,w),q.m(w,null),S(e,v),Z&&Z.m(e,null)},p(K,W){var te;W[0]&2048&&se(n,K[11]),W[0]&2048&&(i=(te=K[41](K[11]))==null?void 0:te.prerelease),i?M||(M=T_(K),M.c(),M.m(r,l)):M&&(M.d(1),M=null),K[13][K[11]]==="beta-alias"?R||(R=P_(K),R.c(),R.m(r,f)):R&&(R.d(1),R=null),K[13][K[11]]==="stable-alias"?D||(D=A_(K),D.c(),D.m(r,null)):D&&(D.d(1),D=null),O===(O=E(K,W))&&A?A.p(K,W):(A&&A.d(1),A=O&&O(K),A&&(A.c(),A.m(d,null))),V===(V=F(K,W))&&q?q.p(K,W):(q.d(1),q=V(K),q&&(q.c(),q.m(w,null))),K[16]?Z?Z.p(K,W):(Z=F_(K),Z.c(),Z.m(e,null)):Z&&(Z.d(1),Z=null)},d(K){K&&L(e),M&&M.d(),R&&R.d(),D&&D.d(),A&&A.d(),q.d(),Z&&Z.d()}}}function T_(o){let e;return{c(){e=T("span"),e.textContent="Pre-release",b(e,"class","prerelease-badge svelte-12doke6")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function P_(o){let e;return{c(){e=T("span"),e.textContent="Beta",b(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function A_(o){let e;return{c(){e=T("span"),e.textContent="Stable",b(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function CM(o){let e;return{c(){e=T("span"),e.textContent="Installed",b(e,"class","currently-installed svelte-12doke6")},m(t,r){C(t,e,r)},p:J,d(t){t&&L(e)}}}function TM(o){let e,t,r,s;function n(l,f){return l[15]===l[11]?AM:PM}let a=n(o,[-1,-1,-1]),i=a(o);return{c(){e=T("button"),i.c(),b(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[15]===o[11]||o[2]},m(l,f){C(l,e,f),i.m(e,null),r||(s=re(e,"click",o[56]),r=!0)},p(l,f){a!==(a=n(l,f))&&(i.d(1),i=a(l),i&&(i.c(),i.m(e,null))),f[0]&34820&&t!==(t=l[15]===l[11]||l[2])&&(e.disabled=t)},d(l){l&&L(e),i.d(),r=!1,s()}}}function PM(o){let e;return{c(){e=z("Install")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function AM(o){let e;return{c(){e=z("Installing...")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function FM(o){let e;return{c(){e=z('"No changelog available"')},m(t,r){C(t,e,r)},p:J,d(t){t&&L(e)}}}function DM(o){var s;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:OM,then:RM,catch:EM,value:70};return Kn(t=o[37](((s=o[41](o[11]))==null?void 0:s.body)||"No changelog available"),r),{c(){e=Ce(),r.block.c()},m(n,a){C(n,e,a),r.block.m(n,r.anchor=a),r.mount=()=>e.parentNode,r.anchor=e},p(n,a){var i;o=n,r.ctx=o,a[0]&2048&&t!==(t=o[37](((i=o[41](o[11]))==null?void 0:i.body)||"No changelog available"))&&Kn(t,r)||zl(r,o,a)},d(n){n&&L(e),r.block.d(n),r.token=null,r=null}}}function MM(o){let e;function t(n,a){if(n[14][n[11]]==="stable-alias")return BM;if(n[14][n[11]]==="beta-alias")return $M;if(n[11]===n[0].version)return UM}let r=t(o,[-1,-1,-1]),s=r&&r(o);return{c(){s&&s.c(),e=Ce()},m(n,a){s&&s.m(n,a),C(n,e,a)},p(n,a){r!==(r=t(n,a))&&(s&&s.d(1),s=r&&r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&L(e),s&&s.d(n)}}}function EM(o){return{c:J,m:J,p:J,d:J}}function RM(o){let e,t=o[70]+"",r;return{c(){e=new Vn(!1),r=Ce(),e.a=r},m(s,n){e.m(t,s,n),C(s,r,n)},p(s,n){n[0]&2048&&t!==(t=s[70]+"")&&e.p(t)},d(s){s&&(L(r),e.d())}}}function OM(o){let e;return{c(){e=z('"loading..."')},m(t,r){C(t,e,r)},p:J,d(t){t&&L(e)}}}function UM(o){let e;return{c(){e=T("p"),e.textContent="Current development version"},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function $M(o){let e;return{c(){e=T("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function BM(o){let e;return{c(){e=T("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function F_(o){let e,t,r,s,n,a=o[12].version+"",i,l,f=o[11]!==o[12].version&&!o[11].startsWith("v"+o[12].version),u,d,m,g,h,_=o[12].name+"",w,v,M,R,D,E,O=o[12].author+"",A,F,V,q,Z,j,K=o[12].description+"",W,te,Te,ie,Pe,Ke,Oe=o[12].isDesktopOnly?"Yes":"No",pe,fe,oe,Ne,It,Wt,zt=o[12].minAppVersion+"",dt,gt=f&&D_(o);return{c(){e=T("div"),t=T("div"),r=T("span"),r.textContent="Version:",s=U(),n=T("span"),i=z(a),l=U(),gt&&gt.c(),u=U(),d=T("div"),m=T("span"),m.textContent="Name:",g=U(),h=T("span"),w=z(_),v=U(),M=T("div"),R=T("span"),R.textContent="Author:",D=U(),E=T("span"),A=z(O),F=U(),V=T("div"),q=T("span"),q.textContent="Description:",Z=U(),j=T("span"),W=z(K),te=U(),Te=T("div"),ie=T("span"),ie.textContent="isDesktopOnly:",Pe=U(),Ke=T("span"),pe=z(Oe),fe=U(),oe=T("div"),Ne=T("span"),Ne.textContent="minAppVersion:",It=U(),Wt=T("span"),dt=z(zt),b(r,"class","manifest-label svelte-12doke6"),b(n,"class","manifest-value svelte-12doke6"),b(t,"class","manifest-field svelte-12doke6"),b(m,"class","manifest-label svelte-12doke6"),b(h,"class","manifest-value svelte-12doke6"),b(d,"class","manifest-field svelte-12doke6"),b(R,"class","manifest-label svelte-12doke6"),b(E,"class","manifest-value svelte-12doke6"),b(M,"class","manifest-field svelte-12doke6"),b(q,"class","manifest-label svelte-12doke6"),b(j,"class","manifest-value svelte-12doke6"),b(V,"class","manifest-field svelte-12doke6"),b(ie,"class","manifest-label svelte-12doke6"),b(Ke,"class","manifest-value svelte-12doke6"),b(Te,"class","manifest-field svelte-12doke6"),b(Ne,"class","manifest-label svelte-12doke6"),b(Wt,"class","manifest-value svelte-12doke6"),b(oe,"class","manifest-field svelte-12doke6"),b(e,"class","manifest-content svelte-12doke6")},m(pt,Kt){C(pt,e,Kt),S(e,t),S(t,r),S(t,s),S(t,n),S(n,i),S(t,l),gt&&gt.m(t,null),S(e,u),S(e,d),S(d,m),S(d,g),S(d,h),S(h,w),S(e,v),S(e,M),S(M,R),S(M,D),S(M,E),S(E,A),S(e,F),S(e,V),S(V,q),S(V,Z),S(V,j),S(j,W),S(e,te),S(e,Te),S(Te,ie),S(Te,Pe),S(Te,Ke),S(Ke,pe),S(e,fe),S(e,oe),S(oe,Ne),S(oe,It),S(oe,Wt),S(Wt,dt)},p(pt,Kt){Kt[0]&4096&&a!==(a=pt[12].version+"")&&se(i,a),Kt[0]&6144&&(f=pt[11]!==pt[12].version&&!pt[11].startsWith("v"+pt[12].version)),f?gt||(gt=D_(pt),gt.c(),gt.m(t,null)):gt&&(gt.d(1),gt=null),Kt[0]&4096&&_!==(_=pt[12].name+"")&&se(w,_),Kt[0]&4096&&O!==(O=pt[12].author+"")&&se(A,O),Kt[0]&4096&&K!==(K=pt[12].description+"")&&se(W,K),Kt[0]&4096&&Oe!==(Oe=pt[12].isDesktopOnly?"Yes":"No")&&se(pe,Oe),Kt[0]&4096&&zt!==(zt=pt[12].minAppVersion+"")&&se(dt,zt)},d(pt){pt&&L(e),gt&&gt.d()}}}function D_(o){let e;return{c(){e=T("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,b(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function NM(o){let e,t=o[1]?"Relay installer":"Relay releases",r,s,n,a,i,l,f=et().enableAutomaticUpdatesOption,u,d,m,g=f&&xM(o),h=!o[7]&&!o[1]&&__(o);function _(M,R){return M[8]?kM:M[3].length===0?SM:M[9].length===0?vM:_M}let w=_(o,[-1,-1,-1]),v=w(o);return{c(){e=T("div"),r=z(t),s=U(),n=T("div"),a=T("div"),i=U(),l=T("div"),g&&g.c(),u=U(),h&&h.c(),d=U(),v.c(),b(e,"class","modal-title"),b(a,"class","settings-spacer svelte-12doke6"),b(l,"class","settings-container svelte-12doke6"),b(n,"class","modal-content svelte-12doke6")},m(M,R){C(M,e,R),S(e,r),C(M,s,R),C(M,n,R),S(n,a),S(n,i),S(n,l),g&&g.m(l,null),S(l,u),h&&h.m(l,null),S(n,d),v.m(n,null),m=!0},p(M,R){(!m||R[0]&2)&&t!==(t=M[1]?"Relay installer":"Relay releases")&&se(r,t),f&&g.p(M,R),!M[7]&&!M[1]?h?(h.p(M,R),R[0]&130&&k(h,1)):(h=__(M),h.c(),k(h,1),h.m(l,null)):h&&(we(),P(h,1,1,()=>{h=null}),_e()),w===(w=_(M,R))&&v?v.p(M,R):(v.d(1),v=w(M),v&&(v.c(),v.m(n,null)))},i(M){m||(k(g),k(h),m=!0)},o(M){P(g),P(h),m=!1},d(M){M&&(L(e),L(s),L(n)),g&&g.d(),h&&h.d(),v.d()}}}var M_="system3-relay";function Gs(o){return o.startsWith("v")?o.substring(1):o}function E_(o){return(o==null?void 0:o.prerelease)===!0}function HM(o,e,t){let r,s,n,a,i,l,f,u,d,m,g,h,_,w,v,M,R,{plugin:D}=e,{version:E}=e,O=ve(D.manifest.version),A=ve(!1),F=ve(""),V=ve(""),q=ve(!1);me(o,q,Y=>t(8,u=Y));let Z=ve(!1);me(o,Z,Y=>t(6,l=Y));let j=ve(null);me(o,j,Y=>t(12,h=Y));let K=ve("");me(o,K,Y=>t(11,g=Y));let W=ve(null),te=ve(null);me(o,te,Y=>t(17,R=Y));let Te=ve(!1);me(o,Te,Y=>t(16,M=Y));let ie=ve(null);me(o,ie,Y=>t(5,n=Y));let Pe=ve(null);me(o,Pe,Y=>t(4,s=Y));let Ke=ve(null);me(o,Ke,Y=>t(58,i=Y));let Oe=ve(null);me(o,Oe,Y=>t(57,a=Y));let pe=ve(!1),fe=!1,oe=ve(null);me(o,oe,Y=>t(15,v=Y));let Ne=D.app;function It(Y){let ue=Gs(Y),nt=Gs(D.version);return ue===nt}let Wt=ve({});me(o,Wt,Y=>t(14,w=Y));let zt=ve({});me(o,zt,Y=>t(13,_=Y));let dt=ve(D.releaseSettings.get().channel);me(o,dt,Y=>t(10,m=Y));let gt=ve(!1);me(o,gt,Y=>t(7,f=Y));function pt(Y){return Ge(this,void 0,void 0,function*(){gt.set(Y);let ue=D.releaseSettings.get().channel;dt.set(ue),D.releaseSettings.update(nt=>Object.assign(Object.assign({},nt),{automaticUpdates:Y})),st(ue)})}sr(()=>{aa(),Kt(),!E&&!r.some(Y=>{Y.tag_name,D.version})?(D.releaseSettings.update(Y=>Object.assign(Object.assign({},Y),{automaticUpdates:!1})),dt.set(null)):dt.set(D.releaseSettings.get().channel),j.set({version:E||D.version,name:D.manifest.name,author:D.manifest.author,description:D.manifest.description,isDesktopOnly:D.manifest.isDesktopOnly,minAppVersion:D.manifest.minAppVersion}),K.set(E||D.version)});function Kt(){return Ge(this,void 0,void 0,function*(){pe.set(!0);try{let Y=yield D.updateManager.fetchRepoManifest("manifest.json");Y&&(ie.set(Y),Ke.set(Y.version));let ue=yield D.updateManager.fetchRepoManifest("manifest-beta.json");ue&&(Pe.set(ue),Oe.set(ue.version))}catch(Y){D.error("Error fetching main branch manifests:",Y)}finally{pe.set(!1)}})}let gs=co(D.updateManager,()=>D.updateManager.releases);me(o,gs,Y=>t(3,r=Y));let js=co([gs,Z],()=>r&&r.length>0?Ys(l).sort():[]);me(o,js,Y=>t(9,d=Y)),r.forEach(Y=>Ge(void 0,void 0,void 0,function*(){try{let ue=yield D.updateManager.fetchReleaseManifest(Y);ue&&Wt.update(nt=>Object.assign(Object.assign({},nt),{[Y.tag_name]:ue.version}))}catch(ue){}}));function aa(){return Ge(this,void 0,void 0,function*(){q.set(!0);try{yield D.updateManager.getReleases(),Ys(l)}catch(Y){D.error("Error refreshing GitHub releases:",Y)}finally{q.set(!1)}})}function ia(Y){return Ge(this,void 0,void 0,function*(){let ue=document.createElement("div");return yield R_.MarkdownRenderer.render(D.app,Y,ue,"",D),ue.innerHTML})}function Ys(Y){return Y?r:E?r.filter(ue=>E===Gs(ue.tag_name)):r.filter(ue=>{let nt=ue.tag_name;return la(ue)})}function la(Y){if(Y.prerelease||Y.draft)return!1;if(Y.latest||Gs(Y.tag_name)===i||Gs(Y.tag_name)===a)return!0;let ue=new Date(Y.created_at),nt=new Date;return nt.setMonth(nt.getMonth()-3),ue>nt}function Ir(Y){return Ge(this,void 0,void 0,function*(){te.set(null),W.set(Y);try{let ue=mo(Y);if(!ue){te.set(`Could not find release for ${Y}`);return}let nt=yield D.updateManager.fetchReleaseManifest(ue);nt?(j.set(nt),K.set(Y),Te.set(!1),Wt.update(ho=>Object.assign(Object.assign({},ho),{[Y]:nt.version}))):te.set(`Could not find manifest for ${Y}`)}catch(ue){D.error("Error fetching manifest:",ue),te.set(`Error fetching manifest: ${ue.message||"Unknown error"}`)}finally{W.set(null)}})}function st(Y){let ue=Y==="stable"?n:s;if(ue){let nt=ue.version;dt.set(Y);let ho=[...r.values()].find(ir=>Gs(ir.tag_name)===Gs(nt));ho?(Y==="stable"?zt.update(ir=>Object.assign(Object.assign({},ir),{[ho.tag_name]:"stable-alias"})):zt.update(ir=>Object.assign(Object.assign({},ir),{[ho.tag_name]:"beta-alias"})),Ir(ho.tag_name)):(j.set(ue),K.set(nt),Y==="stable"?zt.update(ir=>Object.assign(Object.assign({},ir),{[nt]:"stable-alias"})):zt.update(ir=>Object.assign(Object.assign({},ir),{[nt]:"beta-alias"})),Te.set(!1))}else te.set(`Could not find ${Y} manifest`)}function Gt(){j.set(null),K.set(""),te.set(null)}function mo(Y){return[...r.values()].find(ue=>ue.tag_name===Y)}function ys(Y){return Ge(this,void 0,void 0,function*(){try{oe.set(Y);let ue=mo(Y);if(!ue)throw new Error(`Could not find release for ${Y}`);let nt=yield D.updateManager.fetchReleaseManifest(ue);if(!nt)throw new Error(`Could not find manifest for ${Y}`);t(2,fe=!0),yield Ne.plugins.installPlugin(D.repo,Y,nt),yield Ne.plugins.disablePlugin(M_),yield Ne.plugins.enablePlugin(M_)}catch(ue){console.error(`Error installing version ${Y}:`,ue),D&&D.error(`Error installing version ${Y}:`,ue)}finally{D&&(t(2,fe=!1),oe.set(null))}})}let _t=Y=>It(Y.tag_name),ca=()=>{pt(!f)},le=Y=>{(Y.key==="Enter"||Y.key===" ")&&pt(!f)},Me=()=>{Z.update(Y=>!Y)},ke=Y=>{(Y.key==="Enter"||Y.key===" ")&&Z.update(ue=>!ue)},vt=()=>{D.releaseSettings.update(Y=>({...Y,channel:"stable"})),dt.set("stable"),st("stable")},Lr=Y=>{(Y.key==="Enter"||Y.key===" ")&&(D.releaseSettings.update(ue=>({...ue,channel:"stable"})),dt.set("stable"),st("stable"))},Js=()=>{D.releaseSettings.update(Y=>({...Y,channel:"beta"})),dt.set("beta"),st("beta")},xs=Y=>{(Y.key==="Enter"||Y.key===" ")&&(D.releaseSettings.update(ue=>({...ue,channel:"beta"})),dt.set("beta"),st("beta"))},Hc=()=>{dt.set(null),j.set({version:D.manifest.version,name:D.manifest.name,author:D.manifest.author,description:D.manifest.description,isDesktopOnly:D.manifest.isDesktopOnly,minAppVersion:D.manifest.minAppVersion}),K.set(D.version),Te.set(!1)},_i=Y=>{(Y.key==="Enter"||Y.key===" ")&&(dt.set(null),j.set({version:D.manifest.version,name:D.manifest.name,author:D.manifest.author,description:D.manifest.description,isDesktopOnly:D.manifest.isDesktopOnly,minAppVersion:D.manifest.minAppVersion}),K.set(D.version),Te.set(!1))},Yt=Y=>{dt.set(null),Ir(Y.tag_name)},vi=(Y,ue)=>{(ue.key==="Enter"||ue.key===" ")&&(dt.set(null),Ir(Y.tag_name))},fa=async()=>{ys(g)};return o.$$set=Y=>{"plugin"in Y&&t(0,D=Y.plugin),"version"in Y&&t(1,E=Y.version)},[D,E,fe,r,s,n,l,f,u,d,m,g,h,_,w,v,M,R,q,Z,j,K,te,Te,ie,Pe,Ke,Oe,oe,It,Wt,zt,dt,gt,pt,gs,js,ia,Ir,st,Gt,mo,ys,_t,ca,le,Me,ke,vt,Lr,Js,xs,Hc,_i,Yt,vi,fa]}var Lm=class extends X{constructor(e){super(),ee(this,e,HM,NM,Q,{plugin:0,version:1},yM,[-1,-1,-1])}},O_=Lm;var wi=class extends U_.Modal{constructor(t,r,s){super(t);this.plugin=r;this.version=s}onOpen(){let{contentEl:t}=this;this.component=new O_({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var VM={debugging:!1},qM={release:{channel:"stable",automaticUpdates:!1},sharedFolders:[],...Ll,...VM},Nc=class extends N_.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.5.1";this.repo="No-Instructions/Relay"}enableDebugging(t){kl(!0),console.warn("RelayInstances",Et),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){kl(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return kl(r),t&&this.debugSettings.update(s=>({...s,debugging:r})),r}buildApiUrl(t){return"https://api.system3.md"+t}async onload(){this.appId=this.app.appId;let t=qt.moment.now();Et.set(this,"plugin"),this.timeProvider=new On,this.register(()=>{this.timeProvider.destroy()}),Cy(new Oc(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new Rc,this.toast=Ay(this.notifier),this.debug=Ae("[System 3][Relay]","debug"),this.log=Ae("[System 3][Relay]","log"),this.warn=Ae("[System 3][Relay]","warn"),this.error=Ae("[System 3][Relay]","error"),this.settings=new Ul(this,qM),await this.settings.load(),this.featureSettings=new wr(this.settings,"(enable*)"),this.debugSettings=new wr(this.settings,"(debugging)"),this.folderSettings=new wr(this.settings,"sharedFolders"),this.releaseSettings=new wr(this.settings,"release"),Rt.getInstance().setSettings(this.featureSettings),this.settingsTab=new hc(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new Bc(this,this.timeProvider,this.releaseSettings),et().enableAutomaticUpdatesOption&&this.updateManager.applyAutomaticUpdates(),this.debugSettings.subscribe(n=>{n.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let a=new Mc(this.app,()=>{this.reload()});this.openModals.push(a),a.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let a=new Uc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let a=new Ec(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let a=new wi(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let a=new $c(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync status",callback:()=>{let a=new bi(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(a),a.open()}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))}),this.addCommand({id:"reload",name:"Reload Relay",callback:()=>{this.reload()}}),this.updateManager.subscribe(()=>{let n=this.updateManager.getNewRelease();n?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${n.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(n)}}),this.log(`Update available: v${this.version} \u2192 ${n.tag_name}`)):this.removeCommand("update-plugin")}),this.vault=this.app.vault;let s=this.vault.getName();this.fileManager=this.app.fileManager,this.hashStore=new $l(this.appId),this.loginManager=new yc(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this)),this.relayManager=new Dc(this.loginManager),this.sharedFolders=new Nl(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new Pc(this.loginManager,this.timeProvider,s,3),this.networkStatus=new cw(this.timeProvider,"https://api.system3.md/health?version=0.5.1"),this.backgroundSync=new Xl(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new qt.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new tc(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),$_.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(n=>n.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(Jn,n=>new ec(n)),this.registerEvent(this.app.workspace.on("file-menu",(n,a)=>{if(a instanceof qt.TFolder){let i=this.sharedFolders.find(l=>l.path===a.path);if(!i)return;i.relayId&&n.addItem(l=>{l.setTitle(i.connected?"Disconnect":"Connect").setIcon("satellite").onClick(()=>{i.connected?(i.shouldConnect=!1,i.disconnect()):(i.shouldConnect=!0,i.connect()),this._liveViews.refresh("folder connection toggle")})}),n.addItem(l=>{l.setTitle("Folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${i.guid}&relay=${i.relayId}`)})}),i.relayId&&et().enableSyncModal&&n.addItem(l=>{l.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let f=new bi(this.app,this.backgroundSync,this.sharedFolders,i.guid);this.openModals.push(f),f.open()})}),et().enableSyncMenu&&i.relayId&&i.connected&&n.addItem(l=>{l.setTitle("Sync").setIcon("folder-sync").onClick(()=>{i.netSync()})})}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=qt.moment.now()-t})}async reload(){let t=this.manifest.id,r=this.app.plugins;await r.disablePlugin(t),await r.enablePlugin(t)}_createSharedFolder(t,r,s,n){let a=new wr(this.settings,`sharedFolders/[guid=${r}]`),i={guid:r,path:t};return s&&(i.relay=s),a.update(f=>({...f,path:t,guid:r,...s?{relay:s}:{},sync:f.sync?f.sync:cs.defaultFlags}),!0),new Bl(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.app.metadataCache,this.hashStore,this.backgroundSync,a,s,n)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,s,n;let t=this;try{if(this.webviewerPatched)return;let a=(s=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:s.webviewer;if(!((n=a==null?void 0:a.instance)!=null&&n.options)||!a.enabled){this.warn("Webviewer plugin not found or not initialized");return}let i=a.instance.options,l=Object.getOwnPropertyDescriptor(i,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(i,"openExternalURLs",{get(){var m;let d=window.event;if((d==null?void 0:d.type)==="open-url"&&((m=d==null?void 0:d.detail)!=null&&m.url)){let g=d.detail.url;for(let h of t.interceptedUrls)if(typeof h=="string"&&g.startsWith(h)||h instanceof RegExp&&h.test(g))return t.log("Intercepted webviewer, opening in default browser",d.detail.url),!1}return l.value},set(d){l.value=d},configurable:!0}),this.register(()=>{Object.defineProperty(i,"openExternalURLs",l)});let f=this.loginManager.webviewIntercept();this.debug("Intercepting Webviewer for URL pattern",f.source),this.interceptedUrls.push(f);let u=new RegExp("https://api.system3.md".replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",u.source),this.interceptedUrls.push(u),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(a){this.error("Failed to patch webviewer:",a)}}setup(){this.folderNavDecorations=new sc(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=Ae("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",f=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Ae("[System 3][Relay][Vault]","log"),s=f=>{let u=f.error;u&&u instanceof Ks&&this.toast(u)};window.addEventListener("error",s,!0),this.register(()=>window.removeEventListener("error",s,!0));let n=f=>{f.reason instanceof Ks&&this.toast(f.reason)},a=f=>n(f);window.addEventListener("unhandledrejection",a,!0),this.register(()=>window.removeEventListener("unhandledrejection",a,!0)),this.registerEvent(this.app.vault.on("create",f=>{let u=this.sharedFolders.lookup(f.path);if(u){let d=u.getVirtualPath(f.path);u.placeHold([f]).length>0?u.uploadFile(d):u.whenReady().then(g=>{g.getFile(d)})}})),this.registerEvent(this.app.vault.on("delete",f=>{if(f instanceof qt.TFolder){let d=this.sharedFolders.find(m=>m.path===f.path);if(d){this.sharedFolders.delete(d);return}}let u=this.sharedFolders.lookup(f.path);u&&(r("Delete",f.path),u.whenReady().then(d=>{d.proxy.deleteFile(f.path)}))})),this.registerEvent(this.app.vault.on("rename",(f,u)=>{if(f instanceof qt.TFolder){let h=this.sharedFolders.find(_=>_.path==u);if(h){h.move(f.path),this.sharedFolders.update();return}}let d=this.sharedFolders.lookup(u),m=this.sharedFolders.lookup(f.path),g=d||m;d&&m?(r("Rename",f.path,u),d.renameFile(f,u),m.renameFile(f,u),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):g&&(r("Rename",f,u),g.renameFile(f,u),this._liveViews.refresh("rename"),this.folderNavDecorations.refresh())})),this.registerEvent(this.app.vault.on("modify",f=>{let u=this.sharedFolders.lookup(f.path);if(u){r("Modify",f.path),et().enableDesyncPill&&this.folderNavDecorations.quickRefresh();let d=u.proxy.getFile(f.path);d&&$o(d)&&d.sync(),this.app.metadataCache.trigger("resolve",d)}}));let i=this,l=ii(qt.MarkdownView.prototype,{onUnloadFile(f){return function(u){return i._liveViews.wipe(),f.call(this,u)}}});this.register(l),this.patchWebviewer(),Ro(ao.enableNewLinkFormat,()=>{let f=ii(qt.MetadataCache.prototype,{fileToLinktext(u){return function(d,m,g){if(i.sharedFolders.lookup(d.path)){g===void 0&&(g=!0);let _=d.extension==="md"&&g?d.basename:d.name,w=(0,qt.normalizePath)(d.name),v=i.app.metadataCache.uniqueFileLookup.get(w.toLowerCase());if(v&&v.length===1&&v[0]===d)return _;{let M=d.extension==="md"&&g?d.path.slice(0,d.path.length-3):d.path,R=(0,B_.relative)(m,M);return R==="../"+_?"./"+_:R}}return u.call(this,d,m,g)}}});this.register(f)}),this.registerObsidianProtocolHandler("relay/settings/relays",async f=>{let u=f,d=new URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async f=>{let u=f,d=new URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)}),this.registerObsidianProtocolHandler("relay/upgrade",async f=>{var m;let d=(m=f.version)==null?void 0:m.trim();this.installVersion(d)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new wi(this.app,this,t);this.openModals.push(r),r.open()}removeCommand(t){if((0,qt.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,s=r.commands,n=`system3-relay:${t}`;(s.commands.hasOwnProperty(n)||r.hotkeyManager.removeDefaultHotkeys(n))&&(delete s.commands[n],delete s.editorCommands[n])}}onunload(){var t,r,s,n,a,i,l,f,u,d,m,g,h,_;(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(Jn),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(s=this._liveViews)==null||s.destroy(),this._liveViews=null,(n=this.relayManager)==null||n.destroy(),this.relayManager=null,(a=this.tokenStore)==null||a.stop(),(i=this.tokenStore)==null||i.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(f=this.networkStatus)==null||f.stop(),(u=this.networkStatus)==null||u.destroy(),this.networkStatus=null,this.openModals.forEach(w=>{w.close()}),this.openModals.length=0,(d=this.sharedFolders)==null||d.destroy(),this.sharedFolders=null,(m=this.settingsTab)==null||m.destroy(),this.settingsTab=null,(g=this.loginManager)==null||g.destroy(),this.loginManager=null,(h=this.backgroundSync)==null||h.destroy(),this.backgroundSync=null,this.hashStore.destroy(),this.hashStore=null,(_=this.app)==null||_.workspace.updateOptions(),this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.interceptedUrls.length=0,Rt.destroy(),Mr.destroy(),this.notifier=null,this.toast=null,Dy(),vu()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

moment/moment.js:
  (*! moment.js *)
  (*! version : 2.29.4 *)
  (*! authors : Tim Wood, Iskren Chernev, Moment.js contributors *)
  (*! license : MIT *)
  (*! momentjs.com *)

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-up-down.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-check-big.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/clock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/download.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/info.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/pause.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/play.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/refresh-cw.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/triangle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/upload.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */